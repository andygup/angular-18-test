import{a as K,b as _}from"./chunk-6CNLUW6T.js";import{a as U}from"./chunk-AWF4Z7TU.js";import{b as m,c as $,d as nn,e as en,f as rn,g as j,h as M,k as tn,l as on}from"./chunk-IT6EB7VG.js";import{b as E,d as O,g as R}from"./chunk-Z6XPPWSB.js";import{a as S}from"./chunk-T6U45BGW.js";import{b as g}from"./chunk-AIOXCJIZ.js";import{a as y,c as Z}from"./chunk-BVW6ULEA.js";import{a as X}from"./chunk-7C6Z24SS.js";import{n as Q}from"./chunk-MJ4RSERD.js";import{d as F,e as w,g as C,q as J}from"./chunk-5QLB7ZJ7.js";import{k as H}from"./chunk-BNUHB4AP.js";import{F as k,I as Y,a as L,n as W,z as d}from"./chunk-ZGLJFDS6.js";import{j as I}from"./chunk-UHTPPTOJ.js";import{P as B,V as D}from"./chunk-3SBMUUA6.js";import{c as z}from"./chunk-RMOOROEO.js";import{s as h}from"./chunk-3DV77WOO.js";function an(){return h.getLogger("esri.geometry.Mesh")}function ln(n){return n.origin!=null}function Nn(n){return ln(n.vertexSpace)}function bn(n,e){if(!ln(n))return null;let[r,o,t]=n.origin;return new I({x:r,y:o,z:t,spatialReference:e})}function Gn(n,e){let{x:r,y:o,z:t,spatialReference:i}=n,a=[r,o,t??0];return e?.geographic!==void 0&&(z(an(),"option: geographic",{replacement:"use vertexSpace option instead",version:"4.29",warnOnce:!0}),e.vertexSpace&&an().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),(e?.vertexSpace??mn(e?.geographic)??gn(i))==="local"?new _({origin:a}):new K({origin:a})}function gn(n){return n.isGeographic||n.isWebMercator?"local":"georeferenced"}function mn(n){return n==null?void 0:n?"local":"georeferenced"}function sn(n,e){return n.type===e.type&&(n.origin===e.origin||n.origin!=null&&e.origin!=null&&Y(n.origin,e.origin))}var f=()=>h.getLogger("esri.geometry.support.meshUtils.vertexSpaceConversion");function _n(n,e,{vertexSpace:r,spatialReference:o}){if(r.type==="georeferenced"){let u=n;if(!U(e,u,o))return!1;let{origin:c}=r;return W(n,u,c),!0}let t=g(o),i=n;if(!U(e,i,t))return!1;let{origin:a}=r,l=un;if(!S(o,a,l,t))return!1;let s=F(un,l);return s!=null&&(k(n,i,s),!0)}function $n(n,e,r){let{vertexSpace:o,transform:t,vertexAttributes:i}=n,a=P(n.spatialReference,r,v.SOURCE|v.TARGET);if(sn(o,e)&&(!t||J(t.localMatrix,Z))&&H(a,1)){let{position:l,normal:s,tangent:u}=i,c=r?.allowBufferReuse;return{position:c?l:l.slice(),normal:c?s:s?.slice(),tangent:c?u:u?.slice()}}switch(n.vertexSpace.type){case"local":return e.type==="local"?An(n,n.vertexSpace,e.origin,r):xn(n,n.vertexSpace,e.origin,r);case"georeferenced":return e.type==="local"?Sn(n,n.vertexSpace,e.origin,r):vn(n,n.vertexSpace,e.origin,r)}}function vn({vertexAttributes:n,transform:e,spatialReference:r},{origin:o},t,i){let{position:a,normal:l,tangent:s}=e?N(n,e.localMatrix):n,u=new Float64Array(a.length),c=a;if(o&&(c=R(u,c,o)),t){let A=d(fn,t);c=R(u,c,A)}P(r,i,v.NONE);let x=i?.allowBufferReuse;return{position:c!==n.position||x?c:c.slice(),normal:l!==n.normal||x?l:l?.slice(),tangent:s!==n.tangent||x?s:s?.slice()}}function xn({spatialReference:n,vertexAttributes:e,transform:r},{origin:o},t,i){let a=g(n);if(!S(n,o,p,a))return m(f(),n,a),null;r&&w(p,p,r.localMatrix),pn(p,n,i,v.SOURCE);let l=new Float64Array(e.position.length),s=Tn(e.position,p,n,l);if(!s)return null;let u=hn(s,l,e.normal,p,n);if(e.normal&&!u)return null;let c=Fn(s,l,e.tangent,p,n);if(e.tangent&&!c)return null;if(t){let x=d(fn,t);R(s,s,x)}return{position:s,normal:u,tangent:c}}function Sn({vertexAttributes:n,spatialReference:e,transform:r},{origin:o},t,i){let a=g(e);if(!S(e,t,p,a))return m(f(),e,a),null;let l=1/P(e,i,v.TARGET);C(p,p,[l,l,l]);let s=F(T,p),{position:u,normal:c,tangent:x}=Rn(n,o,r),A=new Float64Array(u.length),b=wn(u,e,s,A);if(!b)return null;let G=Q(Pn,s),V=yn(c,u,A,e,G,c!==n.normal?c:void 0);if(!V&&c)return null;let q=En(x,u,A,e,G,x!==n.tangent?x:void 0);return!q&&x?null:{position:b,normal:V,tangent:q}}function Rn(n,e,r){if(!e)return n;if(!r){let{position:t,normal:i,tangent:a}=n;return{position:R(new Float64Array(t.length),t,e),tangent:a,normal:i}}let o=N(n,r.localMatrix);return R(o.position,o.position,e),o}function An({vertexAttributes:n,spatialReference:e,transform:r},{origin:o},t,i){let a=g(e);if(!S(e,o,p,a))return m(f(),e,a),null;if(r&&w(p,p,r.localMatrix),!S(e,t,T,a))return m(f(),a,e),null;F(T,T);let l=w(p,T,p);return pn(l,e,i,v.SOURCE|v.TARGET),N(n,l)}function N(n,e){let r=new Float64Array(n.position.length);E(r,n.position,e);let o=n.normal?new Float32Array(n.normal.length):null,t=n.tangent?new Float32Array(n.tangent.length):null;return o&&n.normal&&j(n.normal,o,e),t&&n.tangent&&M(n.tangent,t,e),{position:r,normal:o,tangent:t}}function Tn(n,e,r,o){E(o,n,e);let t=new Float64Array(n.length);return rn(o,t,r)?t:(m(f(),g(r),r),null)}function hn(n,e,r,o,t){if(r==null)return null;let i=new Float32Array(r.length);return j(r,i,o),nn(i,n,e,t,i)?i:(m(f(),g(t),t),null)}function Fn(n,e,r,o,t){if(r==null)return null;let i=new Float32Array(r.length);return M(r,i,o),on(i,n,e,t,i)?i:(m(f(),g(t),t),null)}function pn(n,e,r,o){let t=P(e,r,o);t!==1&&C(n,n,[t,t,t])}function P(n,e,r){let o=!!(r&v.SOURCE),t=!!(r&v.TARGET),i=e?.sourceUnit,a=e?.targetUnit;if(!i&&!a)return 1;let l=cn(i,n);!o&&i&&l!==1&&(f().warn("source unit conversion not supported"),l=1);let s=1/cn(a,n);return!t&&a&&s!==1&&(f().warn("target unit conversion not supported"),s=1),l*s}function wn(n,e,r,o){let t=en(n,e,o);if(!t)return m(f(),e,g(e)),null;let i=new Float64Array(t.length);return E(i,t,r),i}function yn(n,e,r,o,t,i){if(n==null)return null;let a=i??new Float32Array(n.length);return $(n,e,r,o,a)?(O(a,a,t),a):(m(f(),o,g(o)),null)}function En(n,e,r,o,t,i){if(n==null)return null;let a=i??new Float32Array(n.length);return tn(n,e,r,o,a)?(O(a,a,t,4),a):(m(f(),o,g(o)),null)}function cn(n,e){if(n==null)return 1;let r=D(e);return 1/B(r,"meters",n)}var p=y(),T=y(),Pn=X(),fn=L(),un=y(),v;(function(n){n[n.NONE=0]="NONE",n[n.SOURCE=1]="SOURCE",n[n.TARGET=2]="TARGET"})(v||(v={}));export{ln as a,Nn as b,bn as c,Gn as d,_n as e,$n as f,cn as g};
