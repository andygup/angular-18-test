import{a as Ae}from"./chunk-XQF54ERT.js";import{a as Ue}from"./chunk-WHG2OP5Q.js";import{a as Ee}from"./chunk-ZCOQCU2F.js";import{a as E,d as Ce}from"./chunk-KWYL2RA7.js";import{a as Ne}from"./chunk-NRYRRRU5.js";import{a as Te}from"./chunk-O3JFLEEW.js";import{a as ne}from"./chunk-FOMR7EMA.js";import{a as oe,c as se,d as Q,e as Se,f as ke,g as ie,i as ae}from"./chunk-C46XASX2.js";import{a as K}from"./chunk-NI2H25WT.js";import{d as ve}from"./chunk-SEBAYBYC.js";import{b as re}from"./chunk-CGEI3ID7.js";import{f as Ie}from"./chunk-L2DEVDHE.js";import{a as W}from"./chunk-RU7UW4IO.js";import{a as te}from"./chunk-4R2OFZPD.js";import{a as B}from"./chunk-FKQYBEPG.js";import{t as be}from"./chunk-UHTPPTOJ.js";import{b as ee}from"./chunk-LTDZH3EN.js";import{a as ge,b as Y}from"./chunk-B66V4PSA.js";import{_ as v,g as we}from"./chunk-AANS6QE5.js";import{H as n,K as fe,Q as he,S as H}from"./chunk-RMOOROEO.js";import{S as w}from"./chunk-ZP7G4HN4.js";import{a}from"./chunk-W3WDPWBE.js";import{g as z,p as ye}from"./chunk-43GG6PFR.js";import{s as ce,u as M}from"./chunk-3DV77WOO.js";import{a as b,b as A,f as pe,g as u}from"./chunk-3T7TAUC2.js";var Fe=Y()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"}),O=class extends Ee{constructor(o){super(o),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}checkJobStatus(o){return u(this,null,function*(){let e=A(b({},o),{query:{f:"json"}}),{data:r}=yield v(this.statusUrl,e);return this.read(r),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this})}waitForJobCompletion(){return u(this,arguments,function*(o={}){let{interval:e=1e3,statusCallback:r}=o;return new Promise((t,i)=>{this._clearTimer();let s=setInterval(()=>{this._timer||i(z()),this.checkJobStatus().then(l=>{let{status:d}=l;switch(this.status=d,d){case"job-succeeded":this._clearTimer(),t(this);break;case"job-waiting":case"job-executing":r&&r(this)}},l=>{this._clearTimer(),i(l)})},e);this._timer=s})})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};a([n()],O.prototype,"editsResolver",void 0),a([n({type:String,json:{write:!0}})],O.prototype,"statusUrl",void 0),a([W(Fe)],O.prototype,"status",void 0),a([n({type:Date,json:{type:Number,write:{writer:(o,e)=>{e.submissionTime=o?o.getTime():null}}}})],O.prototype,"submissionTime",void 0),a([n({type:Date,json:{type:Number,write:{writer:(o,e)=>{e.lastUpdatedTime=o?o.getTime():null}}}})],O.prototype,"lastUpdatedTime",void 0),O=a([w("esri.networks.support.TopologyValidationJobInfo")],O);var Oe=O;function Re(o,e){return u(this,null,function*(){if(o==="Utility Network Layer"){let{default:r}=yield import("./chunk-SSBY25DY.js");return new r({layerUrl:e})}return null})}function je(o){return u(this,null,function*(){let e="portalItem"in o?o:{portalItem:o};!e.portalItem||e.portalItem instanceof te||(e=A(b({},e),{portalItem:new te(e.portalItem)}));let r=e.portalItem;if(yield r.load(),r.type!=="Feature Service")throw new M("portal:unknown-item-type","Unknown item type '${type}'",{type:r.type});let t=r.url,i=yield v(t,{responseType:"json",query:{f:"json"}}),s="Network Layer";if(i.data.type?.includes(s))return Re(i.data.type,t);if(i.data.layers){let l=i.data.layers.find(d=>d.type.includes(s));if(l){let d=`${t}/${l.id}`;return Re(l.type,d)}}return null})}var p=class extends Te(B){static fromPortalItem(o){return je(o)}constructor(o){super(o),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this.gdbVersion=null,this.historicMoment=null,this._applyEditsHandler=e=>{let{serviceUrl:r,gdbVersion:t,result:i}=e,s=r===this.featureServiceUrl,l=ae(r,t,this.gdbVersion);s&&l&&i.then(d=>{Q(r,t)&&(this.historicMoment=d.historicMoment)})},this._updateMomentHandler=e=>{let{serviceUrl:r,gdbVersion:t,moment:i}=e,s=r===this.featureServiceUrl,l=ae(r,t,this.gdbVersion);s&&l&&(this.historicMoment=i)},this.when().then(()=>{this.addHandles([Se(this._applyEditsHandler),ke(this._updateMomentHandler)])},()=>{})}initialize(){this.when().catch(o=>{ye(o)||ce.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:o})})}get datasetName(){return this.dataElement?.name??null}get owner(){return this.dataElement?.userIdentity??null}get schemaGeneration(){return this.dataElement?.schemaGeneration??null}get parsedUrl(){return we(this.layerUrl)}get featureServiceUrl(){return re(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return re(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}load(o){return u(this,null,function*(){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),o)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,o)),this})}getLayerIdBySourceId(o){if(this.dataElement){let e=this.dataElement.domainNetworks;for(let r of e){for(let t of r.edgeSources??[])if(t.sourceId===o)return t.layerId;for(let t of r.junctionSources??[])if(t.sourceId===o)return t.layerId}return null}return null}queryNamedTraceConfigurations(o,e){return u(this,null,function*(){let[{queryNamedTraceConfigurations:r},{default:t}]=yield Promise.all([import("./chunk-K5C4QJFJ.js"),import("./chunk-EQNKHVTE.js")]),i=this.networkServiceUrl,s=t.from(o);return(yield r(i,s,b({},e)))?.namedTraceConfigurations})}validateTopology(o,e){return u(this,null,function*(){if(!o.validateArea)throw new M("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");let[{validateNetworkTopology:r},{default:t}]=yield Promise.all([import("./chunk-HLYIHLCO.js"),import("./chunk-TRYSIQDG.js")]),i=t.from(o);Q(this.featureServiceUrl,this.gdbVersion||null)?(i.sessionID=oe,yield se(this.featureServiceUrl,this.gdbVersion,!0)):i.sessionID=null,i.gdbVersion=this.gdbVersion;let s=this.networkServiceUrl,l=this.featureServiceUrl,d=ie(l,null,this.gdbVersion,!0),h=yield r(s,i,b({},e));if(h?.serviceEdits){let c=[];for(let m of h.serviceEdits){let{editedFeatures:y}=m,T=y?.spatialReference?new ee(y.spatialReference):null;c.push({layerId:m.layerId,editedFeatures:{adds:y?.adds?.map(g=>X(g,T))||[],updates:y?.updates?.map(g=>({original:X(g[0],T),current:X(g[1],T)}))||[],deletes:y?.deletes?.map(g=>X(g,T))||[],spatialReference:T}})}d.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:c,exceededTransferLimit:!1,historicMoment:h.moment})}return h})}submitTopologyValidationJob(o,e){return u(this,null,function*(){let r=null;if(!o.validateArea)throw new M("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){let c=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");r=(yield v(c,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}let[{submitValidateNetworkTopologyJob:t},{default:i}]=yield Promise.all([import("./chunk-HLYIHLCO.js"),import("./chunk-TRYSIQDG.js")]),s=i.from(o);Q(this.featureServiceUrl,this.gdbVersion||null)?(s.sessionID=oe,yield se(this.featureServiceUrl,this.gdbVersion,!0)):s.sessionID=null,s.gdbVersion=this.gdbVersion||r;let l=this.networkServiceUrl,d=this.featureServiceUrl?ie(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,h=yield t(l,s,b({},e));return new Oe({statusUrl:h,editsResolver:d})})}_fetchLayerMetaData(o,e){return u(this,null,function*(){let r=yield v(o,b({responseType:"json",query:{f:"json"}},e));this.sourceJSON=r.data,this.read(r.data,{origin:"service"})})}_fetchDataElement(o,e,r){return u(this,null,function*(){if(this.dataElement)return;let t=yield v(`${o}/queryDataElements`,b({responseType:"json",query:{layers:JSON.stringify([e]),f:"json"}},r)).then(i=>i.data.layerDataElements?.[0]);t&&this.read(t,{origin:"service"})})}};function X(o,e){return new K({attributes:o.attributes,geometry:Ie(A(b({},o.geometry),{spatialReference:e}))})}a([n({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],p.prototype,"id",void 0),a([n({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],p.prototype,"title",void 0),a([n({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],p.prototype,"layerUrl",void 0),a([n({type:Object,json:{origins:{service:{read:!0}},read:!1}})],p.prototype,"dataElement",void 0),a([n({type:be,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],p.prototype,"fullExtent",void 0),a([n({type:ee,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],p.prototype,"spatialReference",void 0),a([n({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],p.prototype,"type",void 0),a([n({readOnly:!0})],p.prototype,"datasetName",null),a([n({readOnly:!0})],p.prototype,"owner",null),a([n({readOnly:!0})],p.prototype,"schemaGeneration",null),a([n({readOnly:!0})],p.prototype,"parsedUrl",null),a([n({readOnly:!0})],p.prototype,"featureServiceUrl",null),a([n({readOnly:!0})],p.prototype,"networkServiceUrl",null),a([n({readOnly:!0})],p.prototype,"layerId",null),a([n()],p.prototype,"sourceJSON",void 0),a([n({readOnly:!0})],p.prototype,"networkSystemLayers",null),a([n()],p.prototype,"gdbVersion",void 0),a([n({type:Date})],p.prototype,"historicMoment",void 0),p=a([w("esri.networks.Network")],p);var Ve=p;var R=class extends he(B){constructor(o){super(o),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=v}initialize(){}load(o){return u(this,null,function*(){let e=this.layer.load(o).then(()=>this._initializeRulesTable());return this.addResolvingPromise(e),this})}getFeatureSQL(o,e){let r=o.layerId.toString(),t=o.fieldsIndex?.normalizeFieldName("assetGroup"),i=o.fieldsIndex?.normalizeFieldName("assetType"),s=t?e.attributes[t]:null,l=i?e.attributes[i]:null,d=this.rulesHash[r];if(d){let h=d.assetGroupHash[s];if(h)return h.assetTypeHash[l]||null}return null}_initializeRulesTable(){return u(this,null,function*(){let o={},e;(function(t){t[t.from=0]="from",t[t.to=1]="to",t[t.via=2]="via"})(e||(e={}));let r=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(let t of this.rules){if(t.ruleType===E.RTAttachment){this.rulesCategorized.attachment.push(t);continue}if(t.ruleType===E.RTContainment){this.rulesCategorized.containment.push(t);continue}if(t.ruleType===E.RTJunctionJunctionConnectivity){this.rulesCategorized.connectivity.push(t);continue}this.rulesCategorized.connectivity.push(t);let i=[[e.from,e.to],[e.to,e.from]];t.ruleType===E.RTEdgeJunctionEdgeConnectivity&&(i=[[e.from,e.via],[e.via,e.from],[e.to,e.via],[e.via,e.to]]);for(let s of i){let l=s.shift(),d=s.shift(),h=!1;switch(t.ruleType){case E.RTEdgeJunctionEdgeConnectivity:h=l===e.from||l===e.to;break;case E.RTJunctionEdgeConnectivity:h=l===e.to}let c=r[l],m=t[c.networkSourceId]?.layerId.toString()??"",y=t[c.assetGroupId]?.assetGroupCode?.toString(),T=t[c.assetTypeId],g=T?.assetTypeCode?.toString(),x=r[d],k=t[x.networkSourceId]?.layerId.toString()??"",$=t[x.assetGroupId]?.assetGroupCode?.toString(),J=t[x.assetTypeId],D=J?.assetTypeCode?.toString(),_=o[m]??{assetGroupHash:{}};if(!(y&&g&&$&&D))continue;let F=_.assetGroupHash[y]??{assetTypeHash:{}},f=F.assetTypeHash[g]??{};if(f[k]=f[k]??{},h){f[m]=f[m]??{};let U=`(assetgroup = ${y} AND assettype = ${g})`;f[m].anyVertex=f[m].anyVertex?`${f[m].anyVertex}`:`${U}`,J?.connectivityPolicy==="esriNECPEndVertex"&&(f[m].endVertex=f[m]?.endVertex?`${f[m].endVertex}`:`${U}`)}let I=`(assetgroup = ${$} AND assettype = ${D})`;f[k].anyVertex=f[k]?.anyVertex?`${f[k].anyVertex} OR ${I}`:`${I}`,J?.connectivityPolicy==="esriNECPEndVertex"&&(f[k].endVertex=f[k]?.endVertex?`${f[k].endVertex} OR ${I}`:`${I}`),F.assetTypeHash[g]=f,_.assetGroupHash[y]=F,o[m]=_}}this.rulesHash=o})}};a([n({constructOnly:!0})],R.prototype,"layer",void 0),a([n({constructOnly:!0})],R.prototype,"rules",void 0),a([n()],R.prototype,"rulesHash",void 0),a([n()],R.prototype,"rulesCategorized",void 0),a([n({constructOnly:!0})],R.prototype,"request",void 0),R=a([w("esri.networks.RulesTable")],R);var Ge=R;var S=class extends fe{constructor(o){super(o),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTableId=null,this.associationsTableUrl=null}};a([n({constructOnly:!0})],S.prototype,"rulesTableId",void 0),a([n({constructOnly:!0})],S.prototype,"rulesTableUrl",void 0),a([n({constructOnly:!0})],S.prototype,"subnetworksTableId",void 0),a([n({constructOnly:!0})],S.prototype,"subnetworksTableUrl",void 0),a([n({constructOnly:!0})],S.prototype,"dirtyAreasLayerId",void 0),a([n({constructOnly:!0})],S.prototype,"dirtyAreasLayerUrl",void 0),a([n({constructOnly:!0})],S.prototype,"associationsTableId",void 0),a([n({constructOnly:!0})],S.prototype,"associationsTableUrl",void 0),S=a([w("esri.networks.support.NetworkSystemLayers")],S);var _e=S;var L=class extends H{constructor(o){super(o),this.id=null,this.name=null}};a([n({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],L.prototype,"id",void 0),a([n({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],L.prototype,"name",void 0),a([n({type:Boolean,json:{write:!0}})],L.prototype,"isUpstreamTerminal",void 0),L=a([w("esri.networks.support.Terminal")],L);var Le=L;var Z=new ge({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"}),j=class extends H{constructor(o){super(o),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};a([n({type:String,json:{write:!0}})],j.prototype,"defaultConfiguration",void 0),a([n({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],j.prototype,"id",void 0),a([n({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],j.prototype,"name",void 0),a([n({type:[Le],json:{write:!0}})],j.prototype,"terminals",void 0),a([n({type:Z.apiValues,json:{type:Z.jsonValues,read:Z.read,write:Z.write}})],j.prototype,"traversabilityModel",void 0),j=a([w("esri.networks.support.TerminalConfiguration")],j);var le=j;var Pe=Y()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"}),G=class extends Ae{constructor(o){super(o),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}checkJobStatus(o){return u(this,null,function*(){let e=A(b({},o),{query:{f:"json"}}),{data:r}=yield v(this.statusUrl,e),t=r.traceResults?b(b({},r.traceResults),r):r;return this.read(t),this})}waitForJobCompletion(){return u(this,arguments,function*(o={}){let{interval:e=1e3,statusCallback:r}=o;return new Promise((t,i)=>{this._clearTimer();let s=setInterval(()=>{this._timer||i(z()),this.checkJobStatus().then(l=>{let{status:d}=l;switch(this.status=d,d){case"job-succeeded":this._clearTimer(),t(this);break;case"job-waiting":case"job-executing":r&&r(this)}},l=>{this._clearTimer(),i(l)})},e);this._timer=s})})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};a([n({type:String,json:{write:!0}})],G.prototype,"statusUrl",void 0),a([W(Pe)],G.prototype,"status",void 0),a([n({type:Date,json:{type:Number,write:{writer:(o,e)=>{e.submissionTime=o?o.getTime():null}}}})],G.prototype,"submissionTime",void 0),a([n({type:Date,json:{type:Number,write:{writer:(o,e)=>{e.lastUpdatedTime=o?o.getTime():null}}}})],G.prototype,"lastUpdatedTime",void 0),G=a([w("esri.networks.support.TraceJobInfo")],G);var xe=G;var C=class o extends Ve{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility"}get serviceTerritoryFeatureLayerId(){return this.dataElement?.serviceTerritoryFeatureLayerId??null}get networkSystemLayers(){return new _e({rulesTableId:this.sourceJSON?.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.rulesTableId}`:null,subnetworksTableId:this.sourceJSON?.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:this.sourceJSON?.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:this.sourceJSON?.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){return this.dataElement?.terminalConfigurations.map(e=>le.fromJSON(e))||[]}get domainNetworkNames(){return this.dataElement?.domainNetworks.map(e=>e.domainNetworkName)||[]}get _utilityLayerList(){let e=new Set;return this.dataElement?.domainNetworks?.map(r=>{r.edgeSources.map(t=>{e.add(t.layerId)}),r.junctionSources.map(t=>{e.add(t.layerId)})}),e}load(e){return u(this,null,function*(){return this.addResolvingPromise(pe(o.prototype,this,"load").call(this,e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this})}getTerminalConfiguration(e){let r=null,t=null,i=e.layer,s=null;if(i?.type==="feature"){if(s=i.layerId,s===null)return null}else if(i?.type!=="subtype-sublayer"||(s=i?.parent?.layerId??null,s===null))return null;let l=e.attributes;if(l==null)return null;for(let c of Object.keys(l))c.toUpperCase()==="ASSETGROUP"&&(r=e.getAttribute(c)),c.toUpperCase()==="ASSETTYPE"&&(t=e.getAttribute(c));if(!this.dataElement)return null;let d=null,h=this.dataElement.domainNetworks;for(let c of h){let m=c.junctionSources?.find(y=>y.layerId===s);if(m){let y=m.assetGroups?.find(T=>T.assetGroupCode===r);if(y){let T=y.assetTypes?.find(g=>g.assetTypeCode===t);if(T){d=T.terminalConfigurationId;break}}}}if(d!=null){let c=this.dataElement.terminalConfigurations,m=c?.find(y=>y.terminalConfigurationId===d);return m?le.fromJSON(m):null}return null}getTierNames(e){return this.dataElement?.domainNetworks.find(t=>t.domainNetworkName===e)?.tiers.map(t=>t.name)||[]}getRulesTable(){return u(this,null,function*(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),yield this._sharedRulesTable})}isUtilityLayer(e){return this._utilityLayerList.has(e.layerId)&&(e.url?.startsWith(this.featureServiceUrl)??!1)}queryAssociations(e){return u(this,null,function*(){let[{queryAssociations:r},{default:t}]=yield Promise.all([import("./chunk-USHSRKS3.js"),import("./chunk-ACXF27X6.js")]),i=t.from(e);return i.gdbVersion=this.gdbVersion,i.moment=this.historicMoment,(yield r(this.networkServiceUrl,i)).associations})}synthesizeAssociationGeometries(e){return u(this,null,function*(){let[{synthesizeAssociationGeometries:r},{default:t}]=yield Promise.all([import("./chunk-QHH5DZTK.js"),import("./chunk-FRTEGNLP.js")]),i=t.from(e);return i.gdbVersion=this.gdbVersion,i.moment=this.historicMoment,r(this.networkServiceUrl,i)})}trace(e){return u(this,null,function*(){let[{trace:r},{default:t}]=yield Promise.all([import("./chunk-JC3ELECJ.js"),import("./chunk-73DA2YGQ.js")]),i=t.from(e);return i.gdbVersion=this.gdbVersion,i.moment=this.historicMoment,r(this.networkServiceUrl,i)})}submitTraceJob(e){return u(this,null,function*(){let[{submitTraceJob:r},{default:t}]=yield Promise.all([import("./chunk-JC3ELECJ.js"),import("./chunk-73DA2YGQ.js")]),i=t.from(e);i.gdbVersion=this.gdbVersion,i.moment=this.historicMoment;let s=yield r(this.networkServiceUrl,i);return new xe({statusUrl:s})})}canAddAssociation(e){return u(this,null,function*(){let r=yield this.getRulesTable();if(!r)return!1;yield r.load();let t=(s,l)=>s?s.terminalId===1?!l?.terminalId||l?.terminalId===s.terminalId:s.terminalId===l?.terminalId:!l?.terminalId,i=(s,l)=>s.fromNetworkSource?.sourceId===l.fromNetworkElement?.networkSourceId&&s.toNetworkSource?.sourceId===l.toNetworkElement?.networkSourceId&&s.fromAssetGroup?.assetGroupCode===l.fromNetworkElement?.assetGroupCode&&s.fromAssetType?.assetTypeCode===l.fromNetworkElement?.assetTypeCode&&s.toAssetGroup?.assetGroupCode===l.toNetworkElement?.assetGroupCode&&s.toAssetType?.assetTypeCode===l.toNetworkElement?.assetTypeCode&&t(s.fromTerminal,l.fromNetworkElement)&&t(s.toTerminal,l.toNetworkElement);return e.associationType==="containment"?r.rulesCategorized.containment.some(s=>i(s,e)):e.associationType==="attachment"?r.rulesCategorized.attachment.some(s=>i(s,e)):r.rulesCategorized.connectivity.some(s=>s.viaNetworkSource?s.fromNetworkSource?.sourceId===e.fromNetworkElement?.networkSourceId&&s.viaNetworkSource?.sourceId===e.toNetworkElement?.networkSourceId&&s.fromAssetGroup?.assetGroupCode===e.fromNetworkElement?.assetGroupCode&&s.fromAssetType?.assetTypeCode===e.fromNetworkElement?.assetTypeCode&&s.viaAssetGroup?.assetGroupCode===e.toNetworkElement?.assetGroupCode&&s.viaAssetType?.assetTypeCode===e.toNetworkElement?.assetTypeCode&&t(s.fromTerminal,e.fromNetworkElement)&&t(s.viaTerminal,e.toNetworkElement)||s.viaNetworkSource?.sourceId===e.fromNetworkElement?.networkSourceId&&s.toNetworkSource?.sourceId===e.toNetworkElement?.networkSourceId&&s.viaAssetGroup?.assetGroupCode===e.fromNetworkElement?.assetGroupCode&&s.viaAssetType?.assetTypeCode===e.fromNetworkElement?.assetTypeCode&&s.toAssetGroup?.assetGroupCode===e.toNetworkElement?.assetGroupCode&&s.toAssetType?.assetTypeCode===e.toNetworkElement?.assetTypeCode&&t(s.viaTerminal,e.fromNetworkElement)&&t(s.toTerminal,e.toNetworkElement):i(s,e))})}generateAddAssociations(e){return{addFeatures:e.map(r=>new K({attributes:{fromnetworksourceid:r.fromNetworkElement?.networkSourceId,fromglobalid:r.fromNetworkElement?.globalId,fromterminalid:r.fromNetworkElement?.terminalId,tonetworksourceid:r.toNetworkElement?.networkSourceId,toglobalid:r.toNetworkElement?.globalId,toterminalid:r.toNetworkElement?.terminalId,associationtype:Ce[r.associationType],iscontentvisible:r.isContentVisible?1:0,percentalong:r.percentAlong,globalid:r.globalId}})),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:"globalid",objectIdField:"objectid"}}}generateDeleteAssociations(e){return{deleteFeatures:e.map(r=>({globalId:r.globalId})),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:"globalid",objectIdField:"objectid"}}}_loadNamedTraceConfigurationsFromNetwork(e){return u(this,null,function*(){if(this.sharedNamedTraceConfigurations?.length===0)return;let r=this.sharedNamedTraceConfigurations.map(i=>i.globalId),t=yield this.queryNamedTraceConfigurations({globalIds:r},e);for(let i of this.sharedNamedTraceConfigurations){let s=t?.find(l=>l.globalId===i.globalId);if(s){let l=s.write({},{origin:"service"});i.read(l,{origin:"service"})}}})}_createRulesTable(){return u(this,null,function*(){let e=this.networkSystemLayers.rulesTableUrl,r=new Ne({url:e});yield r.load();let t=this.dataElement?.domainNetworks;if(!t)return null;let i=t.flatMap(l=>[...l.edgeSources||[],...l.junctionSources||[]]),s=(yield Me(r)).map(l=>this._hydrateRuleInfo(r,i,l));return new Ge({layer:r,rules:s})})}_hydrateRuleInfo(e,r,t){let i=e.fieldsIndex,s=i.get("RULETYPE"),l=i.get("CREATIONDATE"),d=i.get("FROMNETWORKSOURCEID"),h=i.get("FROMASSETGROUP"),c=i.get("FROMASSETTYPE"),m=i.get("FROMTERMINALID"),y=i.get("TONETWORKSOURCEID"),T=i.get("TOASSETGROUP"),g=i.get("TOASSETTYPE"),x=i.get("TOTERMINALID"),k=i.get("VIANETWORKSOURCEID"),$=i.get("VIAASSETGROUP"),J=i.get("VIAASSETTYPE"),D=i.get("VIATERMINALID"),_=t.attributes[s.name],F=new Date(t.attributes[l.name]),f=[{networkSourceId:t.attributes[d.name],assetGroupId:t.attributes[h.name],assetTypeId:t.attributes[c.name],terminalId:t.attributes[m.name]},{networkSourceId:t.attributes[y.name],assetGroupId:t.attributes[T.name],assetTypeId:t.attributes[g.name],terminalId:t.attributes[x.name]},{networkSourceId:t.attributes[k.name],assetGroupId:t.attributes[$.name],assetTypeId:t.attributes[J.name],terminalId:t.attributes[D.name]}],I;(function(N){N[N.from=0]="from",N[N.to=1]="to",N[N.via=2]="via"})(I||(I={}));let U={ruleType:_,creationDate:F};for(let N of[I.from,I.to,I.via]){if(_!==E.RTEdgeJunctionEdgeConnectivity&&N===I.via)continue;let q=f[N],ue=r.find(P=>P.sourceId===q.networkSourceId),de=ue?.assetGroups.find(P=>P.assetGroupCode===q.assetGroupId),me=de?.assetTypes.find(P=>P.assetTypeCode===q.assetTypeId),Je=this._getTerminal(me,q),V="";switch(N){case I.from:V="from";break;case I.to:V="to";break;case I.via:V="via"}U[`${V}NetworkSource`]=ue,U[`${V}AssetGroup`]=de,U[`${V}AssetType`]=me,U[`${V}Terminal`]=Je?.toJSON()}return U}_getTerminal(e,r){let t=e?.terminalConfigurationId;return this.terminalConfigurations?.find(s=>s.id===t)?.terminals?.find(s=>s.id===r.terminalId)??null}};function Me(o){return u(this,null,function*(){let e=new ve({where:"1=1",outFields:["*"]});return(yield ne(o,e)).features})}a([n({type:[Ue],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],C.prototype,"sharedNamedTraceConfigurations",void 0),a([n({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],C.prototype,"type",void 0),a([n({readOnly:!0})],C.prototype,"serviceTerritoryFeatureLayerId",null),a([n({readOnly:!0})],C.prototype,"networkSystemLayers",null),a([n({readOnly:!0})],C.prototype,"terminalConfigurations",null),a([n({readOnly:!0})],C.prototype,"domainNetworkNames",null),C=a([w("esri.networks.UtilityNetwork")],C);var eo=C;export{eo as a};
