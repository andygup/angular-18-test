import{a as d,b,c,e as W}from"./chunk-7N5WAVRL.js";import{a as H}from"./chunk-3WO6AXJR.js";import"./chunk-ZSMLWXCC.js";import"./chunk-JOF5BLB6.js";import"./chunk-LFJ4NQ4O.js";import{a as C}from"./chunk-ASQCBKGS.js";import{a as T}from"./chunk-KM4AMTZA.js";import{c as R}from"./chunk-6ZXTJQND.js";import"./chunk-DDNVXGXG.js";import"./chunk-2TKGGTPN.js";import{a as P}from"./chunk-ME7KOLYX.js";import{a as z}from"./chunk-DGXL7ZQL.js";import{e as A}from"./chunk-SYNRDAMR.js";import{a as V}from"./chunk-VSMVTOQ2.js";import{a as K}from"./chunk-O3JFLEEW.js";import"./chunk-FVB5KK7E.js";import"./chunk-RDFYI3QE.js";import"./chunk-UAPVW6JM.js";import"./chunk-VOMQSOTD.js";import"./chunk-VYW7XM4C.js";import"./chunk-AMCDNN62.js";import"./chunk-B5IFP6FP.js";import"./chunk-LXGJGX5J.js";import"./chunk-MNGFITIF.js";import"./chunk-2XS3ER2F.js";import"./chunk-YRMBB4SJ.js";import"./chunk-LOEAA5XF.js";import"./chunk-NI2H25WT.js";import"./chunk-67EKH3Q4.js";import"./chunk-2FWBXOKU.js";import"./chunk-QW4FGXMK.js";import"./chunk-M6ZEQBQT.js";import"./chunk-3FUKLVTW.js";import"./chunk-VI3FHFCE.js";import"./chunk-W2FNMTJT.js";import"./chunk-I3S324BU.js";import"./chunk-JVM3RNQL.js";import"./chunk-OUB3GINH.js";import"./chunk-3ZAISB5N.js";import"./chunk-L3CFPONE.js";import"./chunk-AKHHPLWL.js";import"./chunk-LJMIV7GW.js";import"./chunk-WSHEBM2J.js";import"./chunk-3UBRSNPL.js";import"./chunk-XDRSKFBJ.js";import"./chunk-MGUWZFOE.js";import"./chunk-JXUTKJIX.js";import"./chunk-O5CPPU3T.js";import"./chunk-6KRFVLII.js";import"./chunk-ZGGYJV33.js";import"./chunk-63TUJPJR.js";import"./chunk-GDTXLKQK.js";import"./chunk-YNFZN34N.js";import"./chunk-SHSMFEO2.js";import{a as y,c as S,d as g,f as p}from"./chunk-6A4M7X3R.js";import"./chunk-YRTOHBUA.js";import"./chunk-OQ4BFXF7.js";import"./chunk-LDBOA2H7.js";import"./chunk-CXUCQMGY.js";import"./chunk-DFTBSFIN.js";import"./chunk-WOZZR3L4.js";import"./chunk-LW5IAFEX.js";import"./chunk-AQ74ANSJ.js";import"./chunk-R2K3CL3U.js";import"./chunk-SAOUSUZE.js";import"./chunk-VNBPSOCW.js";import"./chunk-F7Q25XKV.js";import"./chunk-CPGZIEVH.js";import"./chunk-L2DEVDHE.js";import"./chunk-Z5Q76SB7.js";import"./chunk-RU7UW4IO.js";import"./chunk-5QLB7ZJ7.js";import"./chunk-2ETW6ZBA.js";import"./chunk-6K7P7RRW.js";import"./chunk-7LRMKXZV.js";import"./chunk-BCREO4Q5.js";import"./chunk-E5R4OI7X.js";import"./chunk-BNUHB4AP.js";import"./chunk-ZGLJFDS6.js";import"./chunk-RSDQHAJX.js";import"./chunk-PSYXGXKI.js";import"./chunk-Q6TYOK45.js";import"./chunk-QMDBAMTG.js";import{b as u}from"./chunk-RZA5H63B.js";import{a as N}from"./chunk-Y4PMIX35.js";import"./chunk-KVCIO4DX.js";import"./chunk-NWBXT4EB.js";import"./chunk-4R2OFZPD.js";import"./chunk-WBI2AIMN.js";import{a as I}from"./chunk-FKQYBEPG.js";import"./chunk-ZHAVTBSG.js";import"./chunk-SBO2F6VY.js";import"./chunk-MMYIAMQR.js";import{t as m}from"./chunk-UHTPPTOJ.js";import{a as h}from"./chunk-LP5GLSKB.js";import{a as J,b as w}from"./chunk-LTDZH3EN.js";import"./chunk-3SBMUUA6.js";import"./chunk-II7TJXWX.js";import"./chunk-X7Z55FTO.js";import"./chunk-B66V4PSA.js";import"./chunk-A4HCVMB4.js";import{H as j}from"./chunk-AANS6QE5.js";import{H as i,Q as _}from"./chunk-RMOOROEO.js";import{S as f,z as M}from"./chunk-ZP7G4HN4.js";import{a as r}from"./chunk-W3WDPWBE.js";import{k as F}from"./chunk-43GG6PFR.js";import"./chunk-MLSR6YE6.js";import"./chunk-JPDAKIWT.js";import"./chunk-D62JNIRP.js";import"./chunk-VU5W7W6Y.js";import{q as k}from"./chunk-3DV77WOO.js";import"./chunk-NJG4JJ4L.js";import{a as O,g as E}from"./chunk-3T7TAUC2.js";var v,a=v=class extends N.EventedMixin(_(I)){constructor(...e){super(...e),this.description=null,this.fullExtent=null,this.id=null,this.networkLink=null,this.parent=null,this.sublayers=null,this.title=null,this.sourceJSON=null,this.layer=null,this.addHandles([S(()=>this.sublayers,"after-add",({item:t})=>{t.parent=this,t.layer=this.layer},p),S(()=>this.sublayers,"after-remove",({item:t})=>{t.layer=t.parent=null},p),y(()=>this.sublayers,(t,s)=>{if(s)for(let o of s)o.layer=o.parent=null;if(t)for(let o of t)o.parent=this,o.layer=this.layer},p),y(()=>this.layer,t=>{if(this.sublayers)for(let s of this.sublayers)s.layer=t},p)])}initialize(){g(()=>this.networkLink).then(()=>g(()=>this.visible===!0)).then(()=>this.load())}load(e){if(!this.networkLink||this.networkLink.viewFormat)return;let t=e!=null?e.signal:null,s=this._fetchService(this._get("networkLink")?.href??"",t).then(o=>{let n=W(o.sublayers);this.fullExtent=m.fromJSON(n),this.sourceJSON=o;let x=M(u.ofType(v),c(v,o));this.sublayers?this.sublayers.addMany(x):this.sublayers=x,this.layer?.emit("sublayer-update"),this.layer&&this.layer.notifyChange("visibleSublayers")});return this.addResolvingPromise(s),Promise.resolve(this)}get visible(){return this._get("visible")}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this.layer&&this.layer.notifyChange("visibleSublayers"))}readVisible(e,t){return!!t.visibility}_fetchService(e,t){return b(e,this.layer.outSpatialReference,this.layer.refreshInterval,t).then(s=>d(s.data))}};r([i()],a.prototype,"description",void 0),r([i({type:m})],a.prototype,"fullExtent",void 0),r([i()],a.prototype,"id",void 0),r([i({readOnly:!0,value:null})],a.prototype,"networkLink",void 0),r([i({json:{write:{allowNull:!0}}})],a.prototype,"parent",void 0),r([i({type:u.ofType(a),json:{write:{allowNull:!0}}})],a.prototype,"sublayers",void 0),r([i({value:null,json:{read:{source:"name",reader:e=>k(e)}}})],a.prototype,"title",void 0),r([i({value:!0})],a.prototype,"visible",null),r([h("visible",["visibility"])],a.prototype,"readVisible",null),r([i()],a.prototype,"sourceJSON",void 0),r([i()],a.prototype,"layer",void 0),a=v=r([f("esri.layers.support.KMLSublayer")],a);var L=a;var B=["kml","xml"],l=class extends R(T(P(z(C(K(V)))))){constructor(...e){super(...e),this._visibleFolders=[],this.allSublayers=new H({getCollections:()=>[this.sublayers],getChildrenFunction:t=>t.sublayers}),this.outSpatialReference=w.WGS84,this.path=null,this.legendEnabled=!1,this.operationalLayerType="KML",this.sublayers=null,this.type="kml",this.url=null}initialize(){this.addHandles([y(()=>this.sublayers,(e,t)=>{t&&t.forEach(s=>{s.parent=null,s.layer=null}),e&&e.forEach(s=>{s.parent=this,s.layer=this})},p),this.on("sublayer-update",()=>this.notifyChange("fullExtent"))])}normalizeCtorArgs(e,t){return typeof e=="string"?O({url:e},t):e}readSublayersFromItemOrWebMap(e,t){this._visibleFolders=t.visibleFolders}readSublayers(e,t,s){return c(L,t,s,this._visibleFolders)}writeSublayers(e,t){let s=[],o=e.toArray();for(;o.length;){let n=o[0];n.networkLink||(n.visible&&s.push(n.id),n.sublayers&&o.push(...n.sublayers.toArray())),o.shift()}t.visibleFolders=s}get title(){let e=this._get("title");return e&&this.originOf("title")!=="defaults"?e:this.url?j(this.url,B)||"KML":e}set title(e){this._set("title",e)}get visibleSublayers(){let e=this.sublayers,t=[],s=o=>{o.visible&&(t.push(o),o.sublayers&&o.sublayers.forEach(s))};return e&&e.forEach(s),t}get fullExtent(){return this._recomputeFullExtent()}load(e){let t=e!=null?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"],supportsData:!1},e).catch(F).then(()=>this._fetchService(t))),Promise.resolve(this)}destroy(){super.destroy(),this.allSublayers.destroy()}_fetchService(e){return E(this,null,function*(){let t=yield Promise.resolve().then(()=>this.resourceInfo?{ssl:!1,data:this.resourceInfo}:b(this.url??"",this.outSpatialReference,this.refreshInterval,e)),s=d(t.data);s&&this.read(s,{origin:"service"})})}_recomputeFullExtent(){let e=null;this.extent!=null&&(e=this.extent.clone());let t=s=>{if(s.sublayers)for(let o of s.sublayers.items)t(o),o.visible&&o.fullExtent&&(e!=null?e.union(o.fullExtent):e=o.fullExtent.clone())};return t(this),e}};r([i({readOnly:!0})],l.prototype,"allSublayers",void 0),r([i({type:w})],l.prototype,"outSpatialReference",void 0),r([i({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],l.prototype,"path",void 0),r([i({readOnly:!0,json:{read:!1,write:!1}})],l.prototype,"legendEnabled",void 0),r([i({type:["show","hide","hide-children"]})],l.prototype,"listMode",void 0),r([i({type:["KML"]})],l.prototype,"operationalLayerType",void 0),r([i({})],l.prototype,"resourceInfo",void 0),r([i({type:u.ofType(L),json:{write:{ignoreOrigin:!0}}})],l.prototype,"sublayers",void 0),r([h(["web-map","portal-item"],"sublayers",["visibleFolders"])],l.prototype,"readSublayersFromItemOrWebMap",null),r([h("service","sublayers",["sublayers"])],l.prototype,"readSublayers",null),r([J("sublayers")],l.prototype,"writeSublayers",null),r([i({readOnly:!0,json:{read:!1}})],l.prototype,"type",void 0),r([i({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}}})],l.prototype,"title",null),r([i(A)],l.prototype,"url",void 0),r([i({readOnly:!0})],l.prototype,"visibleSublayers",null),r([i({type:m})],l.prototype,"extent",void 0),r([i()],l.prototype,"fullExtent",null),l=r([f("esri.layers.KMLLayer")],l);var Re=l;export{Re as default};
