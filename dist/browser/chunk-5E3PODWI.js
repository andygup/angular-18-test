import{a as L,b as $}from"./chunk-6WUYBFKW.js";import{f as Z}from"./chunk-OW7DVBQB.js";import{b as tt}from"./chunk-6UADMSXH.js";import{a as v}from"./chunk-I46GU3Q4.js";import{a as T}from"./chunk-H5IJXG2U.js";import{a as Q,c as W}from"./chunk-FJAXVFKU.js";import{b as X,c as U}from"./chunk-BVW6ULEA.js";import{E as B,F as J,L as K,a as I,b as q,c as G,l as x,m as _,u as P,x as k}from"./chunk-ZGLJFDS6.js";import{B as R}from"./chunk-RMOOROEO.js";import{a as Y}from"./chunk-D62JNIRP.js";import{A as H,D as V,v as F}from"./chunk-NJG4JJ4L.js";import{a as w,b as E}from"./chunk-3T7TAUC2.js";function it(n){if(n.length<V)return Array.from(n);if(H(n))return Float64Array.from(n);if(!("BYTES_PER_ELEMENT"in n))return Array.from(n);switch(n.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(n);case 2:return F(n)?Uint16Array.from(n):Int16Array.from(n);case 4:return Float32Array.from(n);default:return Float64Array.from(n)}}var C=class n{constructor(t,e,s){this.primitiveIndices=t,this._numIndexPerPrimitive=e,this.position=s,this._children=void 0,v(t.length>=1),v(s.size===3||s.size===4);let{data:a,size:h,indices:o}=s;v(o.length%this._numIndexPerPrimitive==0),v(o.length>=t.length*this._numIndexPerPrimitive);let c=t.length,r=h*o[this._numIndexPerPrimitive*t[0]];y.clear(),y.push(r);let u=G(a[r],a[r+1],a[r+2]),i=q(u);for(let d=0;d<c;++d){let g=this._numIndexPerPrimitive*t[d];for(let b=0;b<this._numIndexPerPrimitive;++b){r=h*o[g+b],y.push(r);let f=a[r];u[0]=Math.min(f,u[0]),i[0]=Math.max(f,i[0]),f=a[r+1],u[1]=Math.min(f,u[1]),i[1]=Math.max(f,i[1]),f=a[r+2],u[2]=Math.min(f,u[2]),i[2]=Math.max(f,i[2])}}this.bbMin=u,this.bbMax=i;let m=B(I(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(i[0]-u[0],i[1]-u[1]),i[2]-u[2]);let A=this.radius*this.radius;for(let d=0;d<y.length;++d){r=y.at(d);let g=a[r]-m[0],b=a[r+1]-m[1],f=a[r+2]-m[2],M=g*g+b*b+f*f;if(M<=A)continue;let S=Math.sqrt(M),j=.5*(S-this.radius);this.radius=this.radius+j,A=this.radius*this.radius;let D=j/S;m[0]+=g*D,m[1]+=b*D,m[2]+=f*D}this.center=m,y.clear()}getChildren(){if(this._children||k(this.bbMin,this.bbMax)<=1)return this._children;let t=B(I(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length,s=new Uint8Array(e),a=new Array(8);for(let i=0;i<8;++i)a[i]=0;let{data:h,size:o,indices:c}=this.position;for(let i=0;i<e;++i){let m=0,A=this._numIndexPerPrimitive*this.primitiveIndices[i],d=o*c[A],g=h[d],b=h[d+1],f=h[d+2];for(let M=1;M<this._numIndexPerPrimitive;++M){d=o*c[A+M];let S=h[d],j=h[d+1],D=h[d+2];S<g&&(g=S),j<b&&(b=j),D<f&&(f=D)}g<t[0]&&(m|=1),b<t[1]&&(m|=2),f<t[2]&&(m|=4),s[i]=m,++a[m]}let r=0;for(let i=0;i<8;++i)a[i]>0&&++r;if(r<2)return;let u=new Array(8);for(let i=0;i<8;++i)u[i]=a[i]>0?new Uint32Array(a[i]):void 0;for(let i=0;i<8;++i)a[i]=0;for(let i=0;i<e;++i){let m=s[i];u[m][a[m]++]=this.primitiveIndices[i]}this._children=new Array;for(let i=0;i<8;++i)u[i]!==void 0&&this._children.push(new n(u[i],this._numIndexPerPrimitive,this.position));return this._children}static prune(){y.prune()}},y=new Y({deallocator:null});function et(n,t){if(!n)return!1;let{size:e,data:s,indices:a}=n;x(t,0,0,0),x(p,0,0,0);let h=0,o=0;for(let c=0;c<a.length-2;c+=3){let r=a[c]*e,u=a[c+1]*e,i=a[c+2]*e;x(l,s[r],s[r+1],s[r+2]),x(O,s[u],s[u+1],s[u+2]),x(z,s[i],s[i+1],s[i+2]);let m=tt(l,O,z);m?(_(l,l,O),_(l,l,z),P(l,l,1/3*m),_(t,t,l),h+=m):(_(p,p,l),_(p,p,O),_(p,p,z),o+=3)}return(o!==0||h!==0)&&(h!==0?(P(t,t,1/h),!0):o!==0&&(P(t,p,1/o),!0))}function nt(n,t){if(!n)return!1;let{size:e,data:s,indices:a}=n;x(t,0,0,0);let h=-1,o=0;for(let c=0;c<a.length;c++){let r=a[c]*e;h!==r&&(t[0]+=s[r],t[1]+=s[r+1],t[2]+=s[r+2],o++),h=r}return o>1&&P(t,t,1/o),o>0}function st(n,t,e){if(!n)return!1;x(e,0,0,0),x(p,0,0,0);let s=0,a=0,{size:h,data:o,indices:c}=n,r=c.length-1,u=r+(t?2:0);for(let i=0;i<u;i+=2){let m=i<r?i+1:0,A=c[i<r?i:r]*h,d=c[m]*h;l[0]=o[A],l[1]=o[A+1],l[2]=o[A+2],O[0]=o[d],O[1]=o[d+1],O[2]=o[d+2],P(l,_(l,l,O),.5);let g=K(l,O);g>0?(_(e,e,P(l,l,g)),s+=g):s===0&&(_(p,p,l),a++)}return s!==0?(P(e,e,1/s),!0):a!==0&&(P(e,p,1/a),!0)}var l=I(),O=I(),z=I(),p=I();var N=class{constructor(t){this.channel=t,this.id=R()}};function rt(n,t){return n==null&&(n=[]),n.push(t),n}function at(n,t){if(n==null)return null;let e=n.filter(s=>s!==t);return e.length===0?null:e}var yt=I(),Mt=new Float32Array(6);var ot=class n extends ${constructor(t,e,s=null,a=L.Mesh,h=null,o=-1){super(),this.material=t,this.mapPositions=s,this.type=a,this.objectAndLayerIdColor=h,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(let[c,r]of e)this._attributes.set(c,E(w({},r),{indices:Q(r.indices)})),c===T.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(c).indices.length:this.edgeIndicesLength)}instantiate(t={}){let e=new n(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((s,a)=>{s.exclusive=!1,e._attributes.set(a,s)}),e._boundingInfo=this._boundingInfo,e.transformation=t.transformation||this.transformation,e}get attributes(){return this._attributes}getMutableAttribute(t){let e=this._attributes.get(t);return e&&!e.exclusive&&(e=E(w({},e),{exclusive:!0,data:it(e.data)}),this._attributes.set(t,e)),e}setAttributeData(t,e){let s=this._attributes.get(t);s&&this._attributes.set(t,E(w({},s),{exclusive:!0,data:e}))}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===L.Mesh?this._computeAttachmentOriginTriangles(t):this.type===L.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(this._transformation!=null&&J(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){let e=this.attributes.get(T.POSITION);return et(e,t)}_computeAttachmentOriginLines(t){let e=this.attributes.get(T.POSITION);return st(e,ht(this.material.parameters,e),t)}_computeAttachmentOriginPoints(t){let e=this.attributes.get(T.POSITION);return nt(e,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let t=this.attributes.get(T.POSITION);if(!t||t.indices.length===0)return null;let e=this.type===L.Mesh?3:1;v(t.indices.length%e==0,"Indexing error: "+t.indices.length+" not divisible by "+e);let s=W(t.indices.length/e);return new C(s,e,t)}get transformation(){return this._transformation??U}set transformation(t){this._transformation=t&&t!==U?X(t):null}addHighlight(){let t=new N(Z.Highlight);return this.highlights=rt(this.highlights,t),t}removeHighlight(t){this.highlights=at(this.highlights,t)}};function ht(n,t){return!(!("isClosed"in n)||!n.isClosed)&&t.indices.length>2}export{ot as a};
