import{a as ut}from"./chunk-BSHZWKPK.js";import{a as rs}from"./chunk-FVCUBGKZ.js";import{a as ee,c as ds}from"./chunk-GOWGPU4N.js";import{b as Ts}from"./chunk-PFBSO54Q.js";import{a as Ge,d as ss,e as Me,g as as,h as os,i as is,j as ns,k as Z,n as ms,o as ct,p as fs,q as ps,x as h,y as hs}from"./chunk-OEMI32RL.js";import{b as Ht,c as ls,d as kt,e as us,f as cs}from"./chunk-NIPH2J6R.js";import"./chunk-46IOK233.js";import"./chunk-E4Z6GAFJ.js";import"./chunk-43UANMP5.js";import{c as X,d as nt,e as lt,g as K}from"./chunk-ZYBGZLJ2.js";import"./chunk-7FVU4GPM.js";import"./chunk-PCE3ZAVU.js";import"./chunk-GMW3QDVG.js";import{h as Hr,i as kr,j as le}from"./chunk-HBLTLHNB.js";import{a as Wr}from"./chunk-RHABF3KL.js";import{a as es,b as ts}from"./chunk-MJHLIPBA.js";import{a as Gt}from"./chunk-VKL3L6CG.js";import{b as Kr,e as Qr,h as $r,j as Yr,k as Zr,l as Jr}from"./chunk-OGG5EF6C.js";import{b as it}from"./chunk-CE56NTX4.js";import"./chunk-M7ZGDKKR.js";import{a as ot}from"./chunk-5E3PODWI.js";import{a as at,b as Xr}from"./chunk-6WUYBFKW.js";import"./chunk-PTXLSCMJ.js";import{b as ue}from"./chunk-YQNUGDFH.js";import"./chunk-45N2JYAW.js";import{a as j,b as ce,e as ae,g as G,i as Ue}from"./chunk-OW7DVBQB.js";import"./chunk-X2T2CBLR.js";import"./chunk-6UADMSXH.js";import"./chunk-675N36PI.js";import"./chunk-7LGSGFQI.js";import"./chunk-X2KSOPZ6.js";import"./chunk-IFFYADB3.js";import{b as jr}from"./chunk-LHY2TOIB.js";import{a as Br,c as Ke}from"./chunk-KNIGXQZZ.js";import"./chunk-2NH7HOKA.js";import{c as re,i as q,j as W,k as se,l as ye,n as ne,w as Bt,x as Dr,z as Y}from"./chunk-ZAQLF7TN.js";import{a as F}from"./chunk-I46GU3Q4.js";import{a as S}from"./chunk-H5IJXG2U.js";import{c as Nr}from"./chunk-FJAXVFKU.js";import{b as Gr,e as Ft}from"./chunk-NILEV7NP.js";import{b as Fr,d as Ur,f as Lt,i as Vt}from"./chunk-Z6XPPWSB.js";import"./chunk-T6U45BGW.js";import"./chunk-AIOXCJIZ.js";import{a as Nt}from"./chunk-BVW6ULEA.js";import{a as Qe,b as st}from"./chunk-7C6Z24SS.js";import{D as Pr,a as br,b as vr,c as Ve,d as Xe,o as Sr,p as Fe,s as Cr,t as wr}from"./chunk-3M7QKELQ.js";import{c as zr,d as qr}from"./chunk-37H4LYIE.js";import{a as Re}from"./chunk-XHOTVM3O.js";import{a as Ut}from"./chunk-MNGFITIF.js";import"./chunk-W2FNMTJT.js";import"./chunk-I3S324BU.js";import{a as Rr,e as Le,h as Mr,i as Er,k as rt}from"./chunk-ZGGYJV33.js";import{d as Ir}from"./chunk-2EA2KAER.js";import{a as Lr,g as Dt,n as Vr}from"./chunk-MJ4RSERD.js";import"./chunk-SHSMFEO2.js";import"./chunk-J57HR4DB.js";import"./chunk-6A4M7X3R.js";import{b as Or}from"./chunk-Z5Q76SB7.js";import{d as wt,s as Pt,t as It}from"./chunk-5QLB7ZJ7.js";import"./chunk-7LRMKXZV.js";import"./chunk-BCREO4Q5.js";import"./chunk-E5R4OI7X.js";import{n as Ct}from"./chunk-BNUHB4AP.js";import{B as _e,C as Ar,D as St,E as _r,F as Ne,G as xr,I as yr,K as xe,a as P,c as Ie,d as je,e as Tr,j as z,k as Be,l as k,m as gr,n as De,p as bt,u as vt,v as ie}from"./chunk-ZGLJFDS6.js";import"./chunk-RSDQHAJX.js";import"./chunk-RZA5H63B.js";import{a as pr}from"./chunk-Y4PMIX35.js";import{c as Ot}from"./chunk-KVCIO4DX.js";import"./chunk-NWBXT4EB.js";import"./chunk-UHTPPTOJ.js";import"./chunk-LP5GLSKB.js";import"./chunk-LTDZH3EN.js";import"./chunk-3SBMUUA6.js";import"./chunk-X7Z55FTO.js";import"./chunk-B66V4PSA.js";import{a as hr}from"./chunk-A4HCVMB4.js";import{Y as fr,_ as dr,v as Et,w as mr}from"./chunk-AANS6QE5.js";import"./chunk-RMOOROEO.js";import"./chunk-ZP7G4HN4.js";import{a as p}from"./chunk-W3WDPWBE.js";import{g as ur,h as Rt,k as Mt,m as cr}from"./chunk-43GG6PFR.js";import{c as nr,d as lr}from"./chunk-MLSR6YE6.js";import"./chunk-JPDAKIWT.js";import"./chunk-D62JNIRP.js";import{s as tt,u as Pe}from"./chunk-3DV77WOO.js";import{a as or,o as ir,q as Ce,s as we}from"./chunk-NJG4JJ4L.js";import{a as $,b as et,g as H}from"./chunk-3T7TAUC2.js";function He(t){if(t==null)return null;let e=t.offset!=null?t.offset:zr,r=t.rotation!=null?t.rotation:0,s=t.scale!=null?t.scale:qr,l=st(1,0,0,0,1,0,e[0],e[1],1),o=st(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),i=st(s[0],0,0,0,s[1],0,0,0,1),n=Qe();return Dt(n,o,i),Dt(n,l,n),n}var zt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},mt=class{constructor(e,r,s){this.name=e,this.lodThreshold=r,this.pivotOffset=s,this.stageResources=new zt,this.numberOfVertices=0}};function As(){return gs??=H(this,null,function*(){let t=yield import("./chunk-HRWRQXBJ.js"),e=yield t.default({locateFile:r=>hr(`esri/libs/basisu/${r}`)});return e.initializeBasis(),e}),gs}var gs;var me;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(me||(me={}));var J=null,ft=null;function _s(){return H(this,null,function*(){return ft==null&&(ft=As(),J=yield ft),ft})}function xs(t,e){if(J==null)return t.byteLength;let r=new J.BasisFile(new Uint8Array(t)),s=Ms(r)?Rs(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),s}function ys(t,e){if(J==null)return t.byteLength;let r=new J.KTX2File(new Uint8Array(t)),s=Es(r)?Rs(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),s}function Rs(t,e,r,s,l){let o=Hr(e?Y.COMPRESSED_RGBA8_ETC2_EAC:Y.COMPRESSED_RGB8_ETC2),i=l&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*s*o*i)}function Ms(t){return t.getNumImages()>=1&&!t.isUASTC()}function Es(t){return t.getFaces()>=1&&t.isETC1S()}function Os(t,e,r){return H(this,null,function*(){J==null&&(J=yield _s());let s=new J.BasisFile(new Uint8Array(r));if(!Ms(s))return null;s.startTranscoding();let l=vs(t,e,s.getNumLevels(0),s.getHasAlpha(),s.getImageWidth(0,0),s.getImageHeight(0,0),(o,i)=>s.getImageTranscodedSizeInBytes(0,o,i),(o,i,n)=>s.transcodeImage(n,0,o,i,0,0));return s.close(),s.delete(),l})}function bs(t,e,r){return H(this,null,function*(){J==null&&(J=yield _s());let s=new J.KTX2File(new Uint8Array(r));if(!Es(s))return null;s.startTranscoding();let l=vs(t,e,s.getLevels(),s.getHasAlpha(),s.getWidth(),s.getHeight(),(o,i)=>s.getImageTranscodedSizeInBytes(o,0,0,i),(o,i,n)=>s.transcodeImage(n,o,0,0,i,0,-1,-1));return s.close(),s.delete(),l})}function vs(t,e,r,s,l,o,i,n){let{compressedTextureETC:a,compressedTextureS3TC:u}=t.capabilities,[c,m]=a?s?[me.ETC2_RGBA,Y.COMPRESSED_RGBA8_ETC2_EAC]:[me.ETC1_RGB,Y.COMPRESSED_RGB8_ETC2]:u?s?[me.BC3_RGBA,Y.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[me.BC1_RGB,Y.COMPRESSED_RGB_S3TC_DXT1_EXT]:[me.RGBA32,ne.RGBA],d=e.hasMipmap?r:Math.min(1,r),A=[];for(let y=0;y<d;y++)A.push(new Uint8Array(i(y,c))),n(y,c,A[y]);return e.internalFormat=m,e.hasMipmap=A.length>1,e.samplingMode=e.hasMipmap?se.LINEAR_MIPMAP_LINEAR:se.LINEAR,e.width=l,e.height=o,new le(t,e,{type:"compressed",levels:A})}var pt=()=>tt.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),oa=542327876,ia=131072,na=4;function qt(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function la(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}var ua=qt("DXT1"),ca=qt("DXT3"),ma=qt("DXT5"),fa=31,pa=0,ha=1,da=2,Ta=3,ga=4,Aa=7,_a=20,xa=21;function Ss(t,e,r){let s=ya(r,e.hasMipmap??!1);if(s==null)throw new Error("DDS texture data is null");let{textureData:l,internalFormat:o,width:i,height:n}=s;return e.samplingMode=l.levels.length>1?se.LINEAR_MIPMAP_LINEAR:se.LINEAR,e.hasMipmap=l.levels.length>1,e.internalFormat=o,e.width=i,e.height=n,new le(t,e,l)}function ya(t,e){let r=new Int32Array(t,0,fa);if(r[pa]!==oa)return pt().error("Invalid magic number in DDS header"),null;if(!(r[_a]&na))return pt().error("Unsupported format, must contain a FourCC code"),null;let s=r[xa],l,o;switch(s){case ua:l=8,o=Y.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case ca:l=16,o=Y.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case ma:l=16,o=Y.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return pt().error("Unsupported FourCC code:",la(s)),null}let i=1,n=r[ga],a=r[Ta];(3&n||3&a)&&(pt().warn("Rounding up compressed texture size to nearest multiple of 4."),n=n+3&-4,a=a+3&-4);let u=n,c=a,m,d;r[da]&ia&&e!==!1&&(i=Math.max(1,r[Aa]));let A=r[ha]+4,y=[];for(let b=0;b<i;++b)d=(n+3>>2)*(a+3>>2)*l,m=new Uint8Array(t,A,d),y.push(m),A+=d,n=Math.max(1,n>>1),a=Math.max(1,a>>1);return{textureData:{type:"compressed",levels:y},internalFormat:o,width:u,height:c}}function Cs(t,e){let o=t.width*t.height;if(o<4096)return t instanceof ImageData?Ps(t):t;let i=t.width,n=t.height;do i=Math.ceil(i/2),n=Math.ceil(n/2),o=i*n;while(o>1048576||e!=null&&(i>e||n>e));return Wt(t,i,n)}function ws(t,e){let r=Math.max(t.width,t.height);if(r<=e)return t;let s=e/r;return Wt(t,Math.round(t.width*s),Math.round(t.height*s))}function Wt(t,e,r){if(t instanceof ImageData)return Wt(Ps(t),e,r);let s=document.createElement("canvas");return s.width=e,s.height=r,s.getContext("2d").drawImage(t,0,0,s.width,s.height),s}function Ps(t){let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let r=e.getContext("2d");if(r==null)throw new Pe("Failed to create 2d context from HTMLCanvasElement");return r.putImageData(t,0,0),e}var ke=class extends Xr{get parameters(){return this._parameters}constructor(e,r){super(),this._data=e,this.type=at.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new pr,this._parameters=$($({},Ma),r),this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=r=>this._frameUpdate(e,r),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(Et(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";let r=!e.paused;if(e.src=e.src,r&&e.autoplay){let s=()=>{e.removeEventListener("canplay",s),e.play()};e.addEventListener("canplay",s)}}}_startPreloadImageElement(e){mr(e.src)||Et(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){let r=new kr;return r.wrapMode=this._parameters.wrap??ye.REPEAT,r.flipped=!this._parameters.noUnpackFlip,r.samplingMode=this._parameters.mipmap?se.LINEAR_MIPMAP_LINEAR:se.LINEAR,r.hasMipmap=!!this._parameters.mipmap,r.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,r.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||Ra(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;let r=this._data;return r==null?(this._glTexture=new le(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(Ce(r)||we(r))&&this._parameters.encoding===Ue.DDS_ENCODING?this._loadFromDDSData(e,r):(Ce(r)||we(r))&&this._parameters.encoding===Ue.KTX2_ENCODING?this._loadFromKTX2(e,r):(Ce(r)||we(r))&&this._parameters.encoding===Ue.BASIS_ENCODING?this._loadFromBasis(e,r):we(r)?this._loadFromPixelData(e,r):Ce(r)?this._loadFromPixelData(e,new Uint8Array(r)):null)}_frameUpdate(e,r){return this._glTexture==null||e.readyState<$e.HAVE_CURRENT_DATA||r===e.currentTime?r:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,r){return this._glTexture=Ss(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>bs(e,this._createDescriptor(e),r).then(s=>(this._glTexture=s,s)))}_loadFromBasis(e,r){return this._loadAsync(()=>Os(e,this._createDescriptor(e),r).then(s=>(this._glTexture=s,s)))}_loadFromPixelData(e,r){F(this._parameters.width>0&&this._parameters.height>0);let s=this._createDescriptor(e);return s.pixelFormat=this._parameters.components===1?ne.LUMINANCE:this._parameters.components===3?ne.RGB:ne.RGBA,s.width=this._parameters.width??0,s.height=this._parameters.height??0,this._glTexture=new le(e,s,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(s=>H(this,null,function*(){let l=yield ut(r,{signal:s});return Rt(s),this._loadFromImage(e,l)}))}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(s=>H(this,null,function*(){let l=yield fr(r,r.src,!1,s);return Rt(s),this._loadFromImage(e,l)}))}_loadFromVideoElement(e,r){return r.readyState>=$e.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(s=>new Promise((l,o)=>{let i=()=>{r.removeEventListener("loadeddata",n),r.removeEventListener("error",a),lr(u)},n=()=>{r.readyState>=$e.HAVE_CURRENT_DATA&&(i(),l(this._loadFromImage(e,r)))},a=c=>{i(),o(c||new Pe("Failed to load video"))};r.addEventListener("loadeddata",n),r.addEventListener("error",a);let u=cr(s,()=>a(ur()))}))}_loadFromImage(e,r){let s=r;if(!(s instanceof HTMLVideoElement)){let{maxTextureSize:i}=e.parameters;s=this._parameters.downsampleUncompressed?Cs(s,i):ws(s,i)}let l=Is(s);this._parameters.width=l.width,this._parameters.height=l.height;let o=this._createDescriptor(e);return o.pixelFormat=this._parameters.components===3?ne.RGB:ne.RGBA,o.width=l.width,o.height=l.height,this._glTexture=new le(e,o,s),this._glTexture}_loadAsync(e){let r=new AbortController;this._loadingController=r;let s=e(r.signal);this._loadingPromise=s;let l=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===s&&(this._loadingPromise=null)};return s.then(l,l),s}unload(){if(this._glTexture=nr(this._glTexture),this._loadingController!=null){let e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function Ra(t,e){if(t==null)return 0;if(Ce(t)||we(t))return e.encoding===Ue.KTX2_ENCODING?ys(t,!!e.mipmap):e.encoding===Ue.BASIS_ENCODING?xs(t,!!e.mipmap):t.byteLength;let{width:r,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?Is(t):e;return(e.mipmap?4/3:1)*r*s*(e.components||4)||0}function Is(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var $e;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})($e||($e={}));var Ma={wrap:{s:ye.REPEAT,t:ye.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1};var Bs=Ht(re.SRC_ALPHA,re.ONE,re.ONE_MINUS_SRC_ALPHA,re.ONE_MINUS_SRC_ALPHA),Ea=Ht(re.ONE,re.ZERO,re.ONE,re.ONE_MINUS_SRC_ALPHA);function Ds(t){return t===Z.FrontFace?null:Ea}var Ns=5e5,Oa={factor:-1,units:-2};function Ls(t){return t?Oa:null}function Vs(t,e=q.LESS){return t===Z.NONE||t===Z.FrontFace?e:q.LEQUAL}function Fs(t){return t===Z.ColorAlpha?{buffers:[Bt.COLOR_ATTACHMENT0,Bt.COLOR_ATTACHMENT1]}:null}var jt=class{constructor(e=!1,r=!0){this.isVerticalRay=e,this.normalRequired=r}},ht=Rr();function Us(t,e,r,s,l,o){if(!t.visible)return;let i=xe(Ua,s,r),n=(u,c,m)=>{o(u,m,c,!1)},a=new jt(!1,e.options.normalRequired);if(t.boundingInfo){F(t.type===at.Mesh);let u=e.tolerance;Gs(t.boundingInfo,r,i,u,l,a,n)}else{let u=t.attributes.get(S.POSITION),c=u.indices;Sa(r,i,0,c.length/3,c,u.data,u.stride,l,a,n)}}var ba=P();function Gs(t,e,r,s,l,o,i){if(t==null)return;let n=Da(r,ba);if(Mr(ht,t.bbMin),Er(ht,t.bbMax),l?.applyToAabb(ht),Na(ht,e,n,s)){let{primitiveIndices:a,position:u}=t,c=a?a.length:u.indices.length/3;if(c>Va){let m=t.getChildren();if(m!==void 0){for(let d of m)Gs(d,e,r,s,l,o,i);return}}va(e,r,0,c,u.indices,u.data,u.stride,a,l,o,i)}}var Ye=P();function va(t,e,r,s,l,o,i,n,a,u,c){let m=t[0],d=t[1],A=t[2],y=e[0],b=e[1],O=e[2],{normalRequired:N}=u;for(let w=r;w<s;++w){let B=n[w],L=3*B,D=i*l[L],C=o[D],_=o[D+1],R=o[D+2],M=i*l[L+1],x=o[M],T=o[M+1],E=o[M+2],f=i*l[L+2],v=o[f],I=o[f+1],V=o[f+2];a!=null&&([C,_,R]=a.applyToVertex(C,_,R,w),[x,T,E]=a.applyToVertex(x,T,E,w),[v,I,V]=a.applyToVertex(v,I,V,w));let U=x-C,pe=T-_,he=E-R,de=v-C,Te=I-_,te=V-R,ge=b*te-Te*O,Ae=O*de-te*y,be=y*Te-de*b,Q=U*ge+pe*Ae+he*be;if(Math.abs(Q)<=Fa)continue;let ve=m-C,xt=d-_,yt=A-R,Se=ve*ge+xt*Ae+yt*be;if(Q>0){if(Se<0||Se>Q)continue}else if(Se>0||Se<Q)continue;let tr=xt*he-pe*yt,rr=yt*U-he*ve,sr=ve*pe-U*xt,Je=y*tr+b*rr+O*sr;if(Q>0){if(Je<0||Se+Je>Q)continue}else if(Je>0||Se+Je<Q)continue;let ar=(de*tr+Te*rr+te*sr)/Q;ar>=0&&c(ar,B,N?Ia(U,pe,he,de,Te,te,Ye):null)}}function Sa(t,e,r,s,l,o,i,n,a,u){let c=e,m=Ga,d=Math.abs(c[0]),A=Math.abs(c[1]),y=Math.abs(c[2]),b=d>=A?d>=y?0:2:A>=y?1:2,O=b,N=c[O]<0?2:1,w=(b+N)%3,B=(b+(3-N))%3,L=c[w]/c[O],D=c[B]/c[O],C=1/c[O],_=Ca,R=wa,M=Pa,{normalRequired:x}=a;for(let T=r;T<s;++T){let E=3*T,f=i*l[E];k(m[0],o[f+0],o[f+1],o[f+2]);let v=i*l[E+1];k(m[1],o[v+0],o[v+1],o[v+2]);let I=i*l[E+2];k(m[2],o[I+0],o[I+1],o[I+2]),n&&(Be(m[0],n.applyToVertex(m[0][0],m[0][1],m[0][2],T)),Be(m[1],n.applyToVertex(m[1][0],m[1][1],m[1][2],T)),Be(m[2],n.applyToVertex(m[2][0],m[2][1],m[2][2],T))),xe(_,m[0],t),xe(R,m[1],t),xe(M,m[2],t);let V=_[w]-L*_[O],U=_[B]-D*_[O],pe=R[w]-L*R[O],he=R[B]-D*R[O],de=M[w]-L*M[O],Te=M[B]-D*M[O],te=de*he-Te*pe,ge=V*Te-U*de,Ae=pe*U-he*V;if((te<0||ge<0||Ae<0)&&(te>0||ge>0||Ae>0))continue;let be=te+ge+Ae;if(be===0)continue;let Q=te*(C*_[O])+ge*(C*R[O])+Ae*(C*M[O]);if(Q*Math.sign(be)<0)continue;let ve=Q/be;ve>=0&&u(ve,T,x?Ba(m):null)}}var Ca=P(),wa=P(),Pa=P();function Ia(t,e,r,s,l,o,i){return k(dt,t,e,r),k(Tt,s,l,o),St(i,dt,Tt),_e(i,i),i}function Ba(t){return xe(dt,t[1],t[0]),xe(Tt,t[2],t[0]),St(Ye,dt,Tt),_e(Ye,Ye),Ye}var dt=P(),Tt=P();function Da(t,e){return k(e,1/t[0],1/t[1],1/t[2])}function Na(t,e,r,s){return La(t,e,r,s,1/0)}function La(t,e,r,s,l){let o=(t[0]-s-e[0])*r[0],i=(t[3]+s-e[0])*r[0],n=Math.min(o,i),a=Math.max(o,i),u=(t[1]-s-e[1])*r[1],c=(t[4]+s-e[1])*r[1];if(a=Math.min(a,Math.max(u,c)),a<0||(n=Math.max(n,Math.min(u,c)),n>a))return!1;let m=(t[2]-s-e[2])*r[2],d=(t[5]+s-e[2])*r[2];return a=Math.min(a,Math.max(m,d)),!(a<0)&&(n=Math.max(n,Math.min(m,d)),!(n>a)&&n<l)}var Va=1e3,Fa=1e-7,Ua=P(),Ga=[P(),P(),P()];var ze;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",t[t.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",t[t.LASERLINES=14]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=16]="HUD_MATERIAL",t[t.LABEL_MATERIAL=17]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=18]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",t[t.DRAPED_WATER=21]="DRAPED_WATER",t[t.VIEWSHED=22]="VIEWSHED",t[t.VOXEL=23]="VOXEL",t[t.MAX_SLOTS=24]="MAX_SLOTS"})(ze||(ze={}));var Xt=class{constructor(e=0){this.offset=e,this.tmpVertex=P()}applyToVertex(e,r,s){let l=k($t,e,r,s),o=gr(zs,l,this.localOrigin),i=this.offset/z(o);return ie(this.tmpVertex,l,o,i),this.tmpVertex}applyToAabb(e){let r=Ha,s=ka,l=za;for(let a=0;a<3;++a)r[a]=e[0+a]+this.localOrigin[a],s[a]=e[3+a]+this.localOrigin[a],l[a]=r[a];let o=this.applyToVertex(r[0],r[1],r[2]);for(let a=0;a<3;++a)e[a]=o[a],e[a+3]=o[a];let i=a=>{let u=this.applyToVertex(a[0],a[1],a[2]);for(let c=0;c<3;++c)e[c]=Math.min(e[c],u[c]),e[c+3]=Math.max(e[c+3],u[c])};for(let a=1;a<8;++a){for(let u=0;u<3;++u)l[u]=a&1<<u?s[u]:r[u];i(l)}let n=0;for(let a=0;a<3;++a)r[a]*s[a]<0&&(n|=1<<a);if(n!==0&&n!==7){for(let a=0;a<8;++a)if(!(n&a)){for(let u=0;u<3;++u)l[u]=n&1<<u?0:a&1<<u?r[u]:s[u];i(l)}}for(let a=0;a<3;++a)e[a]-=this.localOrigin[a],e[a+3]-=this.localOrigin[a];return e}},Kt=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=P(),this._tmpMbs=Gt(),this._tmpObb=new es,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=z(e)}applyToVertex(e,r,s){let l=k($t,e,r,s),o=k(zs,e,r,s+this.componentLocalOriginLength),i=this._totalOffset/z(o);return ie(this._tmpVertex,l,o,i),this._tmpVertex}applyToAabb(e){let r=this.componentLocalOriginLength,s=e[0],l=e[1],o=e[2]+r,i=e[3],n=e[4],a=e[5]+r,u=Math.abs(s),c=Math.abs(l),m=Math.abs(o),d=Math.abs(i),A=Math.abs(n),y=Math.abs(a),b=.5*(1+Math.sign(s*i))*Math.min(u,d),O=.5*(1+Math.sign(l*n))*Math.min(c,A),N=.5*(1+Math.sign(o*a))*Math.min(m,y),w=Math.max(u,d),B=Math.max(c,A),L=Math.max(m,y),D=Math.sqrt(b*b+O*O+N*N),C=Math.sign(u+s),_=Math.sign(c+l),R=Math.sign(m+o),M=Math.sign(d+i),x=Math.sign(A+n),T=Math.sign(y+a),E=this._totalOffset;if(D<E)return e[0]-=(1-C)*E,e[1]-=(1-_)*E,e[2]-=(1-R)*E,e[3]+=M*E,e[4]+=x*E,e[5]+=T*E,e;let f=E/Math.sqrt(w*w+B*B+L*L),v=E/D,I=v-f,V=-I;return e[0]+=s*(C*V+v),e[1]+=l*(_*V+v),e[2]+=o*(R*V+v),e[3]+=i*(M*I+f),e[4]+=n*(x*I+f),e[5]+=a*(T*I+f),e}applyToMbs(e){let r=z(e),s=this._totalOffset/r;return ie(this._tmpMbs,e,e,s),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/r,this._tmpMbs}applyToObb(e){return ts(e,this._totalOffset,this._totalOffset,Re.Global,this._tmpObb),this._tmpObb}},Qt=class{constructor(e=0){this.offset=e,this.sphere=Gt(),this.tmpVertex=P()}applyToVertex(e,r,s){let l=this.objectTransform.transform,o=k($t,e,r,s),i=Ne(o,o,l),n=this.offset/z(i);ie(i,i,i,n);let a=this.objectTransform.inverse;return Ne(this.tmpVertex,i,a),this.tmpVertex}applyToMinMax(e,r){let s=this.offset/z(e);ie(e,e,e,s);let l=this.offset/z(r);ie(r,r,r,l)}applyToAabb(e){let r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;let s=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*s,e[4]+=e[4]*s,e[5]+=e[5]*s,e}applyToBoundingSphere(e){let r=z(e),s=this.offset/r;return ie(this.sphere,e,e,s),this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}},Hs=new Qt;function ks(t){return t!=null?(Hs.offset=t,Hs):null}var Ni=new Kt;var Li=new Xt;var $t=P(),zs=P(),Ha=P(),ka=P(),za=P();function qs(t,e,r){let{data:s,indices:l}=t,o=e.typedBuffer,i=e.typedBufferStride,n=l.length;r*=i;for(let a=0;a<n;++a){let u=2*l[a];o[r]=s[u],o[r+1]=s[u+1],r+=i}}function Ws(t,e,r,s){let{data:l,indices:o}=t,i=e.typedBuffer,n=e.typedBufferStride,a=o.length;if(r*=n,s==null||s===1)for(let u=0;u<a;++u){let c=3*o[u];i[r]=l[c],i[r+1]=l[c+1],i[r+2]=l[c+2],r+=n}else for(let u=0;u<a;++u){let c=3*o[u];for(let m=0;m<s;++m)i[r]=l[c],i[r+1]=l[c+1],i[r+2]=l[c+2],r+=n}}function js(t,e,r,s=1){let{data:l,indices:o}=t,i=e.typedBuffer,n=e.typedBufferStride,a=o.length;if(r*=n,s===1)for(let u=0;u<a;++u){let c=4*o[u];i[r]=l[c],i[r+1]=l[c+1],i[r+2]=l[c+2],i[r+3]=l[c+3],r+=n}else for(let u=0;u<a;++u){let c=4*o[u];for(let m=0;m<s;++m)i[r]=l[c],i[r+1]=l[c+1],i[r+2]=l[c+2],i[r+3]=l[c+3],r+=n}}function qa(t,e,r,s,l=1){if(!e)return void Ws(t,r,s,l);let{data:o,indices:i}=t,n=r.typedBuffer,a=r.typedBufferStride,u=i.length,c=e[0],m=e[1],d=e[2],A=e[4],y=e[5],b=e[6],O=e[8],N=e[9],w=e[10],B=e[12],L=e[13],D=e[14];s*=a;let C=0,_=0,R=0,M=It(e)?x=>{C=o[x]+B,_=o[x+1]+L,R=o[x+2]+D}:x=>{let T=o[x],E=o[x+1],f=o[x+2];C=c*T+A*E+O*f+B,_=m*T+y*E+N*f+L,R=d*T+b*E+w*f+D};if(l===1)for(let x=0;x<u;++x)M(3*i[x]),n[s]=C,n[s+1]=_,n[s+2]=R,s+=a;else for(let x=0;x<u;++x){M(3*i[x]);for(let T=0;T<l;++T)n[s]=C,n[s+1]=_,n[s+2]=R,s+=a}}function Wa(t,e,r,s,l=1){if(!e)return void Ws(t,r,s,l);let{data:o,indices:i}=t,n=e,a=r.typedBuffer,u=r.typedBufferStride,c=i.length,m=n[0],d=n[1],A=n[2],y=n[4],b=n[5],O=n[6],N=n[8],w=n[9],B=n[10],L=!Pt(n),D=1e-6,C=1-D;s*=u;let _=0,R=0,M=0,x=It(n)?T=>{_=o[T],R=o[T+1],M=o[T+2]}:T=>{let E=o[T],f=o[T+1],v=o[T+2];_=m*E+y*f+N*v,R=d*E+b*f+w*v,M=A*E+O*f+B*v};if(l===1)if(L)for(let T=0;T<c;++T){x(3*i[T]);let E=_*_+R*R+M*M;if(E<C&&E>D){let f=1/Math.sqrt(E);a[s]=_*f,a[s+1]=R*f,a[s+2]=M*f}else a[s]=_,a[s+1]=R,a[s+2]=M;s+=u}else for(let T=0;T<c;++T)x(3*i[T]),a[s]=_,a[s+1]=R,a[s+2]=M,s+=u;else for(let T=0;T<c;++T){if(x(3*i[T]),L){let E=_*_+R*R+M*M;if(E<C&&E>D){let f=1/Math.sqrt(E);_*=f,R*=f,M*=f}}for(let E=0;E<l;++E)a[s]=_,a[s+1]=R,a[s+2]=M,s+=u}}function ja(t,e,r,s,l=1){if(!e)return void js(t,r,s,l);let{data:o,indices:i}=t,n=e,a=r.typedBuffer,u=r.typedBufferStride,c=i.length,m=n[0],d=n[1],A=n[2],y=n[4],b=n[5],O=n[6],N=n[8],w=n[9],B=n[10],L=!Pt(n),D=1e-6,C=1-D;if(s*=u,l===1)for(let _=0;_<c;++_){let R=4*i[_],M=o[R],x=o[R+1],T=o[R+2],E=o[R+3],f=m*M+y*x+N*T,v=d*M+b*x+w*T,I=A*M+O*x+B*T;if(L){let V=f*f+v*v+I*I;if(V<C&&V>D){let U=1/Math.sqrt(V);f*=U,v*=U,I*=U}}a[s]=f,a[s+1]=v,a[s+2]=I,a[s+3]=E,s+=u}else for(let _=0;_<c;++_){let R=4*i[_],M=o[R],x=o[R+1],T=o[R+2],E=o[R+3],f=m*M+y*x+N*T,v=d*M+b*x+w*T,I=A*M+O*x+B*T;if(L){let V=f*f+v*v+I*I;if(V<C&&V>D){let U=1/Math.sqrt(V);f*=U,v*=U,I*=U}}for(let V=0;V<l;++V)a[s]=f,a[s+1]=v,a[s+2]=I,a[s+3]=E,s+=u}}function Xa(t,e,r,s,l=1){let{data:o,indices:i}=t,n=r.typedBuffer,a=r.typedBufferStride,u=i.length;if(s*=a,e!==o.length||e!==4)if(l!==1)if(e!==4)for(let c=0;c<u;++c){let m=3*i[c];for(let d=0;d<l;++d)n[s]=o[m],n[s+1]=o[m+1],n[s+2]=o[m+2],n[s+3]=255,s+=a}else for(let c=0;c<u;++c){let m=4*i[c];for(let d=0;d<l;++d)n[s]=o[m],n[s+1]=o[m+1],n[s+2]=o[m+2],n[s+3]=o[m+3],s+=a}else{if(e===4){for(let c=0;c<u;++c){let m=4*i[c];n[s]=o[m],n[s+1]=o[m+1],n[s+2]=o[m+2],n[s+3]=o[m+3],s+=a}return}for(let c=0;c<u;++c){let m=3*i[c];n[s]=o[m],n[s+1]=o[m+1],n[s+2]=o[m+2],n[s+3]=255,s+=a}}else{n[s]=o[0],n[s+1]=o[1],n[s+2]=o[2],n[s+3]=o[3];let c=new Uint32Array(r.typedBuffer.buffer,r.start),m=a/4,d=c[s/=4];s+=m;let A=u*l;for(let y=1;y<A;++y)c[s]=d,s+=m}}function Ka(t,e,r){let{data:s,indices:l}=t,o=e.typedBuffer,i=e.typedBufferStride,n=l.length,a=s[0];r*=i;for(let u=0;u<n;++u)o[r]=a,r+=i}function Qa(t,e,r,s,l=1){let o=e.typedBuffer,i=e.typedBufferStride;if(s*=i,l===1)for(let n=0;n<r;++n)o[s]=t[0],o[s+1]=t[1],o[s+2]=t[2],o[s+3]=t[3],s+=i;else for(let n=0;n<r;++n)for(let a=0;a<l;++a)o[s]=t[0],o[s+1]=t[1],o[s+2]=t[2],o[s+3]=t[3],s+=i}function Xs(t,e,r,s,l,o){for(let i of e.fields.keys()){let n=t.attributes.get(i),a=n?.indices;if(n&&a)$a(i,n,r,s,l,o);else if(i===S.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){let u=t.attributes.get(S.POSITION)?.indices;if(u){let c=u.length,m=l.getField(i,Fe);Qa(t.objectAndLayerIdColor,m,c,o)}}}}function $a(t,e,r,s,l,o){switch(t){case S.POSITION:{F(e.size===3);let i=l.getField(t,Ve);F(!!i,`No buffer view for ${t}`),i&&qa(e,r,i,o);break}case S.NORMAL:{F(e.size===3);let i=l.getField(t,Ve);F(!!i,`No buffer view for ${t}`),i&&Wa(e,s,i,o);break}case S.NORMALCOMPRESSED:{F(e.size===2);let i=l.getField(t,Pr);F(!!i,`No buffer view for ${t}`),i&&qs(e,i,o);break}case S.UV0:{F(e.size===2);let i=l.getField(t,vr);F(!!i,`No buffer view for ${t}`),i&&qs(e,i,o);break}case S.COLOR:case S.SYMBOLCOLOR:{let i=l.getField(t,Fe);F(!!i,`No buffer view for ${t}`),F(e.size===3||e.size===4),!i||e.size!==3&&e.size!==4||Xa(e,e.size,i,o);break}case S.COLORFEATUREATTRIBUTE:{let i=l.getField(t,br);F(!!i,`No buffer view for ${t}`),F(e.size===1),i&&e.size===1&&Ka(e,i,o);break}case S.TANGENT:{F(e.size===4);let i=l.getField(t,Xe);F(!!i,`No buffer view for ${t}`),i&&ja(e,r,i,o);break}case S.PROFILERIGHT:case S.PROFILEUP:case S.PROFILEVERTEXANDNORMAL:case S.FEATUREVALUE:{F(e.size===4);let i=l.getField(t,Xe);F(!!i,`No buffer view for ${t}`),i&&js(e,i,o)}}}var gt=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(S.POSITION).indices.length}write(e,r,s,l,o){Xs(s,this.vertexBufferLayout,e,r,l,o)}};var Ki={func:q.LESS},Qi={func:q.ALWAYS},Ks={mask:255};var Qs={function:{func:q.ALWAYS,ref:ae.OutlineVisualElementMask,mask:ae.OutlineVisualElementMask},operation:{fail:W.KEEP,zFail:W.KEEP,zPass:W.ZERO}},$s={function:{func:q.ALWAYS,ref:ae.OutlineVisualElementMask,mask:ae.OutlineVisualElementMask},operation:{fail:W.KEEP,zFail:W.KEEP,zPass:W.REPLACE}},$i={function:{func:q.EQUAL,ref:ae.OutlineVisualElementMask,mask:ae.OutlineVisualElementMask},operation:{fail:W.KEEP,zFail:W.KEEP,zPass:W.KEEP}},Yi={function:{func:q.NOTEQUAL,ref:ae.OutlineVisualElementMask,mask:ae.OutlineVisualElementMask},operation:{fail:W.KEEP,zFail:W.KEEP,zPass:W.KEEP}};function Ys({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:s,emissiveTexture:l,emissiveFactor:o,occlusionTexture:i}){return t==null&&e==null&&l==null&&(o==null||yr(o,Tr))&&i==null&&(s==null||s===1)&&(r==null||r===1)}var At=[1,1,.5],Zs=[0,.6,.2],Js=[0,1,.2];var _t=class extends ms{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=je(At),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=j.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ie(0,0,0),this.instancedDoublePrecision=!1,this.normalType=K.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ie(.2,.2,.2),this.diffuse=Ie(.8,.8,.8),this.externalColor=Or(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=P(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=ce.Less,this.textureAlphaMode=G.Blend,this.textureAlphaCutoff=.1,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=ns.Occlude,this.isDecoration=!1}};var Ee=class t extends fs{initializeConfiguration(e,r){r.spherical=e.viewingMode===Re.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?Ge.Default:Ge.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,t.shader)}_initializeProgram(e,r){return new ps(e.rctx,r.get().build(this.configuration),as)}_makePipeline(e,r){let s=this.configuration,l=e===Z.NONE,o=e===Z.FrontFace;return cs({blending:s.output===X.Color&&s.transparent?l?Bs:Ds(e):null,culling:Ja(s)?ls(s.cullFace):null,depthTest:{func:Vs(e,Za(s.customDepthTest))},depthWrite:(l||o)&&s.writeDepth?kt:null,drawBuffers:s.output===X.Depth?{buffers:[Dr.NONE]}:Fs(e),colorWrite:us,stencilWrite:s.hasOccludees?Ks:null,stencilTest:s.hasOccludees?r?$s:Qs:null,polygonOffset:l||o?null:Ls(s.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Za(t){return t===ce.Lequal?q.LEQUAL:q.LESS}function Ja(t){return t.cullFace!==j.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}Ee.shader=new ct(ds,()=>import("./chunk-B4R74RJO.js"));var Oe=class extends hs{};p([h({constValue:!0})],Oe.prototype,"hasSliceHighlight",void 0),p([h({constValue:!1})],Oe.prototype,"hasSliceInVertexProgram",void 0),p([h({constValue:Wr.Pass})],Oe.prototype,"pbrTextureBindType",void 0);var g=class extends Oe{constructor(){super(...arguments),this.output=X.Color,this.alphaDiscardMode=G.Opaque,this.doubleSidedMode=ee.None,this.pbrMode=Me.Disabled,this.cullFace=j.None,this.transparencyPassType=Z.NONE,this.normalType=K.Attribute,this.textureCoordinateType=Ge.None,this.customDepthTest=ce.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};p([h({count:X.COUNT})],g.prototype,"output",void 0),p([h({count:G.COUNT})],g.prototype,"alphaDiscardMode",void 0),p([h({count:ee.COUNT})],g.prototype,"doubleSidedMode",void 0),p([h({count:Me.COUNT})],g.prototype,"pbrMode",void 0),p([h({count:j.COUNT})],g.prototype,"cullFace",void 0),p([h({count:Z.COUNT})],g.prototype,"transparencyPassType",void 0),p([h({count:K.COUNT})],g.prototype,"normalType",void 0),p([h({count:Ge.COUNT})],g.prototype,"textureCoordinateType",void 0),p([h({count:ce.COUNT})],g.prototype,"customDepthTest",void 0),p([h()],g.prototype,"spherical",void 0),p([h()],g.prototype,"hasVertexColors",void 0),p([h()],g.prototype,"hasSymbolColors",void 0),p([h()],g.prototype,"hasVerticalOffset",void 0),p([h()],g.prototype,"hasSlicePlane",void 0),p([h()],g.prototype,"hasSliceHighlight",void 0),p([h()],g.prototype,"hasColorTexture",void 0),p([h()],g.prototype,"hasMetallicRoughnessTexture",void 0),p([h()],g.prototype,"hasEmissionTexture",void 0),p([h()],g.prototype,"hasOcclusionTexture",void 0),p([h()],g.prototype,"hasNormalTexture",void 0),p([h()],g.prototype,"hasScreenSizePerspective",void 0),p([h()],g.prototype,"hasVertexTangents",void 0),p([h()],g.prototype,"hasOccludees",void 0),p([h()],g.prototype,"multipassEnabled",void 0),p([h()],g.prototype,"hasModelTransformation",void 0),p([h()],g.prototype,"offsetBackfaces",void 0),p([h()],g.prototype,"vvSize",void 0),p([h()],g.prototype,"vvColor",void 0),p([h()],g.prototype,"receiveShadows",void 0),p([h()],g.prototype,"receiveAmbientOcclusion",void 0),p([h()],g.prototype,"textureAlphaPremultiplied",void 0),p([h()],g.prototype,"instanced",void 0),p([h()],g.prototype,"instancedColor",void 0),p([h()],g.prototype,"objectAndLayerIdColorInstanced",void 0),p([h()],g.prototype,"instancedDoublePrecision",void 0),p([h()],g.prototype,"doublePrecisionRequiresObfuscation",void 0),p([h()],g.prototype,"writeDepth",void 0),p([h()],g.prototype,"transparent",void 0),p([h()],g.prototype,"enableOffset",void 0),p([h()],g.prototype,"cullAboveGround",void 0),p([h()],g.prototype,"snowCover",void 0),p([h()],g.prototype,"hasColorTextureTransform",void 0),p([h()],g.prototype,"hasEmissionTextureTransform",void 0),p([h()],g.prototype,"hasNormalTextureTransform",void 0),p([h()],g.prototype,"hasOcclusionTextureTransform",void 0),p([h()],g.prototype,"hasMetallicRoughnessTextureTransform",void 0),p([h({constValue:!1})],g.prototype,"occlusionPass",void 0),p([h({constValue:!0})],g.prototype,"hasVvInstancing",void 0),p([h({constValue:!1})],g.prototype,"useCustomDTRExponentForWater",void 0),p([h({constValue:!1})],g.prototype,"supportsTextureAtlas",void 0),p([h({constValue:!0})],g.prototype,"useFillLights",void 0);var Ze=class t extends Ee{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=K.Attribute,r.doubleSidedMode=ee.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,t.shader)}};Ze.shader=new ct(Ts,()=>import("./chunk-JKDFS5OE.js"));var fe=class extends is{constructor(e){super(e,eo),this.supportsEdges=!0,this.produces=new Map([[ze.OPAQUE_MATERIAL,r=>(lt(r)||nt(r))&&!this.parameters.transparent],[ze.TRANSPARENT_MATERIAL,r=>(lt(r)||nt(r))&&this.parameters.transparent&&this.parameters.writeDepth],[ze.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>(lt(r)||nt(r))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new g,this._vertexBufferLayout=to(this.parameters)}isVisibleForOutput(e){return e!==X.Shadow&&e!==X.ShadowExcludeHighlight&&e!==X.ShadowHighlight||this.parameters.castShadows}isVisible(){let e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;let{hasInstancedColor:r,hasVertexColors:s,hasSymbolColors:l,vvColor:o}=e,i=e.colorMixMode==="replace",n=e.opacity>0,a=e.externalColor&&e.externalColor[3]>0,u=r||o||l;return s&&u?i||n:s?i?a:n:u?i||n:i?a:n}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?j.None:this.parameters.cullFace,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e===X.Color&&(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=ee.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ee.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ee.WindingOrder:ee.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&r.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Me.Schematic:Me.Normal:Me.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<Ns,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,s,l,o,i){if(this.parameters.verticalOffset!=null){let n=s.camera;k(Zt,r[12],r[13],r[14]);let a=null;switch(s.viewingMode){case Re.Global:a=_e(ea,Zt);break;case Re.Local:a=Be(ea,ao)}let u=0,c=De(oo,Zt,n.eye),m=z(c),d=vt(c,c,1/m),A=null;this.parameters.screenSizePerspective&&(A=Ar(a,d)),u+=os(n,m,this.parameters.verticalOffset,A??0,this.parameters.screenSizePerspective),vt(a,a,u),xr(Yt,a,s.transform.inverseRotation),l=De(ro,l,Yt),o=De(so,o,Yt)}Us(e,s,l,o,ks(s.verticalOffset),i)}createGLMaterial(e){return new Jt(e)}createBufferWriter(){return new gt(this._vertexBufferLayout)}},Jt=class extends ss{constructor(e){super($($({},e),e.material.parameters))}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===X.Color&&(this._updateShadowState(e),this._updateOccludeeState(e));let r=this._material.parameters;this.updateTexture(r.textureId);let s=e.camera.viewInverseTransposeMatrix;return k(r.origin,s[3],s[7],s[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?Ze:Ee,e)}},er=class extends _t{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}},eo=new er;function to(t){let e=Br().vec3f(S.POSITION);return t.normalType===K.Compressed?e.vec2i16(S.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(S.NORMAL),t.hasVertexTangents&&e.vec4f(S.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(S.UV0),t.hasVertexColors&&e.vec4u8(S.COLOR),t.hasSymbolColors&&e.vec4u8(S.SYMBOLCOLOR),or("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(S.OBJECTANDLAYERIDCOLOR),e}var ro=P(),so=P(),ao=Ie(0,0,1),ea=P(),Yt=P(),Zt=P(),oo=P();var oe=()=>tt.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function ta(t,e){return H(this,null,function*(){let r=yield io(t,e),s=yield co(r.textureDefinitions??{},e),l=0;for(let o in s)if(s.hasOwnProperty(o)){let i=s[o];l+=i?.image?i.image.width*i.image.height*4:0}return{resource:r,textures:s,size:l+ir(r)}})}function io(t,e){return H(this,null,function*(){let r=e?.streamDataRequester;if(r)return no(t,r,e);let s=yield Ot(dr(t,e));if(s.ok===!0)return s.value.data;Mt(s.error),ra(s.error)})}function no(t,e,r){return H(this,null,function*(){let s=yield Ot(e.request(t,"json",r));if(s.ok===!0)return s.value;Mt(s.error),ra(s.error.details.url)})}function ra(t){throw new Pe("",`Request for object resource failed: ${t}`)}function lo(t){let e=t.params,r=e.topology,s=!0;switch(e.vertexAttributes||(oe().warn("Geometry must specify vertex attributes"),s=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{let o=e.faces;if(o){if(e.vertexAttributes)for(let i in e.vertexAttributes){let n=o[i];n?.values?(n.valueType!=null&&n.valueType!=="UInt32"&&(oe().warn(`Unsupported indexed geometry indices type '${n.valueType}', only UInt32 is currently supported`),s=!1),n.valuesPerElement!=null&&n.valuesPerElement!==1&&(oe().warn(`Unsupported indexed geometry values per element '${n.valuesPerElement}', only 1 is currently supported`),s=!1)):(oe().warn(`Indexed geometry does not specify face indices for '${i}' attribute`),s=!1)}}else oe().warn("Indexed geometries must specify faces"),s=!1;break}default:oe().warn(`Unsupported topology '${r}'`),s=!1}t.params.material||(oe().warn("Geometry requires material"),s=!1);let l=t.params.vertexAttributes;for(let o in l)l[o].values||(oe().warn("Geometries with externally defined attributes are not yet supported"),s=!1);return s}function sa(t,e){let r=new Array,s=new Array,l=new Array,o=new rs,i=t.resource,n=Ut.parse(i.version||"1.0","wosr");fo.validate(n);let a=i.model.name,u=i.model.geometries,c=i.materialDefinitions??{},m=t.textures,d=0,A=new Map;for(let y=0;y<u.length;y++){let b=u[y];if(!lo(b))continue;let O=mo(b),N=b.params.vertexAttributes,w=[],B=f=>{if(b.params.topology==="PerAttributeArray")return null;let v=b.params.faces;for(let I in v)if(I===f)return v[I].values;return null},L=N[S.POSITION],D=L.values.length/L.valuesPerElement;for(let f in N){let v=N[f],I=v.values,V=B(f)??Nr(D);w.push([f,new ue(I,V,v.valuesPerElement,!0)])}let C=O.texture,_=m&&m[C];if(_&&!A.has(C)){let{image:f,parameters:v}=_,I=new ke(f,v);s.push(I),A.set(C,I)}let R=A.get(C),M=R?R.id:void 0,x=O.material,T=o.get(x,C);if(T==null){let f=c[x.substring(x.lastIndexOf("/")+1)].params;f.transparency===1&&(f.transparency=0);let v=_&&_.alphaChannelUsage,I=f.transparency>0||v==="transparency"||v==="maskAndTransparency",V=_?aa(_.alphaChannelUsage):void 0,U={ambient:je(f.diffuse),diffuse:je(f.diffuse),opacity:1-(f.transparency||0),transparent:I,textureAlphaMode:V,textureAlphaCutoff:.33,textureId:M,initTextureTransparent:!0,doubleSided:!0,cullFace:j.None,colorMixMode:f.externalColorMixMode||"tint",textureAlphaPremultiplied:_?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(U,e.materialParameters),T=new fe(U),o.set(x,C,T)}l.push(T);let E=new ot(T,w);d+=w.find(f=>f[0]===S.POSITION)?.[1]?.indices.length??0,r.push(E)}return{engineResources:[{name:a,stageResources:{textures:s,materials:l,geometries:r},pivotOffset:i.model.pivotOffset,numberOfVertices:d,lodThreshold:null}],referenceBoundingBox:uo(r)}}function uo(t){let e=rt();return t.forEach(r=>{let s=r.boundingInfo;s!=null&&(Le(e,s.bbMin),Le(e,s.bbMax))}),e}function co(t,e){return H(this,null,function*(){let r=new Array;for(let o in t){let i=t[o],n=i.images[0].data;if(!n){oe().warn("Externally referenced texture data is not yet supported");continue}let a=i.encoding+";base64,"+n,u="/textureDefinitions/"+o,c=i.channels==="rgba"?i.alphaChannelUsage||"transparency":"none",m={noUnpackFlip:!0,wrap:{s:ye.REPEAT,t:ye.REPEAT},preMultiplyAlpha:aa(c)!==G.Opaque},d=e?.disableTextures?Promise.resolve(null):ut(a,e);r.push(d.then(A=>({refId:u,image:A,parameters:m,alphaChannelUsage:c})))}let s=yield Promise.all(r),l={};for(let o of s)l[o.refId]=o;return l})}function aa(t){switch(t){case"mask":return G.Mask;case"maskAndTransparency":return G.MaskBlend;case"none":return G.Opaque;default:return G.Blend}}function mo(t){let e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}var fo=new Ut(1,2,"wosr");function Au(t,e){return H(this,null,function*(){let r=po(jr(t));if(r.fileType==="wosr"){let m=yield e.cache?e.cache.loadWOSR(r.url,e):ta(r.url,e),{engineResources:d,referenceBoundingBox:A}=sa(m,e);return{lods:d,referenceBoundingBox:A,isEsriSymbolResource:!1,isWosr:!0}}let s=yield e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):Zr(new Yr(e.streamDataRequester),r.url,e,e.usePBR),l=s.model.meta?.ESRI_proxyEllipsoid,o=s.meta.isEsriSymbolResource&&l!=null&&s.meta.ESRI_webstyle==="EsriRealisticTreesStyle";o&&!s.customMeta.esriTreeRendering&&(s.customMeta.esriTreeRendering=!0,_o(s,l));let i=!!e.usePBR,n=s.meta.isEsriSymbolResource?{usePBR:i,isSchematic:!1,treeRendering:o,mrrFactors:[...Js]}:{usePBR:i,isSchematic:!1,treeRendering:!1,mrrFactors:[...At]},a=et($({},e.materialParameters),{treeRendering:o}),{engineResources:u,referenceBoundingBox:c}=ho(s,n,a,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:u,referenceBoundingBox:c,isEsriSymbolResource:s.meta.isEsriSymbolResource,isWosr:!1}})}function po(t){let e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function ho(t,e,r,s){let l=t.model,o=new Array,i=new Map,n=new Map,a=l.lods.length,u=rt();return l.lods.forEach((c,m)=>{let d=s.skipHighLods===!0&&(a>1&&m===0||a>3&&m===1)||s.skipHighLods===!1&&s.singleLodIndex!=null&&m!==s.singleLodIndex;if(d&&m!==0)return;let A=new mt(c.name,c.lodThreshold,[0,0,0]);c.parts.forEach(y=>{let b=d?new fe({}):To(l,y,A,e,r,i,n),{geometry:O,vertexCount:N}=go(y,b??new fe({})),w=O.boundingInfo;w!=null&&m===0&&(Le(u,w.bbMin),Le(u,w.bbMax)),b!=null&&(A.stageResources.geometries.push(O),A.numberOfVertices+=N)}),d||o.push(A)}),{engineResources:o,referenceBoundingBox:u}}function To(t,e,r,s,l,o,i){let n=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),a=t.materials.get(e.material),u=e.attributes.texCoord0!=null,c=e.attributes.normal!=null;if(a==null)return null;let m=Ao(a.alphaMode);if(!o.has(n)){if(u){let C=(_,R=!1)=>{if(_!=null&&!i.has(_)){let M=t.textures.get(_);if(M!=null){let x=M.data;i.set(_,new ke(it(x)?x.data:x,et($({},M.parameters),{preMultiplyAlpha:!it(x)&&R,encoding:it(x)&&x.encoding!=null?x.encoding:void 0})))}}};C(a.textureColor,m!==G.Opaque),C(a.textureNormal),C(a.textureOcclusion),C(a.textureEmissive),C(a.textureMetallicRoughness)}let A=a.color[0]**(1/2.1),y=a.color[1]**(1/2.1),b=a.color[2]**(1/2.1),O=a.emissiveFactor[0]**(1/2.1),N=a.emissiveFactor[1]**(1/2.1),w=a.emissiveFactor[2]**(1/2.1),B=a.textureColor!=null&&u?i.get(a.textureColor):null,L=Ys({normalTexture:a.textureNormal,metallicRoughnessTexture:a.textureMetallicRoughness,metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor,emissiveTexture:a.textureEmissive,emissiveFactor:a.emissiveFactor,occlusionTexture:a.textureOcclusion}),D=a.normalTextureTransform?.scale!=null?a.normalTextureTransform?.scale:Ir;o.set(n,new fe($(et($({},s),{transparent:m===G.Blend,customDepthTest:ce.Lequal,textureAlphaMode:m,textureAlphaCutoff:a.alphaCutoff,diffuse:[A,y,b],ambient:[A,y,b],opacity:a.opacity,doubleSided:a.doubleSided,doubleSidedType:"winding-order",cullFace:a.doubleSided?j.None:j.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:c?K.Attribute:K.ScreenDerivative,castShadows:!0,receiveShadows:a.receiveShadows,receiveAmbientOcclusion:a.receiveAmbientOcclustion,textureId:B?.id,colorMixMode:a.colorMixMode,normalTextureId:a.textureNormal!=null&&u?i.get(a.textureNormal).id:void 0,textureAlphaPremultiplied:B!=null&&!!B.parameters.preMultiplyAlpha,occlusionTextureId:a.textureOcclusion!=null&&u?i.get(a.textureOcclusion).id:void 0,emissiveTextureId:a.textureEmissive!=null&&u?i.get(a.textureEmissive).id:void 0,metallicRoughnessTextureId:a.textureMetallicRoughness!=null&&u?i.get(a.textureMetallicRoughness).id:void 0,emissiveFactor:[O,N,w],mrrFactors:L?[...Zs]:[a.metallicFactor,a.roughnessFactor,s.mrrFactors[2]],isSchematic:L,colorTextureTransformMatrix:He(a.colorTextureTransform),normalTextureTransformMatrix:He(a.normalTextureTransform),scale:[D[0],D[1]],occlusionTextureTransformMatrix:He(a.occlusionTextureTransform),emissiveTextureTransformMatrix:He(a.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:He(a.metallicRoughnessTextureTransform)}),l)))}let d=o.get(n);if(r.stageResources.materials.push(d),u){let A=y=>{y!=null&&r.stageResources.textures.push(i.get(y))};A(a.textureColor),A(a.textureNormal),A(a.textureOcclusion),A(a.textureEmissive),A(a.textureMetallicRoughness)}return d}function go(t,e){let r=t.attributes.position.count,s=Jr(t.indices||r,t.primitiveType),l=Ke(3*r),{typedBuffer:o,typedBufferStride:i}=t.attributes.position;Fr(l,o,t.transform,3,i);let n=[[S.POSITION,new ue(l,s,3,!0)]];if(t.attributes.normal!=null){let u=Ke(3*r),{typedBuffer:c,typedBufferStride:m}=t.attributes.normal;Vr(We,t.transform),Ur(u,c,We,3,m),Ct(We)&&Vt(u,u),n.push([S.NORMAL,new ue(u,s,3,!0)])}if(t.attributes.tangent!=null){let u=Ke(4*r),{typedBuffer:c,typedBufferStride:m}=t.attributes.tangent;Lr(We,t.transform),Gr(u,c,We,4,m),Ct(We)&&Vt(u,u,4),n.push([S.TANGENT,new ue(u,s,4,!0)])}if(t.attributes.texCoord0!=null){let u=Ke(2*r),{typedBuffer:c,typedBufferStride:m}=t.attributes.texCoord0;Kr(u,c,2,m),n.push([S.UV0,new ue(u,s,2,!0)])}let a=t.attributes.color;if(a!=null){let u=new Uint8Array(4*r);a.elementCount===4?a instanceof Xe?Ft(u,a,255):a instanceof Fe?$r(u,a):a instanceof wr&&Ft(u,a,1/256):(u.fill(255),a instanceof Ve?Lt(u,a.typedBuffer,255,4,a.typedBufferStride):t.attributes.color instanceof Sr?Qr(u,a.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof Cr&&Lt(u,a.typedBuffer,1/256,4,a.typedBufferStride)),n.push([S.COLOR,new ue(u,s,4,!0)])}return{geometry:new ot(e,n),vertexCount:r}}var We=Qe();function Ao(t){switch(t){case"BLEND":return G.Blend;case"MASK":return G.Mask;case"OPAQUE":case null:case void 0:return G.Opaque}}function _o(t,e){for(let r=0;r<t.model.lods.length;++r){let s=t.model.lods[r];for(let l of s.parts){let o=l.attributes.normal;if(o==null)return;let i=l.attributes.position,n=i.count,a=P(),u=P(),c=P(),m=new Uint8Array(4*n),d=new Float64Array(3*n),A=wt(Nt(),l.transform),y=0,b=0;for(let O=0;O<n;O++){i.getVec(O,u),o.getVec(O,a),Ne(u,u,l.transform),De(c,u,e.center),bt(c,c,e.radius);let N=c[2],w=z(c),B=Math.min(.45+.55*w*w,1);bt(c,c,e.radius),A!==null&&Ne(c,c,A),_e(c,c),r+1!==t.model.lods.length&&t.model.lods.length>1&&_r(c,c,a,N>-1?.2:Math.min(-4*N-3.8,1)),d[y]=c[0],d[y+1]=c[1],d[y+2]=c[2],y+=3,m[b]=255*B,m[b+1]=255*B,m[b+2]=255*B,m[b+3]=255,b+=4}l.attributes.normal=new Ve(d),l.attributes.color=new Fe(m)}}}export{Au as fetch,ho as gltfToEngineResources,po as parseUrl};
