import{a as yi}from"./chunk-CKGQR2CH.js";import"./chunk-TU23MJ7K.js";import"./chunk-SPZCBP4U.js";import"./chunk-TH4OZ7JG.js";import{a as Sr}from"./chunk-7CXN6ETB.js";import"./chunk-VLYLJQZR.js";import"./chunk-ULULEDTA.js";import{k as Le,l as Nt,m as Er,n as Tr,p as Lr}from"./chunk-PVKVZEHO.js";import{a as Ir}from"./chunk-XKGZI4SQ.js";import{a as Pt}from"./chunk-52ASZ4HB.js";import{a as pi}from"./chunk-YW3L7OMP.js";import"./chunk-YSHPE5OC.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-BGBRD77V.js";import"./chunk-2T3SF7S4.js";import"./chunk-PT7FWA2O.js";import"./chunk-LHY2TOIB.js";import"./chunk-7QY3BMVN.js";import"./chunk-UQRO7IE7.js";import"./chunk-TNPL7MIN.js";import{a as Tt,b as Lt}from"./chunk-C5NQJ2VI.js";import{a as M,b as Ye,d as Vt,e as Bt,f as kr,g as Rr,h as Pr}from"./chunk-ONZVVE2M.js";import"./chunk-KOIUWRXN.js";import{a as Cr}from"./chunk-NRYRRRU5.js";import"./chunk-TM435WPY.js";import"./chunk-ZVQ6WPUX.js";import"./chunk-RZU6EEB3.js";import"./chunk-WDTJILD4.js";import"./chunk-ZL6WQNKD.js";import"./chunk-HKVOZBSD.js";import"./chunk-X22ES5JP.js";import"./chunk-3FD7DB74.js";import"./chunk-FMKLQJMC.js";import"./chunk-T6HRX4ZB.js";import"./chunk-QDAWFJTY.js";import"./chunk-DTN5RQPH.js";import"./chunk-TQ3JEA47.js";import"./chunk-WNDRUC36.js";import"./chunk-GBR6VCK5.js";import"./chunk-QVGNQ4QU.js";import"./chunk-FLGQJSPM.js";import"./chunk-PNQOUNPC.js";import"./chunk-XCYLC437.js";import"./chunk-7Q7N656Y.js";import{a as Mr}from"./chunk-ZSMLWXCC.js";import"./chunk-JOF5BLB6.js";import"./chunk-BDQSEOPW.js";import"./chunk-XFWB7ADZ.js";import"./chunk-2PAJT2T6.js";import"./chunk-LFJ4NQ4O.js";import"./chunk-CKBOXNTL.js";import"./chunk-ASQCBKGS.js";import"./chunk-KM4AMTZA.js";import"./chunk-6ZXTJQND.js";import"./chunk-DDNVXGXG.js";import"./chunk-2TKGGTPN.js";import"./chunk-ME7KOLYX.js";import"./chunk-DGXL7ZQL.js";import"./chunk-SYNRDAMR.js";import{a as gi}from"./chunk-VSMVTOQ2.js";import"./chunk-O3JFLEEW.js";import"./chunk-AC7AQWXQ.js";import"./chunk-PDLAJXIO.js";import"./chunk-FVB5KK7E.js";import"./chunk-RDFYI3QE.js";import"./chunk-ALOQFH4M.js";import"./chunk-GKFZCPUK.js";import"./chunk-FOMR7EMA.js";import"./chunk-UAPVW6JM.js";import{a as mi}from"./chunk-PVAWONWD.js";import"./chunk-VOMQSOTD.js";import"./chunk-VYW7XM4C.js";import"./chunk-AMCDNN62.js";import"./chunk-B5IFP6FP.js";import"./chunk-LXGJGX5J.js";import"./chunk-MNGFITIF.js";import"./chunk-P5F6DDDU.js";import"./chunk-SHSBHV6F.js";import"./chunk-ASFBXFQ5.js";import"./chunk-2XS3ER2F.js";import"./chunk-YRMBB4SJ.js";import"./chunk-LOEAA5XF.js";import{a as dt}from"./chunk-37Z33WA5.js";import"./chunk-C46XASX2.js";import{a as de}from"./chunk-NI2H25WT.js";import{b as yr,d as Rt,e as vr,f as br,g as wr,i as St,j as _r,k as Fr,l as De,m as hi}from"./chunk-67EKH3Q4.js";import{a as Et}from"./chunk-2FWBXOKU.js";import"./chunk-W4ZGXXVV.js";import"./chunk-QW4FGXMK.js";import"./chunk-M6ZEQBQT.js";import"./chunk-3FUKLVTW.js";import{c as fr,d as kt}from"./chunk-SEBAYBYC.js";import"./chunk-XWAJRRJ4.js";import"./chunk-VI3FHFCE.js";import"./chunk-W2FNMTJT.js";import"./chunk-KLIUUY5R.js";import"./chunk-CGEI3ID7.js";import"./chunk-I3S324BU.js";import"./chunk-JVM3RNQL.js";import"./chunk-OUB3GINH.js";import"./chunk-3ZAISB5N.js";import"./chunk-L3CFPONE.js";import"./chunk-AKHHPLWL.js";import"./chunk-LJMIV7GW.js";import{k as gr}from"./chunk-WSHEBM2J.js";import"./chunk-3UBRSNPL.js";import"./chunk-XDRSKFBJ.js";import"./chunk-MGUWZFOE.js";import"./chunk-JXUTKJIX.js";import"./chunk-MUZSZ4YH.js";import"./chunk-ZOEN7TLV.js";import"./chunk-YF3AUCDJ.js";import"./chunk-TUM5YCRC.js";import"./chunk-O5CPPU3T.js";import"./chunk-6KRFVLII.js";import"./chunk-ZGGYJV33.js";import{a as mr}from"./chunk-63TUJPJR.js";import{g as ur,i as pr,s as hr}from"./chunk-GDTXLKQK.js";import"./chunk-YNFZN34N.js";import"./chunk-SHSMFEO2.js";import{e as ee,f as V,g as q}from"./chunk-2TOKSLT2.js";import{a as nr}from"./chunk-MDSLION2.js";import{g as c,h as sr}from"./chunk-H5CKPFSK.js";import{f as le,g as ci,h as ui}from"./chunk-K6KBTDPE.js";import"./chunk-V2KSICSA.js";import{a as f,b as Be,c as ne,d as rr,f as or,g as C}from"./chunk-6A4M7X3R.js";import"./chunk-YRTOHBUA.js";import"./chunk-Y3PZSOWT.js";import"./chunk-KLDBOMH5.js";import"./chunk-USX74UBG.js";import"./chunk-OQ4BFXF7.js";import"./chunk-LDBOA2H7.js";import"./chunk-CXUCQMGY.js";import"./chunk-3CS3BPVL.js";import"./chunk-DFTBSFIN.js";import{E as Ot,L as xr,M as fi,c as $t,z as Ar}from"./chunk-WOZZR3L4.js";import"./chunk-LW5IAFEX.js";import"./chunk-AQ74ANSJ.js";import"./chunk-R2K3CL3U.js";import"./chunk-SAOUSUZE.js";import"./chunk-VNBPSOCW.js";import{h as cr}from"./chunk-F7Q25XKV.js";import"./chunk-CPGZIEVH.js";import"./chunk-L2DEVDHE.js";import"./chunk-Z5Q76SB7.js";import"./chunk-RU7UW4IO.js";import"./chunk-5QLB7ZJ7.js";import"./chunk-2ETW6ZBA.js";import"./chunk-6K7P7RRW.js";import"./chunk-7LRMKXZV.js";import"./chunk-BCREO4Q5.js";import"./chunk-E5R4OI7X.js";import{b as dr}from"./chunk-BNUHB4AP.js";import"./chunk-ZGLJFDS6.js";import"./chunk-RSDQHAJX.js";import{a as lt,b as Ie,c as Q}from"./chunk-PSYXGXKI.js";import"./chunk-Q6TYOK45.js";import{a as It,f as er,h as Ct,i as At}from"./chunk-QMDBAMTG.js";import{b as be}from"./chunk-RZA5H63B.js";import{a as Ji}from"./chunk-Y4PMIX35.js";import"./chunk-KVCIO4DX.js";import{a as ir}from"./chunk-NWBXT4EB.js";import"./chunk-4R2OFZPD.js";import"./chunk-WBI2AIMN.js";import"./chunk-FKQYBEPG.js";import"./chunk-ZHAVTBSG.js";import"./chunk-SBO2F6VY.js";import"./chunk-MMYIAMQR.js";import{g as lr,j as Xe}from"./chunk-UHTPPTOJ.js";import"./chunk-LP5GLSKB.js";import"./chunk-LTDZH3EN.js";import{O as xt}from"./chunk-3SBMUUA6.js";import"./chunk-II7TJXWX.js";import{a as ae}from"./chunk-X7Z55FTO.js";import"./chunk-B66V4PSA.js";import{a as tr}from"./chunk-A4HCVMB4.js";import{_ as ar}from"./chunk-AANS6QE5.js";import{H as a,K as U,b as nt}from"./chunk-RMOOROEO.js";import{S as w,m as Te,t as Ki}from"./chunk-ZP7G4HN4.js";import{a as n}from"./chunk-W3WDPWBE.js";import{l as Xi,o as Yi,p as at,q as Ft,r as ve,u as Mt,y as Qe}from"./chunk-43GG6PFR.js";import{b as Qi}from"./chunk-MLSR6YE6.js";import"./chunk-JPDAKIWT.js";import"./chunk-D62JNIRP.js";import"./chunk-VU5W7W6Y.js";import{n as ye,r as di,s as N,u as R}from"./chunk-3DV77WOO.js";import{c as st,m as ge}from"./chunk-NJG4JJ4L.js";import"./chunk-MDAB6L5Y.js";import"./chunk-NFHPZN57.js";import{a as b,b as pe,g as y}from"./chunk-3T7TAUC2.js";function qe(e,t,i,r){let o=null,s=1e3;typeof t=="number"?(s=t,r=i):(o=t??null,s=i);let l,d=0,u=()=>{d=0,e.apply(r,l)},p=(...h)=>{o&&o.apply(r,h),l=h,s?d||(d=setTimeout(u,s)):u()};return p.remove=()=>{d&&(clearTimeout(d),d=0)},p.forceUpdate=()=>{d&&(clearTimeout(d),u())},p.hasPendingUpdates=()=>!!d,p}function ct(e){switch(e?.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return null}}function $r(e){return e?{backgroundImage:`url(${e})`}:{}}function Or({action:e,feature:t}){let i=t?.attributes,r="image"in e?e.image:void 0;return r&&i?Q(r,i):r??""}function Xo(e,t){return{type:xt(t),value:e,unit:t}}function Yo(e,t){return{type:xt(t),value:e,unit:t}}function vi(e,t,i="arithmetic"){return{type:xt(t),value:e,unit:t,rotationType:i}}var Fn=Xo(0,"meters"),Mn=Yo(0,"square-meters"),In=vi(0,"radians"),Cn=vi(0,"degrees"),An=vi(0,"degrees","geographic");var Nr=["B","kB","MB","GB","TB"];function Vr(e,t){let i=(t=Math.round(t))===0?0:Math.floor(Math.log(t)/Math.log(pi.KILOBYTES));i=dr(i,0,Nr.length-1);let r=Ie(t/pi.KILOBYTES**i,{maximumFractionDigits:2});return ye(e.units.bytes[Nr[i]],{fileSize:r})}var Ko="esri.widgets.Feature.support.featureUtils",wi=()=>N.getLogger(Ko),Jo=/href=(""|'')/gi,es=/(\{([^{\r\n]+)\})/g,ts=/'/g,zr=/^\s*expression\//i,is=/(\n)/gi,rs=/[\u00A0-\u9999<>&]/gim,os=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,ss=/^(?:mailto:|tel:)/,Hr="relationships/",Br=Ct("short-date-short-time");function qt(e){if(e!=null)return(e.sourceLayer||e.layer)??void 0}function Ke(r){return y(this,arguments,function*({type:e,value:t,event:i}){try{return typeof t=="function"?t(i):t}catch(o){return void wi().error("error",`An error occurred when calling the "${e}" function`,{error:o,graphic:i.graphic,value:t})}})}function zt(e=""){if(e)return!ss.test(e.trim().toLowerCase())}function ut(e){return!!e&&zr.test(e)}function ns(e,t){if(!t||!ut(t)||!e)return;let i=t.replace(zr,"").toLowerCase();return e.find(({name:r})=>r.toLowerCase()===i)}function Ht(e,t){let i=ns(t,e?.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function as(e,t){return`{${t.get(e.toLowerCase())?.fieldName||e}}`}function ls(e){return e.replaceAll(Jo,"")}function ze(e,t){let i=_i(t,e);return i?i.name:e}function Wr(e,t){return e&&e.map(i=>ze(i,t))}function _i(e,t){return e&&typeof e.getField=="function"&&t?e.getField(t)??null:null}function jr(e){return`${e}`.trim()}function Ce({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:o,fieldInfoMap:s}){return r?Wt({formattedAttributes:t,template:ps(r,b(b(b({},t),o),e),i),fieldInfoMap:s}):""}function Wt({formattedAttributes:e,template:t,fieldInfoMap:i}){return jr(ls(ye(ye(t,r=>as(r,i)),e)))}function ds(e,t,i=!1){let r=t[e];if(typeof r=="string"){let o="%27",s=(i?encodeURIComponent(r):r).replaceAll(ts,o);t[e]=s}}function cs(e,t=!1){let i=b({},e);return Object.keys(i).forEach(r=>ds(r,i,t)),i}function us(e,t,i){let r=(t=jr(t))&&t[0]!=="{";return ye(e,cs(i,r||!1))}function jt(e,t){return e.replaceAll(es,(i,r,o)=>{let s=_i(t,o);return s?`{${s.name}}`:r})}function ps(e,t,i){let r=jt(e,i);return r&&r.replaceAll(os,(o,s,l)=>us(o,s||l,t))}function hs(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){let i=Number(e);if(!isNaN(i))return i}return e}function ms(e){return e!=null&&typeof e=="object"&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&(e.type==="feature"||e.type==="scene"||e.type==="sublayer")&&"when"in e}function fs(e){return e!=null&&typeof e=="object"&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function Fi(e){return ms(e)&&fs(e)}function gs(e,t){let{fieldInfos:i,fieldName:r,preventPlacesFormatting:o,layer:s,timeZone:l}=t,d=Mi(i,r),u=_i(s,r);if(d&&!fi(r)){let h=u?.type,m=d.format?.dateFormat;if(h==="date"||h==="date-only"||h==="time-only"||h==="timestamp-offset"||m)return Lt(e,{format:m,fieldType:h,timeZoneOptions:{layerTimeZone:s&&"preferredTimeZone"in s?s.preferredTimeZone:null,viewTimeZone:l,datesInUnknownTimezone:!(!s||!("datesInUnknownTimezone"in s))&&!!s.datesInUnknownTimezone}})}let p=d?.format;return typeof e=="string"&&fi(r)&&p?ys(e,p):typeof(e=hs(e,p))=="string"||e==null||p==null?Je(e):Ie(e,o?pe(b({},lt(p)),{minimumFractionDigits:0,maximumFractionDigits:20}):lt(p))}function ys(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?bi(e,",",", ",t):e.includes(";")?bi(e,";","; ",t):e.includes(" ")?bi(e," "," ",t):Ie(Number(e),lt(t))}function bi(e,t,i,r){return e.trim().split(t).map(o=>Ie(Number(o),lt(r))).join(i)}function Mi(e,t){if(e?.length&&t)return e.find(i=>i.fieldName?.toLowerCase()===t.toLowerCase())}function vs({fieldName:e,graphic:t,layer:i}){if(ce(e)||!i||typeof i.getFeatureType!="function")return null;let{typeIdField:r}=i;if(!r||e!==r)return null;let o=i.getFeatureType(t);return o?o.name:null}function bs({fieldName:e,value:t,graphic:i,layer:r}){if(ce(e)||!r||typeof r.getFieldDomain!="function")return null;let o=i&&r.getFieldDomain(e,{feature:i});return o&&o.type==="coded-value"?o.getName(t):null}function Ur(e,t,i,r){let{creatorField:o,creationDateField:s,editorField:l,editDateField:d}=e;if(!t)return;let u=er(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,i,Br,"date"),p=b(b({},Br),u),h=t[d];if(typeof h=="number"){let v=t[l];return{type:"edit",date:At(h,p),user:v}}let m=t[s];if(typeof m=="number"){let v=t[o];return{type:"create",date:At(m,p),user:v}}return null}function Zr(e,t){let i=new Map;if(!e)return i;for(let r of e){if(!r.fieldName)continue;let o=ze(r.fieldName,t);r.fieldName=o,i.set(o.toLowerCase(),r)}return i}function Ii(e){let t=[];if(!e)return t;let{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(o=>{if(o.type==="fields"){let s=o?.fieldInfos;s&&t.push(...s)}}),t}function Ut(e){return e.replaceAll(rs,t=>`&#${t.charCodeAt(0)};`)}function Je(e){return typeof e=="string"?e.replaceAll(is,'<br class="esri-text-new-line" />'):e}function Gr(e){let{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:o,layer:s,graphic:l,timeZone:d}=e;if(t==null)return"";let u=bs({fieldName:i,value:t,graphic:l,layer:s});if(u)return u;let p=vs({fieldName:i,graphic:l,layer:s});if(p)return p;if(o.get(i.toLowerCase()))return gs(t,{fieldInfos:r||Array.from(o.values()),fieldName:i,layer:s,timeZone:d});let h=s?.fieldsIndex?.get(i);return h&&(Tt(h)||Ot(h))?Lt(t,{fieldType:h.type,timeZoneOptions:{layerTimeZone:s&&"preferredTimeZone"in s?s.preferredTimeZone:null,viewTimeZone:d,datesInUnknownTimezone:!(!s||!("datesInUnknownTimezone"in s))&&!!s.datesInUnknownTimezone}}):Je(t)}function Zt({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:o,relatedInfos:s,timeZone:l}){let d={};return s?.forEach(u=>Fs({attributes:d,relatedInfo:u,fieldInfoMap:o,fieldInfos:e,layer:i,timeZone:l})),t&&Object.keys(t).forEach(u=>{let p=t[u];d[u]=Gr({fieldName:u,fieldInfos:e,fieldInfoMap:o,layer:i,value:p,graphic:r,timeZone:l})}),d}function Ci(e,t){return y(this,null,function*(){let{layer:i,graphic:r,outFields:o,objectIds:s,returnGeometry:l,spatialReference:d}=e,u=s[0];if(typeof u!="number"&&typeof u!="string"){let h="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:u,requiredFields:o};return wi().warn(h,m),null}if(!cr(i)?.operations?.supportsQuery){let h="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:o,returnGeometry:l};return wi().warn(h,m),null}let p=i.createQuery();return p.objectIds=s,p.outFields=o?.length?o:[i.objectIdField],p.returnGeometry=!!l,p.returnZ=!!l,p.returnM=!!l,p.outSpatialReference=d,(yield i.queryFeatures(p,t)).features[0]})}function ws(e){return y(this,null,function*(){if(!e.expressionInfos?.length)return!1;let t=yield $t(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)})}function Qr(s,l){return y(this,arguments,function*({graphic:e,popupTemplate:t,layer:i,spatialReference:r},o){if(!i||!t||(typeof i.load=="function"&&(yield i.load(o)),!e.attributes))return;let d=e.attributes[i.objectIdField];if(d==null)return;let u=[d],p=yield t.getRequiredFields(i.fieldsIndex),h=xr(p,e),m=h?[]:p,v=t.returnGeometry||(yield ws(t));if(h&&!v)return;let g=yield Ci({layer:i,graphic:e,outFields:m,objectIds:u,returnGeometry:v,spatialReference:r},o);g&&(g.geometry&&(e.geometry=g.geometry),g.attributes&&(e.attributes=b(b({},e.attributes),g.attributes)))})}function ce(e=""){return!!e&&e.includes(Hr)}function _s(e){return e?`${Hr}${e.layerId}/${e.fieldName}`:""}function Dr({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:o,layer:s,timeZone:l}){e&&t&&i&&Object.keys(t.attributes).forEach(d=>{let u=_s({layerId:i.relation.id.toString(),fieldName:d}),p=t.attributes[d];e[u]=Gr({fieldName:u,fieldInfos:r,fieldInfoMap:o,layer:s,value:p,graphic:t,timeZone:l})})}function Fs({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:o,timeZone:s}){e&&t&&(t.relatedFeatures?.forEach(l=>Dr({attributes:e,graphic:l,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:o,timeZone:s})),t.relatedStatsFeatures?.forEach(l=>Dr({attributes:e,graphic:l,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:o,timeZone:s})))}var qr=e=>{if(!e)return!1;let t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},Xr=({layer:e,method:t,query:i,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||t==="attachments")return;let o=i.where!=null?i.where:null,s=i.geometry!=null?i.geometry:null;qr(r)||qr(o)||s?.type==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},Yr=({query:e,layer:t,method:i})=>{Xr({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},Kr=({queryPayload:e,layer:t,method:i})=>{Xr({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})};function Jr(e,t,i){return e&&t&&i?t.type==="sublayer"?Dt({layers:t.layer?.sublayers,layer:t,relationship:i})||Dt({layers:t.layer?.subtables,layer:t,relationship:i}):Dt({layers:e.allLayers,layer:t,relationship:i})||Dt({layers:e.allTables,layer:t,relationship:i}):null}function Dt({relationship:{relatedTableId:e},layer:t,layers:i}){if(!i)return null;let r=i.filter(Fi);if(t.type==="sublayer")return r.find(s=>s!==t&&s.id===e);let o=t.type==="scene"&&t.associatedLayer?t.associatedLayer.url:t.url;return o?r.find(s=>s!==t&&s.url===o&&s.layerId===e):null}var eo={editing:!1,operations:{add:!0,update:!0,delete:!0}},to=be.ofType(Ir),te=class extends U{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities=b({},eo),this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new to,this.fileInfos=new be,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(f(()=>this.graphic,()=>this._graphicChanged(),C))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return b(b({},eo),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){let{graphic:e}=this;if(!e)return!1;let t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){return y(this,null,function*(){let{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new R("invalid-layer","getAttachments(): A valid layer is required.");let i=this._getObjectId(),r=new mi({objectIds:[i],returnMetadata:!0}),o=[],s=e.queryAttachments(r).then(d=>d[i]||o).catch(()=>o);this._getAttachmentsPromise=s,this.notifyChange("state");let l=yield s;return t.drain(d=>d.destroy()),l.length&&t.addMany(l),this._getAttachmentsPromise=null,this.notifyChange("state"),l})}addAttachment(i){return y(this,arguments,function*(e,t=this.graphic){let{_attachmentLayer:r,attachmentInfos:o,capabilities:s}=this;if(!t)throw new R("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new R("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations?.add)throw new R("invalid-capabilities","addAttachment(): add capabilities are required.");if(!r||typeof r.addAttachment!="function")throw new R("invalid-layer","addAttachment(): A valid layer is required.");let l=r.addAttachment(t,e).then(u=>this._queryAttachment(u.objectId,t)),d=yield l;return o.add(d),d})}deleteAttachment(e){return y(this,null,function*(){let{_attachmentLayer:t,attachmentInfos:i,graphic:r,capabilities:o}=this;if(!e)throw new R("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!o.operations?.delete)throw new R("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new R("invalid-layer","deleteAttachment(): A valid layer is required.");if(!r)throw new R("invalid-graphic","deleteAttachment(): A graphic is required.");let s=t.deleteAttachments(r,[e.id]).then(()=>e),l=yield s;return i.remove(l),l.destroy(),l})}updateAttachment(i){return y(this,arguments,function*(e,t=this.activeAttachmentInfo){let{_attachmentLayer:r,attachmentInfos:o,graphic:s,capabilities:l}=this;if(!e)throw new R("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new R("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!l.operations?.update)throw new R("invalid-capabilities","updateAttachment(): Update capabilities are required.");let d=o.indexOf(t);if(!r||typeof r.updateAttachment!="function")throw new R("invalid-layer","updateAttachment(): A valid layer is required.");if(!s)throw new R("invalid-graphic","updateAttachment(): A graphic is required.");let u=r.updateAttachment(s,t.id,e).then(h=>this._queryAttachment(h.objectId)),p=yield u;return o.splice(d,1,p),p})}commitFiles(){return y(this,null,function*(){return yield Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()})}addFile(e,t){if(!e||!t)return null;let i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t,i=this.activeFileInfo){if(!e||!t||!i)return null;let r=this.fileInfos.indexOf(i);return r>-1&&this.fileInfos.splice(r,1,{file:e,form:t}),this.fileInfos.items[r]}deleteFile(e){let t=this.fileInfos.find(i=>i.file===e);return t?(this.fileInfos.remove(t),t):null}_queryAttachment(e,t){return y(this,null,function*(){let{_attachmentLayer:i}=this;if(!e||!i?.queryAttachments)throw new R("invalid-attachment-id","Could not query attachment.");let r=this._getObjectId(t),o=new mi({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(o).then(s=>s[r][0])})}_getObjectId(e=this.graphic){return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){let{graphic:e}=this,t=qt(e);this._attachmentLayer=t?t.type==="scene"&&t.associatedLayer!=null?t.associatedLayer:t:null}};n([a()],te.prototype,"capabilities",void 0),n([ae("capabilities")],te.prototype,"castCapabilities",null),n([a()],te.prototype,"activeAttachmentInfo",void 0),n([a()],te.prototype,"activeFileInfo",void 0),n([a({readOnly:!0,type:to})],te.prototype,"attachmentInfos",void 0),n([a()],te.prototype,"fileInfos",void 0),n([a({type:de})],te.prototype,"graphic",void 0),n([a()],te.prototype,"mode",void 0),n([a({readOnly:!0})],te.prototype,"state",null),n([a()],te.prototype,"filesEnabled",void 0),n([a({readOnly:!0})],te.prototype,"supportsResizeAttachments",null),te=n([w("esri.widgets.Attachments.AttachmentsViewModel")],te);var pt=te;function Ai(e){let t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function io(e){let t=tr("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}var he={arrowDown:"esri-icon-arrow-down",arrowUp:"esri-icon-arrow-up",calendar:"esri-icon-calendar",checkMark:"esri-icon-check-mark",checkboxUnchecked:"esri-icon-checkbox-unchecked",close:"esri-icon-close",collapse:"esri-icon-collapse",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",download:"esri-icon-download",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",edit:"esri-icon-edit",error:"esri-icon-error",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",handleHorizontal:"esri-icon-handle-horizontal",handleVertical:"esri-icon-handle-vertical",icon:"esri-icon",launchLinkExternal:"esri-icon-launch-link-external",layers:"esri-icon-layers",left:"esri-icon-left",leftArrows:"esri-icon-left-arrow",leftTriangleArrow:"esri-icon-left-triangle-arrow",loadingIndicator:"esri-icon-loading-indicator",locateCircled:"esri-icon-locate-circled",locked:"esri-icon-locked",mapPin:"esri-icon-map-pin",minus:"esri-icon-minus",noticeTriangle:"esri-icon-notice-triangle",pause:"esri-icon-pause",play:"esri-icon-play",plus:"esri-icon-plus",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",rightArrow:"esri-icon-right-arrow",rightTriangleArrow:"esri-icon-right-triangle-arrow",search:"esri-icon-search",settings2:"esri-icon-settings2",swap:"esri-icon-swap",table:"esri-icon-table",trash:"esri-icon-trash",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomToObject:"esri-icon-zoom-to-object"};var ro={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},S="esri-attachments",F={base:S,loaderContainer:`${S}__loader-container`,loader:`${S}__loader`,fadeIn:`${S}--fade-in`,container:`${S}__container`,containerList:`${S}__container--list`,containerPreview:`${S}__container--preview`,actions:`${S}__actions`,deleteButton:`${S}__delete-button`,addAttachmentButton:`${S}__add-attachment-button`,errorMessage:`${S}__error-message`,items:`${S}__items`,item:`${S}__item`,itemButton:`${S}__item-button`,itemMask:`${S}__item-mask`,itemMaskIcon:`${S}__item-mask--icon`,itemImage:`${S}__image`,itemImageResizable:`${S}__image--resizable`,itemLabel:`${S}__label`,itemFilename:`${S}__filename`,itemChevronIcon:`${S}__item-chevron-icon`,itemLink:`${S}__item-link`,itemLinkOverlay:`${S}__item-link-overlay`,itemLinkOverlayIcon:`${S}__item-link-overlay-icon`,itemEditIcon:`${S}__item-edit-icon`,itemAddIcon:`${S}__item-add-icon`,itemAddButton:`${S}__item-add-button`,formNode:`${S}__form-node`,fileFieldset:`${S}__file-fieldset`,fileLabel:`${S}__file-label`,fileName:`${S}__file-name`,fileInput:`${S}__file-input`,metadata:`${S}__metadata`,metadataFieldset:`${S}__metadata-fieldset`,progressBar:`${S}__progress-bar`},xi=window.CSS,Z=class extends V{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements=b({},ro),this._supportsImageOrientation=xi&&xi.supports&&xi.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e?.viewModel||(e=b({viewModel:new pt},e)),e}initialize(){this.addHandles([ne(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),ne(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),f(()=>this.viewModel?.mode,()=>this._modeChanged(),C)])}loadDependencies(){return ee({icon:()=>import("./chunk-VQEZLR5A.js")})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){let{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return b(b({},ro),e)}addAttachment(){let{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new R("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){let{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new R("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){let{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new R("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){let e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){let{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){let t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",t}render(){let{submitting:e,viewModel:t}=this,{state:i}=t;return c("div",{class:this.classes(F.base,M.widget)},e?this._renderProgressBar():null,i==="loading"?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){let{error:e,visibleElements:t}=this;return e&&t.errorMessage?c("div",{class:F.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){let{activeFileInfo:e,mode:t,activeAttachmentInfo:i}=this.viewModel;return t==="add"?this._renderAddForm():t==="edit"?this._renderDetailsForm(i||e):this._renderAttachmentContainer()}_renderLoading(){return c("div",{class:F.loaderContainer,key:"loader"},c("div",{class:F.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?c("div",{class:F.progressBar,key:"progress-bar"}):null}_renderAddForm(){let{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?c("button",{bind:this,class:this.classes(M.button,M.buttonTertiary,M.buttonSmall,M.buttonHalf,e&&M.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,o=this.visibleElements.addSubmitButton?c("button",{class:this.classes(M.button,M.buttonSecondary,M.buttonSmall,M.buttonHalf,{[M.buttonDisabled]:i}),disabled:i,type:"submit"},this.messages.add):null,s=t?c("span",{class:F.fileName,key:"file-name"},t.name):null,l=c("form",{afterCreate:ui,afterRemoved:ci,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},c("fieldset",{class:F.fileFieldset},s,c("label",{class:this.classes(F.fileLabel,M.button,M.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,c("input",{bind:this,class:F.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),o,r);return c("div",{class:F.formNode,key:"add-form-container"},l)}_renderDetailsForm(e){let{visibleElements:t,viewModel:i,selectedFile:r,submitting:o}=this,{capabilities:s}=i,l=o||!r,d,u,p,h;r?(d=r.type,u=r.name,p=r.size):e&&"file"in e?(d=e.file.type,u=e.file.name,p=e.file.size):e&&"contentType"in e&&(d=e.contentType,u=e.name,p=e.size,h=e.url);let m=s.editing&&s.operations?.delete&&t.deleteButton?c("button",{bind:this,class:this.classes(M.button,M.buttonSmall,M.buttonTertiary,F.deleteButton,{[M.buttonDisabled]:o}),disabled:o,key:"delete-button",onclick:I=>this._submitDeleteAttachment(I,e),type:"button"},this.messages.delete):void 0,v=s.editing&&s.operations?.update&&t.updateButton?c("button",{class:this.classes(M.button,M.buttonSmall,M.buttonThird,{[M.buttonDisabled]:l}),disabled:l,key:"update-button",type:"submit"},this.messages.update):void 0,g=this.visibleElements.cancelUpdateButton?c("button",{bind:this,class:this.classes(M.button,M.buttonSmall,M.buttonTertiary,M.buttonThird,{[M.buttonDisabled]:o}),disabled:o,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,_=s.editing&&s.operations?.update?c("fieldset",{class:F.fileFieldset,key:"file"},c("span",{class:F.fileName,key:"file-name"},u),c("label",{class:this.classes(F.fileLabel,M.button,M.buttonSecondary)},this.messages.changeFile,c("input",{bind:this,class:F.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,E=c("fieldset",{class:F.metadataFieldset,key:"size"},c("label",null,Vr(this.messagesUnits,p??0))),k=c("fieldset",{class:F.metadataFieldset,key:"content-type"},c("label",null,d)),x=h!=null?c("a",{class:F.itemLink,href:h,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),c("div",{class:F.itemLinkOverlay},c("span",{class:F.itemLinkOverlayIcon},c("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),P=c("form",{afterCreate:ui,afterRemoved:ci,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:I=>this._submitUpdateAttachment(I,e)},c("div",{class:F.metadata},E,k),_,c("div",{class:F.actions},m,g,v));return c("div",{class:F.formNode,key:"edit-form-container"},x,P)}_renderImageMask(e,t){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){let{supportsResizeAttachments:i}=this.viewModel,r=io(t),o={[F.itemImageResizable]:i};return c("div",{class:this.classes(F.itemMaskIcon,F.itemMask),key:r},c("img",{alt:e,class:this.classes(o,F.itemImage),src:r,title:e}))}_renderImageMaskForAttachment(e,t){let{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;let{contentType:r,name:o,url:s}=e;if(!i||!Ai(r))return this._renderGenericImageMask(o,r);let l=this._getCSSTransform(e),d=l?{transform:l,"image-orientation":"none"}:{},u=`${s}${s?.includes("?")?"&":"?"}w=${t}`,p={[F.itemImageResizable]:i};return c("div",{class:this.classes(F.itemMask),key:u},c("img",{alt:o,class:this.classes(p,F.itemImage),src:u,styles:d,title:o}))}_renderFile(e){let{file:t}=e;return c("li",{class:F.item,key:t},c("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:F.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),c("label",{class:F.itemLabel},c("span",{class:F.itemFilename},t.name||this.messages.noTitle),c("span",{"aria-hidden":"true",class:this.classes(F.itemChevronIcon,le(this.container)?he.left:he.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:t}){let{viewModel:i,effectiveDisplayType:r}=this,{capabilities:o,supportsResizeAttachments:s}=i,{contentType:l,name:d,url:u}=e,p=this._renderImageMask(e,t==="list"?48:400),h=o.editing?c("span",{"aria-hidden":"true",class:this.classes(F.itemChevronIcon,le(this.container)?he.left:he.right)}):null,m=[p,r==="preview"&&s&&Ai(l)?null:c("label",{class:F.itemLabel},c("span",{class:F.itemFilename},d||this.messages.noTitle),h)],v=o.editing?c("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:F.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},m):c("a",{class:F.itemButton,href:u??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},m);return c("li",{class:F.item,key:e},v)}_renderAttachmentContainer(){let{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,capabilities:o,fileInfos:s}=t,l=!!r?.length,d=!!s?.length,u={[F.containerList]:e!=="preview",[F.containerPreview]:e==="preview"},p=o.editing&&o.operations?.add&&i.addButton?c("button",{bind:this,class:this.classes(M.button,M.buttonTertiary,F.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},c("span",{"aria-hidden":"true",class:this.classes(F.itemAddIcon,he.plus)}),this.messages.add):void 0,h=l?c("ul",{class:F.items,key:"attachments-list"},r.toArray().map(g=>this._renderAttachmentInfo({attachmentInfo:g,displayType:e}))):void 0,m=d?c("ul",{class:F.items,key:"file-list"},s.toArray().map(g=>this._renderFile(g))):void 0,v=d||l?void 0:c("div",{class:M.empty},this.messages.noAttachments);return c("div",{class:this.classes(F.container,u),key:"attachments-container"},h,m,v,p)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){let t=e.target,i=t.files?.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){let{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){let{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){let{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};n([a()],Z.prototype,"capabilities",null),n([a()],Z.prototype,"displayType",void 0),n([a({readOnly:!0})],Z.prototype,"effectiveDisplayType",null),n([a()],Z.prototype,"graphic",null),n([a()],Z.prototype,"icon",null),n([a()],Z.prototype,"label",null),n([a(),q("esri/widgets/Attachments/t9n/Attachments")],Z.prototype,"messages",void 0),n([a(),q("esri/core/t9n/Units")],Z.prototype,"messagesUnits",void 0),n([a({readOnly:!0})],Z.prototype,"selectedFile",void 0),n([a({readOnly:!0})],Z.prototype,"submitting",void 0),n([a({readOnly:!0})],Z.prototype,"error",void 0),n([a({type:pt})],Z.prototype,"viewModel",void 0),n([a()],Z.prototype,"visibleElements",void 0),n([ae("visibleElements")],Z.prototype,"castVisibleElements",null),Z=n([w("esri.widgets.Attachments")],Z);var oo=Z;var ht=class extends pt{constructor(e){super(e),this.description=null,this.title=null}};n([a()],ht.prototype,"description",void 0),n([a()],ht.prototype,"title",void 0),ht=n([w("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],ht);var mt=ht;var Ei="esri-feature-element-info",Ti={base:Ei,title:`${Ei}__title`,description:`${Ei}__description`},et=class extends V{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return c("div",{class:Ti.base},this._renderTitle(),this._renderDescription())}_renderTitle(){let{title:e}=this;return e?c(Ye,{class:Ti.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){let{description:e}=this;return e?c("div",{class:Ti.description,innerHTML:e,key:"description"}):null}};n([a()],et.prototype,"description",void 0),n([a()],et.prototype,"headingLevel",void 0),n([a()],et.prototype,"title",void 0),et=n([w("esri.widgets.Feature.support.FeatureElementInfo")],et);var ke=et;var Ms={base:"esri-feature-attachments"},we=class extends V{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new oo,this.headingLevel=2,this.viewModel=new mt}initialize(){this._featureElementInfo=new ke,this.addHandles([f(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),C),f(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,C)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{attachmentsWidget:e}=this;return c("div",{class:Ms.base},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){let{description:e,title:t,headingLevel:i}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:i})}};n([a({readOnly:!0})],we.prototype,"attachmentsWidget",void 0),n([a()],we.prototype,"description",null),n([a()],we.prototype,"displayType",null),n([a()],we.prototype,"graphic",null),n([a()],we.prototype,"headingLevel",void 0),n([a()],we.prototype,"title",null),n([a({type:mt})],we.prototype,"viewModel",void 0),we=n([w("esri.widgets.Feature.FeatureAttachments")],we);var so=we;var Re=class extends U{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(f(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},C))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){let{created:e,graphic:t,destroyer:i}=this;e&&t&&(Ke({type:"content",value:i,event:{graphic:t}}),this._set("created",null))}_createContent(e){return y(this,null,function*(){let t=this.graphic;if(!t||!e)return;let i=Ke({type:"content",value:e,event:{graphic:t}});this._loadingPromise=i,this.notifyChange("state");let r=yield i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))})}};n([a({readOnly:!0})],Re.prototype,"created",void 0),n([a()],Re.prototype,"creator",void 0),n([a()],Re.prototype,"destroyer",void 0),n([a({type:de})],Re.prototype,"graphic",void 0),n([a({readOnly:!0})],Re.prototype,"state",null),Re=n([w("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Re);var He=Re;var Li="esri-feature-content",ki={base:Li,loaderContainer:`${Li}__loader-container`,loader:`${Li}__loader`},tt=class extends V{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{zt(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){let e=this.viewModel?.state;return c("div",{class:ki.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return c("div",{class:ki.loaderContainer,key:"loader"},c("div",{class:ki.loader}))}_renderCreated(){let e=this.viewModel?.created;return e?e instanceof HTMLElement?c("div",{afterCreate:this._attachToNode,bind:e,key:e}):Bt(e)?c("div",{key:e},!e.destroyed&&e.render()):c("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};n([a()],tt.prototype,"creator",null),n([a()],tt.prototype,"graphic",null),n([a({type:He})],tt.prototype,"viewModel",void 0),tt=n([w("esri.widgets.Feature.FeatureContent")],tt);var it=tt;var Ae=class extends U{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){let{expressionInfos:e,fieldInfos:t}=this,i=[];return t?.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;let o=r.clone();o.label=Ht(o,e),i.push(o)}),i}};n([a()],Ae.prototype,"attributes",void 0),n([a({type:[_r]})],Ae.prototype,"expressionInfos",void 0),n([a()],Ae.prototype,"description",void 0),n([a({type:[Rt]})],Ae.prototype,"fieldInfos",void 0),n([a({readOnly:!0})],Ae.prototype,"formattedFieldInfos",null),n([a()],Ae.prototype,"title",void 0),Ae=n([w("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Ae);var We=Ae;var Is=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function no(e,t){if(typeof t!="string"||!t)return t;let i=Is.find(u=>u.pattern.test(t));if(!i)return t;let r=t.match(i.pattern),o=r?.[2],s=ye(ye(i.label,{messages:e,hierPart:o}),{appName:i.appName}),l=i.target?` target="${i.target}"`:"",d=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${l} href="$1"${d}>${s}</a>`)}var Gt="esri-feature-fields",Qt={base:Gt,fieldHeader:`${Gt}__field-header`,fieldData:`${Gt}__field-data`,fieldDataDate:`${Gt}__field-data--date`},me=class extends V{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new We,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new ke,this.addHandles(f(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),C))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return c("div",{class:Qt.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){let{attributes:i}=this.viewModel,r=e.fieldName||"",o=e.label||r,s=i?i[r]==null?"":i[r]:"",l=!!e.format?.dateFormat,d=typeof s=="number"&&!l?this._forceLTR(s):no(this.messagesURIUtils,s),u={[Qt.fieldDataDate]:l};return c("tr",{key:`fields-element-info-row-${r}-${t}`},c("th",{class:Qt.fieldHeader,innerHTML:o,key:`fields-element-info-row-header-${r}-${t}`}),c("td",{class:this.classes(Qt.fieldData,u),innerHTML:d,key:`fields-element-info-row-data-${r}-${t}`}))}_renderFields(){let{formattedFieldInfos:e}=this.viewModel;return e?.length?c("table",{class:M.table,summary:this.messages.fieldsSummary},c("tbody",null,e.map((t,i)=>this._renderFieldInfo(t,i)))):null}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};n([a()],me.prototype,"attributes",null),n([a()],me.prototype,"description",null),n([a()],me.prototype,"expressionInfos",null),n([a()],me.prototype,"fieldInfos",null),n([a()],me.prototype,"title",null),n([a({type:We,nonNullable:!0})],me.prototype,"viewModel",void 0),n([a(),q("esri/widgets/Feature/t9n/Feature")],me.prototype,"messages",void 0),n([a(),q("esri/widgets/support/t9n/uriUtils")],me.prototype,"messagesURIUtils",void 0),me=n([w("esri.widgets.Feature.FeatureFields")],me);var Xt=me;function ao(e){if(!e.colorStops)return[];let t=[...e.colorStops].filter(r=>r.color?.a>0),i=t.length-1;if(t&&t[0]){let r=t[i];r&&r.ratio!==1&&(t.push(new Mr({ratio:1,color:r.color})),i++)}return t.map((r,o)=>{let s="";return o===0?s=e.legendOptions?.minLabel||"low":o===i&&(s=e.legendOptions?.maxLabel||"high"),{color:r.color,label:s,ratio:r.ratio}}).reverse()}var Wd=Ct("short-date");function re(e,t,i){return y(this,null,function*(){Ki(e,t,()=>[]).push(...i)})}function lo(e){return y(this,null,function*(){let t=new Map;if(!e)return t;if("visualVariables"in e&&e.visualVariables){let i=e.visualVariables.filter(r=>r.type==="color");for(let r of i){let o=((yield Sr(r))??[]).map(s=>s.color);yield re(t,r.field||r.valueExpression,o)}}if(e.type==="heatmap"){let i=ao(e).map(r=>r.color);yield re(t,e.field||e.valueExpression,i)}else if(e.type==="pie-chart"){for(let i of e.attributes)yield re(t,i.field||i.valueExpression,[i.color]);yield re(t,"default",[e?.othersCategory?.color,Le(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(let i of e.attributes)yield re(t,i.field||i.valueExpression,[i.color]);yield re(t,"default",[e.backgroundColor])}else if(e.type==="unique-value")if(e.authoringInfo?.type==="predominance")for(let i of e.uniqueValueInfos??[])yield re(t,i.value.toString(),[Le(i.symbol,null)]);else{let i=(e.uniqueValueInfos??[]).map(d=>Le(d.symbol,null)),{field:r,field2:o,field3:s,valueExpression:l}=e;(r||l)&&(yield re(t,r||l,i)),o&&(yield re(t,o,i)),s&&(yield re(t,s,i))}else if(e.type==="class-breaks"){let i=e.classBreakInfos.map(s=>Le(s.symbol,null)),{field:r,valueExpression:o}=e;yield re(t,r??o,i)}else e.type==="simple"&&(yield re(t,"default",[Le(e.symbol,null)]));return"defaultSymbol"in e&&e.defaultSymbol&&(yield re(t,"default",[Le(e.defaultSymbol,null)])),t.forEach((i,r)=>{let o=st(i.filter(Boolean),(s,l)=>JSON.stringify(s)===JSON.stringify(l));t.set(r,o)}),t})}var Cs="esri.widgets.Feature.support.relatedFeatureUtils",co=()=>N.getLogger(Cs),uo=new Map;function rt(e){if(!ce(e))return null;let[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function As(e,t){if(!t.relationships)return null;let i=null,{relationships:r}=t;return r.some(o=>o.id===parseInt(e,10)&&(i=o,!0)),i}function xs({originRelationship:e,relationships:t,layerId:i}){return t.find(({relatedTableId:r,id:o})=>`${r}`===i&&o===e?.id)??null}function Es(e,t){let i=t.toLowerCase();for(let r in e)if(r.toLowerCase()===i)return e[r];return null}function po(e,t){let i=As(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function ho(e,t){if(!t||!e)return;let{features:i,statsFeatures:r}=e,o=i?.value;t.relatedFeatures=o?o.features:[];let s=r?.value;t.relatedStatsFeatures=s?s.features:[]}function Ts(e,t,i,r){let o=new dt;return o.outFields=["*"],o.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),o.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures?.(o,r)??Promise.resolve({})}function Ls(e,t,i){let r=0,o=[];for(;r<t.length;)o.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return o.join(" OR ")}function ks(e){return e?st(e):void 0}function Rs(e){return e?st(e,(t,i)=>JSON.stringify(t.toJSON())===JSON.stringify(i.toJSON())):void 0}function Ss(e,t,i,r){return y(this,null,function*(){let o=i.layerId.toString(),{layerInfo:s,relation:l,relatedFields:d,outStatistics:u,url:p,sourceSpatialReference:h}=t,m=ks(d),v=Rs(u);if(!s||!l)return null;let g=xs({originRelationship:l,relationships:s.relationships,layerId:o});if(g?.relationshipTableId&&g.keyFieldInRelationshipTable){let E=(yield Ts(e,g,i,r))[e.attributes[i.objectIdField]];if(!E)return null;let k=E.features.map(x=>x.attributes[s.objectIdField]);if(v?.length&&s.supportsStatistics){let x=new kt;x.where=Ls(s.objectIdField,k,1e3),x.outFields=m,x.outStatistics=v,x.sourceSpatialReference=h;let P={features:Promise.resolve(E),statsFeatures:Pt(p,x)};return ve(P)}}let _=g?.keyField;if(_){let E=Ar($s(s.fields,_)),k=Es(e.attributes,l.keyField),x=E?`${_}=${k}`:`${_}='${k}'`,P=Pt(p,new kt({where:x,outFields:m,sourceSpatialReference:h}),r),I=v?.length&&s.supportsStatistics?Pt(p,new kt({where:x,outFields:m,outStatistics:v,sourceSpatialReference:h}),r):null,se={features:P};return I&&(se.statsFeatures=I),ve(se)}return null})}function Ps(e,t){return ar(e,{query:{f:"json"},signal:t?.signal})}function mo({relatedInfos:e,layer:t},i){let r={};return e.forEach((o,s)=>{let{relation:l}=o;if(!l){let m=new R("relation-required","A relation is required on a layer to retrieve related records.");throw co().error(m),m}let{relatedTableId:d}=l;if(typeof d!="number"){let m=new R("A related table ID is required on a layer to retrieve related records.");throw co().error(m),m}let u=`${t.url}/${d}`,p=uo.get(u),h=p??Ps(u);p||uo.set(u,h),r[s]=h}),Yi(ve(r),i)}function fo({graphic:e,relatedInfos:t,layer:i},r){let o={};return t.forEach((s,l)=>{s.layerInfo&&(o[l]=Ss(e,s,i,r))}),ve(o)}function go({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields?.push(t),i.statisticType){let r=new fr({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics?.push(r)}}function $s(e,t){if(e!=null){t=t.toLowerCase();for(let i of e)if(i&&i.name.toLowerCase()===t)return i}return null}var yo={chartAnimation:!0},z=class extends U{constructor(e){super(e),this.abilities=b({},yo),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return b(b({},yo),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){let{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){let{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){let{mediaInfos:e,layer:t}=this,i=this.attributes??{},r=this.formattedAttributes??{},o=this.expressionAttributes??{},s=this.fieldInfoMap??new Map;return e?.map(l=>{let d=l?.clone();return d?(d.title=Ce({attributes:i,fieldInfoMap:s,globalAttributes:r,expressionAttributes:o,layer:t,text:d.title}),d.caption=Ce({attributes:i,fieldInfoMap:s,globalAttributes:r,expressionAttributes:o,layer:t,text:d.caption}),d.altText=Ce({attributes:i,fieldInfoMap:s,globalAttributes:r,expressionAttributes:o,layer:t,text:d.altText}),d.type==="image"?d.value?(this._setImageValue({value:d.value,formattedAttributes:r,layer:t}),d.value.sourceURL?d:void 0):void 0:d.type==="pie-chart"||d.type==="line-chart"||d.type==="column-chart"||d.type==="bar-chart"?d.value?(this._setChartValue({value:d.value,chartType:d.type,attributes:i,formattedAttributes:r,layer:t,expressionAttributes:o}),d):void 0:null):null}).filter(ge)??[]}_setImageValue(e){let t=this.fieldInfoMap??new Map,{value:i,formattedAttributes:r,layer:o}=e,{linkURL:s,sourceURL:l}=i;if(l){let d=jt(l,o);i.sourceURL=Wt({formattedAttributes:r,template:d,fieldInfoMap:t})}if(s){let d=jt(s,o);i.linkURL=Wt({formattedAttributes:r,template:d,fieldInfoMap:t})}}_setChartValue(e){let{value:t,attributes:i,formattedAttributes:r,chartType:o,layer:s,expressionAttributes:l}=e,{popupTemplate:d,relatedInfos:u}=this,{fields:p,normalizeField:h}=t,m=s;if(t.fields=Wr(p,m),h&&(t.normalizeField=ze(h,m)),!p.some(g=>!!(r[g]!=null||ce(g)&&u?.size)))return;let v=d?.fieldInfos??[];p.forEach((g,_)=>{let E=t.colors?.[_];if(ce(g))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:v,fieldName:g,formattedAttributes:r,chartType:o,value:t,color:E})]);let k=this._getChartOption({value:t,attributes:i,chartType:o,formattedAttributes:r,expressionAttributes:l,fieldName:g,fieldInfos:v,color:E});t.series.push(k)})}_getRelatedChartInfos(e){let{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:o,value:s,color:l}=e,d=[],u=rt(i),p=u&&this.relatedInfos?.get(u.layerId.toString());if(!p)return d;let{relatedFeatures:h,relation:m}=p;if(!m||!h)return d;let{cardinality:v}=m;return h.forEach(g=>{let{attributes:_}=g;_&&Object.keys(_).forEach(E=>{E===u.fieldName&&d.push(this._getChartOption({value:s,attributes:_,formattedAttributes:r,fieldName:i,chartType:o,relatedFieldName:E,hasMultipleRelatedFeatures:h?.length>1,fieldInfos:t,color:l}))})}),v==="one-to-many"||v==="many-to-many"?d:[d[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){let{value:t,attributes:i,formattedAttributes:r,expressionAttributes:o,fieldName:s,relatedFieldName:l,fieldInfos:d,chartType:u,hasMultipleRelatedFeatures:p,color:h}=e,m=this.layer,v=this.fieldInfoMap??new Map,{normalizeField:g,tooltipField:_}=t,E=g?ce(g)?i[rt(g).fieldName]:i[g]:null,k=ut(s)&&o&&o[s]!==void 0?o[s]:l&&i[l]!==void 0?i[l]:i[s]!==void 0?i[s]:r[s],x=new br({fieldName:s,color:h,value:k===void 0?null:k&&E?k/E:k});if(ce(s)){let ue=v.get(s.toLowerCase()),jo=_&&v.get(_.toLowerCase()),Uo=ue?.fieldName??s,li=p&&_?rt(_).fieldName:jo?.fieldName??_,Zo=p&&li?i[li]:r[li]??ue?.label??ue?.fieldName??l,Go=p&&l?i[l]:r[Uo];return x.tooltip=this._getTooltip({label:Zo,value:Go,chartType:u}),x}let P=Mi(d,s),I=ze(s,m),se=_&&r[_]!==void 0?r[_]:Ht(P||new Rt({fieldName:I}),this.popupTemplate?.expressionInfos),Ve=r[I];return x.tooltip=this._getTooltip({label:se,value:Ve,chartType:u}),x}};n([a()],z.prototype,"abilities",void 0),n([ae("abilities")],z.prototype,"castAbilities",null),n([a()],z.prototype,"activeMediaInfoIndex",void 0),n([a({readOnly:!0})],z.prototype,"activeMediaInfo",null),n([a()],z.prototype,"attributes",void 0),n([a()],z.prototype,"description",void 0),n([a()],z.prototype,"fieldInfoMap",void 0),n([a()],z.prototype,"formattedAttributes",void 0),n([a()],z.prototype,"expressionAttributes",void 0),n([a({readOnly:!0})],z.prototype,"formattedMediaInfos",null),n([a()],z.prototype,"isAggregate",void 0),n([a()],z.prototype,"layer",void 0),n([a({readOnly:!0})],z.prototype,"formattedMediaInfoCount",null),n([a()],z.prototype,"mediaInfos",void 0),n([a()],z.prototype,"popupTemplate",void 0),n([a()],z.prototype,"relatedInfos",void 0),n([a()],z.prototype,"title",void 0),z=n([w("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],z);var _e=z;var H="esri-feature-media",Y={base:H,mediaContainer:`${H}__container`,mediaItemContainer:`${H}__item-container`,mediaItem:`${H}__item`,mediaItemText:`${H}__item-text`,mediaItemTitle:`${H}__item-title`,mediaItemCaption:`${H}__item-caption`,mediaNavigation:`${H}__item-navigation`,mediaPagination:`${H}__pagination`,mediaPaginationText:`${H}__pagination-text`,mediaPrevious:`${H}__previous`,mediaPreviousIconLTR:`${H}__previous-icon`,mediaPreviousIconRTL:`${H}__previous-icon--rtl`,mediaNext:`${H}__next`,mediaNextIconLTR:`${H}__next-icon`,mediaNextIconRTL:`${H}__next-icon--rtl`,mediaChart:`${H}__chart`,mediaPaginationButton:`${H}__pagination-button`,mediaPaginationIcon:`${H}__pagination-icon`,mediaChartRendered:`${H}__chart--rendered`},Ri=15,Se="category",ft="value",Os="rgba(50, 50, 50, 1)",Ns=250,Vs=500,Bs=200,K=class extends V{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new _e,this.messages=null,this._disposeChart=i=>{this._chartRootMap.get(i)?.dispose(),this._chartRootMap.delete(i)},this._createChart=i=>y(this,null,function*(){let{destroyed:r,viewModel:o}=this;if(r||!o||!i)return;let{createRoot:s}=yield import("./chunk-RO5L4HY7.js"),l=yield s(i);this._chartRootMap.set(i,l),this._renderChart({mediaInfo:o.activeMediaInfo,root:l})})}initialize(){this._featureElementInfo=new ke,this.addHandles([f(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),C),f(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),C)])}loadDependencies(){return ee({icon:()=>import("./chunk-VQEZLR5A.js")})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return c("div",{bind:this,class:Y.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?c("div",{class:Y.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),c("div",{class:Y.mediaNavigation},i,e>1?c("div",{class:Y.mediaPagination},this._renderMediaPageButton("previous"),c("span",{class:Y.mediaPaginationText},Q(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){let{activeMediaInfo:e}=this.viewModel;if(!e)return null;let t=e&&e.title?c("div",{class:Y.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?c("div",{class:Y.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?c("div",{class:Y.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){if(!e.value)return null;let{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:o,refreshInterval:s,altText:l,title:d,type:u}=e,{sourceURL:p,linkURL:h}=o,m=zt(h??void 0)?"_blank":"_self",v=m==="_blank"?"noreferrer":"",g=s?t:null,_=g?g.timestamp:0,E=g?g.sourceURL:p,k=c("img",{alt:l||d,key:`media-${u}-${i}-${r}-${_}`,src:E??void 0});return(h?c("a",{href:h,rel:v,target:m,title:d},k):null)??k}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return c("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:Y.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){let{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this.viewModel;return e?c("div",{class:Y.mediaItemContainer,key:"media-container"},c("div",{class:Y.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;let t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?"chevron-left":"chevron-right",o=t?"media-previous":"media-next",s=t?this._previous:this._next;return c("button",{"aria-label":i,bind:this,class:Y.mediaPaginationButton,key:o,onclick:s,tabIndex:0,title:i,type:"button"},c("calcite-icon",{class:Y.mediaPaginationIcon,icon:r,scale:"s"}))}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;let{isAggregate:e,layer:t}=this.viewModel;return e&&t?.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:t?.renderer}_getSeriesColors(e){return y(this,null,function*(){let{colorAm5:t}=yield import("./chunk-7J6MRJSZ.js"),i=new Map;return e.forEach(r=>{r.color&&i.set(r,t(r.color.toCss(!0)))}),i})}_getRendererColors(){return y(this,null,function*(){let{colorAm5:e}=yield import("./chunk-7J6MRJSZ.js"),t=new Map,i=this._getRenderer(),r="default";if(!i)return t;let o=yield lo(i);return o.delete(r),Array.from(o.values()).every(s=>s?.length===1)&&Array.from(o.keys()).forEach(s=>{let l=o.get(s)?.[0]?.toCss(!0);l&&t.set(s,e(l))}),t})}_handleMediaKeyup(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!Rr()}_getChartAnimationMS(){return this._canAnimateChart()?Ns:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Vs:0}_renderChart(e){return y(this,null,function*(){let{root:t,mediaInfo:i}=e,{value:r,type:o}=i,{ResponsiveThemeAm5:s,DarkThemeAm5:l,AnimatedThemeAm5:d,ColorSetAm5:u,ThemeAm5:p,esriChartColorSet:h}=yield import("./chunk-7J6MRJSZ.js"),m=p.new(t);m.rule("ColorSet").set("colors",h),m.rule("ColorSet").set("reuse",!0);let v=[s.new(t),m];nr()&&v.push(l.new(t)),this._canAnimateChart()&&v.push(d.new(t)),t.setThemes(v);let g=yield this._getRendererColors(),_=yield this._getSeriesColors(r.series),E=u.new(t,{}),k=_.get(r.series[0]),x=k?{lineSettings:{stroke:k}}:void 0,P=r.series.map((I,se)=>{let Ve=_.get(I)||g.get(I.fieldName)||E.getIndex(se);return b({[Se]:I.tooltip,[ft]:I.value,columnSettings:{fill:Ve,stroke:Ve}},x)}).filter(I=>o!=="pie-chart"||I.value!=null&&I.value>0);o==="pie-chart"?this._createPieChart(e,P):this._createXYChart(e,P)})}_getDirection(){return le(this.container)?"rtl":"ltr"}_isInversed(){return!!le(this.container)}_customizeChartTooltip(e,t="horizontal"){return y(this,null,function*(){let{colorAm5:i}=yield import("./chunk-7J6MRJSZ.js");e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:i(Os)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:Bs})})}_createPieChart(e,t){return y(this,null,function*(){let{TooltipAm5:i}=yield import("./chunk-7J6MRJSZ.js"),{PieChartAm5:r,PieSeriesAm5:o}=yield import("./chunk-4HUIMMMI.js"),{mediaInfo:s,root:l}=e,{title:d}=s,u=5,p=s?.altText||s?.title||"",h=l.container.children.push(r.new(l,{ariaLabel:p,focusable:!0,paddingBottom:u,paddingTop:u,paddingLeft:u,paddingRight:u})),m=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,v=i.new(l,{labelText:m}),g=h.series.push(o.new(l,{name:d,valueField:ft,categoryField:Se,tooltip:v}));g.ticks.template.set("forceHidden",!0),g.labels.template.set("forceHidden",!0),g.slices.template.states.create("active",{shiftRadius:u}),this._customizeChartTooltip(v),g.slices.template.setAll({ariaLabel:m,focusable:!0,templateField:"columnSettings"}),g.data.setAll(t),g.appear(this._getChartSeriesAnimationMS()),h.appear(this._getChartAnimationMS()),h.root.dom.classList.toggle(Y.mediaChartRendered,!0)})}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t,i){return y(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:o}=yield import("./chunk-7J6MRJSZ.js"),{CategoryAxisAm5:s,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,ColumnSeriesAm5:p}=yield import("./chunk-XAAE5JIQ.js"),{mediaInfo:h,root:m}=t,{value:v,title:g}=h;e.setAll({wheelX:"panX",wheelY:"zoomX"});let _=e.xAxes.push(s.new(m,{renderer:l.new(m,{inversed:this._isInversed()}),categoryField:Se}));_.get("renderer").labels.template.setAll({forceHidden:!0});let E=e.yAxes.push(d.new(m,{renderer:u.new(m,{inside:!1}),min:this._getMinSeriesValue(v.series)}));E.get("renderer").labels.template.setAll({direction:this._getDirection()});let k="{categoryX}",x=r.new(m,{labelText:k}),P=e.series.push(p.new(m,{name:g,xAxis:_,yAxis:E,valueYField:ft,categoryXField:Se,tooltip:x}));this._customizeChartTooltip(x),P.columns.template.setAll({ariaLabel:k,focusable:!0,templateField:"columnSettings"}),v.series.length>Ri&&e.set("scrollbarX",o.new(m,{orientation:"horizontal"})),_.data.setAll(i),P.data.setAll(i),P.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createBarChart(e,t,i){return y(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:o}=yield import("./chunk-7J6MRJSZ.js"),{CategoryAxisAm5:s,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,ColumnSeriesAm5:p}=yield import("./chunk-XAAE5JIQ.js"),{mediaInfo:h,root:m}=t,{value:v,title:g}=h;e.setAll({wheelX:"panY",wheelY:"zoomY"});let _=e.yAxes.push(s.new(m,{renderer:u.new(m,{inversed:!0}),categoryField:Se}));_.get("renderer").labels.template.setAll({forceHidden:!0});let E=e.xAxes.push(d.new(m,{renderer:l.new(m,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(v.series)}));E.get("renderer").labels.template.setAll({direction:this._getDirection()});let k="{categoryY}",x=r.new(m,{labelText:k}),P=e.series.push(p.new(m,{name:g,xAxis:E,yAxis:_,valueXField:ft,categoryYField:Se,tooltip:x}));this._customizeChartTooltip(x,"vertical"),P.columns.template.setAll({ariaLabel:k,focusable:!0,templateField:"columnSettings"}),v.series.length>Ri&&e.set("scrollbarY",o.new(m,{orientation:"vertical"})),_.data.setAll(i),P.data.setAll(i),P.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createLineChart(e,t,i){return y(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:o}=yield import("./chunk-7J6MRJSZ.js"),{CategoryAxisAm5:s,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,LineSeriesAm5:p}=yield import("./chunk-XAAE5JIQ.js"),{root:h,mediaInfo:m}=t,{value:v,title:g}=m;e.setAll({wheelX:"panX",wheelY:"zoomX"});let _=e.xAxes.push(s.new(h,{renderer:l.new(h,{inversed:this._isInversed()}),categoryField:Se}));_.get("renderer").labels.template.setAll({forceHidden:!0});let E=e.yAxes.push(d.new(h,{renderer:u.new(h,{inside:!1}),min:this._getMinSeriesValue(v.series)}));E.get("renderer").labels.template.setAll({direction:this._getDirection()});let k="{categoryX}",x=i[0]?.lineSettings?.stroke,P=r.new(h,{getFillFromSprite:!x,labelText:k});x&&P.get("background")?.setAll({fill:x});let I=e.series.push(p.new(h,{name:g,xAxis:_,yAxis:E,valueYField:ft,categoryXField:Se,tooltip:P}));I.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(P,"vertical"),v.series.length>Ri&&e.set("scrollbarX",o.new(h,{orientation:"horizontal"})),_.data.setAll(i),I.data.setAll(i),I.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createXYChart(e,t){return y(this,null,function*(){let{XYChartAm5:i,XYCursorAm5:r}=yield import("./chunk-XAAE5JIQ.js"),{root:o,mediaInfo:s}=e,{type:l}=s,d=s?.altText||s?.title||"",u=o.container.children.push(i.new(o,{ariaLabel:d,focusable:!0,panX:!0,panY:!0}));u.set("cursor",r.new(o,{})),l==="column-chart"&&(yield this._createColumnChart(u,e,t)),l==="bar-chart"&&(yield this._createBarChart(u,e,t)),l==="line-chart"&&(yield this._createLineChart(u,e,t)),u.root.dom.classList.toggle(Y.mediaChartRendered,!0)})}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this.viewModel;e?.type==="image"&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:i}=e,r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);let o=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=o}_getImageSource(e,t){let i=e.includes("?")?"&":"?",[r,o=""]=e.split("#");return`${r}${i}timestamp=${t}${o?"#":""}${o}`}};n([a()],K.prototype,"_refreshIntervalInfo",void 0),n([a()],K.prototype,"attributes",null),n([a()],K.prototype,"activeMediaInfoIndex",null),n([a()],K.prototype,"description",null),n([a()],K.prototype,"fieldInfoMap",null),n([a()],K.prototype,"layer",null),n([a()],K.prototype,"mediaInfos",null),n([a()],K.prototype,"popupTemplate",null),n([a()],K.prototype,"relatedInfos",null),n([a()],K.prototype,"title",null),n([a({type:_e})],K.prototype,"viewModel",void 0),n([a(),q("esri/widgets/Feature/t9n/Feature")],K.prototype,"messages",void 0),K=n([w("esri.widgets.Feature.FeatureMedia")],K);var Yt=K;var Ds="esri.widgets.Feature.support.arcadeFeatureUtils",vo=()=>N.getLogger(Ds);function qs(e){return typeof e=="string"?Je(Ut(e)):Array.isArray(e)?zs(e):e?.declaredClass==="esri.arcade.Dictionary"?Hs(e):e}function zs(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?Je(Ut(t)):t}</li>`).join("")}</ul>`}function Hs(e){let t=e.keys().map(i=>{let r=e.field(i);return`<tr><th>${i}</th><td>${typeof r=="string"?Je(Ut(r)):r}</td></tr>`}).join("");return`<table class="${M.table}">${t}</table>`}function Si(){return import("./chunk-L5YDRBSH.js")}function Ws(e){return"createQuery"in e&&"queryFeatures"in e}function js(r){return y(this,arguments,function*({graphic:e,view:t,options:i}){let{isAggregate:o,layer:s}=e;if(!o||!s||t?.type!=="2d")return[];let l=yield t.whenLayerView(s);if(!Ws(l))return[];let d=l.createQuery(),u=e.getObjectId();d.aggregateIds=u!=null?[u]:[];let{features:p}=yield l.queryFeatures(d,i);return p})}function Us({layer:e,aggregatedFeatures:t,interceptor:i}){let{fields:r,objectIdField:o,geometryType:s,spatialReference:l,displayField:d}=e;return new Cr(pe(b({fields:r,objectIdField:o,geometryType:s,spatialReference:l,displayField:d,interceptor:i},e.type==="feature"?{templates:e.templates,typeIdField:e.typeIdField,types:e.types}:null),{source:t}))}function Pi(p){return y(this,arguments,function*({expressionInfo:e,arcade:t,interceptor:i,spatialReference:r,map:o,graphic:s,location:l,view:d,options:u}){if(!e?.expression)return null;let{isAggregate:h}=s,m=(s.sourceLayer||s.layer)??void 0,v=h?"feature-reduction-popup":"popup",g=t.createArcadeProfile(v),_=t.createArcadeExecutor(e.expression,g).catch(se=>vo().error("arcade-executor-error",{error:se,expressionInfo:e})),[E,k]=yield Promise.all([js({graphic:s,view:d,options:u}),_]);if(!k)return null;let x=v==="feature-reduction-popup"?Us({layer:m,aggregatedFeatures:E,interceptor:i}):void 0,P=pe(b({},v==="feature-reduction-popup"?{$aggregatedFeatures:x}:{$datastore:m?.url,$layer:m?.type==="feature"||m?.type==="subtype-sublayer"||m?.type==="catalog-footprint"||m?.type==="oriented-imagery"?m:m?.type==="scene"&&m.associatedLayer!=null?m.associatedLayer:void 0,$map:o,$userInput:l,$graph:m?.type==="knowledge-graph-sublayer"?m?.parentCompositeLayer?.knowledgeGraph:void 0}),{$feature:s}),I={abortSignal:u?.signal??void 0,interceptor:i??void 0,rawOutput:!0,spatialReference:r??void 0,timeZone:d?.timeZone};return yield k.executeAsync(P,I).catch(se=>vo().error("arcade-execution-error",{error:se,graphic:s,expressionInfo:e})).finally(()=>x?.destroy())})}function bo(u){return y(this,arguments,function*({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:o,view:s,location:l,options:d}){if(!e?.length)return{};let p=yield Si(),h={};for(let g of e)h[`expression/${g.name}`]=Pi({expressionInfo:g,arcade:p,interceptor:r,spatialReference:t,map:o,graphic:i,location:l,view:s,options:d});let m=yield ve(h),v={};for(let g in m)v[g]=qs(m[g].value);return v})}var Zs=1,ie=class extends U{constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{let{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{let t=this.contentElement?.type;this.contentElementViewModel?.destroy();let i=t==="fields"?new We:t==="media"?new _e:t==="text"?new He:null;this._set("contentElementViewModel",i)},this._compile=()=>y(this,null,function*(){this._cancelQuery();let t=new AbortController;this._abortController=t,yield this._compileExpression(),this._abortController===t&&(this._abortController=null)}),this._compileThrottled=qe(this._compile,Zs,this),this._compileExpression=()=>y(this,null,function*(){let{expressionInfo:t,graphic:i,interceptor:r,spatialReference:o,map:s,location:l,view:d,_abortController:u}=this;if(!t||!i)return void this._set("contentElement",null);let p=yield Si();if(u!==this._abortController)return;let h=yield Pi({arcade:p,expressionInfo:t,graphic:i,location:l,interceptor:r,map:s,spatialReference:o,view:d});if(!h||h.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);let m=yield h.castAsJsonAsync(u?.signal),v=m?.type,g=v==="media"?wr.fromJSON(m):v==="text"?St.fromJSON(m):v==="fields"?vr.fromJSON(m):null;this._set("contentElement",g)}),this.addHandles([f(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),C),f(()=>[this.contentElement],()=>this._createVM(),C)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){let{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){return this.view?.map??null}set map(e){this._override("map",e)}};n([a()],ie.prototype,"_abortController",void 0),n([a({type:yr})],ie.prototype,"expressionInfo",void 0),n([a({type:de})],ie.prototype,"graphic",void 0),n([a({readOnly:!0})],ie.prototype,"contentElement",void 0),n([a({readOnly:!0})],ie.prototype,"contentElementViewModel",void 0),n([a()],ie.prototype,"interceptor",void 0),n([a({type:Xe})],ie.prototype,"location",void 0),n([a()],ie.prototype,"spatialReference",null),n([a({readOnly:!0})],ie.prototype,"state",null),n([a()],ie.prototype,"map",null),n([a()],ie.prototype,"view",void 0),ie=n([w("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],ie);var gt=ie;var wo="esri-feature",_o={base:`${wo}-expression`,loadingSpinnerContainer:`${wo}__loading-container`},Kt=class extends V{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new gt}initialize(){this.addHandles(f(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),C))}loadDependencies(){return ee({loader:()=>import("./chunk-N5ULBSCQ.js")})}destroy(){this._destroyContentWidget()}render(){let{state:e}=this.viewModel;return c("div",{class:_o.base},e==="loading"?this._renderLoading():e==="disabled"?null:this._contentWidget?.render())}_renderLoading(){return c("div",{class:_o.loadingSpinnerContainer,key:"loading-container"},c("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){let{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){let{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t?.type;this._destroyContentWidget();let r=e?i==="fields"?new Xt({viewModel:e}):i==="media"?new Yt({viewModel:e}):i==="text"?new it({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};n([a({type:gt})],Kt.prototype,"viewModel",void 0),Kt=n([w("esri.widgets.Feature.FeatureExpression")],Kt);var Fo=Kt;var Mo;(function(e){e.TOO_SHORT="length-validation-error::too-short"})(Mo||(Mo={}));var Io=e=>{let t=[];if(e.formTemplate){let{description:i,title:r}=e.formTemplate;e.fields?.forEach(o=>{let s=r&&di(r,o.name),l=i&&di(i,o.name);(s||l)&&t.push(o.name)})}return t};var $i=100,$=class extends mr(Et(U)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{let{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{let{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{let{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=()=>y(this,null,function*(){this._cancelQuery();let t=new AbortController;this._queryAbortController=t,yield Ft(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)}),this._queryFeatureCountController=()=>y(this,null,function*(){this._loaded=!1,this._cancelQueryFeatureCount();let t=new AbortController;this._queryFeatureCountAbortController=t,yield Ft(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0}),this._queryPageController=()=>y(this,null,function*(){let t=new AbortController;this._queryPageAbortController=t,yield Ft(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)}),this._queryDebounced=Qe(this._queryController,$i),this._queryFeatureCountDebounced=Qe(this._queryFeatureCountController,$i),this._queryPageDebounced=Qe(this._queryPageController,$i),this._query=()=>y(this,null,function*(){let{_queryAbortController:t,relatedFeatures:i}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.drain(r=>r.destroy()),this.destroyed||i.addMany(this._sliceFeatures(yield this._queryRelatedFeatures({signal:t?.signal}))))}),this.addHandles([f(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),C),f(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),f(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.drain(e=>e.destroy()),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){let{featuresPerPage:t,featureCount:i}=this,r=1,o=Math.ceil(i/t)||1;this._set("featurePage",Math.min(Math.max(e,r),o))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){let{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(i=>{let r=i.clone();return r.field=ze(i.field,t),r}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){let e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&e?.supportsCount&&e?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new be}get relatedLayer(){let{layer:e,map:t,relationship:i}=this;return e?.loaded&&t&&i?Jr(t,e,i)??null:null}get relationship(){let{relationshipId:e,layer:t}=this;return e!=null?t?.relationships?.find(({id:i})=>i===e)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new be}get state(){let{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:r,_loaded:o,canLoad:s}=this;return t||s&&!o?"loading":e||i?"querying":r?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.forEach(e=>!e.destroyed&&e.destroy()),this.relatedFeatureViewModels.removeAll()}_queryFeatureCount(){return y(this,null,function*(){let{layer:e,relatedLayer:t,relationshipId:i,objectId:r,_queryFeatureCountAbortController:o,canQuery:s,supportsCacheHint:l}=this;if(yield e?.load(),yield t?.load(),!s||!e||!t||r==null)return void this._set("featureCount",0);let d=t.createQuery(),u=new dt({cacheHint:l,relationshipId:i,returnGeometry:!1,objectIds:[r],where:d.where??void 0}),p=yield e.queryRelatedFeaturesCount(u,{signal:o?.signal});this._set("featureCount",p[r]||0)})}_sliceFeatures(e){let{showAllEnabled:t,displayCount:i}=this;return t?e:i?e.slice(0,i):[]}_queryPage(){return y(this,null,function*(){let{relatedFeatures:e,featurePage:t,showAllEnabled:i,_queryPageAbortController:r,featureCount:o}=this;!i||t<2||!o||e.addMany(yield this._queryRelatedFeatures({signal:r?.signal}))})}_queryRelatedFeatures(e){return y(this,null,function*(){let{orderByFieldsFixedCasing:t,showAllEnabled:i,featuresPerPage:r,displayCount:o,layer:s,relationshipId:l,featurePage:d,featureCount:u,relatedLayer:p,supportsCacheHint:h}=this,{canQuery:m,objectId:v}=this;if(!m||!s||!p||v==null)return[];let g=i?((d-1)*r+u)%u:0,_=i?r:o,E=p.objectIdField,k=[...t.map(ue=>ue.field),...Io(p),E].filter(ge),x=t.map(ue=>`${ue.field} ${ue.order}`),P=p.createQuery(),I=new dt({orderByFields:x,start:g,num:_,outFields:k,cacheHint:h,relationshipId:l,returnGeometry:!1,objectIds:[v],where:P.where??void 0}),se=yield s.queryRelatedFeatures(I,{signal:e?.signal}),Ve=se[v]?.features||[];return Ve.forEach(ue=>{ue.sourceLayer=p,ue.layer=p}),Ve})}};n([a()],$.prototype,"_loaded",void 0),n([a()],$.prototype,"_queryAbortController",void 0),n([a()],$.prototype,"_queryPageAbortController",void 0),n([a()],$.prototype,"_queryFeatureCountAbortController",void 0),n([a({value:1})],$.prototype,"featurePage",null),n([a()],$.prototype,"featuresPerPage",void 0),n([a({readOnly:!0})],$.prototype,"orderByFieldsFixedCasing",null),n([a({readOnly:!0})],$.prototype,"supportsCacheHint",null),n([a({readOnly:!0})],$.prototype,"canLoad",null),n([a({readOnly:!0})],$.prototype,"canQuery",null),n([a()],$.prototype,"description",void 0),n([a({readOnly:!0})],$.prototype,"itemDescriptionFieldName",null),n([a({value:3})],$.prototype,"displayCount",null),n([a({type:de})],$.prototype,"graphic",void 0),n([a()],$.prototype,"layer",void 0),n([a()],$.prototype,"map",void 0),n([a({readOnly:!0})],$.prototype,"objectId",null),n([a({readOnly:!0})],$.prototype,"objectIdField",null),n([a()],$.prototype,"orderByFields",void 0),n([a({readOnly:!0})],$.prototype,"relatedFeatures",null),n([a({readOnly:!0})],$.prototype,"relatedLayer",null),n([a({readOnly:!0})],$.prototype,"relationship",null),n([a()],$.prototype,"featureCount",void 0),n([a({readOnly:!0})],$.prototype,"relatedFeatureViewModels",null),n([a()],$.prototype,"relationshipId",void 0),n([a()],$.prototype,"showAllEnabled",void 0),n([a()],$.prototype,"state",null),n([a()],$.prototype,"title",void 0),$=n([w("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],$);var yt=$;var Jt="esri-feature",vt=`${Jt}-relationship`,Pe={base:vt,listContainer:`${vt}__list`,listItem:`${vt}__list-item`,listItemHidden:`${vt}__list-item--hidden`,listContainerQuerying:`${vt}__list--querying`,featureObserver:`${Jt}__feature-observer`,stickySpinnerContainer:`${Jt}__sticky-loading-container`,loadingSpinnerContainer:`${Jt}__loading-container`},Co={title:!0,description:!0},J=class extends V{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new yt,this.messages=null,this.messagesCommon=null,this.visibleElements=b({},Co),this._increaseFeaturePage=()=>{let{state:i,showAllEnabled:r,relatedFeatures:o,featuresPerPage:s,featurePage:l}=this.viewModel;i==="ready"&&r&&o.length>=s*l&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new ke,this.addHandles([f(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),C),f(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),ne(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return ee({icon:()=>import("./chunk-VQEZLR5A.js"),list:()=>import("./chunk-VMNMFMZ2.js"),"list-item":()=>import("./chunk-FAB5FTUK.js"),loader:()=>import("./chunk-N5ULBSCQ.js"),notice:()=>import("./chunk-QOT2HPNH.js")})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Qi(this._featureElementInfo)}get displayShowAllButton(){let{showAllEnabled:e,featureCount:t,displayCount:i,state:r}=this.viewModel;return!e&&!!t&&r==="ready"&&(t>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){let{messages:e}=this,{featureCount:t}=this.viewModel;return Q(e?.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return b(b({},Co),e)}render(){let{state:e}=this.viewModel;return c("div",{class:this.classes(Pe.base,M.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return this.viewModel.state==="querying"?c("div",{class:Pe.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return c("calcite-loader",{inline:!0,label:""})}_renderLoading(){return c("div",{class:Pe.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return c("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){let e=le(this.container)?"chevron-left":"chevron-right";return c("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderRelatedFeature(e){let{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&e.formattedAttributes?.global[t];let r=e.state==="loading";return c("calcite-list-item",{class:this.classes(Pe.listItem,{[Pe.listItemHidden]:r}),description:e.description??"",key:e.uid,label:i,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?c("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return c("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return c("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Pe.featureObserver,key:"feature-observer"})}_renderList(){let{relatedFeatureViewModels:e}=this.viewModel;return c("calcite-list",null,e.toArray().map(t=>this._renderRelatedFeature(t)),this._renderShowAllListItem())}_renderRelatedFeatures(){let{displayListItems:e}=this,{state:t}=this.viewModel;return c("div",{class:this.classes(Pe.listContainer,{[Pe.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return c("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){let{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e?.forEach(i=>{this.addHandles(f(()=>[i.title,i.state],()=>this.scheduleRender(),C),t)}),this.scheduleRender()}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,r=t.title&&this.title;this._featureElementInfo?.set({description:i,title:r,headingLevel:e})}_handleRelatedFeatureObserverChange(){return y(this,null,function*(){this._unobserveRelatedFeatureObserver();let{state:e,showAllEnabled:t}=this.viewModel;yield Mt(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)})}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};n([a()],J.prototype,"_relatedFeatureIntersectionObserverNode",void 0),n([a({readOnly:!0})],J.prototype,"displayShowAllButton",null),n([a({readOnly:!0})],J.prototype,"displayListItems",null),n([a()],J.prototype,"description",null),n([a({readOnly:!0})],J.prototype,"featureCountDescription",null),n([a()],J.prototype,"headingLevel",void 0),n([a()],J.prototype,"title",null),n([a({type:yt})],J.prototype,"viewModel",void 0),n([a(),q("esri/widgets/Feature/t9n/Feature")],J.prototype,"messages",void 0),n([a(),q("esri/t9n/common")],J.prototype,"messagesCommon",void 0),n([a()],J.prototype,"visibleElements",void 0),n([ae("visibleElements")],J.prototype,"castVisibleElements",null),J=n([w("esri.widgets.Feature.FeatureRelationship")],J);var Oi=J;var ei=class{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}};var bt,Gs=1,Ao="content-view-models",xo="relationship-view-models",Eo={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0},O=bt=class extends Et(U){constructor(e){super(e),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=qe(this._graphicChanged,Gs,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=b({},Eo),this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{let{abilities:i}=this;return t.type==="attachments"&&!!i.attachmentsContent||t.type==="custom"&&!!i.customContent||t.type==="fields"&&!!i.fieldsContent||t.type==="media"&&!!i.mediaContent||t.type==="text"&&!!i.textContent||t.type==="expression"&&!!i.expressionContent||t.type==="relationship"&&!!i.relationshipContent},this.addHandles(f(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),C))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return Zr(Ii(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return qt(this.graphic)}castAbilities(e){return b(b({},Eo),e)}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get timeZone(){return this.view?.timeZone??It}set timeZone(e){this._overrideIfSome("timeZone",e)}get map(){return this.view?.map||null}set map(e){this._override("map",e)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){let i=this.contentViewModels[e];i instanceof _e&&i.setActiveMedia(t)}nextMedia(e){let t=this.contentViewModels[e];t instanceof _e&&t.next()}previousMedia(e){let t=this.contentViewModels[e];t instanceof _e&&t.previous()}updateGeometry(){return y(this,null,function*(){let{graphic:e,spatialReference:t,_sourceLayer:i}=this;yield i?.load();let r=i?.objectIdField;if(!r||!e||!i)return;let o=e?.attributes?.[r];if(o==null)return;let s=[o];if(!e.geometry){let l=yield Ci({layer:i,graphic:e,outFields:[],objectIds:s,returnGeometry:!0,spatialReference:t}),d=l?.geometry;d&&(e.geometry=d)}})}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){return y(this,null,function*(){this._cancelFeatureQuery(),this._error=null,this._clear();let{graphic:e}=this;if(!e)return;let t=new AbortController;this._featureAbortController=t;try{yield this._queryFeature({signal:t.signal})}catch(i){at(i)||(this._error=i,N.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)})}_cancelFeatureQuery(){let{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)).filter(ge):typeof e=="string"?this._compileText(new St({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(xo),this.removeHandles(Ao),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){let i=e?.graphic?.getObjectId(),r=t?.getObjectId();return i!=null&&r!=null&&i===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:i}){let{view:r,spatialReference:o,timeZone:s}=this;t?.filter(Boolean).forEach(l=>{e.some(d=>this._matchesFeature(d,l))||e.add(new bt({abilities:{relationshipContent:!1},map:i,view:r,spatialReference:o,timeZone:s,graphic:l}))}),e.forEach(l=>{t?.find(u=>this._matchesFeature(l,u))||e.remove(l)})}_setExpressionContentVM(e,t){let i=this.formattedAttributes,{contentElement:r,contentElementViewModel:o}=e,s=r?.type;o&&s&&(s==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),o.set(this._createFieldsVMParams(r,t))),s==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),o.set(this._createMediaVMParams(r,t))),s==="text"&&o.set(this._createTextVMParams(r)))}_compileRelationship(e,t){let{displayCount:i,orderByFields:r,relationshipId:o,title:s,description:l}=e,{_sourceLayer:d,graphic:u,map:p}=this;if(!Fi(d))return;let h=new yt(b({displayCount:i,graphic:u,orderByFields:r,relationshipId:o,layer:d,map:p},this._compileTitleAndDesc({title:s,description:l})));return this.contentViewModels[t]=h,this.addHandles(ne(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),xo),e}_compileExpression(e,t){let{expressionInfo:i}=e,{graphic:r,map:o,spatialReference:s,view:l,location:d}=this,u=new gt({expressionInfo:i,graphic:r,interceptor:bt.interceptor,map:o,spatialReference:s,view:l,location:d});return this.contentViewModels[t]=u,this.addHandles(f(()=>u.contentElementViewModel,()=>this._setExpressionContentVM(u,t),C),Ao),e}_compileAttachments(e,t){let{graphic:i}=this,{description:r,title:o}=e;return this.contentViewModels[t]=new mt(b({graphic:i},this._compileTitleAndDesc({title:o,description:r}))),e}_compileCustom(e,t){let{graphic:i}=this,{creator:r,destroyer:o}=e;return this.contentViewModels[t]=new He({graphic:i,creator:r,destroyer:o}),e}_compileTitleAndDesc({title:e,description:t}){let{_fieldInfoMap:i,_sourceLayer:r,graphic:o,formattedAttributes:s}=this,l=o?.attributes,d=this._expressionAttributes,u=s.global;return{title:Ce({attributes:l,fieldInfoMap:i,globalAttributes:u,expressionAttributes:d,layer:r,text:e}),description:Ce({attributes:l,fieldInfoMap:i,globalAttributes:u,expressionAttributes:d,layer:r,text:t})}}_createFieldsVMParams(e,t){let i=this._effectivePopupTemplate,r=this.formattedAttributes,o=b(b({},r?.global),r?.content[t]),s=e?.fieldInfos||i?.fieldInfos,l=s?.filter(({fieldName:h})=>!!h&&(ut(h)||ce(h)||o.hasOwnProperty(h))),d=i?.expressionInfos,{description:u,title:p}=e;return b({attributes:o,expressionInfos:d,fieldInfos:l},this._compileTitleAndDesc({title:p,description:u}))}_compileFields(e,t){let i=e.clone(),r=new We(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){let{abilities:i,graphic:r,_fieldInfoMap:o,_effectivePopupTemplate:s,relatedInfos:l,_sourceLayer:d,_expressionAttributes:u}=this,p=this.formattedAttributes,h=r?.attributes??{},{description:m,mediaInfos:v,title:g}=e;return b({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,isAggregate:r?.isAggregate,layer:d,fieldInfoMap:o,formattedAttributes:b(b({},p?.global),p?.content[t]),expressionAttributes:u,mediaInfos:v,popupTemplate:s,relatedInfos:l},this._compileTitleAndDesc({title:g,description:m}))}_compileMedia(e,t){let i=e.clone(),r=new _e(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){let{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:o}=this;if(e&&e.text){let s=t?.attributes??{},l=this.formattedAttributes?.global??{};e.text=Ce({attributes:s,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){let i=e.clone();return this.contentViewModels[t]=new He(this._createTextVMParams(i)),i}_compileLastEditInfo(){let{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,timeZone:r}=this;if(!e)return;let{lastEditInfoEnabled:o}=e,s=t?.editFieldsInfo;return o&&s?Ur(s,i?.attributes,r,t):void 0}_compileTitle(e){let{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:o}=this,s=r?.attributes??{},l=this.formattedAttributes?.global??{};return Ce({attributes:s,fieldInfoMap:t,globalAttributes:l,expressionAttributes:o,layer:i,text:e})}_getTitle(){return y(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?Ke({type:"title",value:e?.title,event:{graphic:t}}):null})}_getContent(){return y(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?Ke({type:"content",value:e?.content,event:{graphic:t}}):null})}_queryFeature(e){return y(this,null,function*(){let{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:o}=this,s=this.map,l=this.view,d=this.spatialReference,u=this.location;if(t!==this._featureAbortController||!r)return;yield Qr({graphic:r,popupTemplate:o,layer:i,spatialReference:d},e);let{content:{value:p},title:{value:h}}=yield ve({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:m}}=yield ve({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:bo({expressionInfos:o?.expressionInfos,spatialReference:d,graphic:r,map:s,interceptor:bt.interceptor,view:l,options:e,location:u})});t===this._featureAbortController&&r&&(this._expressionAttributes=m,this._graphicExpressionAttributes=b(b({},r.attributes),m),this._set("formattedAttributes",this._createFormattedAttributes(p)),this._set("title",this._compileTitle(h)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(p)||null))})}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){let{_effectivePopupTemplate:r,graphic:o,relatedInfos:s,_sourceLayer:l,_fieldInfoMap:d,_graphicExpressionAttributes:u,timeZone:p}=this;i.content[t]=Zt({fieldInfos:r?.fieldInfos,graphic:o,attributes:b(b({},u),e.attributes),layer:l,fieldInfoMap:d,relatedInfos:s,timeZone:p})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){let{graphic:r,relatedInfos:o,_sourceLayer:s,_fieldInfoMap:l,_graphicExpressionAttributes:d,timeZone:u}=this;i.content[t]=Zt({fieldInfos:e.fieldInfos,graphic:r,attributes:b(b({},d),e.attributes),layer:s,fieldInfoMap:l,relatedInfos:o,timeZone:u})}}_createFormattedAttributes(e){let{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:o,_fieldInfoMap:s,_graphicExpressionAttributes:l,timeZone:d}=this,u=t?.fieldInfos,p={global:Zt({fieldInfos:u,graphic:i,attributes:l,layer:o,fieldInfoMap:s,relatedInfos:r,timeZone:d}),content:[]};return Array.isArray(e)&&e.forEach((h,m)=>{h.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:h,contentElementIndex:m,formattedAttributes:p}),h.type==="media"&&this._createMediaFormattedAttributes({contentElement:h,contentElementIndex:m,formattedAttributes:p})}),p}_checkForRelatedFeatures(e){let{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Ii(i),e)}_queryRelatedInfos(e,t,i){return y(this,null,function*(){let{relatedInfos:r,_sourceLayer:o}=this;r.clear();let s=o?.associatedLayer!=null?yield o?.associatedLayer.load(i):o;if(!s||!e||!t.filter(p=>!!p.fieldName&&ce(p.fieldName))?.length)return;t.forEach(p=>this._configureRelatedInfo(p,s));let d=yield mo({relatedInfos:r,layer:s},i);Object.keys(d).forEach(p=>{let h=r.get(p.toString()),m=d[p]?.value;h&&m&&(h.layerInfo=m.data)});let u=yield fo({graphic:e,relatedInfos:r,layer:s},i);Object.keys(u).forEach(p=>{ho(u[p]?.value,r.get(p.toString()))})})}_configureRelatedInfo(e,t){let{relatedInfos:i}=this,r=rt(e.fieldName||"");if(!r)return;let{layerId:o,fieldName:s}=r;if(!o)return;let l=i.get(o.toString())||po(o,t);l&&(go({relatedInfo:l,fieldName:s,fieldInfo:e}),this.relatedInfos.set(o,l))}};O.interceptor=new ei(Yr,Kr),n([a()],O.prototype,"_error",void 0),n([a()],O.prototype,"_featureAbortController",void 0),n([a({readOnly:!0})],O.prototype,"_effectivePopupTemplate",null),n([a({readOnly:!0})],O.prototype,"_fieldInfoMap",null),n([a({readOnly:!0})],O.prototype,"_sourceLayer",null),n([a()],O.prototype,"abilities",void 0),n([ae("abilities")],O.prototype,"castAbilities",null),n([a({readOnly:!0})],O.prototype,"content",void 0),n([a({readOnly:!0})],O.prototype,"contentViewModels",void 0),n([a()],O.prototype,"description",void 0),n([a({type:Boolean})],O.prototype,"defaultPopupTemplateEnabled",void 0),n([a({readOnly:!0})],O.prototype,"isTable",null),n([a({readOnly:!0})],O.prototype,"state",null),n([a({readOnly:!0})],O.prototype,"formattedAttributes",void 0),n([a({type:de,value:null})],O.prototype,"graphic",null),n([a({readOnly:!0})],O.prototype,"lastEditInfo",void 0),n([a({type:Xe})],O.prototype,"location",void 0),n([a({readOnly:!0})],O.prototype,"relatedInfos",void 0),n([a()],O.prototype,"spatialReference",null),n([a()],O.prototype,"timeZone",null),n([a({readOnly:!0})],O.prototype,"title",void 0),n([a()],O.prototype,"map",null),n([a({readOnly:!0})],O.prototype,"waitingForContent",null),n([a()],O.prototype,"view",void 0),O=bt=n([w("esri.widgets.Feature.FeatureViewModel")],O);var wt=O;var G="esri-feature",B={base:G,container:`${G}__size-container`,title:`${G}__title`,main:`${G}__main-container`,btn:`${G}__button`,icon:`${G}__icon`,content:`${G}__content`,contentNode:`${G}__content-node`,contentNodeText:`${G}__content-node--text`,contentElement:`${G}__content-element`,text:`${G}__text`,lastEditedInfo:`${G}__last-edited-info`,fields:`${G}__fields`,fieldHeader:`${G}__field-header`,fieldData:`${G}__field-data`,fieldDataDate:`${G}__field-data--date`,loadingSpinnerContainer:`${G}__loading-container`};var ti=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>Bt(i)&&!i.destroyed?c("div",{class:B.contentNode,key:i},i.render()):i instanceof HTMLElement?c("div",{afterCreate:this._attachToNode,bind:i,class:B.contentNode,key:i}):kr(i)?c("div",{afterCreate:this._attachToNode,bind:i.domNode,class:B.contentNode,key:i}):null}_attachToNode(i){let r=this;i.appendChild(r)}};return t=n([w("esri.widgets.Feature.support.FeatureContentMixin")],t),t};var Ni,To={title:!0,content:!0,lastEditedInfo:!0},Lo="relationship-handles",W=Ni=class extends ti(V){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements=b({},To),this.viewModel=new wt}initialize(){this.addHandles(f(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),C))}loadDependencies(){return ee({notice:()=>import("./chunk-QOT2HPNH.js"),loader:()=>import("./chunk-N5ULBSCQ.js")})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return b(b({},To),e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){let{state:e}=this.viewModel,t=c("div",{class:B.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return c("div",{class:this.classes(B.base,M.widget)},t)}_renderError(){let{messagesCommon:e,messages:t,visibleElements:i}=this;return c("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?c("div",{key:"error-title",slot:"title"},e.errorMessage):null,c("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return c("div",{class:B.loadingSpinnerContainer,key:"loading-container"},c("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){let{visibleElements:e}=this;return e.content?c("div",{class:B.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){let{visibleElements:e,title:t}=this;return e.title?c(Ye,{class:B.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){let e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?c("div",{class:B.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){let i=this._contentWidgets[0];return!i||i.destroyed?null:c("div",{class:this.classes(B.contentNode,B.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){let{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content?.[e.type])return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);default:return null}}_renderAttachments(e){let t=this._contentWidgets[e];if(!t||t.destroyed)return null;let{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?c("div",{class:this.classes(B.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?c("div",{class:B.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderExpression(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:B.contentElement,key:this._buildKey("expression-element",e)},t.render())}_renderCustom(e,t){let{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?c("div",{class:B.contentElement,key:this._buildKey("custom-element",t)},r.render()):null}_renderFields(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:B.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:B.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){let{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;let{date:r,user:o}=i,s=i.type==="edit"?o?t.lastEditedByUser:t.lastEdited:o?t.lastCreatedByUser:t.lastCreated,l=Q(s,{date:r,user:o});return c("div",{class:this.classes(B.lastEditedInfo,B.contentElement),key:"edit-info-element"},l)}_renderText(e,t){let i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?c("div",{class:this.classes(B.contentElement,B.text),key:this._buildKey("text-element",t)},r.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this.removeHandles(Lo),this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_addFeatureRelationshipHandles(e){let{flowItems:t,visibleElements:i}=this;this.addHandles([ne(()=>e,"select-record",({featureViewModel:r})=>{t&&(r.abilities={relationshipContent:!0},t.push(new Ni({flowItems:t,viewModel:r,visibleElements:i})))}),ne(()=>e,"show-all-records",()=>{if(!t)return;let{viewModel:r}=e;r.showAllEnabled=!0;let o=new Oi({visibleElements:{title:!1,description:!1},viewModel:r});this._addFeatureRelationshipHandles(o),t.push(o)})],Lo)}_setupContentWidgets(){this._destroyContentWidgets();let{headingLevel:e,visibleElements:t}=this,i=this.viewModel?.content,{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((o,s)=>{if(o.type==="attachments"&&(this._contentWidgets[s]=new so({displayType:o.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:r[s]})),o.type==="fields"&&(this._contentWidgets[s]=new Xt({viewModel:r[s]})),o.type==="media"&&(this._contentWidgets[s]=new Yt({viewModel:r[s]})),o.type==="text"&&(this._contentWidgets[s]=new it({viewModel:r[s]})),o.type==="custom"&&(this._contentWidgets[s]=new it({viewModel:r[s]})),o.type==="expression"&&(this._contentWidgets[s]=new Fo({viewModel:r[s]})),o.type==="relationship"){let l=new Oi({viewModel:r[s]});this._addFeatureRelationshipHandles(l),this._contentWidgets[s]=l}},this);else{let o=r[0];o&&!o.destroyed&&(this._contentWidgets[0]=new it({viewModel:o}))}this.scheduleRender()}};n([a()],W.prototype,"graphic",null),n([a()],W.prototype,"defaultPopupTemplateEnabled",null),n([a()],W.prototype,"flowItems",void 0),n([a()],W.prototype,"headingLevel",void 0),n([a({readOnly:!0})],W.prototype,"isTable",null),n([a()],W.prototype,"icon",null),n([a()],W.prototype,"label",null),n([a(),q("esri/widgets/Feature/t9n/Feature")],W.prototype,"messages",void 0),n([a(),q("esri/t9n/common")],W.prototype,"messagesCommon",void 0),n([a()],W.prototype,"spatialReference",null),n([a()],W.prototype,"timeZone",null),n([a({readOnly:!0})],W.prototype,"title",null),n([a()],W.prototype,"visibleElements",void 0),n([ae("visibleElements")],W.prototype,"castVisibleElements",null),n([a()],W.prototype,"map",null),n([a()],W.prototype,"view",null),n([a({type:wt})],W.prototype,"viewModel",void 0),W=Ni=n([w("esri.widgets.Feature")],W);var ko=W;var je=class extends Ji.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([Be(()=>{let t=this.screenLocationEnabled?this.view:null;return t?[t.size,t.type==="3d"?t.camera:t.viewpoint]:null},()=>this.notifyChange("screenLocation")),f(()=>this.screenLocation,(t,i)=>{t!=null&&i!=null&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){let{location:e,view:t,screenLocationEnabled:i}=this,r=t?.spatialReference,o=r?pr(e,r).geometry:null;return i&&o&&t?.ready?t.toScreen(o):null}};n([a()],je.prototype,"location",void 0),n([a()],je.prototype,"screenLocation",null),n([a()],je.prototype,"screenLocationEnabled",void 0),n([a()],je.prototype,"view",void 0),je=n([w("esri.widgets.support.AnchorElementViewModel")],je);var ii=je;var ri=class extends ii{constructor(e){super(e),this.visible=!1}};n([a()],ri.prototype,"visible",void 0),ri=n([w("esri.widgets.Spinner.SpinnerViewModel")],ri);var Vi=ri;var Bi="esri-spinner",Di={base:Bi,spinnerStart:`${Bi}--start`,spinnerFinish:`${Bi}--finish`},Ue=class extends V{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new Vi}initialize(){this.addHandles(f(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){let{location:t,promise:i}=e??{};t&&(this.viewModel.location=t),this.visible=!0;let r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){let{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,o=!e&&i,s={[Di.spinnerStart]:r,[Di.spinnerFinish]:o},l=this._getPositionStyles();return c("div",{class:this.classes(Di.base,s),styles:l})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);let t=Mt(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){let{screenLocation:e,view:t}=this.viewModel;if(t==null||e==null)return{};let{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};n([a()],Ue.prototype,"location",null),n([a()],Ue.prototype,"view",null),n([a({type:Vi})],Ue.prototype,"viewModel",void 0),n([a()],Ue.prototype,"visible",null),Ue=n([w("esri.widgets.Spinner")],Ue);var Ro=Ue;var X="esri-features",j={icon:`${X}__icon`,actionImage:`${X}__action-image`,base:X,container:`${X}__container`,contentContainer:`${X}__content-container`,contentFeature:`${X}__content-feature`,flowItemCollapsed:`${X}__flow-item--collapsed`,header:`${X}__header`,footer:`${X}__footer`,featureMenuObserver:`${X}__feature-menu-observer`,actionExit:`${X}__action--exit`,loader:`${X}__loader`,featuresHeading:`${X}__heading`,paginationActionBar:`${X}__pagination-action-bar`,paginationPrevious:`${X}__pagination-previous`,paginationNext:`${X}__pagination-next`};var Ze=class extends V{constructor(e,t){super(e,t),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=i=>{this.emit("open-related-feature",{feature:i})}}loadDependencies(){return ee({action:()=>import("./chunk-B3LYN5YS.js"),"flow-item":()=>import("./chunk-R2TUY7C4.js")})}render(){let{flowItems:e}=this,t=e?.toArray();return c(sr,null,t?.map(i=>this._renderRelatedRecordsFlowItem(i)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){let e=this.flowItems?.pop();e&&("showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_renderRelatedRecordsFlowItem(e){let{messages:t,closable:i,closed:r}=this,o="graphic"in e&&!e.isTable&&e.graphic?.geometry,s=t.exitRelatedRecords,l=t.selectFeature;return c("calcite-flow-item",{bind:this,closable:i,closed:r,description:this._getRelatedRecordsFlowItemDescription(e),heading:e.title??"",key:`flow-item-${e.viewModel.uid}`,onCalciteFlowItemBack:d=>{d.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},c("calcite-action",{appearance:"transparent",bind:this,class:j.actionExit,icon:"move-up",key:"exit-related-records-action",onclick:this._handleExitClick,slot:"header-actions-start",text:s,title:s}),o?c("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",onclick:()=>this._handleOpenRelatedFeature(e),slot:"header-actions-end",text:l,title:l}):null,c("div",{class:j.container},e.render()))}_getRelatedRecordsFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}};n([a()],Ze.prototype,"flowItems",void 0),n([a(),q("esri/widgets/Features/t9n/Features")],Ze.prototype,"messages",void 0),n([a()],Ze.prototype,"closed",void 0),n([a()],Ze.prototype,"closable",void 0),Ze=n([w("esri.widgets.Features.FeaturesRelatedRecords")],Ze);var So=Ze;var oi=class{constructor(t){this._observable=new ir,this._set=new Set(t)}get size(){return Te(this._observable),this._set.size}add(t){let i=this._set.size;return this._set.add(t),this._set.size!==i&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(t){let i=this._set.delete(t);return i&&this._observable.notify(),i}entries(){return Te(this._observable),this._set.entries()}forEach(t,i){Te(this._observable),this._set.forEach((r,o)=>t.call(i,r,o,this),i)}has(t){return Te(this._observable),this._set.has(t)}keys(){return Te(this._observable),this._set.keys()}values(){return Te(this._observable),this._set.values()}[Symbol.iterator](){return Te(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}};var qi="OBJECTID";var Po="esri-relationship-ramp",ot=`${Po}--diamond`,$e=`${Po}--square`;var Xf={diamondContainer:`${ot}__container`,diamondLeftCol:`${ot}__left-column`,diamondRightCol:`${ot}__right-column`,diamondMidCol:`${ot}__middle-column`,diamondMidColLabel:`${ot}__middle-column--label`,diamondMidColRamp:`${ot}__middle-column--ramp`,squareTable:`${$e}__table`,squareTableRow:`${$e}__table-row`,squareTableCell:`${$e}__table-cell`,squareTableLabel:`${$e}__table-label`,squareTableLabelLeftBottom:`${$e}__table-label--left-bottom`,squareTableLabelRightBottom:`${$e}__table-label--right-bottom`,squareTableLabelLeftTop:`${$e}__table-label--left-top`,squareTableLabelRightTop:`${$e}__table-label--right-top`};function $o(e){return e&&"opacity"in e?e.opacity*$o(e.parent):1}function zi(e,t){return y(this,null,function*(){if(!e)return;let i=e.sourceLayer,r=(t!=null&&t.useSourceLayer?i:e.layer)??i,o=$o(r);if(e.symbol!=null&&(t==null||t.ignoreGraphicSymbol!==!0)){let I=e.symbol.type==="web-style"?yield Lr(e.symbol,pe(b({},t),{cache:t!=null?t.webStyleCache:null})):e.symbol.clone();return Nt(I,null,o),I}let s=t?.renderer??Ys(r),l=s&&"getSymbolAsync"in s?yield s.getSymbolAsync(e,t):null;if(!l)return;if(l=l.type==="web-style"?yield l.fetchSymbol(pe(b({},t),{cache:t!=null?t.webStyleCache:null})):l.clone(),!s||!("visualVariables"in s)||!s.visualVariables?.length)return Nt(l,null,o),l;if("arcadeRequiredForVisualVariables"in s&&s.arcadeRequiredForVisualVariables&&t?.arcade==null){let I=b({},t);I.arcade=yield $t(),t=I}let{getColor:d,getOpacity:u,getAllSizes:p,getRotationAngle:h}=yield import("./chunk-UZBCY7CH.js"),m=[],v=[],g=[],_=[];for(let I of s.visualVariables)switch(I.type){case"color":m.push(I);break;case"opacity":v.push(I);break;case"rotation":_.push(I);break;case"size":I.target||g.push(I)}let E=!!m.length&&m[m.length-1],k=E?d(E,e,t):null,x=!!v.length&&v[v.length-1],P=x?u(x,e,t):null;if(o!=null&&(P=P!=null?P*o:o),Nt(l,k,P),g.length){let I=p(g,e,t);yield Er(l,I)}for(let I of _)Tr(l,h(I,e,t),I.axis);return l})}function Ys(e){if(e)return"renderer"in e?e.renderer:void 0}var xe=be.ofType({key:"type",defaultKeyValue:"button",base:Fr,typeMap:{button:De,toggle:hi}}),Ee=new De({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:he.zoomInMagnifyingGlass}),Hi=new De({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:he.trash}),Oe=new De({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:he.zoomInMagnifyingGlass}),Fe=new hi({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:he.table,value:!1});var Ks="esri.widgets.Popup.PopupViewModel",si=()=>N.getLogger(Ks),Oo=e=>{let{event:t,view:i,viewModel:r}=e,{action:o}=t;if(!o)return Promise.reject(new R("trigger-action:missing-arguments","Event has no action"));let{disabled:s,id:l}=o;if(!l)return Promise.reject(new R("trigger-action:invalid-action","action.id is missing"));if(s)return Promise.reject(new R("trigger-action:invalid-action","Action is disabled"));if(l===Ee.id)return en(r).catch(Xi);if(l===Oe.id)return tn(r);if(l===Fe.id)return r.browseClusterEnabled=!r.browseClusterEnabled,r.featureMenuOpen=r.browseClusterEnabled,Promise.resolve();if(l===Hi.id){r.visible=!1;let{selectedFeature:d}=r;if(!d)return Promise.reject(new R(`trigger-action:${Hi.id}`,"selectedFeature is required",{selectedFeature:d}));let{sourceLayer:u}=d;return u?u.remove(d):i?.graphics.remove(d),Promise.resolve()}return Promise.resolve()};function Wi(e){let{selectedFeature:t,location:i,view:r}=e;return r?t??i??null:null}function Ne(e){return!!e&&e.isAggregate&&e.sourceLayer?.featureReduction?.type==="cluster"}function Js(e,t){return y(this,null,function*(){if(t?.type!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;let i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=null;try{r=yield i.whenGraphicBounds(e,{useViewElevation:!0})}catch{}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0})}function en(e){return y(this,null,function*(){let{location:t,selectedFeature:i,view:r,zoomFactor:o}=e,s=Wi(e);if(!r||!s){let h=new R("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:r});throw si().error(h),h}let l=r.scale/o,d=e.selectedFeature?.geometry,u=d??t,p=u!=null&&u.type==="point"&&(yield Js(i,r));Ee.active=!0,Ee.disabled=!0;try{yield e.zoomTo({target:{target:s,scale:p?l:void 0}})}catch{let m=new R("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});si().error(m)}finally{Ee.active=!1,Ee.disabled=!1,e.zoomToLocation=null,p&&(e.location=u)}})}function tn(e){return y(this,null,function*(){let{selectedFeature:t,view:i}=e;if(i?.type!=="2d"){let l=new R("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw si().error(l),l}if(!t||!Ne(t)){let l=new R("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw si().error(l),l}let[r,o]=yield ji(i,t);Oe.active=!0,Oe.disabled=!0;let{extent:s}=yield r.queryExtent(o);s&&(yield e.zoomTo({target:s})),Oe.active=!1,Oe.disabled=!1})}function No(e){return y(this,null,function*(){let{view:t,selectedFeature:i}=e;if(!t||!i)return;let[r,o]=yield ji(t,i),{extent:s}=yield r.queryExtent(o);e.selectedClusterBoundaryFeature.geometry=s,t.graphics.add(e.selectedClusterBoundaryFeature)})}function Vo(e){return y(this,null,function*(){let{selectedFeature:t,view:i}=e;if(!i||!t)return;let[r,o]=yield ji(i,t);Fe.active=!0,Fe.disabled=!0;let{features:s}=yield r.queryFeatures(o);Fe.active=!1,Fe.disabled=!1,Fe.value=!0,e?.open({features:[t].concat(s),featureMenuOpen:!0})})}function ji(e,t){return y(this,null,function*(){let i=yield e.whenLayerView(t.sourceLayer),r=i.createQuery(),o=t.getObjectId();return r.aggregateIds=o!=null?[o]:[],[i,r]})}function Bo(e){Fe.value=!1;let t=e.features.filter(i=>Ne(i));t.length&&(e.features=t)}var rn=()=>[Ee.clone()],on=()=>[Oe.clone(),Fe.clone()],ni=null;function sn(e,t){return e==="building-scene"||t==="2d"&&(e==="map-image"||e==="tile"||e==="imagery"||e==="imagery-tile")}var A=class extends Pr(ii){constructor(e){super(e),this._pendingPromises=new oi,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this._locationScaleHandle=null,this.actions=new xe,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new de({symbol:new gr({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=Qe(t=>y(this,null,function*(){let{spatialReference:i}=this,r=this.selectedFeature?.geometry?.type,o=this.location??t;if(r!=="mesh"&&i&&o&&this.selectedFeature)if(r!=="point")try{let{pendingFeatures:s}=yield this._fetchFeaturesWithController({mapPoint:o}),l=(yield Promise.all(s)).flat().filter(Boolean);if(!l.length)return;if(l.length!==this.features.length){let h=this._getHighlightLayer(this.selectedFeature),m=h?.type==="imagery"?void 0:h&&"objectIdField"in h?h.objectIdField||qi:null;if(m){let v=this.selectedFeature.getObjectId(),g=l.findIndex(_=>this._getHighlightLayer(_)?.uid===h?.uid&&_.attributes[m]===v);this.features=l,this.selectedFeatureIndex=g}}let d=l[this.selectedFeatureIndex]?.geometry,u=(d?.type!=="mesh"?d:null)??this.selectedFeature.geometry,p=u?ur(u,i):null;if(!p)return;ni||(ni=yield import("./chunk-PRKZKXZV.js")),(yield ni.intersects(p,o))||(this.location=(yield ni.nearestCoordinate(p,o)).coordinate??o)}catch(s){at(s)||N.getLogger(this).error(s)}else this.location=ct(this.selectedFeature.geometry)??o}))}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),f(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),f(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),f(()=>this.view?.animation?.state,e=>this._animationStateChange(e)),f(()=>this.location,e=>this._locationChange(e)),f(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),f(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),f(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),f(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>Oo({event:e,viewModel:this,view:this.view})),Be(()=>!this.waitingForResult,()=>this._waitingForResultChange(),or),f(()=>[this.features,this.map,this.spatialReference,this.timeZone],()=>this._updateFeatureVMs()),f(()=>this.view?.scale,()=>this._viewScaleChange()),Be(()=>!this.visible,()=>this.browseClusterEnabled=!1),f(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null,this._locationScaleHandle?.remove(),this._locationScaleHandle=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){let e=this._get("allActions")||new xe;e.removeAll();let{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:o,selectedFeature:s}=this,l=o?i.concat(t):t,d=s&&(typeof s.getEffectivePopupTemplate=="function"&&s.getEffectivePopupTemplate(r)||s.popupTemplate),u=d?.actions;return(d?.overwriteActions?u:u?.concat(l)??l)?.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){let e=this._get("defaultActions")||new xe;return e.removeAll(),e.addMany(Ne(this.selectedFeature)?on():rn()),e}get featureCount(){return this.features.length}set features(e){let t=e||[];this._set("features",t);let{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:o}=this,s=r&&t.length;s&&i&&o===-1?this.selectedFeatureIndex=0:s&&o!==-1||(this.selectedFeatureIndex=t.length?0:-1)}set location(e){let t=e,i=this.spatialReference?.isWebMercator;e?.spatialReference?.isWGS84&&i&&(t=lr(e)),this._set("location",t)}get map(){return this.view?.map??null}set map(e){this._override("map",e)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){this._pendingPromises.clear(),this.features=[],Array.isArray(e)&&e.length?(this._set("promises",e),(e=e.slice(0)).forEach(t=>this._pendingPromises.add(t)),e.reduce((t,i)=>t.finally(()=>i.then(r=>{this._pendingPromises.has(i)&&this._updateFeatures(r)}).finally(()=>this._pendingPromises.delete(i)).catch(()=>{})),Promise.resolve())):this._set("promises",[])}get selectedFeature(){let{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){let e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){let{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){let{view:e,map:t}=this;return e?e.ready?"ready":"disabled":t?"ready":"disabled"}get timeZone(){return this.view?.timeZone??It}set timeZone(e){this._overrideIfSome("timeZone",e)}get waitingForContents(){return this.featureViewModels.some(e=>e.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}centerAtLocation(){let{view:e}=this,t=Wi(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new R("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){let{view:i}=this;if(!i||!e)throw new R("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{pointerType:t?.event?.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t?.signal})}open(e){let t=pe(b({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);let r=["actionsMenuOpen","collapsed"];for(let o of r)delete t[o];this.set(t)}triggerAction(e){let t=this.allActions.at(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){Bo(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){return y(this,null,function*(){let{view:e,selectedFeature:t}=this;e?.type==="2d"?Ne(t)?(yield No(this),yield Vo(this)):N.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):N.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)})}handleViewClick(e){this._fetchFeaturesAndOpen(e)}_animationStateChange(e){this.zoomToLocation||(Ee.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){let e=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(ge);this.view?.graphics?.removeMany(e),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Ne(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){let{selectedFeature:t,updateLocationEnabled:i,view:r}=this;r&&i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){let{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:o}=this;if(i===null)return;let s=((i-1)*r+t)%t,l=s+r;o.slice(s,l).forEach((d,u)=>{d&&(d.graphic??=e[s+u])})}_selectedFeatureChange(e){return y(this,null,function*(){let{location:t,updateLocationEnabled:i,view:r}=this;if(!e||!r)return;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),Ne(e)?void 0:(e.symbol=yield zi(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));let o=e.sourceLayer?.type;if(o!=="map-image"&&o!=="imagery"&&o!=="imagery-tile"||(e.symbol=yield zi(e)),!i&&t||!e.geometry){if(i&&!e.geometry){yield this.centerAtLocation();let s=r.center?.clone();s&&(this.location=s)}}else this.location=ct(e.geometry)})}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return y(this,null,function*(){let{pendingFeatures:t}=yield this._fetchFeaturesWithController({mapPoint:e});this.promises=t})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){let{selectedFeature:e,features:t,featureViewModels:i,view:r,spatialReference:o,map:s,timeZone:l,location:d}=this;if(Ne(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t?.length)return;let u=i.slice(0),p=[];t.forEach((h,m)=>{if(!h)return;let v=null;if(u.some((g,_)=>(g&&g.graphic===h&&(v=g,u.splice(_,1)),!!v)),v)p[m]=v;else{let g=new wt({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:o,graphic:h===e?h:null,location:d,map:s,view:r,timeZone:l});p[m]=g}}),u.forEach(h=>h&&!h.destroyed&&h.destroy()),this._set("featureViewModels",p)}_getScreenPoint(e,t){return y(this,null,function*(){let{spatialReference:i,view:r}=this;if(!r)return null;yield r?.when();let o=e?.spatialReference;return o&&i?(yield hr(o,i,null,t),r.toScreen(e)):null})}_cancelFetchingFeatures(){let e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null}_projectScreenPointAndFetchFeatures(o){return y(this,arguments,function*({mapPoint:e,screenPoint:t,event:i,signal:r}){return this.fetchFeatures(t??(yield this._getScreenPoint(e??this.location,{signal:r})),{signal:r,event:i})})}_fetchFeaturesWithController({mapPoint:e,screenPoint:t,event:i}){this._cancelFetchingFeatures();let r=new AbortController,{signal:o}=r;this._fetchFeaturesController=r;let s=this._projectScreenPointAndFetchFeatures({mapPoint:e,screenPoint:t,signal:o,event:i});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),s}_fetchFeaturesAndOpen(e){return y(this,null,function*(){let{mapPoint:t,screenPoint:i}=e,{view:r}=this;this._locationScaleHandle?.remove(),this._locationScaleHandle=f(()=>this.view?.scale,()=>this._debouncedLocationUpdate(t).catch(s=>{at(s)||N.getLogger(this).error(s)}));let{pendingFeatures:o}=yield this._fetchFeaturesWithController({mapPoint:t,screenPoint:i,event:e});r?.popup&&"open"in r.popup&&r.popup.open({location:t??void 0,promises:o})})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(e,t){return y(this,null,function*(){return yield e.when(),e.whenLayerView(t)})}_getHighlightLayer(e){let{layer:t,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:i?.type==="map-notes"||i?.type==="subtype-group"?i:t}_getHighlightTarget(e,t,i){if(sn(t.type,i))return e;let r=e.getObjectId();if(r!=null)return r;let o=t.type==="imagery"?void 0:"objectIdField"in t?t.objectIdField||qi:null,s=e.attributes;return s&&o&&s[o]||e}_mapIncludesLayer(e){return!!this.map?.allLayers?.includes(e)}_highlightActiveFeature(){return y(this,null,function*(){let e="highlight-active-feature";this.removeHandles(e);let{highlightEnabled:t,view:i,activeFeature:r,visible:o}=this;if(!(r&&i&&t&&o))return;let s=this._getHighlightLayer(r);if(!(s&&s instanceof gi&&this._mapIncludesLayer(s)))return;let l=this._getLayerView(i,s);this._highlightActiveFeaturePromise=l;let d=yield l;if(!(d&&yi(d)&&this._highlightActiveFeaturePromise===l&&this.activeFeature&&this.highlightEnabled))return;let u=d.highlight(this._getHighlightTarget(r,s,i.type));this.addHandles(u,e)})}_highlightSelectedFeature(){return y(this,null,function*(){let e="highlight-selected-feature";this.removeHandles(e);let{selectedFeature:t,highlightEnabled:i,view:r,visible:o}=this;if(!(t&&r&&i&&o))return;let s=this._getHighlightLayer(t);if(!(s&&s instanceof gi&&this._mapIncludesLayer(s)))return;let l=this._getLayerView(r,s);this._highlightSelectedFeaturePromise=l;let d=yield l;if(!(d&&yi(d)&&this._highlightSelectedFeaturePromise===l&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;let u=d.highlight(this._getHighlightTarget(t,s,r.type));this.addHandles(u,e)})}_updateFeatures(e){let{features:t}=this,i=e.filter(r=>!t.includes(r));i?.length&&(this.features=t.concat(i))}};n([a()],A.prototype,"_fetchFeaturesController",void 0),n([a({type:xe})],A.prototype,"actions",void 0),n([a({readOnly:!0})],A.prototype,"active",null),n([a()],A.prototype,"activeFeature",void 0),n([a({readOnly:!0})],A.prototype,"allActions",null),n([a()],A.prototype,"autoCloseEnabled",void 0),n([a()],A.prototype,"browseClusterEnabled",void 0),n([a()],A.prototype,"content",void 0),n([a({type:xe,readOnly:!0})],A.prototype,"defaultActions",null),n([a({type:Boolean})],A.prototype,"defaultPopupTemplateEnabled",void 0),n([a({readOnly:!0})],A.prototype,"featureCount",null),n([a()],A.prototype,"featurePage",void 0),n([a({value:[]})],A.prototype,"features",null),n([a()],A.prototype,"featuresPerPage",void 0),n([a()],A.prototype,"featureMenuOpen",void 0),n([a()],A.prototype,"featureViewModelAbilities",void 0),n([a({readOnly:!0})],A.prototype,"featureViewModels",void 0),n([a()],A.prototype,"highlightEnabled",void 0),n([a()],A.prototype,"includeDefaultActions",void 0),n([a({type:Xe})],A.prototype,"location",null),n([a()],A.prototype,"map",null),n([a({readOnly:!0})],A.prototype,"pendingPromisesCount",null),n([a({readOnly:!0})],A.prototype,"promiseCount",null),n([a()],A.prototype,"promises",null),n([a({readOnly:!0})],A.prototype,"selectedClusterBoundaryFeature",void 0),n([a({value:null,readOnly:!0})],A.prototype,"selectedFeature",null),n([a({value:-1})],A.prototype,"selectedFeatureIndex",null),n([a({readOnly:!0})],A.prototype,"selectedFeatureViewModel",null),n([a({readOnly:!0})],A.prototype,"state",null),n([a()],A.prototype,"timeZone",null),n([a()],A.prototype,"title",void 0),n([a()],A.prototype,"updateLocationEnabled",void 0),n([a()],A.prototype,"view",void 0),n([a()],A.prototype,"visible",void 0),n([a({readOnly:!0})],A.prototype,"waitingForContents",null),n([a({readOnly:!0})],A.prototype,"waitingForResult",null),n([a()],A.prototype,"zoomFactor",void 0),n([a()],A.prototype,"zoomToLocation",void 0),n([a()],A.prototype,"centerAtLocation",null),A=n([w("esri.widgets.Features.FeaturesViewModel")],A);var _t=A;var fe=class extends U{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};n([a({type:Boolean,nonNullable:!0})],fe.prototype,"actionBar",void 0),n([a({type:Boolean,nonNullable:!0})],fe.prototype,"closeButton",void 0),n([a({type:Boolean,nonNullable:!0})],fe.prototype,"collapseButton",void 0),n([a({type:Boolean,nonNullable:!0})],fe.prototype,"featureNavigation",void 0),n([a({type:Boolean,nonNullable:!0})],fe.prototype,"featureListLayerTitle",void 0),n([a({type:Boolean,nonNullable:!0})],fe.prototype,"flow",void 0),n([a({type:Boolean,nonNullable:!0})],fe.prototype,"heading",void 0),n([a({type:Boolean,nonNullable:!0})],fe.prototype,"spinner",void 0),fe=n([w("esri.widgets.Features.FeaturesVisibleElements")],fe);var Ui=fe;var Do="selected-index",nn=0,qo="features-spinner",an=50;function zo(e){return e?.declaredClass.startsWith("esri.layers.")??!1}var T=class extends ti(V){constructor(e,t){super(e,t),this._featureMenuIntersectionObserverCallback=([i])=>{i?.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new be,this._relatedRecordsWidget=new So({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new xe,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new _t,this.visibleElements=new Ui,this._renderAction=(i,r)=>{let o=this._getActionTitle(i),{type:s,active:l,uid:d,disabled:u,indicator:p}=i;return i.visible?c("calcite-action",{active:s==="toggle"&&i.value,appearance:"solid",bind:this,"data-action-uid":d,disabled:u,icon:this._getActionIcon(i),indicator:p,key:`action-${r}`,loading:l,onclick:this._triggerAction,scale:"s",text:o,title:this._hideActionText?o:void 0},this._getFallbackIcon(i)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=i=>{this._focusOn===i&&requestAnimationFrame(()=>y(this,null,function*(){switch(i){case"menu-flow-item":yield this._featureMenuViewportNode?.setFocus();break;case"root-flow-item":yield this._rootFlowItemNode?.setFocus()}this._focusOn=null}))},this._focusFlowItemNodeThrottled=qe(this._focusFlowItemNode,an),this._displaySpinnerThrottled=qe(()=>this._displaySpinner(),nn),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,f(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),f(()=>this.viewModel?.active,i=>this._relatedRecordsWidget.closed=!i),f(()=>this.visibleElements?.closeButton,i=>this._relatedRecordsWidget.closable=i),f(()=>this.visibleElements?.spinner,i=>this._spinnerEnabledChange(i)),f(()=>this.viewModel?.view,(i,r)=>this._viewChange(i,r)),f(()=>this.viewModel?.view?.ready,(i,r)=>this._viewReadyChange(i??!1,r??!1)),f(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),f(()=>this.viewModel?.screenLocation,()=>this._closeOpenActionMenu()),f(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),f(()=>{let i=this.selectedFeatureWidget?.viewModel;return[i?.title,i?.state]},()=>this._setTitleFromFeatureWidget()),f(()=>{let i=this.selectedFeatureWidget?.viewModel;return[i?.content,i?.state]},()=>this._setContentFromFeatureWidget()),f(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:i})=>this._openRelatedFeature(i))])}loadDependencies(){return ee({action:()=>import("./chunk-B3LYN5YS.js"),"action-bar":()=>import("./chunk-MUY7JD3H.js"),"action-group":()=>import("./chunk-R5ZT4NPG.js"),button:()=>import("./chunk-2NXTUNEG.js"),flow:()=>import("./chunk-NIMWGK3C.js"),"flow-item":()=>import("./chunk-R2TUY7C4.js"),list:()=>import("./chunk-VMNMFMZ2.js"),"list-item":()=>import("./chunk-FAB5FTUK.js"),"list-item-group":()=>import("./chunk-MVA7DCBD.js"),loader:()=>import("./chunk-N5ULBSCQ.js")})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;let e=this.view?.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){let{_feature:e,headingLevel:t,_relatedRecordsFlowItems:i,timeZone:r,spatialReference:o,map:s}=this,{selectedFeatureViewModel:l}=this.viewModel,d={title:!1};return l?(e?(e.viewModel=l,e.visibleElements=d):this._feature=new ko({flowItems:i,headingLevel:t+1,timeZone:r,spatialReference:o,map:s,viewModel:l,visibleElements:d}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){let{active:e}=this.viewModel;e?this._rootFlowItemNode?.blur():N.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){let{active:e}=this.viewModel;e?this._setFocusOn():N.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){this.removeHandles(Do);let t={collapsed:e?.collapsed??!1};this.set(t),this.viewModel.open(e),this.addHandles(Be(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return c("div",{bind:this,class:this.classes(j.base,M.widget,M.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?c("div",{class:j.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:c("div",{class:j.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){let{messages:e,viewModel:t}=this,{featureCount:i,selectedFeatureIndex:r,pendingPromisesCount:o}=t;return c("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:o>0,onclick:this._openFeatureMenu,scale:"s",text:Q(e.pageText,{index:Ie(r+1),total:Ie(i)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){let{previous:e,next:t}=this.messagesCommon.pagination;return c("calcite-action-bar",{class:j.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},c("calcite-action-group",{scale:"s"},c("calcite-action",{appearance:"solid",class:j.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),c("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:t,onclick:this._nextFeature,scale:"s",text:t,title:t})))}_renderFeatureMenuItem(e){let{selectedFeatureViewModel:t,featureViewModels:i}=this.viewModel,r=e===t,o=i.indexOf(e);return c("calcite-list-item",{bind:this,"data-feature-index":o,key:`feature-menu-item-${e.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:r,onCalciteListItemSelect:this._selectFeature},c("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){let{featureViewModels:e}=this.viewModel,t=new Map;return e.forEach(i=>{let r=i?.graphic;if(!r)return;let{layer:o,sourceLayer:s}=r,l=(zo(o)?o:null)||(zo(s)?s:null),d=t.get(l)??[];t.set(l,[...d,i])}),t}_renderFeatureMenu(){let{featureViewModels:e}=this.viewModel,t=this._groupResultsByLayer();return e.length?c("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(t.keys(),i=>{let r=t.get(i)?.map(s=>this._renderFeatureMenuItem(s)),o=i?i.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&o!==null?c("calcite-list-item-group",{heading:o,key:i?.uid||"map-graphics"},r):r})):null}_renderHeaderAction(e,t){let i=e.title||"";return e.visible?c("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${t}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:i,title:i}):null}_renderHeaderActions(){return this.headerActions.map((e,t)=>this._renderHeaderAction(e,t)).toArray()}_renderContentFeature(){let{headingLevel:e,visibleElements:t,_isCollapsed:i,_collapseEnabled:r,featureNavigationTop:o}=this,{title:s,active:l}=this.viewModel,d=t.heading&&s?s:"";return c("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[j.contentFeature]:!0,[j.flowItemCollapsed]:i}),closable:t.closeButton,closed:!l,collapsed:i,collapseDirection:o?"down":"up",collapsible:r,headingLevel:e,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},d?c(Ye,{class:this.classes(j.featuresHeading,M.heading),innerHTML:d,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),i?null:c("div",{class:this.classes(j.container,j.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){let{viewModel:e,featureMenuOpen:t,messages:i,messagesCommon:r}=this,{active:o,featureViewModels:s,pendingPromisesCount:l}=e;return t?c("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!o,description:Q(i.total,{total:s.length}),heading:i.selectFeature,key:"feature-menu",loading:e.waitingForContents,onCalciteFlowItemBack:d=>{d.preventDefault(),this._handleFeatureMenuBack()}},l>0?c("calcite-loader",{class:j.loader,inline:!0,key:"feature-menu-loader",label:r.loading,slot:"header-actions-end"}):null,c("div",{class:j.container},this._renderFeatureMenu()),c("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:j.featureMenuObserver}),c("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},r.back)):null}_renderContentContainer(){let e=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?c("calcite-flow",{key:"content-container"},e):e}_getFallbackIcon(e){let{className:t,icon:i}=e;if(i)return null;let r=Or({action:e,feature:this.selectedFeature}),o={[j.icon]:!!t,[j.actionImage]:!!r};return t&&(o[t]=!0),r||t?c("span",{"aria-hidden":"true",class:this.classes(j.icon,o),key:"icon",styles:$r(r)}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?c("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},c("calcite-action-group",{afterCreate:e=>this._actionBarMenuNode=e,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){let e=this.viewModel?.content;return e?typeof e=="string"?c("div",{class:B.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_setFocusOn(){this.renderNow(),requestAnimationFrame(()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"})}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(e){return y(this,null,function*(){yield e.viewModel.updateGeometry();let t=e.graphic,i=t?.geometry;if(i==null||t==null)return;this._destroyRelatedRecordsFlowItemWidgets(),yield this.viewModel.zoomTo({target:i});let r=ct(i);this.open({features:[t],location:r??void 0})})}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(e){this._rootFlowItemNode=e,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(e){let{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features?.[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){let t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){let{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:o}=e,s=i?.attributes,l=e.title??"",d=o==="zoom-to-feature"?Q(l,{messages:t}):o==="remove-selected-feature"?Q(l,{messages:r}):o==="zoom-to-clustered-features"||o==="browse-clustered-features"?Q(l,{messages:t}):e.title;return d&&s?Q(d,s):d??""}_onMainKeydown(e){let{key:t}=e;t==="ArrowLeft"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){let{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){let{selectedFeatureWidget:e,messagesCommon:t}=this,i=e?.viewModel;e&&(this.viewModel.title=i?.state==="error"?t?.errorMessage:i?.title||"")}_addSelectedFeatureIndexHandle(){let e=f(()=>this.viewModel?.selectedFeatureIndex,(t,i)=>this._selectedFeatureIndexUpdated(t,i));this.addHandles(e,Do)}_selectedFeatureIndexUpdated(e,t){let{featureCount:i}=this.viewModel;i&&e!==t&&e!==-1&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(e){let t=e.currentTarget;if(t.disabled)return;let i=t.dataset.actionUid,r=this.headerActions.find(({uid:o})=>o===i);r&&!r.disabled&&(r?.type==="toggle"&&(r.value=!r.value),this.emit("trigger-header-action",{action:r}))}_triggerAction(e){let t=e.currentTarget;if(t.disabled)return;let i=t.dataset.actionUid,{allActions:r}=this.viewModel,o=r.findIndex(l=>l.uid===i),s=r.at(o);s&&s.type==="toggle"&&(s.value=!s.value),this.viewModel.triggerAction(o)}_createSpinner(e){e&&(this._spinner=new Ro({view:e}),e.ui.add(this._spinner,{key:qo,position:"manual",internal:!0}))}_wireUpView(e){this._destroySpinner(),e&&this.visibleElements?.spinner&&this._createSpinner(e)}_hideSpinner(){let{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,t){e?this._wireUpView(this.viewModel?.view):t&&this.viewModel.clear()}_viewChange(e,t){e&&t&&this.viewModel.clear()}_destroySelectedFeatureWidget(){let{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_closeOpenActionMenu(){let{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.drain(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_toggleScreenLocationEnabled(){let{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){let{_spinner:e}=this;if(!e)return;let{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_destroySpinner(){let{_spinner:e,view:t}=this;e&&(t?.ui?.remove(e,qo),e.destroy(),this._spinner=null)}_spinnerEnabledChange(e){this._destroySpinner(),e&&this._createSpinner(this.viewModel?.view)}};n([a()],T.prototype,"_focusOn",void 0),n([a()],T.prototype,"_relatedRecordsFlowItems",void 0),n([a()],T.prototype,"_hideActionText",null),n([a()],T.prototype,"_featureNavigationVisible",null),n([a()],T.prototype,"_isCollapsed",null),n([a()],T.prototype,"_collapseEnabled",null),n([a({readOnly:!0})],T.prototype,"active",null),n([a()],T.prototype,"collapsed",void 0),n([a()],T.prototype,"content",null),n([a()],T.prototype,"icon",null),n([a()],T.prototype,"featureMenuOpen",null),n([a()],T.prototype,"featureNavigationTop",void 0),n([a()],T.prototype,"features",null),n([a()],T.prototype,"goToOverride",null),n([a({type:xe})],T.prototype,"headerActions",void 0),n([a()],T.prototype,"headingLevel",void 0),n([a()],T.prototype,"location",null),n([a()],T.prototype,"label",null),n([a()],T.prototype,"map",null),n([a(),q("esri/widgets/Features/t9n/Features")],T.prototype,"messages",void 0),n([a(),q("esri/t9n/common")],T.prototype,"messagesCommon",void 0),n([a()],T.prototype,"promises",null),n([a()],T.prototype,"responsiveActionsEnabled",void 0),n([a({readOnly:!0})],T.prototype,"selectedFeature",null),n([a()],T.prototype,"selectedFeatureIndex",null),n([a({readOnly:!0})],T.prototype,"selectedFeatureWidget",null),n([a()],T.prototype,"spatialReference",null),n([a()],T.prototype,"title",null),n([a()],T.prototype,"timeZone",null),n([a()],T.prototype,"updateLocationEnabled",null),n([a()],T.prototype,"view",null),n([a({type:_t}),Vt(["triggerAction","trigger-action"])],T.prototype,"viewModel",void 0),n([a({type:Ui,nonNullable:!0})],T.prototype,"visibleElements",void 0),n([a()],T.prototype,"visible",null),T=n([w("esri.widgets.Features")],T);var Ho=T;var oe="esri-popup",Ge=`${oe}--is-docked`,D={base:oe,baseHidden:`${oe}--hidden`,main:`${oe}__main-container`,shadow:`${oe}--shadow`,isDocked:Ge,isDockedTopLeft:`${Ge}-top-left`,isDockedTopCenter:`${Ge}-top-center`,isDockedTopRight:`${Ge}-top-right`,isDockedBottomLeft:`${Ge}-bottom-left`,isDockedBottomCenter:`${Ge}-bottom-center`,isDockedBottomRight:`${Ge}-bottom-right`,alignTopCenter:`${oe}--aligned-top-center`,alignBottomCenter:`${oe}--aligned-bottom-center`,alignTopLeft:`${oe}--aligned-top-left`,alignBottomLeft:`${oe}--aligned-bottom-left`,alignTopRight:`${oe}--aligned-top-right`,alignBottomRight:`${oe}--aligned-bottom-right`,pointer:`${oe}__pointer`,pointerDirection:`${oe}__pointer-direction`};var Zi=class extends _t{constructor(e){super(e)}};Zi=n([w("esri.widgets.Popup.PopupViewModel")],Zi);var Gi=Zi;var Me=class extends U{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};n([a({type:Boolean,nonNullable:!0})],Me.prototype,"actionBar",void 0),n([a({type:Boolean,nonNullable:!0})],Me.prototype,"closeButton",void 0),n([a({type:Boolean,nonNullable:!0})],Me.prototype,"collapseButton",void 0),n([a({type:Boolean,nonNullable:!0})],Me.prototype,"featureNavigation",void 0),n([a({type:Boolean,nonNullable:!0})],Me.prototype,"featureListLayerTitle",void 0),n([a({type:Boolean,nonNullable:!0})],Me.prototype,"heading",void 0),n([a({type:Boolean,nonNullable:!0})],Me.prototype,"spinner",void 0),Me=n([w("esri.widgets.Popup.PopupVisibleElements")],Me);var ai=Me;var Wo={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},L=class extends V{constructor(e,t){super(e,t),this._dockAction=new De({id:"popup-dock-action"}),this._featuresWidget=new Ho({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new Gi,this.visibleElements=new ai}initialize(){this.addHandles([f(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),C),f(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),C),f(()=>this.dockOptions,e=>{let{_dockAction:t}=this,i=this._featuresWidget.headerActions;i.remove(t),e.buttonEnabled&&i.add(t)},C),f(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),f(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),f(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),f(()=>this.viewModel?.view?.size,(e,t)=>this._updateDockEnabledForViewSize(e,t)),f(()=>this.viewModel?.view,(e,t)=>this._viewChange(e,t)),f(()=>this.viewModel?.view?.ready,(e,t)=>this._viewReadyChange(e??!1,t??!1)),f(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,C),f(()=>this._featureNavigationTop,e=>this._featuresWidget.featureNavigationTop=e,C),f(()=>this.headingLevel,e=>this._featuresWidget.headingLevel=e,C),f(()=>this.visibleElements.actionBar,e=>this._featuresWidget.visibleElements.actionBar=!!e,C),f(()=>this.visibleElements.closeButton,e=>this._featuresWidget.visibleElements.closeButton=!!e,C),f(()=>this.visibleElements.collapseButton,e=>this._featuresWidget.visibleElements.collapseButton=!!e,C),f(()=>this.visibleElements.heading,e=>this._featuresWidget.visibleElements.heading=!!e,C),f(()=>this.visibleElements.spinner,e=>this._featuresWidget.visibleElements.spinner=!!e,C),f(()=>this.visibleElements.featureNavigation,e=>this._featuresWidget.visibleElements.featureNavigation=!!e,C),f(()=>this.visibleElements.featureListLayerTitle,e=>this._featuresWidget.visibleElements.featureListLayerTitle=!!e,C),ne(()=>this._featuresWidget,"trigger-header-action",e=>{e.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(e){let t=b({},e);return e?.visibleElements!=null&&(t.visibleElements=new ai(e.visibleElements),e.collapseEnabled!=null&&(t.visibleElements.collapseButton=e.collapseEnabled),e.spinnerEnabled!=null&&(t.visibleElements.spinner=e.spinnerEnabled)),t}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){let{currentAlignment:e,currentDockPosition:t}=this;return e==="bottom-left"||e==="bottom-center"||e==="bottom-right"||t==="top-left"||t==="top-center"||t==="top-right"}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get collapsed(){return this._featuresWidget.collapsed}set collapsed(e){this._featuresWidget.collapsed=e}get collapseEnabled(){return nt(N.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(e){nt(N.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Wo}set dockOptions(e){let t=b({},Wo),i=this.viewModel?.view?.breakpoints,r={};i&&(r.width=i.xsmall,r.height=i.xsmall);let o=b(b({},t),e),s=b(b({},t.breakpoint),r),{breakpoint:l}=o;typeof l=="object"?o.breakpoint=b(b({},s),l):l&&(o.breakpoint=s),this._set("dockOptions",o),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get icon(){return"popup"}set icon(e){this._overrideIfSome("icon",e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return nt(N.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(e){nt(N.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){let{active:e}=this.viewModel;e||N.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){let{active:e}=this.viewModel;e||N.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame(()=>{this._featuresWidget.focus()})}next(){return this.viewModel.next()}open(e){let t=!!e&&!!e.featureMenuOpen,i={collapsed:!!e&&!!e.collapsed,featureMenuOpen:t};this.set(i),this.viewModel.open(e),this._shouldFocus(e)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){let{dockEnabled:e,currentAlignment:t,currentDockPosition:i}=this,{active:r,screenLocation:o}=this.viewModel,s=r&&e,l=r&&!e,d=this.selectedFeature?.layer?.title,u=this.selectedFeature?.layer?.id,p={[D.alignTopCenter]:t==="top-center",[D.alignBottomCenter]:t==="bottom-center",[D.alignTopLeft]:t==="top-left",[D.alignBottomLeft]:t==="bottom-left",[D.alignTopRight]:t==="top-right",[D.alignBottomRight]:t==="bottom-right",[D.isDocked]:s,[D.shadow]:l,[D.isDockedTopLeft]:i==="top-left",[D.isDockedTopCenter]:i==="top-center",[D.isDockedTopRight]:i==="top-right",[D.isDockedBottomLeft]:i==="bottom-left",[D.isDockedBottomCenter]:i==="bottom-center",[D.isDockedBottomRight]:i==="bottom-right"};return c("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(D.base,p,{[D.baseHidden]:!o&&!e}),"data-layer-id":u,"data-layer-title":d,role:"presentation"},r?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:c("div",{class:D.pointer,key:"popup-pointer",role:"presentation"},c("div",{class:this.classes(D.pointerDirection,D.shadow)}))}_renderMainContainer(){let{dockEnabled:e}=this,t={[D.shadow]:e};return c("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(D.main,M.widget,t)},this._featuresWidget.render())}_shouldFocus(e){return y(this,null,function*(){e?.shouldFocus&&(yield rr(()=>this.viewModel?.active===!0),this.focus())})}_isOutsideView(e){let{popupHeight:t,popupWidth:i,screenLocation:r,side:o,view:s}=e;if(isNaN(i)||isNaN(t)||!s||!r)return!1;let l=s.padding;return o==="right"&&r.x+i/2>s.width-l.right||o==="left"&&r.x-i/2<l.left||o==="top"&&r.y-t<l.top||o==="bottom"&&r.y+t>s.height-l.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;let{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:o}=this,{screenLocation:s,view:l}=o;if(s==null||!l||!i)return"top-center";function d(I){return parseInt(I.replaceAll(/[^-\d.]/g,""),10)}let u=r?window.getComputedStyle(r,null):null,p=u?d(u.getPropertyValue("max-height")):0,h=u?d(u.getPropertyValue("height")):0,{height:m,width:v}=i.getBoundingClientRect(),g=v+t,_=Math.max(m,p,h)+t,E=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:s,side:"right",view:l}),k=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:s,side:"left",view:l}),x=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:s,side:"top",view:l}),P=this._isOutsideView({popupHeight:_,popupWidth:g,screenLocation:s,side:"bottom",view:l});return k?x?"bottom-right":"top-right":E?x?"bottom-left":"top-left":x?P?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){let{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){let t=["left","right"];return le(this.container)&&t.reverse(),e?.replace(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(e){if(e!=="auto")return e;let t=this.viewModel?.view,i=le(this.container)?"top-left":"top-right";if(!t)return i;let r=t.padding||{left:0,right:0,top:0,bottom:0},o=t.width-r.left-r.right,{breakpoints:s}=t;return s&&o<=s.xsmall?"bottom-center":i}_getDockIcon(){let e=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(e){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(e){this._mainContainerNode=e}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;let{screenLocation:t}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&Object.assign(this._containerNode.style,r)}_calculateFullWidth(e){let{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){let{currentAlignment:o,_pointerOffsetInPx:s}=this;if(!i)return;let{padding:l}=i,d=r/2,u=i.height-t,p=i.width-e;return o==="bottom-center"?{top:t+s-l.top,left:e-d-l.left}:o==="top-left"?{bottom:u+s-l.bottom,right:p+s-l.right}:o==="bottom-left"?{top:t+s-l.top,right:p+s-l.right}:o==="top-right"?{bottom:u+s-l.bottom,left:e+s-l.left}:o==="bottom-right"?{top:t+s-l.top,left:e+s-l.left}:o==="top-center"?{bottom:u+s-l.bottom,left:e-d-l.left}:void 0}_calculatePositionStyle(e,t){let{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(e==null||!t)return;let o=this._calculateFullWidth(t),s=this._calculateAlignmentPosition(e.x,e.y,r,o);return s?{top:s.top!==void 0?`${s.top}px`:"auto",left:s.left!==void 0?`${s.left}px`:"auto",bottom:s.bottom!==void 0?`${s.bottom}px`:"auto",right:s.right!==void 0?`${s.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){e?this._wireUpView():t&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){let[r,o]=e,[s,l]=t,{width:d=0,height:u=0}=i??{};return r<=d&&s>d||r>d&&s<=d||o<=u&&l>u||o>u&&l<=u}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;let i=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,o=i.top+i.bottom,s=[],l=[];s[0]=e[0]-r,s[1]=e[1]-o,l[0]=t[0]-r,l[1]=t[1]-o;let{dockOptions:d}=this,u=d.breakpoint;this._dockingThresholdCrossed(s,l,u)&&this._setDockEnabledForViewSize(d),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){let{dockEnabled:e,viewModel:t}=this;if(!t)return;let i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){let t=e.breakpoint,i=this.viewModel?.view?.ui;if(!i)return!1;let{width:r,height:o}=i;if(isNaN(r)||isNaN(o)||!t)return!1;let s=t.hasOwnProperty("width")&&r<=(t.width??0),l=t.hasOwnProperty("height")&&o<=(t.height??0);return s||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}};n([a({readOnly:!0})],L.prototype,"_featureNavigationTop",null),n([a()],L.prototype,"actions",null),n([a({readOnly:!0})],L.prototype,"active",null),n([a()],L.prototype,"alignment",void 0),n([a()],L.prototype,"autoCloseEnabled",null),n([a()],L.prototype,"defaultPopupTemplateEnabled",null),n([a()],L.prototype,"content",null),n([a()],L.prototype,"collapsed",null),n([a()],L.prototype,"collapseEnabled",null),n([a({readOnly:!0})],L.prototype,"currentAlignment",null),n([a({readOnly:!0})],L.prototype,"currentDockPosition",null),n([a()],L.prototype,"dockOptions",null),n([a()],L.prototype,"dockEnabled",void 0),n([a({readOnly:!0})],L.prototype,"featureCount",null),n([a()],L.prototype,"featureMenuOpen",null),n([a()],L.prototype,"features",null),n([a()],L.prototype,"goToOverride",null),n([a()],L.prototype,"headingLevel",void 0),n([a()],L.prototype,"highlightEnabled",null),n([a()],L.prototype,"icon",null),n([a()],L.prototype,"location",null),n([a()],L.prototype,"label",null),n([a(),q("esri/widgets/Popup/t9n/Popup")],L.prototype,"messages",void 0),n([a()],L.prototype,"promises",null),n([a({readOnly:!0})],L.prototype,"selectedFeature",null),n([a()],L.prototype,"selectedFeatureIndex",null),n([a({readOnly:!0})],L.prototype,"selectedFeatureWidget",null),n([a()],L.prototype,"spinnerEnabled",null),n([a()],L.prototype,"title",null),n([a()],L.prototype,"updateLocationEnabled",null),n([a()],L.prototype,"view",null),n([a({type:Gi}),Vt(["triggerAction","trigger-action"])],L.prototype,"viewModel",void 0),n([a()],L.prototype,"visible",null),n([a({type:ai,nonNullable:!0})],L.prototype,"visibleElements",void 0),L=n([w("esri.widgets.Popup")],L);var Nv=L;export{Nv as default};
