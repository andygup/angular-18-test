import{f as It}from"./chunk-BNUHB4AP.js";import{t as Tt}from"./chunk-UHTPPTOJ.js";import{o as Pt}from"./chunk-3SBMUUA6.js";import{a as Ut}from"./chunk-X7Z55FTO.js";import{a as vt}from"./chunk-B66V4PSA.js";import{H as X,S as bt}from"./chunk-RMOOROEO.js";import{S as At}from"./chunk-ZP7G4HN4.js";import{a as q}from"./chunk-W3WDPWBE.js";import{h as kt}from"./chunk-43GG6PFR.js";import{b as yt,s as H,u as Mt}from"./chunk-3DV77WOO.js";import{a as Z,b as pt}from"./chunk-NJG4JJ4L.js";import{g as at}from"./chunk-3T7TAUC2.js";var rt=class{constructor(e=null,n=null,l=null){this.minValue=e,this.maxValue=n,this.noDataValue=l}};var Xt=9999999e31,Kt=2e-7,$t={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function it(t){return $t[t]??[-34028234663852886e22,34028234663852886e22]}function we(t,e){return t==null||e==null?"s32":t<0?t>=-128&&e<128?"s8":t>=-32768&&e<32768?"s16":"s32":e<256?"u8":e<65536?"u16":"u32"}function ye(t){return(t?.startsWith("s")||t?.startsWith("u"))??!1}function Me(t,e,n){if(t.depthCount&&t.depthCount>1)return;let{pixels:l,statistics:a,pixelType:i}=t,o=l[0].length,c=t.bandMasks??[],h=t.mask??new Uint8Array(o).fill(255),r=i==="f32"||i==="f64",s=it(i),f=!1;for(let p=0;p<l.length;p++){let u=typeof e=="number"?e:e[p];if(u==null)continue;let m=a?.[p]?.minValue??s[0],d=a?.[p]?.maxValue??s[1];if(m>u+Number.EPSILON||d<u-Number.EPSILON)continue;let g=c[p]||h.slice(),y=l[p],k=n?.customFloatTolerance;if(r&&k!==0){let w=k;w||(w=Math.abs(u)>=Xt?Kt*Math.abs(u):i==="f32"?2**-23:Number.EPSILON);for(let M=0;M<y.length;M++)g[M]&&Math.abs(y[M]-u)<w&&(y[M]=0,g[M]=0,h[M]=0,f=!0)}else for(let w=0;w<y.length;w++)g[w]&&y[w]===u&&(y[w]=0,g[w]=0,h[w]=0,f=!0);c[p]=g}f&&(t.bandMasks=t.bandMasks||t.pixels.length>1?c:null,t.mask=h),f&&"updateStatistics"in t&&t.updateStatistics()}var Q,G=Q=class extends bt{static createEmptyBand(t,e){return new(Q.getPixelArrayConstructor(t))(e)}static combineBandMasks(t){if(t.length<2)return t[0];let e=t[0].length,n=new Uint8Array(e).fill(255);for(let l=0;l<t.length;l++){let a=t[l];for(let i=0;i<e;i++)a[i]||(n[i]=0)}return n}static getPixelArrayConstructor(t){let e;switch(t){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":e=Float32Array;break;case"f64":e=Float64Array}return e}constructor(t){super(t),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(t){if(!t)return"f32";let e=t.toLowerCase();return["u1","u2","u4"].includes(e)?e="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(e)||(e="f32"),e}getPlaneCount(){return this.pixels?.length}addData(t){if(!t.pixels||t.pixels.length!==this.width*this.height)throw new Mt("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(t.pixels),this.statistics.push(t.statistics??new rt)}getAsRGBA(){let t=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(t);break;default:this._fillFrom8Bit(t)}return new Uint8ClampedArray(t)}getAsRGBAFloat(){let t=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(t),t}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map(n=>Ht(n,this.mask));let t=this.mask,e=0;if(t!=null)for(let n=0;n<t.length;n++)t[n]&&e++;else e=this.width*this.height;this.validPixelCount=e}clamp(t){if(!t||t==="f64"||t==="f32"||!this.pixels)return;let[e,n]=it(t),l=this.pixels,a=this.width*this.height,i=l.length,o,c,h,r=[];for(let s=0;s<i;s++){h=Q.createEmptyBand(t,a),o=l[s];for(let f=0;f<a;f++)c=o[f],h[f]=c>n?n:c<e?e:c;r.push(h)}this.pixels=r,this.pixelType=t}extractBands(t){let{pixels:e,statistics:n}=this;if(t==null||t.length===0||!e||e.length===0)return this;let l=e.length,a=t.some(f=>f>=e.length),i=l===t.length&&!t.some((f,p)=>f!==p);if(a||i)return this;let o=this.bandMasks?.length===l?t.map(f=>this.bandMasks[f]):void 0,{mask:c,validPixelCount:h}=this,{width:r,height:s}=this;return o?.length&&(c=Q.combineBandMasks(o),h=c.filter(f=>!!f).length),new Q({pixelType:this.pixelType,width:r,height:s,mask:c,bandMasks:o,validPixelCount:h,maskIsAlpha:this.maskIsAlpha,pixels:t.map(f=>e[f]),statistics:n&&t.map(f=>n[f])})}clone(){let t=new Q({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount}),e;this.mask!=null&&(t.mask=new Uint8Array(this.mask)),this.bandMasks&&(t.bandMasks=this.bandMasks.map(l=>new Uint8Array(l)));let n=Q.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){t.pixels=[];let l=!!this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)t.pixels[e]=l?this.pixels[e].slice(0,this.pixels[e].length):new n(this.pixels[e])}if(this.statistics)for(t.statistics=[],e=0;e<this.statistics.length;e++)t.statistics[e]=yt(this.statistics[e]);return t.premultiplyAlpha=this.premultiplyAlpha,t}_fillFrom8Bit(t){let{mask:e,maskIsAlpha:n,premultiplyAlpha:l,pixels:a}=this;if(!t||!a?.length)return void H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let i,o,c,h;i=o=c=a[0],a.length>=3?(o=a[1],c=a[2]):a.length===2&&(o=a[1]);let r=new Uint32Array(t),s=this.width*this.height;if(i.length===s)if(e!=null&&e.length===s)if(n)for(h=0;h<s;h++){let f=e[h];if(f){let p=f/255;r[h]=l?f<<24|c[h]*p<<16|o[h]*p<<8|i[h]*p:f<<24|c[h]<<16|o[h]<<8|i[h]}}else for(h=0;h<s;h++)e[h]&&(r[h]=255<<24|c[h]<<16|o[h]<<8|i[h]);else for(h=0;h<s;h++)r[h]=255<<24|c[h]<<16|o[h]<<8|i[h];else H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(t){let{pixels:e,mask:n,statistics:l}=this;if(!t||!e?.length)return void H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let a=this.pixelType,i=1,o=0,c=1;if(l&&l.length>0){for(let d of l)if(d.minValue!=null&&(o=Math.min(o,d.minValue)),d.maxValue!=null&&d.minValue!=null){let g=d.maxValue-d.minValue;c=Math.max(c,g)}i=255/c}else{let d=255;a==="s8"?(o=-128,d=127):a==="u16"?d=65535:a==="s16"?(o=-32768,d=32767):a==="u32"?d=4294967295:a==="s32"?(o=-2147483648,d=2147483647):a==="f32"?(o=-34e38,d=34e38):a==="f64"&&(o=-Number.MAX_VALUE,d=Number.MAX_VALUE),i=255/(d-o)}let h=new Uint32Array(t),r=this.width*this.height,s,f,p,u,m;if(s=f=p=e[0],s.length!==r)return H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(e.length>=2)if(f=e[1],e.length>=3&&(p=e[2]),n!=null&&n.length===r)for(u=0;u<r;u++)n[u]&&(h[u]=255<<24|(p[u]-o)*i<<16|(f[u]-o)*i<<8|(s[u]-o)*i);else for(u=0;u<r;u++)h[u]=255<<24|(p[u]-o)*i<<16|(f[u]-o)*i<<8|(s[u]-o)*i;else if(n!=null&&n.length===r)for(u=0;u<r;u++)m=(s[u]-o)*i,n[u]&&(h[u]=255<<24|m<<16|m<<8|m);else for(u=0;u<r;u++)m=(s[u]-o)*i,h[u]=255<<24|m<<16|m<<8|m}_fillFrom32Bit(t){let{pixels:e,mask:n}=this;if(!t||!e?.length)return H.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let l,a,i,o;l=a=i=e[0],e.length>=3?(a=e[1],i=e[2]):e.length===2&&(a=e[1]);let c=this.width*this.height;if(l.length!==c)return H.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let h=0;if(n!=null&&n.length===c)for(o=0;o<c;o++)t[h++]=l[o],t[h++]=a[o],t[h++]=i[o],t[h++]=1&n[o];else for(o=0;o<c;o++)t[h++]=l[o],t[h++]=a[o],t[h++]=i[o],t[h++]=1}};function Ht(t,e){let n=1/0,l=-1/0,a=t.length,i,o=0;if(e!=null)for(i=0;i<a;i++)e[i]&&(o=t[i],n=o<n?o:n,l=o>l?o:l);else for(i=0;i<a;i++)o=t[i],n=o<n?o:n,l=o>l?o:l;return new rt(n,l)}q([X({json:{write:!0}})],G.prototype,"width",void 0),q([X({json:{write:!0}})],G.prototype,"height",void 0),q([X({json:{write:!0}})],G.prototype,"pixelType",void 0),q([Ut("pixelType")],G.prototype,"castPixelType",null),q([X({json:{write:!0}})],G.prototype,"validPixelCount",void 0),q([X({json:{write:!0}})],G.prototype,"mask",void 0),q([X({json:{write:!0}})],G.prototype,"maskIsAlpha",void 0),q([X({json:{write:!0}})],G.prototype,"pixels",void 0),q([X()],G.prototype,"premultiplyAlpha",void 0),q([X({json:{write:!0}})],G.prototype,"statistics",void 0),q([X({json:{write:!0}})],G.prototype,"depthCount",void 0),q([X({json:{write:!0}})],G.prototype,"noDataValues",void 0),q([X({json:{write:!0}})],G.prototype,"bandMasks",void 0),G=Q=q([At("esri.layers.support.PixelBlock")],G);var _=G;var Bt,St;(function(t){t[t.matchAny=0]="matchAny",t[t.matchAll=1]="matchAll"})(Bt||(Bt={})),function(t){t[t.bestMatch=0]="bestMatch",t[t.fail=1]="fail"}(St||(St={}));var Le=6;function L(t){return t!=null&&t.declaredClass==="esri.layers.support.PixelBlock"&&t.pixels&&t.pixels.length>0}function Re(t){if(!t?.length||t.some(s=>!L(s)))return null;if(t.length===1)return t[0]?.clone()??null;let e=t,{width:n,height:l,pixelType:a}=e[0];if(e.some(s=>s.width!==n||s.height!==l))return null;let i=e.map(({mask:s})=>s).filter(s=>s!=null),o=null;i.length&&(o=new Uint8Array(n*l),o.set(i[0]),i.length>1&&_t(i.slice(1),o));let c=[];e.forEach(({pixels:s})=>c.push(...s));let h=e.map(({statistics:s})=>s).filter(s=>s?.length),r=[];return h.forEach(s=>r.push(...s)),new _({pixelType:a,width:n,height:l,mask:o,pixels:c,statistics:r.length?r:null})}function Ne(t){if(!t)return;let e=t.colormap;if(!e||e.length===0)return;let n=e.sort((f,p)=>f[0]-p[0]),l=0;n[0][0]<0&&(l=n[0][0]);let a=Math.max(256,n[n.length-1][0]-l+1),i=new Uint8Array(4*a),o=[],c,h=0,r=0,s=n[0].length===5;if(a>65536)return n.forEach(f=>{o[f[0]-l]=s?f.slice(1):f.slice(1).concat([255])}),{indexed2DColormap:o,offset:l,alphaSpecified:s};if(t.fillUnspecified)for(c=n[r],h=c[0]-l;h<a;h++)i[4*h]=c[1],i[4*h+1]=c[2],i[4*h+2]=c[3],i[4*h+3]=s?c[4]:255,h===c[0]-l&&(c=r===n.length-1?c:n[++r]);else for(h=0;h<n.length;h++)c=n[h],r=4*(c[0]-l),i[r]=c[1],i[r+1]=c[2],i[r+2]=c[3],i[r+3]=s?c[4]:255;return{indexedColormap:i,offset:l,alphaSpecified:s}}function Ee(t,e){if(!L(t)||!e||!e.indexedColormap&&!e.indexed2DColormap)return t;let n=t.clone(),l=n.pixels,a=n.mask,i=n.width*n.height;if(l.length!==1)return t;let{indexedColormap:o,indexed2DColormap:c,offset:h,alphaSpecified:r}=e,s=0,f=l[0],p=new Uint8Array(f.length),u=new Uint8Array(f.length),m=new Uint8Array(f.length),d,g=0;if(o){let y=o.length-1;if(a!=null)for(s=0;s<i;s++)a[s]&&(g=4*(f[s]-h),g<h||g>y?a[s]=0:(p[s]=o[g],u[s]=o[g+1],m[s]=o[g+2],a[s]=o[g+3]));else{for(a=new Uint8Array(i),s=0;s<i;s++)g=4*(f[s]-h),g<h||g>y?a[s]=0:(p[s]=o[g],u[s]=o[g+1],m[s]=o[g+2],a[s]=o[g+3]);n.mask=a}}else if(c)if(a!=null)for(s=0;s<i;s++)a[s]&&(d=c[f[s]],p[s]=d[0],u[s]=d[1],m[s]=d[2],a[s]=d[3]);else{for(a=new Uint8Array(i),s=0;s<i;s++)d=c[f[s]],p[s]=d[0],u[s]=d[1],m[s]=d[2],a[s]=d[3];n.mask=a}return n.pixels=[p,u,m],n.statistics=null,n.pixelType="u8",n.maskIsAlpha=r,n}function Oe(t,e){if(!L(t))return null;let{pixels:n,mask:l}=t,a=n.length,i=e.lut,{offset:o}=e;i&&i[0].length===1&&(i=n.map(()=>i));let c=[],h=e.outputPixelType||"u8";for(let s=0;s<a;s++){let f=Dt(n[s],l,i[s],o||0,h);c.push(f)}let r=new _({width:t.width,height:t.height,pixels:c,mask:l,pixelType:h});return r.updateStatistics(),r}function Dt(t,e,n,l,a){let i=t.length,o=_.createEmptyBand(a,i);if(e)for(let c=0;c<i;c++)e[c]&&(o[c]=n[t[c]-l]);else for(let c=0;c<i;c++)o[c]=n[t[c]-l];return o}function je(t,e){if(!L(t))return null;let n=t.clone(),{pixels:l}=n,a=n.width*n.height,i=e.length,o=Math.floor(i/2),c=e[Math.floor(o)],h=l[0],r,s,f,p,u,m,d=!1,g=new Uint8Array(a),y=new Uint8Array(a),k=new Uint8Array(a),w=n.mask,M=e[0].mappedColor.length===4;for(w||(w=new Uint8Array(a),w.fill(M?255:1),n.mask=w),u=0;u<a;u++)if(w[u]){for(r=h[u],d=!1,m=o,s=c,f=0,p=i-1;p-f>1;){if(r===s.value){d=!0;break}r>s.value?f=m:p=m,m=Math.floor((f+p)/2),s=e[Math.floor(m)]}d||(r===e[f].value?(s=e[f],d=!0):r===e[p].value?(s=e[p],d=!0):r<e[f].value?(d=!1,s=null):r>e[f].value&&(r<e[p].value?(s=e[f],d=!0):p===i-1?(d=!1,s=null):(s=e[p],d=!0))),d?(g[u]=s.mappedColor[0],y[u]=s.mappedColor[1],k[u]=s.mappedColor[2],w[u]=s.mappedColor[3]):g[u]=y[u]=k[u]=w[u]=0}return n.pixels=[g,y,k],n.mask=w,n.pixelType="u8",n.maskIsAlpha=M,n}function Ge(t,e){if(!L(t))return null;let{width:n,height:l}=t,{inputRanges:a,outputValues:i,outputPixelType:o,noDataRanges:c,allowUnmatched:h,isLastInputRangeInclusive:r}=e,s=t.pixels[0],f=_.createEmptyBand(o,s.length),p=t.mask,u=new Uint8Array(n*l);p?u.set(p):u.fill(255);let m=t.pixelType.startsWith("f")?1e-6:0,d=a.map(M=>M-m);d[0]=a[0],d[d.length-1]=a[a.length-1]+(r?1e-6:0);let g=a.length/2,[y,k]=it(o);for(let M=0;M<l;M++)for(let x=0;x<n;x++){let A=M*n+x;if(u[A]){let b=s[A],v=!1;for(let T=g-1;T>=0;T--)if(b===d[2*T]||b>d[2*T]&&b<d[2*T+1]){f[A]=i[T],v=!0;break}v||(h?f[A]=b>k?k:b<y?y:b:u[A]=0)}}let w=c?.length;if(w)for(let M=0;M<l;M++)for(let x=0;x<n;x++){let A=M*n+x;if(!p||p[A]){let b=s[A];for(let v=0;v<w;v+=2)if(b>=c[v]&&b<=c[v+1]){f[A]=0,u[A]=0;break}}}return new _({width:n,height:l,pixelType:o,pixels:[f],mask:u})}function Vt(t,e,n,l){let a=n!=null&&n.length>=2?new Set(n):null,i=n?.length===1?n[0]:null,o=!!e?.length;for(let c=0;c<t.length;c++)if(l[c]){let h=t[c];if(o){let r=!1;for(let s=0;s<e.length;s+=2)if(h>=e[s]&&h<=e[s+1]){r=!0;break}r||(l[c]=0)}l[c]&&(h===i||a?.has(h))&&(l[c]=0)}}function Ft(t,e){let n=t[0].length;for(let l=0;l<n;l++)if(e[l]){let a=!1;for(let i=0;i<t.length;i++)if(t[i][l]){a=!0;break}a||(e[l]=0)}}function _t(t,e){let n=t[0].length;for(let l=0;l<n;l++)if(e[l]){let a=!1;for(let i=0;i<t.length;i++)if(t[i][l]===0){a=!0;break}a&&(e[l]=0)}}function We(t,e){if(!L(t))return null;let{width:n,height:l,pixels:a}=t,i=n*l,o=new Uint8Array(i);t.mask?o.set(t.mask):o.fill(255);let c=a.length,{includedRanges:h,noDataValues:r,outputPixelType:s,matchAll:f,lookups:p}=e;if(p){let u=[];for(let m=0;m<c;m++){let d=p[m],g=Dt(a[m],o,d.lut,d.offset||0,"u8");u.push(g)}u.length===1?o.set(u[0]):f?Ft(u,o):_t(u,o)}else if(f){let u=[];for(let m=0;m<c;m++){let d=new Uint8Array(i);d.set(o),Vt(a[m],h?.slice(2*m,2*m+2),r?.[m],d),u.push(d)}u.length===1?o.set(u[0]):Ft(u,o)}else for(let u=0;u<c;u++)Vt(a[u],h?.slice(2*u,2*u+2),r?.[u],o);return new _({width:n,height:l,pixelType:s,pixels:a,mask:o})}function qe(t){let{srcPixelType:e,inputRanges:n,outputValues:l,allowUnmatched:a,noDataRanges:i,isLastInputRangeInclusive:o,outputPixelType:c}=t;if(e!=="u8"&&e!=="s8"&&e!=="u16"&&e!=="s16")return null;let h=e.includes("16")?65536:256,r=e.includes("s")?-h/2:0,s=_.createEmptyBand(c,h),f=new Uint8Array(h);a&&f.fill(255);let[p,u]=it(c);if(n?.length&&l?.length){let d=n.map(g=>g-1e-6);d[0]=n[0],o&&(d[d.length-1]=n[n.length-1]);for(let g=0;g<d.length;g++){let y=l[g]>u?u:l[g]<p?p:l[g],k=Math.ceil(d[2*g]-r),w=Math.floor(d[2*g+1]-r);for(let M=k;M<=w;M++)s[M]=y,f[M]=255}}if(i?.length)for(let m=0;m<i.length;m++){let d=Math.ceil(i[2*m]-r),g=Math.floor(i[2*m+1]-r);for(let y=d;y<=g;y++)f[y]=0}return{lut:s,offset:r,mask:f}}function ze(t,e,n){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;let l=t.includes("16")?65536:256,a=t.includes("s")?-l/2:0,i=new Uint8Array(l);if(e)for(let o=0;o<e.length;o++){let c=Math.ceil(e[2*o]-a),h=Math.floor(e[2*o+1]-a);for(let r=c;r<=h;r++)i[r]=255}else i.fill(255);if(n)for(let o=0;o<n.length;o++)i[n[o]-a]=0;return{lut:i,offset:a}}function Qt(t,e,n,l,a,i,o,c){return{xmin:a<=n*t?0:a<n*t+t?a-n*t:t,ymin:i<=l*e?0:i<l*e+e?i-l*e:e,xmax:a+o<=n*t?0:a+o<n*t+t?a+o-n*t:t,ymax:i+c<=l*e?0:i+c<l*e+e?i+c-l*e:e}}function Je(t,e){if(!t||t.length===0)return null;let n=t.find(m=>m.pixelBlock);if(n?.pixelBlock==null)return null;let l=(n.extent.xmax-n.extent.xmin)/n.pixelBlock.width,a=(n.extent.ymax-n.extent.ymin)/n.pixelBlock.height,i=.01*Math.min(l,a),o=t.sort((m,d)=>Math.abs(m.extent.ymax-d.extent.ymax)>i?d.extent.ymax-m.extent.ymax:Math.abs(m.extent.xmin-d.extent.xmin)>i?m.extent.xmin-d.extent.xmin:0),c=Math.min.apply(null,o.map(m=>m.extent.xmin)),h=Math.min.apply(null,o.map(m=>m.extent.ymin)),r=Math.max.apply(null,o.map(m=>m.extent.xmax)),s=Math.max.apply(null,o.map(m=>m.extent.ymax)),f={x:Math.round((e.xmin-c)/l),y:Math.round((s-e.ymax)/a)},p={width:Math.round((r-c)/l),height:Math.round((s-h)/a)},u={width:Math.round((e.xmax-e.xmin)/l),height:Math.round((e.ymax-e.ymin)/a)};return Math.round(p.width/n.pixelBlock.width)*Math.round(p.height/n.pixelBlock.height)!==o.length||f.x<0||f.y<0||p.width<u.width||p.height<u.height?null:{extent:e,pixelBlock:Yt(o.map(m=>m.pixelBlock),p,{clipOffset:f,clipSize:u})}}function mt(t,e,n,l,a,i){let{width:o,height:c}=n.block,{x:h,y:r}=n.offset,{width:s,height:f}=n.mosaic,p=Qt(o,c,l,a,h,r,s,f),u=0,m=0;if(i){let d=i.hasGCSSShiftTransform?360:i.halfWorldWidth??0,g=o*i.resolutionX,y=i.startX+l*g;y<d&&y+g>d?m=i.rightPadding:y>=d&&(u=i.leftMargin-i.rightPadding,m=0)}if(p.xmax-=m,typeof e!="number")for(let d=p.ymin;d<p.ymax;d++){let g=(a*c+d-r)*s+(l*o-h)+u,y=d*o;for(let k=p.xmin;k<p.xmax;k++)t[g+k]=e[y+k]}else for(let d=p.ymin;d<p.ymax;d++){let g=(a*c+d-r)*s+(l*o-h)+u;for(let y=p.xmin;y<p.xmax;y++)t[g+y]=e}}function Yt(t,e,n={}){let{clipOffset:l,clipSize:a,alignmentInfo:i,blockWidths:o}=n;if(o)return Zt(t,e,{blockWidths:o});let c=t.find(P=>L(P));if(c==null)return null;let h=a?a.width:e.width,r=a?a.height:e.height,s=c.width,f=c.height,p=e.width/s,u=e.height/f,m={offset:l||{x:0,y:0},mosaic:a||e,block:{width:s,height:f}},d=c.pixelType,g=_.getPixelArrayConstructor(d),y=c.pixels.length,k=[],w,M;for(let P=0;P<y;P++){M=new g(h*r);for(let I=0;I<u;I++)for(let U=0;U<p;U++){let B=t[I*p+U];L(B)&&(w=B.pixels[P],mt(M,w,m,U,I,i))}k.push(M)}let x=t.some(P=>P==null||P.mask!=null&&P.mask.length>0),A=t.some(P=>P?.bandMasks&&P.bandMasks.length>1),b=x?new Uint8Array(h*r):void 0,v=A?[]:void 0;if(b){for(let P=0;P<u;P++)for(let I=0;I<p;I++){let U=t[P*p+I],B=U!=null?U.mask:null;mt(b,B??(U?255:0),m,I,P,i)}if(v)for(let P=0;P<y;P++){let I=new Uint8Array(h*r);for(let U=0;U<u;U++)for(let B=0;B<p;B++){let C=t[U*p+B],V=C?.bandMasks?.[P]??C?.mask;mt(I,V??(C?255:0),m,B,U,i)}v.push(I)}}let T=new _({width:h,height:r,pixels:k,pixelType:d,bandMasks:v,mask:b});return T.updateStatistics(),T}function Zt(t,e,n){let l=t.find(g=>g!=null);if(l==null)return null;let a=t.some(g=>g==null||!!g.mask),{width:i,height:o}=e,c=a?new Uint8Array(i*o):null,{blockWidths:h}=n,r=[],s=l.getPlaneCount(),f=_.getPixelArrayConstructor(l.pixelType);if(a)for(let g=0,y=0;g<t.length;y+=h[g],g++){let k=t[g];if(!L(k))continue;let w=k.mask;for(let M=0;M<o;M++)for(let x=0;x<h[g];x++)c[M*i+x+y]=w==null?255:w[M*k.width+x]}let p=t.some(g=>g?.bandMasks&&g.bandMasks.length>1),u=p?[]:void 0,m=i*o;for(let g=0;g<s;g++){let y=new f(m),k=p?new Uint8Array(m):void 0;for(let w=0,M=0;w<t.length;M+=h[w],w++){let x=t[w];if(!L(x))continue;let A=x.pixels[g];if(A!=null){for(let b=0;b<o;b++)for(let v=0;v<h[w];v++)y[b*i+v+M]=A[b*x.width+v];if(k){let b=x.bandMasks?.[g]??x.mask;for(let v=0;v<o;v++)for(let T=0;T<h[w];T++)k[v*i+T+M]=b?b[v*x.width+T]:255}}}r.push(y),u&&k&&u.push(k)}let d=new _({width:i,height:o,mask:c,bandMasks:u,pixels:r,pixelType:l.pixelType});return d.updateStatistics(),d}function Xe(t,e,n){if(!L(t))return null;let{width:l,height:a}=t,i=e.x,o=e.y,c=n.width+i,h=n.height+o;if(i<0||o<0||c>l||h>a||i===0&&o===0&&c===l&&h===a)return t;t.mask||(t.mask=new Uint8Array(l*a));let r=t.mask;for(let s=0;s<a;s++){let f=s*l;for(let p=0;p<l;p++)r[f+p]=s<o||s>=h||p<i||p>=c?0:1}return t.updateStatistics(),t}function te(t){if(!L(t))return null;let e=t.clone(),{width:n,height:l,pixels:a}=t,i=a[0],o=e.pixels[0],c=t.mask;for(let h=2;h<l-1;h++){let r=new Map;for(let f=h-2;f<h+2;f++)for(let p=0;p<4;p++){let u=f*n+p;ot(r,i[u],c?c[u]:1)}o[h*n]=Ct(r),o[h*n+1]=o[h*n+2]=o[h*n];let s=3;for(;s<n-1;s++){let f=(h-2)*n+s+1;ot(r,i[f],c?c[f]:1),f=(h-1)*n+s+1,ot(r,i[f],c?c[f]:1),f=h*n+s+1,ot(r,i[f],c?c[f]:1),f=(h+1)*n+s+1,ot(r,i[f],c?c[f]:1),f=(h-2)*n+s-3,ht(r,i[f],c?c[f]:1),f=(h-1)*n+s-3,ht(r,i[f],c?c[f]:1),f=h*n+s-3,ht(r,i[f],c?c[f]:1),f=(h+1)*n+s-3,ht(r,i[f],c?c[f]:1),o[h*n+s]=Ct(r)}o[h*n+s+1]=o[h*n+s]}for(let h=0;h<n;h++)o[h]=o[n+h]=o[2*n+h],o[(l-1)*n+h]=o[(l-2)*n+h];return e.updateStatistics(),e}function Ct(t){if(t.size===0)return 0;let e=0,n=-1,l=0,a=t.keys(),i=a.next();for(;!i.done;)l=t.get(i.value),l>e&&(n=i.value,e=l),i=a.next();return n}function ht(t,e,n){if(n===0)return;let l=t.get(e);l===1?t.delete(e):t.set(e,l-1)}function ot(t,e,n){n!==0&&t.set(e,t.has(e)?t.get(e)+1:1)}function Lt(t,e,n){let{x:l,y:a}=e,{width:i,height:o}=n;if(l===0&&a===0&&o===t.height&&i===t.width)return t;let{width:c,height:h}=t,r=Math.max(0,a),s=Math.max(0,l),f=Math.min(l+i,c),p=Math.min(a+o,h);if(f<0||p<0||!L(t))return null;l=Math.max(0,-l),a=Math.max(0,-a);let{pixels:u}=t,m=i*o,d=u.length,g=[];for(let M=0;M<d;M++){let x=u[M],A=_.createEmptyBand(t.pixelType,m);for(let b=r;b<p;b++){let v=b*c,T=(b+a-r)*i+l;for(let P=s;P<f;P++)A[T++]=x[v+P]}g.push(A)}let y=new Uint8Array(m),k=t.mask;for(let M=r;M<p;M++){let x=M*c,A=(M+a-r)*i+l;for(let b=s;b<f;b++)y[A++]=k?k[x+b]:1}let w=new _({width:n.width,height:n.height,pixelType:t.pixelType,pixels:g,mask:y});return w.updateStatistics(),w}function Rt(t,e=!0){if(!L(t))return null;let{pixels:n,width:l,height:a,mask:i,pixelType:o}=t,c=[],h=Math.round(l/2),r=Math.round(a/2),s=a-1,f=l-1;for(let u=0;u<n.length;u++){let m=n[u],d=_.createEmptyBand(o,h*r),g=0;for(let y=0;y<a;y+=2)for(let k=0;k<l;k+=2){let w=m[y*l+k];if(e){let M=k===f?w:m[y*l+k+1],x=y===s?w:m[y*l+k+l],A=k===f?x:y===s?M:m[y*l+k+l+1];d[g++]=(w+M+x+A)/4}else d[g++]=w}c.push(d)}let p=null;if(i!=null){p=new Uint8Array(h*r);let u=0;for(let m=0;m<a;m+=2)for(let d=0;d<l;d+=2){let g=i[m*l+d];if(e){let y=d===f?g:i[m*l+d+1],k=m===s?g:i[m*l+d+l],w=d===f?k:m===s?y:i[m*l+d+l+1];p[u++]=g*y*k*w?1:0}else p[u++]=g}}return new _({width:h,height:r,pixelType:o,pixels:c,mask:p})}function Ke(t,e,n=0,l=!0){if(!L(t))return null;let{width:a,height:i}=e,{width:o,height:c}=t,h=new Map,r={x:0,y:0},s=1+n,f=t;for(let p=0;p<s;p++){let u=Math.ceil(o/a),m=Math.ceil(c/i);for(let d=0;d<m;d++){r.y=d*i;for(let g=0;g<u;g++){r.x=g*a;let y=Lt(f,r,e);h.set(`${p}/${d}/${g}`,y)}}p<s-1&&(f=Rt(f,l)),o=Math.round(o/2),c=Math.round(c/2)}return h}function $e(t){let{pixelBlock:e,tileSize:n,level:l,row:a,col:i,useBilinear:o}=t;if(!L(e))return null;let{width:c,height:h}=n,r=2**l,s=r*c,f=r*h,p=Lt(e,{y:a*f,x:i*s},{width:s,height:f});if(!p)return null;for(let u=l;u>0;u--)p=Rt(p,o);return p}function Nt(t,e,n,l,a=0){let{width:i,height:o}=t,{width:c,height:h}=e,r=l.cols,s=l.rows,f=Math.ceil(c/r-.1/r),p=Math.ceil(h/s-.1/s),u,m,d,g,y,k,w,M=f*r,x=M*p*s,A=new Float32Array(x),b=new Float32Array(x),v=new Uint32Array(x),T=new Uint32Array(x),P,I,U=0;for(let B=0;B<p;B++)for(let C=0;C<f;C++){u=12*(B*f+C),m=n[u],d=n[u+1],g=n[u+2],y=n[u+3],k=n[u+4],w=n[u+5];for(let V=0;V<s;V++){U=(B*s+V)*M+C*r,I=(V+.5)/s;for(let S=0;S<V;S++)P=(S+.5)/r,A[U+S]=(m*P+d*I+g)*i+a,b[U+S]=(y*P+k*I+w)*o+a,v[U+S]=Math.floor(A[U+S]),T[U+S]=Math.floor(b[U+S])}u+=6,m=n[u],d=n[u+1],g=n[u+2],y=n[u+3],k=n[u+4],w=n[u+5];for(let V=0;V<s;V++){U=(B*s+V)*M+C*r,I=(V+.5)/s;for(let S=V;S<r;S++)P=(S+.5)/r,A[U+S]=(m*P+d*I+g)*i+a,b[U+S]=(y*P+k*I+w)*o+a,v[U+S]=Math.floor(A[U+S]),T[U+S]=Math.floor(b[U+S])}}return{offsets_x:A,offsets_y:b,offsets_xi:v,offsets_yi:T,gridWidth:M}}function He(t,e){let{coefficients:n,spacing:l}=e,{offsets_x:a,offsets_y:i,gridWidth:o}=Nt(t,t,n,{rows:l[0],cols:l[1]}),{width:c,height:h}=t,r=new Float32Array(c*h),s=180/Math.PI;for(let f=0;f<h;f++)for(let p=0;p<c;p++){let u=f*o+p,m=f===0?u:u-o,d=f===h-1?u:u+o,g=a[m]-a[d],y=i[d]-i[m];if(isNaN(g)||isNaN(y))r[f*c+p]=90;else{let k=Math.atan2(y,g)*s;k=(360+k)%360,r[f*c+p]=k}}return r}function Qe(t,e,n,l,a="nearest"){if(!L(t))return null;a==="majority"&&(t=te(t));let{pixels:i,mask:o,bandMasks:c,pixelType:h}=t,r=t.width,s=t.height,f=_.getPixelArrayConstructor(h),p=i.length,{width:u,height:m}=e,d=!1;for(let U=0;U<n.length;U+=3)n[U]===-1&&n[U+1]===-1&&n[U+2]===-1&&(d=!0);let{offsets_x:g,offsets_y:y,offsets_xi:k,offsets_yi:w,gridWidth:M}=Nt({width:r,height:s},e,n,l,a==="majority"?.5:0),x,A=(U,B,C,V)=>{let S=U instanceof Float32Array||U instanceof Float64Array?0:.5;for(let F=0;F<m;F++){x=F*M;for(let D=0;D<u;D++){if(g[x]<0||y[x]<0)U[F*u+D]=0;else if(V)U[F*u+D]=B[k[x]+w[x]*r];else{let O=Math.floor(g[x]),z=Math.floor(y[x]),N=Math.ceil(g[x]),W=Math.ceil(y[x]),J=g[x]-O,$=y[x]-z;if(!C||C[O+z*r]&&C[N+z*r]&&C[O+W*r]&&C[N+W*r]){let nt=(1-J)*B[O+z*r]+J*B[N+z*r],Y=(1-J)*B[O+W*r]+J*B[N+W*r];U[F*u+D]=(1-$)*nt+$*Y+S}else U[F*u+D]=B[k[x]+w[x]*r]}x++}}},b=[],v,T=c?.length===p,P=[];for(let U=0;U<p;U++){if(T){let B=new Uint8Array(u*m);A(B,c[U],c[U],!0),P.push(B)}v=new f(u*m),A(v,i[U],T?c[U]:o,a==="nearest"||a==="majority"),b.push(v)}let I=new _({width:u,height:m,pixelType:h,pixels:b,bandMasks:T?P:void 0});if(o!=null)I.mask=new Uint8Array(u*m),A(I.mask,o,o,!0);else if(d){I.mask=new Uint8Array(u*m);for(let U=0;U<u*m;U++)I.mask[U]=g[U]<0||y[U]<0?0:1}return I.updateStatistics(),I}var et=new Map;et.set("meter-per-second",1),et.set("kilometer-per-hour",.277778),et.set("knots",.514444),et.set("feet-per-second",.3048),et.set("mile-per-hour",.44704);var gt=180/Math.PI,xt=5,ft=new vt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function wt(t,e){return et.get(t)/et.get(e)||1}function Ot(t){return(450-t)%360}function jt(t,e="geographic"){let[n,l]=t,a=Math.sqrt(n*n+l*l),i=Math.atan2(l,n)*gt;return i=(360+i)%360,e==="geographic"&&(i=Ot(i)),[a,i]}function Gt(t,e="geographic"){let n=t[1];e==="geographic"&&(n=Ot(n)),n%=360;let l=t[0];return[l*Math.cos(n/gt),l*Math.sin(n/gt)]}function nn(t,e,n,l="geographic"){if(!L(t)||n==null)return t;let a=e==="vector-magdir"?t.clone():Et(t,e),i=a.pixels[1];for(let o=0;o<i.length;o++)i[o]=l==="geographic"?(i[o]+n[o]+270)%360:(i[o]+360-n[o])%360;return e==="vector-magdir"?a:Et(a,"vector-magdir")}function Et(t,e,n="geographic",l=1){if(!L(t))return t;let{pixels:a,width:i,height:o}=t,c=i*o,h=a[0],r=a[1],s=t.pixelType.startsWith("f")?t.pixelType:"f32",f=_.createEmptyBand(s,c),p=_.createEmptyBand(s,c),u=0;for(let d=0;d<o;d++)for(let g=0;g<i;g++)e==="vector-uv"?([f[u],p[u]]=jt([h[u],r[u]],n),f[u]*=l):([f[u],p[u]]=Gt([h[u],r[u]],n),f[u]*=l,p[u]*=l),u++;let m=new _({pixelType:s,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[f,p]});return m.updateStatistics(),m}function sn(t,e,n=1){if(n===1||!L(t))return t;let l=t.clone(),{pixels:a,width:i,height:o}=l,c=a[0],h=a[1],r=0;for(let s=0;s<o;s++)for(let f=0;f<i;f++)e==="vector-uv"?(c[r]*=n,h[r]*=n):c[r]*=n,r++;return l.updateStatistics(),l}function ln(t,e,n,l,a){if(a==null||!a.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(e/l),height:Math.round(n/l),resolution:t.width/e};let i=a.xmin,o=a.ymax,c=(t.xmax-t.xmin)/e*l,h=(t.ymax-t.ymin)/n*l,r=(c+h)/2;return t.xmin=i+Math.floor((t.xmin-i)/c)*c,t.xmax=i+Math.ceil((t.xmax-i)/c)*c,t.ymin=o+Math.floor((t.ymin-o)/h)*h,t.ymax=o+Math.ceil((t.ymax-o)/h)*h,{extent:t,width:Math.round(t.width/c),height:Math.round(t.height/h),resolution:r}}var ee=Wt(0,0,0);function Wt(t=0,e=0,n=Math.PI,l=!0){l&&(n=(2*Math.PI-n)%(2*Math.PI));let a=l?-1:1,i=13*a,o=-7*a,c=-2*a,h=-16*a,r=21.75,[s,f]=j(0,e+i,n,r),[p,u]=j(t-5.5,e+o,n,r),[m,d]=j(t+5.5,e+o,n,r),[g,y]=j(t-1.5,e+c,n,r),[k,w]=j(t+1.5,e+c,n,r),[M,x]=j(t-1.5,e+h,n,r),[A,b]=j(t+1.5,e+h,n,r);return[s,f,p,u,g,y,k,w,m,d,M,x,A,b]}function ne(t=0,e=Math.PI,n=!0){n&&(e=(2*Math.PI-e)%(2*Math.PI));let l=10,a=n?-1:1,i=5*a,o=20*a,c=25*a,h=45,r=0,s=0,f=2,p=0,u=f*a,m=n?1:-1,d=l/2*m,[g,y]=[r+d,s-o],[k,w]=[g+f*m,y],[M,x]=[k-p*m,w+u],[A,b]=[r-d,s-c],[v,T]=[A+p*m,b-u],P=Math.ceil(t/xt),I=Math.floor(P/10);P-=8*I;let U=[],B=[];for(let J=0;J<P/2;J++,I--){I<=0&&P%2==1&&J===(P-1)/2&&(A=r,v=A+p*m,b=(b+y)/2,T=b-u);let[$,nt]=j(A,b,e,h);if(I>0){let[Y,st]=j(k,b,e,h),[lt,R]=j(g,y,e,h);U.push(Y),U.push(st),U.push($),U.push(nt),U.push(lt),U.push(R)}else{let[Y,st]=j(k,w,e,h),[lt,R]=j(M,x,e,h),[E,ut]=j(v,T,e,h);B.push($),B.push(nt),B.push(E),B.push(ut),B.push(lt),B.push(R),B.push(Y),B.push(st)}b+=i,y+=i,w+=i,x+=i,T+=i}let[C,V]=j(r+d,s+o,e,h),S=(l/2+f)*m,[F,D]=j(r+S,s+o,e,h),[O,z]=j(r+d,s-c,e,h),[N,W]=j(r+S,s-c,e,h);return{pennants:U,barbs:B,shaft:[C,V,F,D,O,z,N,W]}}function j(t,e,n,l=1){let a=Math.sqrt(t*t+e*e)/l,i=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[a,(2*Math.PI+i-n)%(2*Math.PI)]}var ct=[0,1,3,6,10,16,21,27,33,40,47,55,63],ie=[0,.5,1,1.5,2],se=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function tt(t,e,n,l){let a=wt(l||"knots",n),i;for(i=1;i<e.length;i++)if(i===e.length-1){if(t<e[i]*a)break}else if(t<=e[i]*a)break;return Math.min(i-1,e.length-2)}function le(t,e,n,l,a){let i=0;switch(e){case"beaufort_kn":i=tt(t,ct,"knots",n);break;case"beaufort_km":i=tt(t,ct,"kilometer-per-hour",n);break;case"beaufort_ft":i=tt(t,ct,"feet-per-second",n);break;case"beaufort_m":i=tt(t,ct,"meter-per-second",n);break;case"classified_arrow":i=tt(t,a??[],l,n);break;case"ocean_current_m":i=tt(t,ie,"meter-per-second",n);break;case"ocean_current_kn":i=tt(t,se,"knots",n)}return i}function re(t,e){let{style:n,inputUnit:l,outputUnit:a,breakValues:i}=e,o=ft.fromJSON(l),c=ft.fromJSON(a),h=7*6,r=15,s=0,f=0,{width:p,height:u,mask:m}=t,d=t.pixels[0],g=t.pixels[1],y=m!=null?m.filter(x=>x>0).length:p*u,k=new Float32Array(y*h),w=new Uint32Array(r*y),M=e.invertDirection?Wt(0,0,0,!1):ee;for(let x=0;x<u;x++)for(let A=0;A<p;A++){let b=x*p+A;if(!m||m[x*p+A]){let v=(g[b]+360)%360/180*Math.PI,T=le(d[b],n,o,c,i);for(let I=0;I<M.length;I+=2)k[s++]=(A+.5)/p,k[s++]=(x+.5)/u,k[s++]=M[I],k[s++]=M[I+1]+v,k[s++]=T,k[s++]=d[b];let P=7*(s/h-1);w[f++]=P,w[f++]=P+1,w[f++]=P+2,w[f++]=P+0,w[f++]=P+4,w[f++]=P+3,w[f++]=P+0,w[f++]=P+2,w[f++]=P+3,w[f++]=P+2,w[f++]=P+5,w[f++]=P+3,w[f++]=P+5,w[f++]=P+6,w[f++]=P+3}}return{vertexData:k,indexData:w}}var dt=[];function oe(t,e){if(dt.length===0)for(let u=0;u<30;u++)dt.push(ne(5*u,0,!e.invertDirection));let n=wt(ft.fromJSON(e.inputUnit),"knots"),{width:l,height:a,mask:i}=t,o=t.pixels[0],c=t.pixels[1],h=6,r=[],s=[],f=0,p=0;for(let u=0;u<a;u++)for(let m=0;m<l;m++){let d=u*l+m,g=o[d]*n;if((!i||i[u*l+m])&&g>=xt){let y=(c[d]+360)%360/180*Math.PI,{pennants:k,barbs:w,shaft:M}=dt[Math.min(Math.floor(g/5),29)];if(k.length+w.length===0)continue;let x=r.length/h,A=(m+.5)/l,b=(u+.5)/a;for(let v=0;v<k.length;v+=2)r[f++]=A,r[f++]=b,r[f++]=k[v],r[f++]=k[v+1]+y,r[f++]=0,r[f++]=g;for(let v=0;v<w.length;v+=2)r[f++]=A,r[f++]=b,r[f++]=w[v],r[f++]=w[v+1]+y,r[f++]=0,r[f++]=g;for(let v=0;v<M.length;v+=2)r[f++]=A,r[f++]=b,r[f++]=M[v],r[f++]=M[v+1]+y,r[f++]=0,r[f++]=g;for(let v=0;v<k.length/6;v++)s[p++]=x,s[p++]=x+1,s[p++]=x+2,x+=3;for(let v=0;v<w.length/8;v++)s[p++]=x,s[p++]=x+1,s[p++]=x+2,s[p++]=x+1,s[p++]=x+2,s[p++]=x+3,x+=4;s[p++]=x+0,s[p++]=x+1,s[p++]=x+2,s[p++]=x+1,s[p++]=x+3,s[p++]=x+2,x+=4}}return{vertexData:new Float32Array(r),indexData:new Uint32Array(s)}}function ae(t,e){let l=0,a=0,{width:i,height:o,mask:c}=t,h=t.pixels[0],r=[],s=[],f=wt(ft.fromJSON(e.inputUnit),"knots"),p=e.style==="wind_speed"?xt:Number.MAX_VALUE;for(let u=0;u<o;u++)for(let m=0;m<i;m++){let d=h[u*i+m]*f;if((!c||c[u*i+m])&&d<p){for(let y=0;y<4;y++)r[l++]=(m+.5)/i,r[l++]=(u+.5)/o,r[l++]=y<2?-.5:.5,r[l++]=y%2==0?-.5:.5,r[l++]=0,r[l++]=d;let g=4*(l/24-1);s[a++]=g,s[a++]=g+1,s[a++]=g+2,s[a++]=g+1,s[a++]=g+2,s[a++]=g+3}}return{vertexData:new Float32Array(r),indexData:new Uint32Array(s)}}function rn(t,e){return e.style==="simple_scalar"?ae(t,e):e.style==="wind_speed"?oe(t,e):re(t,e)}function on(t,e,n,l=[0,0],a=.5){let{width:i,height:o,mask:c}=t,[h,r]=t.pixels,[s,f]=l,p=Math.round((i-s)/n),u=Math.round((o-f)/n),m=p*u,d=new Float32Array(m),g=new Float32Array(m),y=new Uint8Array(m),k=e==="vector-uv";for(let M=0;M<u;M++)for(let x=0;x<p;x++){let A=0,b=M*p+x,v=Math.max(0,M*n+f),T=Math.max(0,x*n+s),P=Math.min(o,v+n),I=Math.min(i,T+n);for(let U=v;U<P;U++)for(let B=T;B<I;B++){let C=U*i+B;if(!c||c[C]){A++;let V=k?[h[C],r[C]]:[h[C],(360+r[C])%360],[S,F]=k?V:Gt(V);d[b]+=S,g[b]+=F}}if(A>=(P-v)*(I-T)*(1-a)){y[b]=1;let[U,B]=jt([d[b]/A,g[b]/A]);d[b]=U,g[b]=B}else y[b]=0,d[b]=0,g[b]=0}let w=new _({width:p,height:u,pixels:[d,g],mask:y});return w.updateStatistics(),w}var K=()=>H.getLogger("esri.views.2d.engine.flow.dataUtils"),he=10;function xn(t,e,n,l){return at(this,null,function*(){let a=performance.now(),i=ce(e,n),o=performance.now(),c=ue(e,i,n.width,n.height),h=performance.now(),r=me(c,!0),s=performance.now(),f=t==="Streamlines"?de(r,he):ge(r),p=performance.now();return Z("esri-2d-profiler")&&(K().info("I.1","_createFlowFieldFromData (ms)",Math.round(o-a)),K().info("I.2","_getStreamlines (ms)",Math.round(h-o)),K().info("I.3","createAnimatedLinesData (ms)",Math.round(s-h)),K().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(p-s)),K().info("I.5","createFlowMesh (ms)",Math.round(p-a)),K().info("I.6","Mesh size (bytes)",f.vertexData.buffer.byteLength+f.indexData.buffer.byteLength)),yield Promise.resolve(),kt(l),f})}function ce(t,e){let n=pe(e.data,e.width,e.height,t.smoothing);return t.interpolate?(l,a)=>{let i=Math.floor(l),o=Math.floor(a);if(i<0||i>=e.width)return[0,0];if(o<0||o>=e.height)return[0,0];let c=l-i,h=a-o,r=i,s=o,f=i<e.width-1?i+1:i,p=o<e.height-1?o+1:o,u=n[2*(s*e.width+r)],m=n[2*(s*e.width+f)],d=n[2*(p*e.width+r)],g=n[2*(p*e.width+f)],y=n[2*(s*e.width+r)+1],k=n[2*(s*e.width+f)+1];return[(u*(1-h)+d*h)*(1-c)+(m*(1-h)+g*h)*c,(y*(1-h)+n[2*(p*e.width+r)+1]*h)*(1-c)+(k*(1-h)+n[2*(p*e.width+f)+1]*h)*c]}:(l,a)=>{let i=Math.round(l),o=Math.round(a);return i<0||i>=e.width||o<0||o>=e.height?[0,0]:[n[2*(o*e.width+i)],n[2*(o*e.width+i)+1]]}}function fe(t,e,n,l,a,i,o,c,h){let r=[],s=n,f=l,p=0,[u,m]=e(s,f);u*=t.velocityScale,m*=t.velocityScale;let d=Math.sqrt(u*u+m*m),g,y;r.push({x:s,y:f,t:p,speed:d});for(let k=0;k<t.verticesPerLine;k++){let[w,M]=e(s,f);w*=t.velocityScale,M*=t.velocityScale;let x=Math.sqrt(w*w+M*M);if(x<t.minSpeedThreshold)return r;let A=w/x,b=M/x;if(s+=A*t.segmentLength,f+=b*t.segmentLength,p+=t.segmentLength/x,Math.acos(A*g+b*y)>t.maxTurnAngle)return r;if(t.collisions){let v=Math.round(s*h),T=Math.round(f*h);if(v<0||v>o-1||T<0||T>c-1)return r;let P=i[T*o+v];if(P!==-1&&P!==a)return r;i[T*o+v]=a}r.push({x:s,y:f,t:p,speed:x}),g=A,y=b}return r}function ue(t,e,n,l){let a=[],i=new pt,o=1/Math.max(t.lineCollisionWidth,1),c=Math.round(n*o),h=Math.round(l*o),r=new Int32Array(c*h);for(let f=0;f<r.length;f++)r[f]=-1;let s=[];for(let f=0;f<l;f+=t.lineSpacing)for(let p=0;p<n;p+=t.lineSpacing)s.push({x:p,y:f,sort:i.getFloat()});s.sort((f,p)=>f.sort-p.sort);for(let{x:f,y:p}of s)if(i.getFloat()<t.density){let u=fe(t,e,f,p,a.length,r,c,h,o);if(u.length<2)continue;a.push(u)}return a}function pe(t,e,n,l){if(l===0)return t;let a=Math.round(3*l),i=new Array(2*a+1),o=0;for(let r=-a;r<=a;r++){let s=Math.exp(-r*r/(l*l));i[r+a]=s,o+=s}for(let r=-a;r<=a;r++)i[r+a]/=o;let c=new Float32Array(t.length);for(let r=0;r<n;r++)for(let s=0;s<e;s++){let f=0,p=0;for(let u=-a;u<=a;u++){if(s+u<0||s+u>=e)continue;let m=i[u+a];f+=m*t[2*(r*e+(s+u))],p+=m*t[2*(r*e+(s+u))+1]}c[2*(r*e+s)]=f,c[2*(r*e+s)+1]=p}let h=new Float32Array(t.length);for(let r=0;r<e;r++)for(let s=0;s<n;s++){let f=0,p=0;for(let u=-a;u<=a;u++){if(s+u<0||s+u>=n)continue;let m=i[u+a];f+=m*c[2*((s+u)*e+r)],p+=m*c[2*((s+u)*e+r)+1]}h[2*(s*e+r)]=f,h[2*(s*e+r)+1]=p}return h}function me(t,e){let n=new pt,l=t.reduce((h,r)=>h+r.length,0),a=new Float32Array(4*l),i=new Array(t.length),o=0,c=0;for(let h of t){let r=o;for(let s of h)a[4*o]=s.x,a[4*o+1]=s.y,a[4*o+2]=s.t,a[4*o+3]=s.speed,o++;i[c++]={startVertex:r,numberOfVertices:h.length,totalTime:h[h.length-1].t,timeSeed:e?n.getFloat():0}}return{lineVertices:a,lineDescriptors:i}}function de(t,e){let{lineVertices:l,lineDescriptors:a}=t,i=0,o=0;for(let u of a)i+=2*u.numberOfVertices,o+=6*(u.numberOfVertices-1);let c=new Float32Array(i*9),h=new Uint32Array(o),r=0,s=0;function f(){h[s++]=r-2,h[s++]=r,h[s++]=r-1,h[s++]=r,h[s++]=r+1,h[s++]=r-1}function p(u,m,d,g,y,k,w,M){let x=r*9,A=0;c[x+A++]=u,c[x+A++]=m,c[x+A++]=1,c[x+A++]=d,c[x+A++]=k,c[x+A++]=w,c[x+A++]=g/2,c[x+A++]=y/2,c[x+A++]=M,r++,c[x+A++]=u,c[x+A++]=m,c[x+A++]=-1,c[x+A++]=d,c[x+A++]=k,c[x+A++]=w,c[x+A++]=-g/2,c[x+A++]=-y/2,c[x+A++]=M,r++}for(let u of a){let{totalTime:m,timeSeed:d}=u,g=null,y=null,k=null,w=null,M=null,x=null;for(let A=0;A<u.numberOfVertices;A++){let b=l[4*(u.startVertex+A)],v=l[4*(u.startVertex+A)+1],T=l[4*(u.startVertex+A)+2],P=l[4*(u.startVertex+A)+3],I=null,U=null,B=null,C=null;if(A>0){I=b-g,U=v-y;let V=Math.sqrt(I*I+U*U);if(I/=V,U/=V,A>1){let S=I+M,F=U+x,D=Math.sqrt(S*S+F*F);S/=D,F/=D;let O=Math.min(1/(S*I+F*U),e);S*=O,F*=O,B=-F,C=S}else B=-U,C=I;B!==null&&C!==null&&(p(g,y,k,B,C,m,d,P),f())}g=b,y=v,k=T,M=I,x=U,w=P}p(g,y,k,-x,M,m,d,w)}return{vertexData:c,indexData:h}}function ge(t){let{lineVertices:a,lineDescriptors:i}=t,o=0,c=0;for(let V of i){let S=V.numberOfVertices-1;o+=4*S*2,c+=6*S*2}let h=new Float32Array(o*16),r=new Uint32Array(c),s,f,p,u,m,d,g,y,k,w,M,x,A,b,v=0,T=0;function P(){r[T++]=v-8,r[T++]=v-7,r[T++]=v-6,r[T++]=v-7,r[T++]=v-5,r[T++]=v-6,r[T++]=v-4,r[T++]=v-3,r[T++]=v-2,r[T++]=v-3,r[T++]=v-1,r[T++]=v-2}function I(V,S,F,D,O,z,N,W,J,$,nt,Y,st,lt){let R=v*16,E=0;for(let ut of[1,2])for(let Jt of[1,2,3,4])h[R+E++]=V,h[R+E++]=S,h[R+E++]=F,h[R+E++]=D,h[R+E++]=N,h[R+E++]=W,h[R+E++]=J,h[R+E++]=$,h[R+E++]=ut,h[R+E++]=Jt,h[R+E++]=st,h[R+E++]=lt,h[R+E++]=O/2,h[R+E++]=z/2,h[R+E++]=nt/2,h[R+E++]=Y/2,v++}function U(V,S){let F=k+M,D=w+x,O=Math.sqrt(F*F+D*D);F/=O,D/=O;let z=k*F+w*D;F/=z,D/=z;let N=M+A,W=x+b,J=Math.sqrt(N*N+W*W);N/=J,W/=J;let $=M*N+x*W;N/=$,W/=$,I(s,f,p,u,-D,F,m,d,g,y,-W,N,V,S),P()}function B(V,S,F,D,O,z){if(k=M,w=x,M=A,x=b,k==null&&w==null&&(k=M,w=x),m!=null&&d!=null){A=V-m,b=S-d;let N=Math.sqrt(A*A+b*b);A/=N,b/=N}k!=null&&w!=null&&U(O,z),s=m,f=d,p=g,u=y,m=V,d=S,g=F,y=D}function C(V,S){k=M,w=x,M=A,x=b,k==null&&w==null&&(k=M,w=x),k!=null&&w!=null&&U(V,S)}for(let V of i){s=null,f=null,p=null,u=null,m=null,d=null,g=null,y=null,k=null,w=null,M=null,x=null,A=null,b=null;let{totalTime:S,timeSeed:F}=V;for(let D=0;D<V.numberOfVertices;D++)B(a[4*(V.startVertex+D)],a[4*(V.startVertex+D)+1],a[4*(V.startVertex+D)+2],a[4*(V.startVertex+D)+3],S,F);C(S,F)}return{vertexData:h,indexData:r}}function qt(t,e){let n=e.pixels,{width:l,height:a}=e,i=new Float32Array(l*a*2),o=e.mask||new Uint8Array(l*a*2);if(e.mask||o.fill(255),t==="vector-uv")for(let c=0;c<l*a;c++)i[2*c]=n[0][c],i[2*c+1]=-n[1][c];else if(t==="vector-magdir")for(let c=0;c<l*a;c++){let h=n[0][c],r=It(n[1][c]),s=Math.cos(r-Math.PI/2),f=Math.sin(r-Math.PI/2);i[2*c]=s*h,i[2*c+1]=f*h}return{data:i,mask:o,width:l,height:a}}function wn(t,e,n,l,a,i){return at(this,null,function*(){let o=performance.now(),c=Pt(e.spatialReference);if(!c){let M=yield zt(t,e,n,l,a,i);return Z("esri-2d-profiler")&&K().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-o)),Z("esri-2d-profiler")&&K().info("I.9","Number of parts",1),M}let[h,r]=c.valid,s=r-h,f=Math.ceil(e.width/s),p=e.width/f,u=Math.round(n/f),m=e.xmin,d=[],g=performance.now();for(let M=0;M<f;M++){let x=new Tt({xmin:m,xmax:m+p,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});d.push(zt(t,x,u,l,a,i)),m+=p}let y=yield Promise.all(d);Z("esri-2d-profiler")&&K().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-g)),Z("esri-2d-profiler")&&K().info("I.9","Number of parts",y.length);let k={data:new Float32Array(n*l*2),mask:new Uint8Array(n*l),width:n,height:l},w=0;for(let M of y){for(let x=0;x<M.height;x++)for(let A=0;A<M.width;A++)w+A>=n||(k.data[2*(x*n+w+A)]=M.data[2*(x*M.width+A)],k.data[2*(x*n+w+A)+1]=M.data[2*(x*M.width+A)+1],k.mask[x*n+w+A]=M.mask[x*M.width+A]);w+=M.width}return Z("esri-2d-profiler")&&K().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-o)),k})}function zt(t,e,n,l,a,i){return at(this,null,function*(){let o={requestProjectedLocalDirections:!0,signal:i};if(a!=null&&(o.timeExtent=a),t.type==="imagery"){yield t.load({signal:i});let r=t.rasterInfo.dataType,s=yield t.fetchImage(e,n,l,o);return s?.pixelData?.pixelBlock==null?{data:new Float32Array(n*l*2),mask:new Uint8Array(n*l),width:n,height:l}:qt(r,s.pixelData.pixelBlock)}yield t.load({signal:i});let c=t.serviceRasterInfo.dataType,h=yield t.fetchPixels(e,n,l,o);return h?.pixelBlock==null?{data:new Float32Array(n*l*2),mask:new Uint8Array(n*l),width:n,height:l}:qt(c,h.pixelBlock)})}export{rt as a,it as b,we as c,ye as d,Me as e,_ as f,Bt as g,St as h,Le as i,L as j,Re as k,Ne as l,Ee as m,Oe as n,Dt as o,je as p,Ge as q,We as r,qe as s,ze as t,Je as u,Yt as v,Xe as w,Ke as x,$e as y,He as z,Qe as A,ft as B,wt as C,jt as D,nn as E,Et as F,sn as G,ln as H,ae as I,rn as J,on as K,xn as L,wn as M};
