import{a as j}from"./chunk-I3S324BU.js";import{a as J,b as P}from"./chunk-3UBRSNPL.js";import{a as F}from"./chunk-XDRSKFBJ.js";import{a as E}from"./chunk-3CS3BPVL.js";import{a as _}from"./chunk-R2K3CL3U.js";import{a as $}from"./chunk-RU7UW4IO.js";import{b as N}from"./chunk-RZA5H63B.js";import{a as O}from"./chunk-FKQYBEPG.js";import{a as T}from"./chunk-LTDZH3EN.js";import{H as l,Q as L,S as x}from"./chunk-RMOOROEO.js";import{H as g,S as u}from"./chunk-ZP7G4HN4.js";import{a as o}from"./chunk-W3WDPWBE.js";import{h as m,p as A}from"./chunk-43GG6PFR.js";import{b}from"./chunk-MLSR6YE6.js";import{b as f,s as h,u as I}from"./chunk-3DV77WOO.js";import{a as d,b as S,g as c}from"./chunk-3T7TAUC2.js";var v,p=v=class extends x{constructor(e){super(e),this.type="none"}clone(){return new v({type:this.type})}};o([$({none:"none",stayAbove:"stay-above"})],p.prototype,"type",void 0),p=v=o([u("esri.ground.NavigationConstraint")],p);var w,s=w=class extends L(O){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new N;let r=t=>{t.parent&&t.parent!==this&&"remove"in t.parent&&t.parent.remove(t),t.parent=this,t.type!=="elevation"&&t.type!=="base-elevation"&&h.getLogger(this).error(`Layer '${t.title}, id:${t.id}' of type '${t.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=t=>{t.parent=null};this.addHandles([this.layers.on("after-add",t=>r(t.item)),this.layers.on("after-remove",t=>i(t.item))])}initialize(){this.when().catch(e=>{A(e)||h.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){let e=this.layers.removeAll();for(let r of e)b(r);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=d({},e)).resourceInfo),e}set layers(e){this._set("layers",_(e,this._get("layers")))}writeLayers(e,r,i,t){let a=[];e&&(t=S(d({},t),{layerContainerType:"ground"}),e.forEach(n=>{if("write"in n){let y={};j(n)().write(y,t)&&a.push(y)}else t?.messages&&t.messages.push(new I("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),r.layers=a}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return E(this,e=>{e(this.layers)})}queryElevation(e,r){return c(this,null,function*(){yield this.load({signal:r?.signal});let{ElevationQuery:i}=yield import("./chunk-EJU5KMGV.js");m(r);let t=new i,a=this.layers.filter(q).toArray();return t.queryAll(a,e,r)})}createElevationSampler(e,r){return c(this,null,function*(){yield this.load({signal:r?.signal});let{ElevationQuery:i}=yield import("./chunk-EJU5KMGV.js");m(r);let t=new i,a=this.layers.filter(q).toArray();return t.createSamplerAll(a,e,r)})}clone(){let e={opacity:this.opacity,surfaceColor:f(this.surfaceColor),navigationConstraint:f(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new w({resourceInfo:this.resourceInfo}).set(e)}read(e,r){this.resourceInfo||this._set("resourceInfo",{data:e,context:r}),super.read(e,r)}_loadFromSource(e){let r=this.resourceInfo;return r?this._loadLayersFromJSON(r.data,r.context,e):Promise.resolve()}_loadLayersFromJSON(e,r,i){return c(this,null,function*(){let t=r?.origin||"web-scene",a=r?.portal||null,n=r?.url||null,{populateOperationalLayers:y}=yield import("./chunk-VQXZCW2V.js");m(i);let C=[];if(e.layers&&Array.isArray(e.layers)){let z={context:{origin:t,url:n,portal:a,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};C.push(y(this.layers,e.layers,z))}yield Promise.allSettled(C)})}};function G(e){return e&&"createElevationSampler"in e}function q(e){return e.type==="elevation"||G(e)}o([l({json:{read:!1}})],s.prototype,"layers",null),o([T("layers")],s.prototype,"writeLayers",null),o([l({readOnly:!0})],s.prototype,"resourceInfo",void 0),o([l({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:g,read:{reader:P,source:"transparency"},write:{writer:(e,r)=>{r.transparency=J(e)},target:"transparency"}}})],s.prototype,"opacity",void 0),o([l({type:F,json:{type:[g],write:(e,r)=>{r.surfaceColor=e.toJSON().slice(0,3)}}})],s.prototype,"surfaceColor",void 0),o([l({type:p,json:{write:!0}})],s.prototype,"navigationConstraint",void 0),s=w=o([u("esri.Ground")],s);var fe=s;export{fe as a};
