import{a as q}from"./chunk-2DNJOZTY.js";import{a as k}from"./chunk-SPZCBP4U.js";import{a as G}from"./chunk-TH4OZ7JG.js";import"./chunk-PVKVZEHO.js";import{p as j,r as E,v as C}from"./chunk-C3IO7G52.js";import"./chunk-NOUYXRP4.js";import"./chunk-IXJ4GQFR.js";import"./chunk-GHXDYQ3O.js";import"./chunk-ZOOQQO74.js";import"./chunk-NODFFC3X.js";import"./chunk-B7IX6UFG.js";import"./chunk-HUYHDVA2.js";import"./chunk-TNPL7MIN.js";import{a as D}from"./chunk-JOF5BLB6.js";import"./chunk-DDNVXGXG.js";import"./chunk-2TKGGTPN.js";import"./chunk-AC7AQWXQ.js";import"./chunk-37H4LYIE.js";import{B as _}from"./chunk-FVB5KK7E.js";import"./chunk-RDFYI3QE.js";import"./chunk-2E6TO2WI.js";import"./chunk-L3CFPONE.js";import"./chunk-AKHHPLWL.js";import"./chunk-LJMIV7GW.js";import"./chunk-WSHEBM2J.js";import"./chunk-3UBRSNPL.js";import"./chunk-XDRSKFBJ.js";import"./chunk-MGUWZFOE.js";import"./chunk-6KRFVLII.js";import"./chunk-ZGGYJV33.js";import"./chunk-63TUJPJR.js";import"./chunk-J57HR4DB.js";import"./chunk-H5CKPFSK.js";import"./chunk-K6KBTDPE.js";import"./chunk-6A4M7X3R.js";import"./chunk-LDBOA2H7.js";import"./chunk-DFTBSFIN.js";import"./chunk-WOZZR3L4.js";import"./chunk-LW5IAFEX.js";import{a as H,b as z}from"./chunk-AQ74ANSJ.js";import"./chunk-R2K3CL3U.js";import"./chunk-SAOUSUZE.js";import"./chunk-VNBPSOCW.js";import"./chunk-CPGZIEVH.js";import"./chunk-L2DEVDHE.js";import"./chunk-Z5Q76SB7.js";import"./chunk-RU7UW4IO.js";import"./chunk-5QLB7ZJ7.js";import"./chunk-2ETW6ZBA.js";import"./chunk-6K7P7RRW.js";import"./chunk-7LRMKXZV.js";import"./chunk-BCREO4Q5.js";import"./chunk-E5R4OI7X.js";import"./chunk-BNUHB4AP.js";import"./chunk-ZGLJFDS6.js";import"./chunk-RSDQHAJX.js";import"./chunk-PSYXGXKI.js";import"./chunk-Q6TYOK45.js";import"./chunk-QMDBAMTG.js";import"./chunk-RZA5H63B.js";import"./chunk-Y4PMIX35.js";import"./chunk-KVCIO4DX.js";import"./chunk-NWBXT4EB.js";import"./chunk-WBI2AIMN.js";import"./chunk-FKQYBEPG.js";import"./chunk-ZHAVTBSG.js";import"./chunk-SBO2F6VY.js";import"./chunk-MMYIAMQR.js";import"./chunk-UHTPPTOJ.js";import"./chunk-LP5GLSKB.js";import"./chunk-LTDZH3EN.js";import"./chunk-3SBMUUA6.js";import"./chunk-II7TJXWX.js";import"./chunk-X7Z55FTO.js";import"./chunk-B66V4PSA.js";import"./chunk-A4HCVMB4.js";import"./chunk-AANS6QE5.js";import"./chunk-RMOOROEO.js";import"./chunk-ZP7G4HN4.js";import"./chunk-W3WDPWBE.js";import"./chunk-43GG6PFR.js";import"./chunk-MLSR6YE6.js";import"./chunk-JPDAKIWT.js";import"./chunk-D62JNIRP.js";import"./chunk-VU5W7W6Y.js";import"./chunk-3DV77WOO.js";import"./chunk-NJG4JJ4L.js";import{g as P}from"./chunk-3T7TAUC2.js";var $=96/72,F=class{constructor(a){this._spatialReference=a,this._imageDataCanvas=null,this._cimResourceManager=new q}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}rasterizeCIMSymbolAsync(a,m,r,n,t,i,l,y,b){return P(this,null,function*(){if(!a)return null;let{data:f}=a;if(!f||f.type!=="CIMSymbolReference"||!f.symbol)return null;let{symbol:I}=f;i||(i=_(I));let c=yield D.resolveSymbolOverrides(f,m,this._spatialReference,t,i,l,y),u=this._cimResourceManager,g=[];C.fetchResources(c,u,g),C.fetchFonts(c,u,g),g.length>0&&(yield Promise.all(g));let{width:o,height:s}=r,S=V(i,o,s,n),e=C.getEnvelope(c,S,u);if(!e)return null;let h=1,v=0,x=0;switch(I.type){case"CIMPointSymbol":case"CIMTextSymbol":{let d=1;e.width>o&&(d=o/e.width);let M=1;e.height>s&&(M=s/e.height),n==="preview"&&(e.width<o&&(d=o/e.width),e.height<s&&(M=s/e.height)),h=Math.min(d,M),v=e.x+e.width/2,x=e.y+e.height/2}break;case"CIMLineSymbol":{(b||e.height>s)&&(h=s/e.height),x=e.y+e.height/2;let d=e.x*h+o/2,M=(e.x+e.width)*h+o/2,{paths:R}=S;R[0][0][0]-=d/h,R[0][2][0]-=(M-o)/h}break;case"CIMPolygonSymbol":{v=e.x+e.width/2,x=e.y+e.height/2;let d=e.x*h+o/2,M=(e.x+e.width)*h+o/2,R=e.y*h+s/2,T=(e.y+e.height)*h+s/2,{rings:w}=S;d<0&&(w[0][0][0]-=d,w[0][3][0]-=d,w[0][4][0]-=d),R<0&&(w[0][0][1]+=R,w[0][1][1]+=R,w[0][4][1]+=R),M>o&&(w[0][1][0]-=M-o,w[0][2][0]-=M-o),T>s&&(w[0][2][1]+=T-s,w[0][3][1]+=T-s)}}let W={type:"cim",data:{type:"CIMSymbolReference",symbol:c}};return this.rasterize(W,o,s,v,x,h,i,1,S)})}rasterize(a,m,r,n,t,i,l,y=0,b=null){let{data:f}=a;if(!f||f.type!=="CIMSymbolReference"||!f.symbol)return null;let{symbol:I}=f,c=this._canvas,u=(window.devicePixelRatio||1)*$;c.width=m*u,c.height=r*u,l||(l=_(I)),b||(b=V(l,m,r,"legend")),c.width+=2*y,c.height+=2*y;let g=c.getContext("2d",{willReadFrequently:!0}),o=j.createIdentity();return o.translate(-n,-t),o.scale(i*u,-i*u),o.translate(m*u/2+y,r*u/2+y),g.clearRect(0,0,c.width,c.height),new E(g,this._cimResourceManager,o,!0).drawSymbol(I,b),g.getImageData(0,0,c.width,c.height)}};function V(p,a,m,r){let t=-a/2+1,i=a/2-1,l=m/2-1,y=-m/2+1;switch(p){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[t,0],[0,0],[i,0]]]};default:return r==="legend"?{rings:[[[t,l],[i,0],[i,y],[t,y],[t,l]]]}:{rings:[[[t,l],[i,l],[i,y],[t,y],[t,l]]]}}}var O=new F(null),L=z(G.size),A=z(G.maxSize),U=z(G.lineWidth),B=1;function J(p,a,m){return P(this,null,function*(){let r=a?.size,n=r!=null&&typeof r=="object"&&"width"in r?r.width:r,t=r!=null&&typeof r=="object"&&"height"in r?r.height:r;if(n==null||t==null)if(m==="esriGeometryPolygon")n=L,t=L;else{let i=yield K(p,a,m);i&&(n=i.width,t=i.height),m==="esriGeometryPolyline"&&(n=U),n=n!=null&&isFinite(n)?Math.min(n,A):L,t=t!=null&&isFinite(t)?Math.max(Math.min(t,A),B):L}return a.style==="legend"&&m==="esriGeometryPolyline"&&(n=U),{width:n,height:t}})}function K(p,a,m){return P(this,null,function*(){let{feature:r,fieldMap:n,viewParams:t}=a.cimOptions||a,i=yield D.resolveSymbolOverrides(p.data,r,null,n,m,null,t);if(!i)return null;(p=p.clone()).data={type:"CIMSymbolReference",symbol:i},p.data.primitiveOverrides=void 0;let l=[];return C.fetchResources(i,O.resourceManager,l),C.fetchFonts(i,O.resourceManager,l),l.length>0&&(yield Promise.all(l)),C.getEnvelope(i,null,O.resourceManager)})}function he(m){return P(this,arguments,function*(p,a={}){let{node:r,opacity:n,symbolConfig:t}=a,i=t!=null&&typeof t=="object"&&"isSquareFill"in t&&t.isSquareFill,l=a.cimOptions||a,y=l.geometryType||_(p?.data?.symbol),b=yield J(p,a,y),{feature:f,fieldMap:I}=l,c=i||y!=="esriGeometryPolygon"?"preview":"legend",u=yield O.rasterizeCIMSymbolAsync(p,f,b,c,I,y,null,l.viewParams,l.allowScalingUp);if(!u)return null;let{width:g,height:o}=u,s=document.createElement("canvas");s.width=g,s.height=o,s.getContext("2d").putImageData(u,0,0);let S=H(b.width),e=H(b.height),h=new Image(S,e);h.src=s.toDataURL(),h.ariaLabel=a.ariaLabel??null,h.alt=a.ariaLabel??"",n!=null&&(h.style.opacity=`${n}`);let v=h;if(a.effectView!=null){let x={shape:{type:"image",x:0,y:0,width:S,height:e,src:h.src},fill:null,stroke:null,offset:[0,0]};v=k([[x]],[S,e],{effectView:a.effectView,ariaLabel:a.ariaLabel})}return r&&v&&r.appendChild(v),v})}export{he as previewCIMSymbol};
