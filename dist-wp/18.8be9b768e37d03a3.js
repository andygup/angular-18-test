"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[18],{40018:(Fn,Mn,T)=>{T.d(Mn,{DO:()=>kn,FT:()=>C,Hh:()=>Gn,OM:()=>tn,Ps:()=>In,Wo:()=>Q,_I:()=>Z,_l:()=>nn,dK:()=>Bn,eh:()=>yn,l0:()=>Ln,t$:()=>Dn,uk:()=>Cn,vI:()=>cn,xh:()=>J});var Y,n,Pn=T(10467),Rn=(T(21152),T(89952)),En=T(5922),W=T(82663),E=T(33658),G=T(11817),wn=T(58701),D=T(28067),b=T(1749),an=T(55861),Sn=T(32034);function J(n,t,i){return!(0,G.canProjectWithoutEngine)(n,t,i)}function j(n,t,i){const s=J(n,t,i);if(s&&!(0,G.isLoaded)())throw new En.A("rasterprojectionhelper-project","projection engine is not loaded");return s}(n=Y||(Y={}))[n.None=0]="None",n[n.North=1]="North",n[n.South=2]="South",n[n.Both=3]="Both";const ln=(n,t,i,s=0)=>{if(1===i[0])return[0,0];let r=1,e=-1,o=1,f=-1;for(let x=0;x<n.length;x+=2)isNaN(n[x])||(r=r>n[x]?n[x]:r,e=e>n[x]?e:n[x],o=o>n[x+1]?n[x+1]:o,f=f>n[x+1]?f:n[x+1]);const{cols:l,rows:a}=t,c=(e-r)/l/i[0],_=(f-o)/a/i[1],y=2*s;let u=0,m=!1,p=[0,0];for(let x=0;x<l-3;x++){for(let M=0;M<a-3;M++){const h=x*a*2+2*M,d=(n[h+1]+n[h+5]+n[h+4*a+1]+n[h+4*a+5])/4,P=Math.abs(((n[h]+n[h+4]+n[h+4*a]+n[h+4*a+4])/4-n[h+2*a+2])/c),R=Math.abs((d-n[h+2*a+3])/_);if(P+R>u&&(u=P+R,p=[P,R]),y&&u>y){m=!0;break}}if(m)break}return p},An={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},z=32,U=4,X=U,H=new Map,V=new Map,K=500;function Gn(){return $.apply(this,arguments)}function $(){return($=(0,Pn.A)(function*(){(0,G.isLoaded)()||(yield(0,G.load)())})).apply(this,arguments)}function cn(n,t,i){return j(n.spatialReference,t),i?(0,G.getTransformation)(t,n.spatialReference,n):(0,G.getTransformation)(n.spatialReference,t,n)}function Q(n,t,i,s=null){const r=n.spatialReference;if(r.equals(t))return n;j(r,t,s);const e=i.center,o=new D.A({xmin:e.x-n.x/2,xmax:e.x+n.x/2,ymin:e.y-n.y/2,ymax:e.y+n.y/2,spatialReference:r}),f=(0,G.project)(o,t,s),l=C(t);let a;if(null==f||null!=l&&f.width>=l){const c=(0,W.GA)(r)/(0,W.GA)(t);a={x:n.x*c,y:n.y*c}}else a={x:f.width,y:f.height};return a}function v(n,t=.01){return(0,W.GA)(n)?t/(0,W.GA)(n):0}function Z(n,t,i=null,s=!0){const r=n.spatialReference;if(r.equals(t))return n;j(r,t,i);const e=(0,G.project)(n,t,i);return s&&e&&fn([n],[e],r,t),e}function fn(n,t,i,s){const r=F(i,!0),e=F(s,!0),o=v(i,K),f=v(s,K);if(o&&null!=r&&null!=e)for(let l=0;l<n.length;l++){const a=t[l];if(!a)continue;const{x:c}=n[l],{x:_}=a;_>=e[1]-f&&Math.abs(c-r[0])<o?a.x-=e[1]-e[0]:_<=e[0]+f&&Math.abs(c-r[1])<o&&(a.x+=e[1]-e[0])}}function L(n,t=!1){let i=n.wkid||n.wkt2||n.wkt;if(!i||n.isGeographic)return null;if(i=String(i),H.has(i)){const o=H.get(i);return t?o?.gcs:o?.pcs}const s=n.wkid?E.P.coordsys(n.wkid):E.P.fromString(n.isGeographic?E.a.PE_TYPE_GEOGCS:E.a.PE_TYPE_PROJCS,n.wkt2||n.wkt),r=xn(s,v(n,1e-4)),e=xn(s,0,!0);return H.set(i,{pcs:r,gcs:e}),t?e:r}function xn(n,t=0,i=!1){const s=E.j.generate(n),r=i?n.horizonGcsGenerate():n.horizonPcsGenerate();if(!s||!r?.length)return null;let e=!1,o=r.find(x=>1===x.getInclusive()&&1===x.getKind());if(!o){if(o=r.find(x=>1===x.getInclusive()&&0===x.getKind()),!o)return null;e=!0}const f=i?0:(2===s.getNorthPoleLocation()?1:0)|(2===s.getSouthPoleLocation()?2:0),l=s.isPannableRectangle(),a=o.getCoord();if(e)return{isEnvelope:e,isPannable:l,vertices:a,coef:null,bbox:[a[0][0]-t,a[0][1]-t,a[1][0]+t,a[1][1]+t],poleLocation:f};let c=0;const _=[];let[y,u]=a[0],[m,p]=a[0];for(let x=0,M=a.length;x<M;x++){c++,c===M&&(c=0);const[h,g]=a[x],[d,P]=a[c];if(P===g)_.push([h,d,g,P,2]);else{const R=(d-h)/(P-g||1e-4),N=h-R*g;_.push(g<P?[R,N,g,P,0]:[R,N,P,g,1])}y=y<h?y:h,u=u<g?u:g,m=m>h?m:h,p=p>g?p:g}return{isEnvelope:!1,isPannable:l,vertices:a,coef:_,bbox:[y,u,m,p],poleLocation:f}}function q(n,t){const i=[],{cols:s,rows:r,xres:e,yres:o,usePixelCenter:f}=n;let{xmin:l,ymax:a}=n;if(f&&(l+=e/2,a-=o/2),null==t){for(let u=0;u<s;u++)for(let m=0;m<r;m++)i.push([l+e*u,a-o*m]);return{points:i}}const c=new Uint8Array(s*r);if(t.isEnvelope){const{bbox:[u,m,p,x]}=t;for(let M=0,h=0;M<s;M++){const g=l+e*M,d=t.isPannable||g>=u&&g<=p;for(let P=0;P<r;P++,h++){const R=a-o*P;d&&R>=m&&R<=x&&(i.push([g,R]),c[h]=1)}}return{points:i,mask:c}}const _=t.coef,y=[];for(let u=0;u<r;u++){const m=a-o*u,p=[],x=[];for(let h=0;h<_.length;h++){const[g,d,P,R,N]=_[h];m===P&&P===R?(p.push(g),p.push(d),x.push(2),x.push(2)):m>=P&&m<=R&&(p.push(g*m+d),x.push(N))}let M=p;if(p.length>2){let h=2===x[0]?0:x[0],g=p[0];M=[];for(let d=1;d<x.length;d++)2===x[d]&&d!==x.length-1||(x[d]!==h&&(M.push(0===h?Math.min(g,p[d-1]):Math.max(g,p[d-1])),h=x[d],g=p[d]),d===x.length-1&&M.push(0===x[d]?Math.min(g,p[d]):Math.max(g,p[d])));M.sort((d,P)=>d-P)}else p[0]>p[1]&&(M=[p[1],p[0]]);y.push(M)}for(let u=0,m=0;u<s;u++){const p=l+e*u;for(let x=0;x<r;x++,m++){const M=a-o*x,h=y[x];if(2===h.length)p>=h[0]&&p<=h[1]&&(i.push([p,M]),c[m]=1);else if(h.length>2){let g=!1;for(let d=0;d<h.length;d+=2)if(p>=h[d]&&p<=h[d+1]){g=!0;break}g&&(i.push([p,M]),c[m]=1)}}}return{points:i,mask:c}}function mn(n,t){const i=C(n[0].spatialReference);if(n.length<2||null==i||(t=t??v(n[0].spatialReference),1===(n=n.filter(f=>f.width>t)).length))return n[0];let{xmin:s,xmax:r,ymin:e,ymax:o}=n[0];for(let f=1;f<n.length;f++){const l=n[f];r=l.xmax+i*f,e=Math.min(e,l.ymin),o=Math.max(o,l.ymax)}return new D.A({xmin:s,xmax:r,ymin:e,ymax:o,spatialReference:n[0].spatialReference})}function nn(n,t,i=null,s=!0){const r=n.spatialReference;if(r.equals(t))return n;const e=tn(n),o=C(r,!0),f=C(t);if(0===e||null==o||null==f){const a=hn(n,t,i,s);if(null==o&&null!=f&&Math.abs(a.width-f)<v(t)&&(0,G.isLoaded)()){const c=L(r);if(null!=c&&c.poleLocation===Y.None&&n.width<(c.bbox[2]-c.bbox[0])/2)return function Nn(n,t){const i=C(t);if(null==i)return null;let{xmin:s,ymin:r,xmax:e,ymax:o}=n;const f=n.spatialReference,l=new an.A({spatialReference:f,rings:[[[s,r],[e,r],[e,o],[s,o],[s,r]]]}),a=(0,G.project)(l,t);if(2!==a.rings.length||!a.rings[0].length||!a.rings[1].length)return null;const{rings:c}=a,_=v(f),y=new D.A({spatialReference:t});for(let u=0;u<2;u++){s=e=c[u][0][0],r=o=c[u][0][1];for(let m=0;m<c[u].length;m++)s=s>c[u][m][0]?c[u][m][0]:s,e=e<c[u][m][0]?c[u][m][0]:e,r=r>c[u][m][1]?c[u][m][1]:r,o=o<c[u][m][1]?c[u][m][1]:o;if(0===u)y.ymin=r,y.ymax=o,y.xmin=s,y.xmax=e;else if(y.ymin=Math.min(y.ymin,r),y.ymax=Math.max(y.ymax,o),Math.abs(e-i/2)<_)y.xmin=s,y.xmax=y.xmax+i;else{if(!(Math.abs(s+i/2)<_))return null;y.xmax=e+i}}return y}(n,t)||a}return a}const l=n.clone().normalize();if(1===l.length&&n.xmax<o&&n.xmax-o/2>v(r)){const{xmin:a,xmax:c}=n;for(let _=0;_<=e;_++)l[_]=new D.A({xmin:0===_?a:-o/2,xmax:_===e?c-o*_:o/2,ymin:n.ymin,ymax:n.ymax,spatialReference:r})}return mn(l.map(a=>hn(a,t,i,s)).filter(Rn.Ru))}function Cn(n,t,i){if("extent"===n.type){const{xmin:s,ymin:r,xmax:e,ymax:o,spatialReference:f}=n;n=new an.A({rings:[[[s,o],[e,o],[e,r],[s,r],[s,o]]],spatialReference:f})}return n.spatialReference.equals(t)?n:(j(n.spatialReference,t,i),(0,G.project)(n,t,i))}function hn(n,t,i=null,s=!0,r=!0){const e=n.spatialReference;if(e.equals(t)||!t)return n;j(e,t,i);const o=(0,G.project)(n,t,i);if(r&&t.isWebMercator&&o&&(o.ymax=Math.min(20037508.342787,o.ymax),o.ymin=Math.max(-20037508.342787,o.ymin),o.ymin>=o.ymax))return null;if(!s||!o)return o;const f=F(e,!0),l=F(t,!0);if(null==f||null==l)return o;const a=v(e,.001),c=v(e,K),_=v(t,.001);if(Math.abs(o.xmin-l[0])<_&&Math.abs(o.xmax-l[1])<_){const y=Math.abs(n.xmin-f[0]),u=Math.abs(f[1]-n.xmax);if(y<a&&u>c){o.xmin=l[0];const m=[];m.push(new b.A(n.xmax,n.ymin,e)),m.push(new b.A(n.xmax,(n.ymin+n.ymax)/2,e)),m.push(new b.A(n.xmax,n.ymax,e));const p=m.map(x=>Z(x,t,i)).filter(x=>!isNaN(x?.x)).map(x=>x.x);o.xmax=Math.max.apply(null,p)}if(u<a&&y>c){o.xmax=l[1];const m=[];m.push(new b.A(n.xmin,n.ymin,e)),m.push(new b.A(n.xmin,(n.ymin+n.ymax)/2,e)),m.push(new b.A(n.xmin,n.ymax,e));const p=m.map(x=>Z(x,t,i)).filter(x=>!isNaN(x?.x)).map(x=>x.x);o.xmin=Math.min.apply(null,p)}}else{const y=v(t,.001);Math.abs(o.xmin-l[0])<y&&(o.xmin=l[0]),Math.abs(o.xmax-l[1])<y&&(o.xmax=l[1])}return o}function C(n,t=!1){return n?n.isWebMercator?2*(t?20037508.342787:20037508.342788905):n.wkid&&n.isGeographic?360:2*An[n.wkid]||null:null}function F(n,t=!1){if(n.isGeographic)return[-180,180];const i=C(n,t);return null!=i?[-i/2,i/2]:null}function pn(n,t,i,s){let r=(n-t)/i;return r-Math.floor(r)!=0?r=Math.floor(r):s&&(r-=1),r}function tn(n,t=!1){const i=C(n.spatialReference);if(null==i)return 0;const s=t?0:-i/2,r=v(n.spatialReference),e=!t&&Math.abs(n.xmax-i/2)<r?i/2:n.xmax,o=!t&&Math.abs(n.xmin+i/2)<r?-i/2:n.xmin;return pn(e,s,i,!0)-pn(o,s,i,!1)}function kn(n){const t=n.storageInfo.origin.x,i=C(n.spatialReference,!0);if(null==i)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const s=i/2,{nativePixelSize:r,storageInfo:e,extent:o}=n,{maximumPyramidLevel:f,blockWidth:l,pyramidScalingFactor:a}=e;let c=r.x;const _=[],y=null!=n.transform&&"gcs-shift"===n.transform.type,u=t+(y?0:s),m=y?i-t:s-t;for(let p=0;p<=f;p++){const x=(o.xmax-t)/c/l,M=x-Math.floor(x)==0?x:Math.ceil(x),h=m/c/l,g=h-Math.floor(h)==0?h:Math.ceil(h),d=Math.floor(u/c/l),P=Math.round(u/c)%l,R=(l-Math.round(m/c)%l)%l;_.push({resolutionX:c,blockWidth:l,datasetColumnCount:M,worldColumnCountFromOrigin:g,leftMargin:P,rightPadding:R,originColumnOffset:d}),c*=a}return{originX:t,halfWorldWidth:s,pyramidsInfo:_,hasGCSSShiftTransform:y}}function Ln(n){const t=n.isAdaptive&&null==n.spacing;let i=n.spacing||[z,z],s=en(n),r={cols:s.size[0]+1,rows:s.size[1]+1};const e=s.outofBoundPointCount>0&&s.outofBoundPointCount<s.offsets.length/2;let o=s.outofBoundPointCount===s.offsets.length/2||t&&e?[0,0]:ln(s.offsets,r,i,X);const l=n.projectedExtent.spatialReference,a=n.srcBufferExtent.spatialReference;if(t&&(e||(o[0]+o[1])/2>X)&&(J(l,a,n.datumTransformation)&&(l.isGeographic||L(l)),i=[U,U],s=en({...n,spacing:i}),r={cols:s.size[0]+1,rows:s.size[1]+1},o=ln(s.offsets,r,i,X)),s.error=o,i[0]>1&&(s.coefficients=gn(s.offsets,r,e)),n.includeGCSGrid&&!l.isGeographic&&!l.isWebMercator)if(a.isGeographic)s.gcsGrid={offsets:s.offsets,coefficients:s.coefficients,spacing:i};else{const c=L(l);if(null!=c&&!c.isEnvelope){const _=function jn(n){if(!n||n.isGeographic)return n;const t=String(n.wkid||n.wkt2||n.wkt);let i;return V.has(t)?i=V.get(t):(i=(n.wkid?E.P.coordsys(n.wkid):E.P.fromString(E.a.PE_TYPE_PROJCS,n.wkt2||n.wkt)).getGeogcs().getCode(),V.set(t,i)),new Sn.A({wkid:i})}(l),y=nn(n.projectedExtent,_),{offsets:u}=en({...n,srcBufferExtent:y,spacing:i}),m=gn(u,r,e);s.gcsGrid={offsets:u,coefficients:m,spacing:i}}}return s}function en(n){const{projectedExtent:t,srcBufferExtent:i,pixelSize:s,datumTransformation:r,rasterTransform:e}=n,o=t.spatialReference,f=i.spatialReference,l=j(o,f),{xmin:a,ymin:c,xmax:_,ymax:y}=t,u=C(f),m=null!=u&&(n.hasWrapAround||"gcs-shift"===e?.type),p=n.spacing||[z,z],x=p[0]*s.x,M=p[1]*s.y,h=1===p[0],g=Math.ceil((_-a)/x-.1/p[0])+(h?0:1),d=Math.ceil((y-c)/M-.1/p[1])+(h?0:1),P=function Tn(n){const{inSR:t,outSR:i,datumTransformation:s,preferPE:r}=n;if(t.equals(i)){const{points:e}=q(n,null);return e}return t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator?function vn(n){const{cols:t,rows:i,xres:s,yres:r,usePixelCenter:e,inSR:o,outSR:f}=n;let{xmin:l,ymax:a}=n;e&&(l+=s/2,a-=r/2);const c=[],_=[],y=Math.max(t,i);for(let m=0;m<y;m++){const p=l+s*Math.min(t,m),x=a-r*Math.min(i,m),M=(0,G.project)(new b.A({x:p,y:x,spatialReference:o}),f);m<=t&&c.push(M.x),m<=i&&_.push(M.y)}const u=[];for(let m=0;m<t;m++)for(let p=0;p<i;p++)u.push([c[m],_[p]]);return u}(n):j(t,i,s)&&r&&(t.isGeographic||null!=L(t))?function un(n){const{inSR:t,outSR:i,datumTransformation:s}=n,r=L(t),{points:e,mask:o}=q(n,r);if(!t.isGeographic){const l=t.wkid?E.P.coordsys(t.wkid):E.P.fromString(t.isGeographic?E.a.PE_TYPE_GEOGCS:E.a.PE_TYPE_PROJCS,t.wkt2||t.wkt);E.g.projToGeog(l,e.length,e)}if(null!=s&&s.steps.length){let l;if(i.isGeographic&&(l=e.map(([c])=>c>179.9955?1:c<-179.9955?-1:0)),s.steps.forEach(c=>{const _=c.wkid?E.P.geogtran(c.wkid):E.P.fromString(E.a.PE_TYPE_GEOGTRAN,c.wkt);E.h.geogToGeog(_,e.length,e,null,c.isInverse?E.a.PE_TRANSFORM_2_TO_1:E.a.PE_TRANSFORM_1_TO_2)}),l)for(let c=0;c<e.length;c++){const _=l[c],y=e[c][0],u=y>179.9955?1:y<-179.9955?-1:0;_&&u&&_!==u&&(e[c][0]=_>0?y+360:y-360)}}if(!i.isGeographic){const l=L(i,!0);!function On(n,t){const[i,s]=t;for(let r=0;r<n.length;r++){const e=n[r][1];(e<i||e>s)&&(n[r]=[NaN,NaN])}}(e,null!=l&&l.isEnvelope?[l.bbox[1],l.bbox[3]]:[-90,90]);const c=i.wkid?E.P.coordsys(i.wkid):E.P.fromString(i.isGeographic?E.a.PE_TYPE_GEOGCS:E.a.PE_TYPE_PROJCS,i.wkt2||i.wkt);E.g.geogToProj(c,e.length,e)}let f=e;if(o&&e.length!==o.length){f=[];for(let l=0,a=0;l<o.length;l++)f.push(o[l]?e[a++]:[NaN,NaN])}return f}(n):function bn(n){const{points:t}=q(n,null),{inSR:i,outSR:s,datumTransformation:r}=n,e=t.map(f=>new b.A(f[0],f[1],i)),o=(0,G.project)(e,s,r);return r&&fn(e,o,i,s),o.map(f=>f?[f.x,f.y]:[NaN,NaN])}(n)}({cols:g,rows:d,xmin:a,ymax:y,xres:x,yres:M,inSR:o,outSR:f,datumTransformation:r,preferPE:p[0]<=U,usePixelCenter:h}),R=[];let N,I=0;const w=h?-1:NaN,{xmin:A,xmax:O,ymax:on,width:sn,height:zn}=i,Un=v(f,K),Kn=null!=u&&A>0&&O>u/2;let dn=!1;if(l){const k=L(o);dn=null!=k&&k.poleLocation>0}for(let k=0;k<g;k++){const rn=[];for(let B=0;B<d;B++){let S=P[k*d+B];if(m&&S[0]>O&&S[0]>u/2-Un?S[0]-=u:m&&0===k&&S[0]<0&&Kn&&!e&&(S[0]+=u),!S||isNaN(S[0])||isNaN(S[1]))R.push(w),R.push(w),rn.push(null),I++;else{if(e){const _n=e.inverseTransform(new b.A({x:S[0],y:S[1],spatialReference:f}));S=[_n.x,_n.y]}rn.push(S),k>0&&m&&N[B]&&S[0]<N[B][0]&&(S[0]+=u,dn&&S[0]>O&&S[0]>u&&(S[0]-=u)),R.push((S[0]-A)/sn),R.push((on-S[1])/zn)}}N=rn}return{offsets:R,error:null,coefficients:null,outofBoundPointCount:I,spacing:p,size:h?[g,d]:[g-1,d-1]}}function gn(n,t,i){const{cols:s,rows:r}=t,e=new Float32Array((s-1)*(r-1)*2*6),o=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),f=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<s-1;l++){for(let a=0;a<r-1;a++){let c=l*r*2+2*a;const _=n[c],y=n[c+1],u=n[c+2],m=n[c+3];c+=2*r;const p=n[c],x=n[c+1],M=n[c+2],h=n[c+3];let g=0,d=12*(a*(s-1)+l);for(let P=0;P<3;P++)e[d++]=o[g++]*_+o[g++]*u+o[g++]*M;g=0;for(let P=0;P<3;P++)e[d++]=o[g++]*y+o[g++]*m+o[g++]*h;g=0;for(let P=0;P<3;P++)e[d++]=f[g++]*_+f[g++]*p+f[g++]*M;g=0;for(let P=0;P<3;P++)e[d++]=f[g++]*y+f[g++]*x+f[g++]*h}if(i)for(let a=0;a<e.length;a++)isNaN(e[a])&&(e[a]=-1)}return e}function In(n){const{spatialReference:t}=n,i=(0,wn.Vp)(t);if(!i)return n;const[s,r]=i.valid,e=r-s;let o=0;return n.xmin<s?o=Math.ceil((s-n.xmin)/e):n.xmin>r&&(o=-Math.ceil((n.xmin-r)/e)),new D.A({spatialReference:n.spatialReference,xmin:n.xmin+o*e,ymin:n.ymin,xmax:n.xmax+o*e,ymax:n.ymax})}function Dn(n,t,i){const{storageInfo:s,pixelSize:r}=t;let e=0,o=!1;const{pyramidResolutions:f}=s,l="mixed"===s.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,s.tileInfo.dpi/96)):1,a=(n.x+n.y)/2/l;if(null!=f&&f.length){const m=f[f.length-1],p=(m.x+m.y)/2,x=(r.x+r.y)/2;if(a<=x)e=0;else if(a>=p)e=f.length,o=a/p>8;else{let h,g=x;for(let d=1;d<=f.length;d++){if(h=(f[d-1].x+f[d-1].y)/2,a<=h){a===h?e=d:"down"===i?(e=d-1,o=a/g>8):e="up"===i||a-g>h-a||a/g>2?d:d-1;break}g=h}}const M=0===e?r:f[e-1];return o&&Math.min(M.x,M.y)*(0,W.GA)(t.spatialReference)>19567&&(o=!1),{pyramidLevel:e,pyramidResolution:new b.A({x:M.x,y:M.y,spatialReference:t.spatialReference}),excessiveReading:o}}const c=Math.log(n.x/r.x)/Math.LN2,_=Math.log(n.y/r.y)/Math.LN2,y=t.storageInfo.maximumPyramidLevel||0;e="down"===i?Math.floor(Math.min(c,_)):"up"===i?Math.ceil(Math.max(c,_)):Math.round((c+_)/2),e<0?e=0:e>y&&(o=e>y+3,e=y);const u=2**e;return{pyramidLevel:e,pyramidResolution:new b.A({x:u*t.nativePixelSize.x,y:u*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}function yn(n,t){const{pixelSize:i,extent:s}=n,r=cn(s,t,!1);return nn(function Wn(n,t){const i=n.clone().normalize();return 1===i.length?i[0]:mn(i,t)}(s,(i.x+i.y)/16),t,r)}function Bn(n,t,i){const s=i?.tileSize??512,r=i?.alignGlobalDatasetWithAGOL??!0,e=!!i?.limitToSrcResolution,{extent:o,spatialReference:f,pixelSize:l}=n,a=Q(new b.A({x:l.x,y:l.y,spatialReference:f}),t,o);if(null==a)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const c=(a.x+a.y)/2,_=(0,W.GA)(t),y=c*_*96*39.37,u=t.isGeographic?256/s*295828763.7958547:256/s*591657527.591555;let m="vector-magdir"===n.dataType||"vector-uv"===n.dataType;const p=yn(n,t),x=Math.min(Math.ceil(Math.log(Math.min(n.width,n.height)/32)/Math.LN2),Math.ceil(Math.log(u/2/y)/Math.LN2));if(!m&&r&&(t.isGeographic||t.isWebMercator)){const w=C(t);if(m=tn(p)>0||null!=w&&p.width>w/4,!m&&null!=w){let A=-1;if(x<3)A=2**x*c*s;else if(n.storageInfo){const{maximumPyramidLevel:on=0,pyramidScalingFactor:sn=2}=n.storageInfo;A=sn**on*c*s}const O=Math.ceil(w/A);m=1===O||2===O&&w/2-p.xmax<A}}let M,h=y;const g=1.001,d=Math.min(2,Math.max(1.414,n.storageInfo?.pyramidScalingFactor||2));if(m){h=u;const w=t.isGeographic?1341104507446289e-21:.29858214164761665,A=w*(96*_*39.37);M=Q(new b.A({x:w,y:w,spatialReference:{wkid:t.isGeographic?4326:3857}}),f,p),M.x*=h/A,M.y*=h/A}else{M={x:l.x,y:l.y};let w=0;for(;h<u*(g/2)&&w<x;)w++,h*=d,M.x*=d,M.y*=d;Math.max(h,u)/Math.min(h,u)<=g&&(h=u)}const P=[h],R=[{x:M.x,y:M.y}],I=Math.min(70.5310735,y)/g;for(;h>=I;)h/=d,M.x/=d,M.y/=d,P.push(h),R.push({x:M.x,y:M.y});if(e){const w=.001*l.x;let A=R.findIndex(O=>O.x>=l.x-w&&O.x<=l.x+w);A>-1?(R.length=A+1,P.length=A+1):(A=R.findIndex(O=>O.x<=l.x+w),A>0&&(R.length=A,P.length=A))}return{projectedPixelSize:a,scales:P,srcResolutions:R,isCustomTilingScheme:!m}}}}]);