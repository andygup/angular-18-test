"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[9424],{28250:(re,Q,h)=>{function T(l){return null!=j(l)||null!=U(l)}function J(l){return P.test(l)}function L(l){return j(l)??U(l)}function U(l){const I=new Date(l);return function W(l,I){if(Number.isNaN(l.getTime()))return!1;let _=!0;if(O&&/\d+\W*$/.test(I)){const b=I.match(/[a-zA-Z]{2,}/);if(b){let o=!1,d=0;for(;!o&&d<=b.length;)o=!z.test(b[d]),d++;_=!o}}return _}(I,l)?Number.isNaN(I.getTime())?null:I.getTime()-6e4*I.getTimezoneOffset():null}function j(l){const I=P.exec(l);if(!I?.groups)return null;const _=I.groups,b=+_.year,o=+_.month-1,d=+_.day,B=+(_.hours??"0"),N=+(_.minutes??"0"),X=+(_.seconds??"0");if(B>23||N>59||X>59)return null;const V=_.ms??"0",H=V?+V.padEnd(3,"0").substring(0,3):0;let w;return w=_.isUTC||!_.offsetSign?Date.UTC(b,o,d,B,N,X,H):6e4*("+"===_.offsetSign?-1:1)*(60*+_.offsetHours+ +_.offsetMinutes)+Date.UTC(b,o,d,B,N,X,H),Number.isNaN(w)?null:w}h.d(Q,{Br:()=>J,Cq:()=>T,_U:()=>L});const P=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/,z=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,O=!Number.isNaN(new Date("technology 10").getTime())},3567:(re,Q,h)=>{h.d(Q,{w:()=>j});var T=h(89952),L=(h(3248),h(12438)),U=h(17694);class j{constructor(e=9,s){this._compareMinX=_,this._compareMinY=b,this._toBBox=i=>i,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),s&&("function"==typeof s?this._toBBox=s:this._initFormat(s)),this.clear()}destroy(){this.clear(),w.prune(),ee.prune(),R.prune(),se.prune()}all(e){W(this._data,e)}search(e,s){let i=this._data;const f=this._toBBox;if(V(e,i))for(w.clear();i;){for(let u=0,y=i.children.length;u<y;u++){const E=i.children[u],F=i.leaf?f(E):E;V(e,F)&&(i.leaf?s(E):X(e,F)?W(E,s):w.push(E))}i=w.pop()}}collides(e){let s=this._data;const i=this._toBBox;if(!V(e,s))return!1;for(w.clear();s;){for(let f=0,u=s.children.length;f<u;f++){const y=s.children[f],E=s.leaf?i(y):y;if(V(e,E)){if(s.leaf||X(e,E))return!0;w.push(y)}}s=w.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let i=0,f=e.length;i<f;i++)this.insert(e[i]);return this}let s=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===s.height)this._splitRoot(this._data,s);else{if(this._data.height<s.height){const i=this._data;this._data=s,s=i}this._insert(s,this._data.height-s.height-1,!0)}else this._data=s;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new te([]),this}remove(e){if(!e)return this;let s,i=this._data,f=null,u=0,y=!1;const E=this._toBBox(e);for(R.clear(),se.clear();i||R.length>0;){if(i||(i=R.pop(),f=R.data[R.length-1],u=se.pop()??0,y=!0),i.leaf&&(s=(0,T.qh)(i.children,e,i.children.length,i.indexHint),-1!==s))return i.children.splice(s,1),R.push(i),this._condense(R),this;y||i.leaf||!X(i,E)?f?(u++,i=f.children[u],y=!1):i=null:(R.push(i),se.push(u),u=0,f=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,s,i,f){const u=i-s+1;let y=this._maxEntries;if(u<=y){const A=new te(e.slice(s,i+1));return O(A,this._toBBox),A}f||(f=Math.ceil(Math.log(u)/Math.log(y)),y=Math.ceil(u/y**(f-1)));const E=new ae([]);E.height=f;const F=Math.ceil(u/y),C=F*Math.ceil(Math.sqrt(y));H(e,s,i,C,this._compareMinX);for(let A=s;A<=i;A+=C){const Y=Math.min(A+C-1,i);H(e,A,Y,F,this._compareMinY);for(let ne=A;ne<=Y;ne+=F){const ue=Math.min(ne+F-1,Y);E.children.push(this._build(e,ne,ue,f-1))}}return O(E,this._toBBox),E}_insert(e,s,i){const u=i?e:(0,this._toBBox)(e);R.clear();const y=function P(a,e,s,i){for(;i.push(e),!0!==e.leaf&&i.length-1!==s;){let f,u=1/0,y=1/0;for(let E=0,F=e.children.length;E<F;E++){const C=e.children[E],A=o(C),Y=B(a,C)-A;Y<y?(y=Y,u=A<u?A:u,f=C):Y===y&&A<u&&(u=A,f=C)}e=f||e.children[0]}return e}(u,this._data,s,R);for(y.children.push(e),I(y,u);s>=0&&R.data[s].children.length>this._maxEntries;)this._split(R,s),s--;!function z(a,e,s){for(let i=s;i>=0;i--)I(e.data[i],a)}(u,R,s)}_split(e,s){const i=e.data[s],f=i.children.length,u=this._minEntries;this._chooseSplitAxis(i,u,f);const y=this._chooseSplitIndex(i,u,f);if(!y)return;const E=i.children.splice(y,i.children.length-y),F=i.leaf?new te(E):new ae(E);F.height=i.height,O(i,this._toBBox),O(F,this._toBBox),s?e.data[s-1].children.push(F):this._splitRoot(i,F)}_splitRoot(e,s){this._data=new ae([e,s]),this._data.height=e.height+1,O(this._data,this._toBBox)}_chooseSplitIndex(e,s,i){let f,u,y;f=u=1/0;for(let E=s;E<=i-s;E++){const F=l(e,0,E,this._toBBox),C=l(e,E,i,this._toBBox),A=N(F,C),Y=o(F)+o(C);A<f?(f=A,y=E,u=Y<u?Y:u):A===f&&Y<u&&(u=Y,y=E)}return y}_chooseSplitAxis(e,s,i){const f=e.leaf?this._compareMinX:_,u=e.leaf?this._compareMinY:b;this._allDistMargin(e,s,i,f)<this._allDistMargin(e,s,i,u)&&e.children.sort(f)}_allDistMargin(e,s,i,f){e.children.sort(f);const u=this._toBBox,y=l(e,0,s,u),E=l(e,i-s,i,u);let F=d(y)+d(E);for(let C=s;C<i-s;C++){const A=e.children[C];I(y,e.leaf?u(A):A),F+=d(y)}for(let C=i-s-1;C>=s;C--){const A=e.children[C];I(E,e.leaf?u(A):A),F+=d(E)}return F}_condense(e){for(let s=e.length-1;s>=0;s--){const i=e.data[s];if(0===i.children.length)if(s>0){const f=e.data[s-1],u=f.children;u.splice((0,T.qh)(u,i,u.length,f.indexHint),1)}else this.clear();else O(i,this._toBBox)}}_initFormat(e){const s=["return a"," - b",";"];this._compareMinX=new Function("a","b",s.join(e[0])),this._compareMinY=new Function("a","b",s.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function W(a,e){let s=a;for(ee.clear();s;){if(!0===s.leaf)for(const i of s.children)e(i);else ee.pushArray(s.children);s=ee.pop()??null}}function O(a,e){l(a,0,a.children.length,e,a)}function l(a,e,s,i,f){f||(f=new te([])),f.minX=1/0,f.minY=1/0,f.maxX=-1/0,f.maxY=-1/0;for(let u,y=e;y<s;y++)u=a.children[y],I(f,a.leaf?i(u):u);return f}function I(a,e){a.minX=Math.min(a.minX,e.minX),a.minY=Math.min(a.minY,e.minY),a.maxX=Math.max(a.maxX,e.maxX),a.maxY=Math.max(a.maxY,e.maxY)}function _(a,e){return a.minX-e.minX}function b(a,e){return a.minY-e.minY}function o(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function d(a){return a.maxX-a.minX+(a.maxY-a.minY)}function B(a,e){return(Math.max(e.maxX,a.maxX)-Math.min(e.minX,a.minX))*(Math.max(e.maxY,a.maxY)-Math.min(e.minY,a.minY))}function N(a,e){const s=Math.max(a.minX,e.minX),i=Math.max(a.minY,e.minY),f=Math.min(a.maxX,e.maxX),u=Math.min(a.maxY,e.maxY);return Math.max(0,f-s)*Math.max(0,u-i)}function X(a,e){return a.minX<=e.minX&&a.minY<=e.minY&&e.maxX<=a.maxX&&e.maxY<=a.maxY}function V(a,e){return e.minX<=a.maxX&&e.minY<=a.maxY&&e.maxX>=a.minX&&e.maxY>=a.minY}function H(a,e,s,i,f){const u=[e,s];for(;u.length;){const y=u.pop(),E=u.pop();if(y-E<=i)continue;const F=E+Math.ceil((y-E)/i/2)*i;(0,U.q)(a,F,E,y,f),u.push(E,F,F,y)}}const w=new L.A,ee=new L.A,R=new L.A,se=new L.A({deallocator:void 0});class le{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class oe extends le{constructor(){super(...arguments),this.height=1,this.indexHint=new T.vW}}class te extends oe{constructor(e){super(),this.children=e,this.leaf=!0}}class ae extends oe{constructor(e){super(),this.children=e,this.leaf=!1}}},59894:(re,Q,h)=>{h.d(Q,{F:()=>z});var T=h(3248),J=h(3567),L=h(51995);const j={minX:0,minY:0,maxX:0,maxY:0};class z{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new J.w(9,(0,T.A)("esri-csp-restrictions")?l=>({minX:l[0],minY:l[1],maxX:l[2],maxY:l[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const l=new Array(this._idByBounds.size);let I=0;this._idByBounds.forEach((_,b)=>{l[I++]=b}),this._indexInvalid=!1,this._index.clear(),this._index.load(l)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(l=>this._idByBounds.has(l))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const l=(0,L.Ie)();for(const I of this._boundsById.values())I&&(l[0]=Math.min(I[0],l[0]),l[1]=Math.min(I[1],l[1]),l[2]=Math.max(I[2],l[2]),l[3]=Math.max(I[3],l[3]));return l}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(l){const I=this._boundsById.get(l);this._boundsById.delete(l),I&&(this._idByBounds.delete(I),this._indexInvalid||this._index.remove(I))}forEachInBounds(l,I){this._loadIndex(),function W(O,l,I){(function P(O){j.minX=O[0],j.minY=O[1],j.maxX=O[2],j.maxY=O[3]})(l),O.search(j,I)}(this._index,l,_=>I(this._idByBounds.get(_)))}get(l){return this._boundsById.get(l)}has(l){return this._boundsById.has(l)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(l,I){if(!this._indexInvalid){const _=this._boundsById.get(l);_&&(this._index.remove(_),this._idByBounds.delete(_))}this._boundsById.set(l,I),I&&(this._idByBounds.set(I,l),this._indexInvalid||(this._boundsToLoad.push(I),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},64373:(re,Q,h)=>{h.d(Q,{A:()=>_});var T=h(89952),J=h(5922),L=h(42425),U=h(35150),j=h(2296),P=h(51995),W=h(31732),z=h(59894),O=h(95985),l=h(50690);const I=(0,j.vt)();class _{constructor(o){this.geometryInfo=o,this._boundsStore=new z.F,this._featuresById=new Map,this._markedIds=new Set,this.events=new L.A,this.featureAdapter=l.T}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let o=0;return this._featuresById.forEach(d=>{null!=d.geometry&&d.geometry.coords&&(o+=d.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:o/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(o){if(null==this.fullBounds)return null;const[d,B,N,X]=this.fullBounds;return{xmin:d,ymin:B,xmax:N,ymax:X,spatialReference:(0,O.ag)(o)}}add(o){this._add(o),this._emitChanged()}addMany(o){for(const d of o)this._add(d);this._emitChanged()}upsertMany(o){const d=o.map(B=>this._upsert(B));return this._emitChanged(),d.filter(T.Ru)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(o){const d=this._featuresById.get(o);return d?(this._remove(d),this._emitChanged(),d):null}removeManyById(o){this._boundsStore.invalidateIndex();for(const d of o){const B=this._featuresById.get(d);B&&this._remove(B)}this._emitChanged()}forEachBounds(o,d){for(const B of o){const N=this._boundsStore.get(B.objectId);N&&d((0,j.Jt)(I,N))}}getFeature(o){return this._featuresById.get(o)}has(o){return this._featuresById.has(o)}forEach(o){this._featuresById.forEach(d=>o(d))}forEachInBounds(o,d){this._boundsStore.forEachInBounds(o,B=>{d(this._featuresById.get(B))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let o=!1;this._featuresById.forEach((d,B)=>{this._markedIds.has(B)||(o=!0,this._remove(d))}),this._markedIds.clear(),o&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(o){if(!o)return;const d=o.objectId;if(null==d)return void U.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new J.A("featurestore:invalid-feature","feature id is missing",{feature:o}));const B=this._featuresById.get(d);let N;if(this._markedIds.add(d),B?(o.displayId=B.displayId,N=this._boundsStore.get(d),this._boundsStore.delete(d)):null!=this.onFeatureAdd&&this.onFeatureAdd(o),!o.geometry?.coords?.length)return this._boundsStore.set(d,null),void this._featuresById.set(d,o);N=(0,W.jQ)(N??(0,P.vt)(),o.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=N&&this._boundsStore.set(d,N),this._featuresById.set(d,o)}_upsert(o){const d=o?.objectId;if(null==d)return U.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new J.A("featurestore:invalid-feature","feature id is missing",{feature:o})),null;const B=this._featuresById.get(d);if(!B)return this._add(o),o;this._markedIds.add(d);const{geometry:N,attributes:X}=o;for(const V in X)B.attributes[V]=X[V];return N&&(B.geometry=N,this._boundsStore.set(d,(0,W.jQ)((0,P.vt)(),N,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),B}_remove(o){null!=this.onFeatureRemove&&this.onFeatureRemove(o);const d=o.objectId;return this._markedIds.delete(d),this._boundsStore.delete(d),this._featuresById.delete(d),o}}},39424:(re,Q,h)=>{h.r(Q),h.d(Q,{default:()=>_e});var T=h(10467),L=(h(21152),h(89563)),U=h(89447),j=h(28250),P=h(5922),W=h(35150),z=h(56492),O=h(45272),l=h(11817),I=h(79915),_=h(58701),b=h(55039),o=h(42086),d=h(13682),B=h(64373),N=h(88840),X=h(33594),V=h(85775),H=h(86300);const w=/^\s*"([\S\s]*)"\s*$/,ee=/""/g,R="\n",se=[","," ",";","|","\t"];function*le(p,r,t){let n=0;for(;n<=p.length;){const m=p.indexOf(r,n),c=p.substring(n,m>-1?m:void 0);n+=c.length+r.length,t&&!c.trim()||(yield c)}}function oe(p){const r=p.includes("\r\n")?"\r\n":R;return le(p,r,!0)}function te(p,r){return le(p,r,!1)}function*a(p,r,t,n=(()=>Object.create(null))){const m=oe(p);m.next();let c="",g="",v=0,M=n(),S=0;e:for(const k of m){const K=te(k,t);for(const G of K)if(c+=g+G,g="",v+=i(G),v%2==0){if(v>0){const q=w.exec(c);if(!q){M=n(),S=0,c="",v=0;continue e}M[r[S]]=q[1].replaceAll(ee,'"'),S++}else M[r[S]]=c,S++;c="",v=0}else g=t;0===v?(yield M,M=n(),S=0):g=R}}function e(p,r){const t=s(p,r).filter(m=>null!=m),n=t.map(m=>(0,H.rS)(m));for(let m=n.length-1;m>=0;m--)n[m]||(n.splice(m,1),t.splice(m,1));return{names:n,aliases:t}}function s(p,r){if(!p?.length)return[];const t=[];let n="",m="",c=0;const g=te(p,r);for(const v of g)if(n+=m+v,m="",c+=i(v),c%2==0){if(c>0){const M=w.exec(n);M&&t.push(M[1].replaceAll(ee,'"'))}else t.push(n);n="",c=0}else m=r;return t}function i(p){let r=0,t=0;for(t=p.indexOf('"',t);t>=0;)r++,t=p.indexOf('"',t+1);return r}function f(p,r,t){r=(0,H.rS)(r)?.toLowerCase(),t=(0,H.rS)(t)?.toLowerCase();const n=p.map(g=>g.toLowerCase()),m=r?p[n.indexOf(r)]:null,c=t?p[n.indexOf(t)]:null;return{longitudeFieldName:m||p[n.indexOf(C.find(g=>n.includes(g)))],latitudeFieldName:c||p[n.indexOf(F.find(g=>n.includes(g)))]}}function y(p){if(!p.length)return"string";const r=/[^+\-.,0-9]/;return p.map(t=>{if(""!==t){if(!r.test(t)){let n=E(t);if(!isNaN(n))return/[.,]/.test(t)||!Number.isInteger(n)||n>214783647||n<-214783648?"double":"integer";if(t.includes("E")&&(n=Number(t),!Number.isNaN(n)||t.includes(",")&&(t=t.replace(",","."),n=Number(t),!Number.isNaN(n))))return"double"}return(0,j.Cq)(t)?"date":"string"}}).reduce((t,n)=>void 0===t?n:void 0===n?t:t===n?n:"string"===t||"string"===n?"string":"double"===t||"double"===n?"double":void 0)}const E=function(){const p=(0,V.B)(),r=new RegExp("^"+p.regexp+"$"),t=new RegExp("["+p.group+"\\s\\xa0]","g"),n=p.factor;return m=>{const c=r.exec(m);if(p.factor=n,!c)return NaN;let g=c[1];if(!c[1]){if(!c[2])return NaN;g=c[2],p.factor*=-1}return g=g.replace(t,"").replace(p.decimal,"."),+g*p.factor}}(),F=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],C=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"];var A=h(89962),Y=h(73258),ne=h(22639),ue=h(32034);const he=(0,A.F0)("esriGeometryPoint"),ce=["csv"],fe=[0,0];class me{constructor(r,t){this.x=r,this.y=t}}class _e{constructor(){var r=this;this._queryEngine=null,this._snapshotFeatures=function(){var t=(0,T.A)(function*(n){const m=yield r._fetch(n);return r._createFeatures(m)});return function(n){return t.apply(this,arguments)}}()}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}load(r,t={}){var n=this;return(0,T.A)(function*(){n._loadOptions=r;const[m]=yield Promise.all([n._fetch(t.signal),n._checkProjection(r?.parsingOptions?.spatialReference)]),c=function pe(p,r){const t=r.parsingOptions||{},n={delimiter:t.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:t.latitudeField,longitudeFieldName:t.longitudeField}},m=n.layerDefinition={name:(0,O.e7)(r.url,ce)||"csv",dateFieldsTimeReference:{timeZoneIANA:ne.n$},drawingInfo:he,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:t.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:t.spatialReference||{wkid:4326}}},c=oe(p),g=c.next().value?.trim(),v=c.next().value?.trim();if(!g)throw new P.A("csv-layer:empty-csv","CSV is empty",{csv:p});const{delimiter:M,locationInfo:S}=function ae(p,r,t){p=p.trim(),r=r?.trim();const n=[],m=Array.from(new Set([t?.delimiter,...se])).filter(g=>null!=g);for(const g of m){const v=s(p,g).length,M=s(r,g).length??v;v>1&&n.push({weight:Math.min(v,M),delimiter:g})}const c=n.sort(({weight:g},{weight:v})=>v-g).map(({delimiter:g})=>g);for(const g of c){const v=f(e(p,g).names,t?.longitudeField,t?.latitudeField);if(v.longitudeFieldName&&v.latitudeFieldName)return{delimiter:g,locationInfo:v}}return{delimiter:c[0],locationInfo:null}}(g,v,t);if(!M)throw new P.A("csv-layer:invalid-delimiter","Unable to detect the delimiter from CSV",{firstLine:g,secondLine:v,parsingOptions:t});if(!S)throw new P.A("csv-layer:location-fields-not-found","Unable to identify latitude and longitude fields from the CSV file",{firstLine:g,secondLine:v,parsingOptions:t});n.locationInfo=S,n.delimiter=M;const{names:k,aliases:K}=e(g,M),G=function u(p,r,t,n,m){const c=[],g=a(p,t,r),v=[];for(const M of g){if(10===v.length)break;v.push(M)}for(let M=0;M<t.length;M++){const S=t[M],k=n[M];if(S===m.longitudeFieldName||S===m.latitudeFieldName)c.push({name:S,type:"esriFieldTypeDouble",alias:k});else{let K;switch(y(v.map(G=>G[S]))){case"integer":K="esriFieldTypeInteger";break;case"double":K="esriFieldTypeDouble";break;case"date":K="esriFieldTypeDate";break;default:K="esriFieldTypeString"}c.push({name:S,type:K,alias:k,length:(0,H._b)(K)})}}return c}(p,n.delimiter,k,K,n.locationInfo);if(t.fields?.length){const D=new Y.A(t.fields);for(const x of G){const Z=D.get(x.name);Z&&Object.assign(x,Z)}}if(!G.some(D=>"esriFieldTypeOID"===D.type&&(m.objectIdField=D.name,!0))){const D={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};m.objectIdField=D.name,G.unshift(D)}m.fields=G;const q=new Y.A(m.fields);if(n.locationInfo&&(n.locationInfo.latitudeFieldName=q.get(n.locationInfo.latitudeFieldName).name,n.locationInfo.longitudeFieldName=q.get(n.locationInfo.longitudeFieldName).name),m.timeInfo){const D=m.timeInfo;if(D.startTimeField){const x=q.get(D.startTimeField);x?(D.startTimeField=x.name,x.type="esriFieldTypeDate"):D.startTimeField=null}if(D.endTimeField){const x=q.get(D.endTimeField);x?(D.endTimeField=x.name,x.type="esriFieldTypeDate"):D.endTimeField=null}if(D.trackIdField){const x=q.get(D.trackIdField);D.trackIdField=x?x.name:null}D.startTimeField||D.endTimeField||(m.timeInfo=null)}return n}(m,r);n._locationInfo=c.locationInfo,n._delimiter=c.delimiter,n._queryEngine=n._createQueryEngine(c);const g=yield n._createFeatures(m);n._queryEngine.featureStore.addMany(g);const{fullExtent:v,timeExtent:M}=yield n._queryEngine.fetchRecomputedExtents();if(c.layerDefinition.extent=v,M){const{start:S,end:k}=M;c.layerDefinition.timeInfo.timeExtent=[S,k]}return c})()}applyEdits(){return(0,T.A)(function*(){throw new P.A("csv-layer:editing-not-supported","applyEdits() is not supported on CSVLayer")})()}queryFeatures(r={},t={}){var n=this;return(0,T.A)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQuery(r,t.signal)})()}queryFeatureCount(r={},t={}){var n=this;return(0,T.A)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForCount(r,t.signal)})()}queryObjectIds(r={},t={}){var n=this;return(0,T.A)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForIds(r,t.signal)})()}queryExtent(r={},t={}){var n=this;return(0,T.A)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForExtent(r,t.signal)})()}querySnapping(r,t={}){var n=this;return(0,T.A)(function*(){return yield n._waitSnapshotComplete(),n._queryEngine.executeQueryForSnapping(r,t.signal)})()}refresh(r){var t=this;return(0,T.A)(function*(){t._loadOptions.customParameters=r,t._snapshotTask?.abort(),t._snapshotTask=(0,U.UT)(t._snapshotFeatures),t._snapshotTask.promise.then(c=>{t._queryEngine.featureStore.clear(),c&&t._queryEngine.featureStore.addMany(c)},c=>{t._queryEngine.featureStore.clear(),(0,z.zf)(c)||W.A.getLogger("esri.layers.CSVLayer").error(new P.A("csv-layer:refresh","An error occurred during refresh",{error:c}))}),yield t._waitSnapshotComplete();const{fullExtent:n,timeExtent:m}=yield t._queryEngine.fetchRecomputedExtents();return{extent:n,timeExtent:m}})()}_waitSnapshotComplete(){var r=this;return(0,T.A)(function*(){if(r._snapshotTask&&!r._snapshotTask.finished){try{yield r._snapshotTask.promise}catch{}return r._waitSnapshotComplete()}})()}_fetch(r){var t=this;return(0,T.A)(function*(){const{url:n,customParameters:m}=t._loadOptions;if(!n)throw new P.A("csv-layer:invalid-source","url not defined");const c=(0,O.An)(n);return(yield(0,L.A)(c.path,{query:{...c.query,...m},responseType:"text",signal:r})).data})()}_createQueryEngine(r){const{objectIdField:t,fields:n,extent:m,timeInfo:c}=r.layerDefinition,g=new B.A({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});return new X.d({fieldsIndex:Y.A.fromLayerJSON({fields:n,dateFieldsTimeReference:{timeZoneIANA:ne.n$}}),geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:c,objectIdField:t,spatialReference:m.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:g})}_createFeatures(r){var t=this;return(0,T.A)(function*(){const{latitudeFieldName:n,longitudeFieldName:m}=t._locationInfo,{objectIdField:c,fieldsIndex:g,spatialReference:v}=t._queryEngine;let M=[];const S=[],k=g.fields.filter(x=>x.name!==c).map(x=>x.name);let K=0;const G={};for(const x of g.fields)if("esriFieldTypeOID"!==x.type&&"esriFieldTypeGlobalID"!==x.type){const Z=(0,H.lD)(x);void 0!==Z&&(G[x.name]=Z)}const q=a(r,k,t._delimiter,(0,A.Vx)(G,c));for(const x of q){const Z=t._parseCoordinateValue(x[n]),ie=t._parseCoordinateValue(x[m]);if(null!=ie&&null!=Z&&!isNaN(Z)&&!isNaN(ie)){x[n]=Z,x[m]=ie;for(const $ in x)if($!==n&&$!==m)if(g.isDateField($))x[$]=(0,j._U)(x[$]);else if(g.isNumericField($)){const de=E(x[$]);x[$]=isNaN(de)?null:de}x[c]=K,K++,M.push(new me(ie,Z)),S.push(x)}}if(!(0,_.aI)({wkid:4326},v))if((0,_.K8)(v))for(const x of M)[x.x,x.y]=(0,b.je)(x.x,x.y,fe);else M=(0,l.projectMany)(I.g,M,ue.A.WGS84,v,null,null);const D=[];for(let x=0;x<M.length;x++){const{x:Z,y:ie}=M[x],$=S[x];$[c]=x+1,D.push(new o.Om(new d.A([],[Z,ie]),$,null,$[c]))}return D})()}_parseCoordinateValue(r){if(null==r||""===r)return null;let t=E(r);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(r)),t}_checkProjection(r){return(0,T.A)(function*(){try{yield(0,N.Nk)(_.KK,r)}catch{throw new P.A("csv-layer:projection-not-supported","Projection not supported")}})()}}},89962:(re,Q,h)=>{h.d(Q,{F0:()=>j,Vx:()=>z,e2:()=>l,f:()=>I});var T=h(3248),J=h(77806),L=h(78200),U=h(48254);function j(_){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===_||"esriGeometryMultipoint"===_?U.Cb:"esriGeometryPolyline"===_?U.yM:U.WR}}}const P=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let W=1;function z(_,b){if((0,T.A)("esri-csp-restrictions"))return()=>({[b]:null,..._});try{let o=`this${O(b)} = null;`;for(const B in _)o+=`this${O(B)} = ${JSON.stringify(_[B])};`;const d=new Function(`\n      return class AttributesClass$${W++} {\n        constructor() {\n          ${o};\n        }\n      }\n    `)();return()=>new d}catch{return()=>({[b]:null,..._})}}function O(_){return P.test(_)?`.${_}`:`["${_}"]`}function l(_={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,J.o8)(_)}}]}function I(_,b){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:_},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:b,supportsDelete:b,supportsEditing:b,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:b,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:L.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:b,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}}}]);