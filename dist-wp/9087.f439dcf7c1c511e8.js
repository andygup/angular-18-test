"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[9087],{15590:(ut,Q,r)=>{r.d(Q,{A:()=>S});class S{constructor(Y){this.size=0,this._start=0,this.maxSize=Y,this._buffer=new Array(Y)}get entries(){return this._buffer}enqueue(Y){if(this.size===this.maxSize){const D=this._buffer[this._start];return this._buffer[this._start]=Y,this._start=(this._start+1)%this.maxSize,D}return this._buffer[(this._start+this.size++)%this.maxSize]=Y,null}dequeue(){if(0===this.size)return null;const Y=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,Y}peek(){return 0===this.size?null:this._buffer[this._start]}find(Y){if(0===this.size)return null;for(const D of this._buffer)if(null!=D&&Y(D))return D;return null}clear(Y){let D=this.dequeue();for(;null!=D;)Y&&Y(D),D=this.dequeue()}}},8897:(ut,Q,r)=>{r.d(Q,{F:()=>W,l:()=>T});var S=r(10467),k=r(90261),Y=r(3248);const D=128e3;let N=null,M=null;function W(){return O.apply(this,arguments)}function O(){return O=(0,S.A)(function*(){return N||(N=function g(){return p.apply(this,arguments)}()),N}),O.apply(this,arguments)}function p(){return(p=(0,S.A)(function*(){M=yield((0,Y.A)("esri-csp-restrictions")?yield r.e(4049).then(r.bind(r,34049)).then(G=>G.l):yield r.e(787).then(r.bind(r,50787)).then(G=>G.l)).default({locateFile:G=>(0,k.s)(`esri/core/libs/libtess/${G}`)})})).apply(this,arguments)}function T(B,G){const E=Math.max(B.length,D);return M.triangulate(B,G,E)}},10223:(ut,Q,r)=>{r.d(Q,{V:()=>W});var S=r(72137),k=r(53262),Y=r(47961),D=r(91486),N=r(26747);const M=96/72;class W{static executeEffects(g,p,T,B){const G=M,E=(0,N.ll)(g);let u=new Y.k(p);for(const c of g){const l=(0,D.A)(c);l&&(u=l.execute(u,c,G,T,B,E))}return u}static applyEffects(g,p,T){if(!g)return p;const B=(0,N.ll)(g);let G,E=new Y.k(S.z.fromJSONCIM(p));for(const l of g){const m=(0,D.A)(l);m&&(E=m.execute(E,l,1,null,T,B))}const u=[];let c=null;for(;G=E.next();)u.push(...(0,k.x)(G)),c=G.geometryType;return 0===u.length||null===c?null:"esriGeometryPolygon"===c?{rings:u}:{paths:u}}}},71725:(ut,Q,r)=>{r.d(Q,{l:()=>k});var S=r(91486);class k{static getPlacement(D,N,M,W,O,g){const p=(0,S.c)(M);return p?(-1===N&&D.invertY(),p.execute(D,M,W,O,g)):null}}},7933:(ut,Q,r)=>{r.d(Q,{i:()=>G});var S=r(65374),k=r(47669);function Y(E,u){return E.x===u.x&&E.y===u.y}function N(E,u){return E.x=u.y,E.y=-u.x,E}function M(E,u){return E.x=-u.y,E.y=u.x,E}function W(E,u){return E.x=u.x,E.y=u.y,E}function O(E,u){return E.x=-u.x,E.y=-u.y,E}function g(E){return Math.sqrt(E.x*E.x+E.y*E.y)}function p(E,u){return E.x*u.y-E.y*u.x}function T(E,u){return E.x*u.x+E.y*u.y}function B(E,u,c,l){return E.x=u.x*c+u.y*l,E.y=u.x*l-u.y*c,E}class G{constructor(u,c,l){this._writeVertex=u,this._writeTriangle=c,this._canUseThinTessellation=l,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(u,c,l=this._canUseThinTessellation){(function D(E){if(!E)return;const u=E.length;if(u<=1)return;let c=0;for(let l=1;l<u;l++)Y(E[l],E[c])||++c===l||(E[c]=E[l]);E.length=c+1})(u),l&&c.halfWidth<k.Gh&&!c.offset?this._tessellateThin(u,c):this._tessellate(u,c)}_tessellateThin(u,c){if(u.length<2)return;const l=c.wrapDistance||65535;let m=c.initialDistance||0,x=!1,A=u[0].x,C=u[0].y;const J=u.length;for(let ot=1;ot<J;++ot){x&&(x=!1,m=0);let j=u[ot].x,v=u[ot].y,f=j-A,R=v-C,V=Math.sqrt(f*f+R*R);if(f/=V,R/=V,m+V>l){x=!0;const a=(l-m)/V;V=l-m,j=(1-a)*A+a*j,v=(1-a)*C+a*v,--ot}const U=this._writeVertex(A,C,0,0,f,R,R,-f,0,-1,m),X=this._writeVertex(A,C,0,0,f,R,-R,f,0,1,m);m+=V;const b=this._writeVertex(j,v,0,0,f,R,R,-f,0,-1,m),n=this._writeVertex(j,v,0,0,f,R,-R,f,0,1,m);this._writeTriangle(U,X,b),this._writeTriangle(X,b,n),A=j,C=v}}_tessellate(u,c){const m=u[u.length-1],x=Y(u[0],m);if(u.length<(x?3:2))return;const C=c.pixelCoordRatio,J=null!=c.capType?c.capType:S.xR.BUTT,ot=null!=c.joinType?c.joinType:S.JO.MITER,j=null!=c.miterLimit?Math.min(c.miterLimit,4):2,v=null!=c.roundLimit?Math.min(c.roundLimit,1.05):1.05,f=null!=c.halfWidth?c.halfWidth:2,R=!!c.textured;let V,U,X,b=null;const n=this._prevNormal,a=this._nextNormal;let L=-1,z=-1;const I=this._joinNormal;let w,H;const tt=this._textureNormalLeft,rt=this._textureNormalRight,Z=this._textureNormal;let st=-1,q=-1;const dt=c.wrapDistance||65535;let nt=c.initialDistance||0;const mt=this._writeVertex,pt=this._writeTriangle,lt=(o,i,h,s,_,d)=>{const P=mt(U,X,w,H,h,s,o,i,_,d,nt);return st>=0&&q>=0&&P>=0&&pt(st,q,P),st=q,q=P,P};x&&(V=u[u.length-2],a.x=m.x-V.x,a.y=m.y-V.y,z=g(a),a.x/=z,a.y/=z);let e=!1;for(let o=0;o<u.length;++o){if(e&&(e=!1,nt=0),V&&(n.x=-a.x,n.y=-a.y,L=z,nt+L>dt&&(e=!0)),e){const y=(dt-nt)/L;L=dt-nt,V={x:(1-y)*V.x+y*u[o].x,y:(1-y)*V.y+y*u[o].y},--o}else V=u[o];U=V.x,X=V.y;const i=o<=0&&!e,h=o===u.length-1;if(i||(nt+=L),b=h?x?u[1]:null:u[o+1],b?(a.x=b.x-U,a.y=b.y-X,z=g(a),a.x/=z,a.y/=z):(a.x=void 0,a.y=void 0),!x){if(i){M(I,a),w=I.x,H=I.y,J===S.xR.SQUARE&&(lt(-a.y-a.x,a.x-a.y,a.x,a.y,0,-1),lt(a.y-a.x,-a.x-a.y,a.x,a.y,0,1)),J===S.xR.ROUND&&(lt(-a.y-a.x,a.x-a.y,a.x,a.y,-1,-1),lt(a.y-a.x,-a.x-a.y,a.x,a.y,-1,1)),J!==S.xR.ROUND&&J!==S.xR.BUTT||(lt(-a.y,a.x,a.x,a.y,0,-1),lt(a.y,-a.x,a.x,a.y,0,1));continue}if(h){N(I,n),w=I.x,H=I.y,J!==S.xR.ROUND&&J!==S.xR.BUTT||(lt(n.y,-n.x,-n.x,-n.y,0,-1),lt(-n.y,n.x,-n.x,-n.y,0,1)),J===S.xR.SQUARE&&(lt(n.y-n.x,-n.x-n.y,-n.x,-n.y,0,-1),lt(-n.y-n.x,n.x-n.y,-n.x,-n.y,0,1)),J===S.xR.ROUND&&(lt(n.y-n.x,-n.x-n.y,-n.x,-n.y,1,-1),lt(-n.y-n.x,n.x-n.y,-n.x,-n.y,1,1));continue}}let s,_,d=-p(n,a);if(Math.abs(d)<.01)T(n,a)>0?(I.x=n.x,I.y=n.y,d=1,s=Number.MAX_VALUE,_=!0):(M(I,a),d=1,s=1,_=!1);else{I.x=(n.x+a.x)/d,I.y=(n.y+a.y)/d,s=g(I);const y=(s-1)*f*C;_=s>4||y>L&&y>z}w=I.x,H=I.y;let P=ot;switch(ot){case S.JO.BEVEL:s<1.05&&(P=S.JO.MITER);break;case S.JO.ROUND:s<v&&(P=S.JO.MITER);break;case S.JO.MITER:s>j&&(P=S.JO.BEVEL)}switch(P){case S.JO.MITER:if(lt(I.x,I.y,-n.x,-n.y,0,-1),lt(-I.x,-I.y,-n.x,-n.y,0,1),h)break;if(R){const y=e?0:nt;st=this._writeVertex(U,X,w,H,a.x,a.y,I.x,I.y,0,-1,y),q=this._writeVertex(U,X,w,H,a.x,a.y,-I.x,-I.y,0,1,y)}break;case S.JO.BEVEL:{const y=d<0;let F,K,at,it;if(y){const ct=st;st=q,q=ct,F=tt,K=rt}else F=rt,K=tt;if(_)at=y?M(this._innerPrev,n):N(this._innerPrev,n),it=y?N(this._innerNext,a):M(this._innerNext,a);else{const ct=y?O(this._inner,I):W(this._inner,I);at=ct,it=ct}const $=y?N(this._bevelStart,n):M(this._bevelStart,n);lt(at.x,at.y,-n.x,-n.y,F.x,F.y);const et=lt($.x,$.y,-n.x,-n.y,K.x,K.y);if(h)break;const ht=y?M(this._bevelEnd,a):N(this._bevelEnd,a);if(_){const ct=this._writeVertex(U,X,w,H,-n.x,-n.y,0,0,0,0,nt);st=this._writeVertex(U,X,w,H,a.x,a.y,it.x,it.y,F.x,F.y,nt),q=this._writeVertex(U,X,w,H,a.x,a.y,ht.x,ht.y,K.x,K.y,nt),this._writeTriangle(et,ct,q)}else{if(R){const ct=this._bevelMiddle;ct.x=($.x+ht.x)/2,ct.y=($.y+ht.y)/2,B(Z,ct,-n.x,-n.y),lt(ct.x,ct.y,-n.x,-n.y,Z.x,Z.y),B(Z,ct,a.x,a.y),st=this._writeVertex(U,X,w,H,a.x,a.y,ct.x,ct.y,Z.x,Z.y,nt),q=this._writeVertex(U,X,w,H,a.x,a.y,it.x,it.y,F.x,F.y,nt)}else{const ct=st;st=q,q=ct}lt(ht.x,ht.y,a.x,a.y,K.x,K.y)}if(y){const ct=st;st=q,q=ct}break}case S.JO.ROUND:{const y=d<0;let F,K;if(y){const _t=st;st=q,q=_t,F=tt,K=rt}else F=rt,K=tt;const at=y?O(this._inner,I):W(this._inner,I);let it,$;_?(it=y?M(this._innerPrev,n):N(this._innerPrev,n),$=y?N(this._innerNext,a):M(this._innerNext,a)):(it=at,$=at);const et=y?N(this._roundStart,n):M(this._roundStart,n),ht=y?M(this._roundEnd,a):N(this._roundEnd,a),ct=lt(it.x,it.y,-n.x,-n.y,F.x,F.y),ft=lt(et.x,et.y,-n.x,-n.y,K.x,K.y);if(h)break;const xt=this._writeVertex(U,X,w,H,-n.x,-n.y,0,0,0,0,nt);_||this._writeTriangle(st,q,xt);const yt=O(this._outer,at),Et=this._writeVertex(U,X,w,H,a.x,a.y,ht.x,ht.y,K.x,K.y,nt);let vt,Pt;const Tt=s>2;if(Tt){let _t;s!==Number.MAX_VALUE?(yt.x/=s,yt.y/=s,_t=T(n,yt),_t=(s*(_t*_t-1)+1)/_t):_t=-1,vt=y?N(this._startBreak,n):M(this._startBreak,n),vt.x+=n.x*_t,vt.y+=n.y*_t,Pt=y?M(this._endBreak,a):N(this._endBreak,a),Pt.x+=a.x*_t,Pt.y+=a.y*_t}B(Z,yt,-n.x,-n.y);const Dt=this._writeVertex(U,X,w,H,-n.x,-n.y,yt.x,yt.y,Z.x,Z.y,nt);B(Z,yt,a.x,a.y);const Lt=R?this._writeVertex(U,X,w,H,a.x,a.y,yt.x,yt.y,Z.x,Z.y,nt):Dt,It=xt,Ot=R?this._writeVertex(U,X,w,H,a.x,a.y,0,0,0,0,nt):xt;let Mt=-1,gt=-1;if(Tt&&(B(Z,vt,-n.x,-n.y),Mt=this._writeVertex(U,X,w,H,-n.x,-n.y,vt.x,vt.y,Z.x,Z.y,nt),B(Z,Pt,a.x,a.y),gt=this._writeVertex(U,X,w,H,a.x,a.y,Pt.x,Pt.y,Z.x,Z.y,nt)),R?Tt?(this._writeTriangle(It,ft,Mt),this._writeTriangle(It,Mt,Dt),this._writeTriangle(Ot,Lt,gt),this._writeTriangle(Ot,gt,Et)):(this._writeTriangle(It,ft,Dt),this._writeTriangle(Ot,Lt,Et)):Tt?(this._writeTriangle(xt,ft,Mt),this._writeTriangle(xt,Mt,gt),this._writeTriangle(xt,gt,Et)):(this._writeTriangle(xt,ft,Dt),this._writeTriangle(xt,Lt,Et)),_?(st=this._writeVertex(U,X,w,H,a.x,a.y,$.x,$.y,F.x,F.y,nt),q=Et):(st=R?this._writeVertex(U,X,w,H,a.x,a.y,$.x,$.y,F.x,F.y,nt):ct,this._writeTriangle(st,Ot,Et),q=Et),y){const _t=st;st=q,q=_t}break}}}}}},73584:(ut,Q,r)=>{r.d(Q,{uS:()=>lt,FE:()=>pt,lO:()=>q,XZ:()=>nt}),r(92405);var k=r(8897),Y=r(91766),D=r(13682),N=r(47669);function M(e,o,i,h,s,_,d){w=0;const P=(h-i)*_,y=s&&s.length,F=y?(s[0]-i)*_:P;let K,at,it,$,et,ht=W(o,i,0,0,F,_,!0);if(ht&&ht.next!==ht.prev){if(y&&(ht=function u(e,o,i,h,s,_){const d=new Array;for(let P=0,y=h.length;P<y;P++){const F=W(e,o,0,h[P]*_,P<y-1?h[P+1]*_:i*_,_,!1);F===F.next&&(F.steiner=!0),d.push(E(F))}d.sort(V);for(const P of d)s=c(P,s);return s}(o,i,h,s,ht,_)),P>80*_){K=it=o[0+i*_],at=$=o[1+i*_];for(let ct=_;ct<F;ct+=_){const ft=o[ct+i*_],xt=o[ct+1+i*_];K=Math.min(K,ft),at=Math.min(at,xt),it=Math.max(it,ft),$=Math.max($,xt)}et=Math.max(it-K,$-at),et=0!==et?1/et:0}g(ht,e,_,K,at,et,d,0)}}function W(e,o,i,h,s,_,d){let P;if(d===function ot(e,o,i,h,s,_){let d=0;for(let P=h,y=s-_;P<s;P+=_)d+=(e[y+o*_]-e[P+o*_])*(e[P+1+o*_]+e[y+1+o*_]),y=P;return d}(e,o,0,h,s,_)>0)for(let y=h;y<s;y+=_)P=B(y+o*_,e[y+o*_],e[y+1+o*_],P);else for(let y=s-_;y>=h;y-=_)P=B(y+o*_,e[y+o*_],e[y+1+o*_],P);return P&&R(P,P.next)&&(G(P),P=P.next),P}function O(e,o=e){if(!e)return e;let i,h=e;do{if(i=!1,h.steiner||!R(h,h.next)&&0!==A(h.prev,h,h.next))h=h.next;else{if(G(h),h=o=h.prev,h===h.next)break;i=!0}}while(i||h!==o);return o}function g(e,o,i,h,s,_,d,P){if(!e)return;!P&&_&&(e=m(e,h,s,_));let y=e;for(;e.prev!==e.next;){const F=e.prev,K=e.next;if(_?T(e,h,s,_):p(e))o.push(F.index/i+d),o.push(e.index/i+d),o.push(K.index/i+d),G(e),e=K.next,y=K.next;else if((e=K)===y){P?1===P?g(e=U(e,o,i,d),o,i,h,s,_,d,2):2===P&&X(e,o,i,h,s,_,d):g(O(e),o,i,h,s,_,d,1);break}}}function p(e){const o=e.prev,i=e,h=e.next;if(A(o,i,h)>=0)return!1;let s=e.next.next;const _=s;let d=0;for(;s!==e.prev&&(0===d||s!==_);){if(d++,j(o.x,o.y,i.x,i.y,h.x,h.y,s.x,s.y)&&A(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function T(e,o,i,h){const s=e.prev,_=e,d=e.next;if(A(s,_,d)>=0)return!1;const F=s.x>_.x?s.x>d.x?s.x:d.x:_.x>d.x?_.x:d.x,K=s.y>_.y?s.y>d.y?s.y:d.y:_.y>d.y?_.y:d.y,at=f(s.x<_.x?s.x<d.x?s.x:d.x:_.x<d.x?_.x:d.x,s.y<_.y?s.y<d.y?s.y:d.y:_.y<d.y?_.y:d.y,o,i,h),it=f(F,K,o,i,h);let $=e.prevZ,et=e.nextZ;for(;$&&$.z>=at&&et&&et.z<=it;){if($!==e.prev&&$!==e.next&&j(s.x,s.y,_.x,_.y,d.x,d.y,$.x,$.y)&&A($.prev,$,$.next)>=0||($=$.prevZ,et!==e.prev&&et!==e.next&&j(s.x,s.y,_.x,_.y,d.x,d.y,et.x,et.y)&&A(et.prev,et,et.next)>=0))return!1;et=et.nextZ}for(;$&&$.z>=at;){if($!==e.prev&&$!==e.next&&j(s.x,s.y,_.x,_.y,d.x,d.y,$.x,$.y)&&A($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;et&&et.z<=it;){if(et!==e.prev&&et!==e.next&&j(s.x,s.y,_.x,_.y,d.x,d.y,et.x,et.y)&&A(et.prev,et,et.next)>=0)return!1;et=et.nextZ}return!0}function B(e,o,i,h){const s=L.create(e,o,i);return h?(s.next=h.next,s.prev=h,h.next.prev=s,h.next=s):(s.prev=s,s.next=s),s}function G(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e){let o=e,i=e;do{(o.x<i.x||o.x===i.x&&o.y<i.y)&&(i=o),o=o.next}while(o!==e);return i}function c(e,o){const i=function l(e,o){let i=o;const h=e.x,s=e.y;let _,d=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const it=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(it<=h&&it>d){if(d=it,it===h){if(s===i.y)return i;if(s===i.next.y)return i.next}_=i.x<i.next.x?i:i.next}}i=i.next}while(i!==o);if(!_)return null;if(h===d)return _.prev;const P=_,y=_.x,F=_.y;let K,at=1/0;for(i=_.next;i!==P;)h>=i.x&&i.x>=y&&h!==i.x&&j(s<F?h:d,s,y,F,s<F?d:h,s,i.x,i.y)&&(K=Math.abs(s-i.y)/(h-i.x),(K<at||K===at&&i.x>_.x)&&v(i,e)&&(_=i,at=K)),i=i.next;return _}(e,o);if(!i)return o;const h=a(i,e);return O(h,h.next),O(i,i.next)}function m(e,o,i,h){let s;for(;s!==e;s=s.next){if(s=s||e,null===s.z&&(s.z=f(s.x,s.y,o,i,h)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,m(e,o,i,h);s.prevZ=s.prev,s.nextZ=s.next}return e.prevZ.nextZ=null,e.prevZ=null,function x(e){let o,i=1;for(;;){let h,s=e;e=null,o=null;let _=0;for(;s;){_++,h=s;let d=0;for(;d<i&&h;d++)h=h.nextZ;let P=i;for(;d>0||P>0&&h;){let y;0===d?(y=h,h=h.nextZ,P--):0!==P&&h?s.z<=h.z?(y=s,s=s.nextZ,d--):(y=h,h=h.nextZ,P--):(y=s,s=s.nextZ,d--),o?o.nextZ=y:e=y,y.prevZ=o,o=y}s=h}if(o.nextZ=null,i*=2,_<2)return e}}(e)}function A(e,o,i){return(o.y-e.y)*(i.x-o.x)-(o.x-e.x)*(i.y-o.y)}function C(e,o,i,h){return!!(R(e,o)&&R(i,h)||R(e,h)&&R(i,o))||A(e,o,i)>0!=A(e,o,h)>0&&A(i,h,e)>0!=A(i,h,o)>0}function j(e,o,i,h,s,_,d,P){return(s-d)*(o-P)-(e-d)*(_-P)>=0&&(e-d)*(h-P)-(i-d)*(o-P)>=0&&(i-d)*(_-P)-(s-d)*(h-P)>=0}function v(e,o){return A(e.prev,e,e.next)<0?A(e,o,e.next)>=0&&A(e,e.prev,o)>=0:A(e,o,e.prev)<0||A(e,e.next,o)<0}function f(e,o,i,h,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*s)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function R(e,o){return e.x===o.x&&e.y===o.y}function V(e,o){return e.x-o.x}function U(e,o,i,h){let s=e;do{const _=s.prev,d=s.next.next;!R(_,d)&&C(_,s,s.next,d)&&v(_,d)&&v(d,_)&&(o.push(_.index/i+h),o.push(s.index/i+h),o.push(d.index/i+h),G(s),G(s.next),s=e=d),s=s.next}while(s!==e);return s}function X(e,o,i,h,s,_,d){let P=e;do{let y=P.next.next;for(;y!==P.prev;){if(P.index!==y.index&&b(P,y)){let F=a(P,y);return P=O(P,P.next),F=O(F,F.next),g(P,o,i,h,s,_,d,0),void g(F,o,i,h,s,_,d,0)}y=y.next}P=P.next}while(P!==e)}function b(e,o){return e.next.index!==o.index&&e.prev.index!==o.index&&!function J(e,o){let i=e;do{if(i.index!==e.index&&i.next.index!==e.index&&i.index!==o.index&&i.next.index!==o.index&&C(i,i.next,e,o))return!0;i=i.next}while(i!==e);return!1}(e,o)&&v(e,o)&&v(o,e)&&function n(e,o){let i=e,h=!1;const s=(e.x+o.x)/2,_=(e.y+o.y)/2;do{i.y>_!=i.next.y>_&&i.next.y!==i.y&&s<(i.next.x-i.x)*(_-i.y)/(i.next.y-i.y)+i.x&&(h=!h),i=i.next}while(i!==e);return h}(e,o)}function a(e,o){const i=L.create(e.index,e.x,e.y),h=L.create(o.index,o.x,o.y),s=e.next,_=o.prev;return e.next=o,o.prev=e,i.next=s,s.prev=i,h.next=i,i.prev=h,_.next=h,h.prev=_,h}class L{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(o,i,h){const s=w<z.length?z[w++]:new L;return s.index=o,s.x=i,s.y=h,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}}const z=[];let w=0;for(let e=0;e<8096;e++)z.push(new L);const H=1e-5,tt=new Y.O3(0,0,0,1,0),rt=new Y.O3(0,0,0,1,0);function Z(e,o,i){let h=0;for(let s=1;s<i;s++)h+=(e[2*(o+s)]-e[2*(o+s-1)])*(e[2*(o+s)+1]+e[2*(o+s-1)+1]);return h}function st(e,o,i,h,s){let _=0;for(let P=i;P<h;P+=3){const y=2*(e[P]-s),F=2*(e[P+1]-s),K=2*(e[P+2]-s);_+=Math.abs((o[y]-o[K])*(o[F+1]-o[y+1])-(o[y]-o[F])*(o[K+1]-o[y+1]))}return _}function q(e,o){const{coords:i,lengths:h,hasIndeterminateRingOrder:s}=o,d=e;if(s)return!1;let P=0;for(let y=0;y<h.length;){let F=y,K=h[y],at=Z(i,P,K);const it=[];for(;++F<h.length;){const ct=h[F],ft=Z(i,P+K,ct);if(!(ft>0))break;at+=ft,it.push(P+K),K+=ct}const $=d.length;M(d,i,P,P+K,it,2,0);const et=st(d,i,$,d.length,0),ht=Math.abs(at);if(Math.abs((et-ht)/Math.max(1e-7,ht))>H)return d.length=0,!1;y=F,P+=K}return!0}function nt(e){const{coords:o,lengths:i}=e,{buffer:h}=(0,k.l)(o,i);return h}function pt(e,o){if(null==e)return null;if(!function mt(e,o,i){let h=0;for(let s=0;s<e.lengths.length;s++){const _=e.lengths[s];for(let d=0;d<_;d++){const P=e.coords[2*(d+h)],y=e.coords[2*(d+h)+1];if(P<o||P>i||y<o||y>i)return!0}h+=_}return!1}(e,-128,N.CQ+128))return e;tt.setPixelMargin(o),tt.reset(Y.dC.Polygon);let i=0;for(let d=0;d<e.lengths.length;d++){const P=e.lengths[d];let y=e.coords[2*(0+i)],F=e.coords[2*(0+i)+1];tt.moveTo(y,F);for(let K=1;K<P;K++)y=e.coords[2*(K+i)],F=e.coords[2*(K+i)+1],tt.lineTo(y,F);tt.close(),i+=P}const h=tt.result(!1);if(!h)return null;const s=[],_=[];for(const d of h){let P=0;for(const y of d)_.push(y.x),_.push(y.y),P++;s.push(P)}return new D.A(s,_)}function lt(e,o){rt.setPixelMargin(o);const i=rt,h=-o,s=N.CQ+o;let _=[],d=!1;if(!e.nextPath())return null;let P=!0;for(;P;){e.seekPathStart();const y=[];if(!e.pathSize)return null;i.reset(Y.dC.LineString),e.nextPoint();let F=e.x,K=e.y;if(d)i.moveTo(F,K);else{if(F<h||F>s||K<h||K>s){d=!0;continue}y.push({x:F,y:K})}let at=!1;for(;e.nextPoint();)if(F=e.x,K=e.y,d)i.lineTo(F,K);else{if(F<h||F>s||K<h||K>s){at=!0;break}y.push({x:F,y:K})}if(at)d=!0;else{if(d){const it=i.resultWithStarts();if(it)for(const $ of it)_.push($)}else _.push({line:y,start:0});P=e.nextPath(),d=!1}}return _=_.filter(y=>y.line.length>1),0===_.length?null:_}tt.setExtent(N.CQ),rt.setExtent(N.CQ)},16006:(ut,Q,r)=>{r.d(Q,{k:()=>D});var S=r(77233),k=r(50915);const Y={createComputedParams:N=>N,optionalAttributes:{},attributes:{id:{type:k.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:k.pe.UNSIGNED_BYTE,count:1},pos:{type:k.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:k.pe.FLOAT,count:1,packTessellation:({inverseArea:N})=>N}}};class D extends S.N{constructor(){super(...arguments),this.vertexSpec=Y}createTesselationParams(M){return{inverseArea:1/M.readGeometryArea()}}}},77233:(ut,Q,r)=>{r.d(Q,{N:()=>O});var S=r(10467),k=r(3248),Y=r(8897),D=r(73584),N=r(9368);const W=(0,k.A)("featurelayer-fast-triangulation-enabled");class O extends N.r{loadDependencies(){var p=()=>super.loadDependencies,T=this;return(0,S.A)(function*(){yield Promise.all([p().call(T),(0,Y.F)()])})()}_write(p,T,B){const G=B?.asOptimized()??T.readGeometryForDisplay(),E=this._clip(G);E&&(p.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(p,T,E),p.recordEnd())}_clip(p){return p?(0,D.FE)(p,this.hasEffects?256:8):null}_writeGeometry(p,T,B){const G=B.maxLength>100,E=[],u=this.createTesselationParams(T);if(!G&&W&&(0,D.lO)(E,B))return void(E.length&&this._writeVertices(p,T,B.coords,u,E));const c=(0,D.XZ)(B);this._writeVertices(p,T,c,u)}_writeVertices(p,T,B,G,E){const u=T.getDisplayId(),c=p.vertexCount(),l=this.hasEffects;let m=0;if(E)for(const x of E){const A=B[2*x],C=B[2*x+1];l&&p.recordBounds(A,C,0,0),this._writeVertex(p,u,A,C,G),m++}else for(let x=0;x<B.length;x+=2){const A=Math.round(B[x]),C=Math.round(B[x+1]);l&&p.recordBounds(A,C,0,0),this._writeVertex(p,u,A,C,G),m++}p.indexEnsureSize(m);for(let x=0;x<m;x++)p.indexWrite(x+c)}}},13494:(ut,Q,r)=>{r.d(Q,{KE:()=>p,KI:()=>O,lB:()=>g,oI:()=>W});var S=r(67685),k=r(4139),Y=r(98522),D=r(76740),N=r(90731),M=r(50915);function W(T){const{sprite:B,aspectRatio:G,scaleProportionally:E}=T,u=(0,S.Lz)(T.height);let l=u*G;return l<=0?l=B.width:E&&(l*=B.width/B.height),{width:l,height:u>0?u:B.height}}function O(T){const{applyRandomOffset:B,sampleAlphaOnly:G}=T;return(0,Y.xo)([[N.Fz,B],[N.cn,G]])}const g={createComputedParams:T=>T,optionalAttributes:D.l.optionalAttributes,attributes:{...D.l.attributes,bitset:{count:1,type:M.pe.UNSIGNED_BYTE,pack:O},width:{count:1,type:M.pe.HALF_FLOAT,pack:T=>W(T).width},height:{count:1,type:M.pe.HALF_FLOAT,pack:T=>W(T).height},offset:{count:2,type:M.pe.HALF_FLOAT,pack:({offsetX:T,offsetY:B})=>[(0,S.Lz)(T),-(0,S.Lz)(B)]},scale:{count:2,type:M.pe.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:T,scaleY:B})=>[T,B]},angle:{count:1,type:M.pe.UNSIGNED_BYTE,pack:({angle:T})=>(0,k.wV)(T)}}};class p extends D.m{constructor(){super(...arguments),this.vertexSpec=g}}},58096:(ut,Q,r)=>{r.d(Q,{O:()=>u});var S=r(10467),k=r(67685),Y=r(72137),D=r(13494),N=r(98522),M=r(79184),W=r(80302),O=r(90731),g=r(50915);const p=D.lB,B={createComputedParams:c=>c,optionalAttributes:p.optionalAttributes,attributes:{...p.attributes,bitset:{type:g.pe.UNSIGNED_BYTE,count:1,pack:c=>(0,D.KI)(c)},aux1:{count:1,type:g.pe.HALF_FLOAT,pack:c=>(0,D.oI)(c).width},aux2:{count:1,type:g.pe.HALF_FLOAT,pack:c=>(0,D.oI)(c).height},aux3:{count:2,type:g.pe.HALF_FLOAT,pack:({offsetX:c,offsetY:l})=>[(0,k.Lz)(c),(0,k.Lz)(l)]},aux4:{count:2,type:g.pe.UNSIGNED_BYTE,pack:({scaleX:c,scaleY:l})=>[c*W.cZ,l*W.cZ]}}},G={createComputedParams:c=>c,optionalAttributes:p.optionalAttributes,attributes:{...p.attributes,color:M.e4.attributes.color,bitset:{type:g.pe.UNSIGNED_BYTE,count:1,pack:c=>(0,N.xo)([[O.Xx,!0]])},aux1:{count:1,type:g.pe.HALF_FLOAT,pack:c=>(0,k.Lz)(.5*c.width)},aux2:{count:1,type:g.pe.HALF_FLOAT,pack:c=>(0,k.Lz)(.5*c.referenceWidth)},aux3:{count:2,type:g.pe.HALF_FLOAT,packTessellation:({extrusionOffsetX:c,extrusionOffsetY:l})=>[c,l]},aux4:{count:2,type:g.pe.UNSIGNED_BYTE,packTessellation:({normalX:c,normalY:l})=>[c*W.cZ+W.v9,l*W.cZ+W.v9]}}};class E extends M.eY{constructor(){super(...arguments),this.vertexSpec=G}}class u extends M.w0{constructor(){super(...arguments),this.vertexSpec=B}_createOutlineWriter(l,m,x,A){return new E(l,m,x,A)}_write(l,m,x){const A=x?.asOptimized()??m.readGeometryForDisplay(),C=this._clip(A);if(!C)return;const J=this.evaluatedMeshParams.sprite?.textureBinding;l.recordStart(this.instanceId,this.attributeLayout,J),this._writeGeometry(l,m,C),this._lineMeshWriter.writeLineVertices(l,Y.z.fromOptimizedCIM(C,"esriGeometryPolyline"),m),l.recordEnd()}ensurePacked(l,m,x){super.ensurePacked(l,m,x),this._lineMeshWriter.ensurePacked(l,m,x)}enqueueRequest(l,m,x){super.enqueueRequest(l,m,x),this._lineMeshWriter.enqueueRequest(l,m,x)}loadDependencies(){var l=()=>super.loadDependencies,m=this;return(0,S.A)(function*(){yield Promise.all([l().call(m),m._lineMeshWriter.loadDependencies()])})()}}},82870:(ut,Q,r)=>{r.d(Q,{Y:()=>M,v:()=>N});var S=r(47669),k=r(77233),Y=r(98522),D=r(50915);const N={createComputedParams:W=>W,optionalAttributes:{zoomRange:{type:D.pe.SHORT,count:2,packPrecisionFactor:S.fq,pack:({scaleInfo:W},{tileInfo:O})=>(0,Y.My)(W,O)}},attributes:{id:{type:D.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:D.pe.UNSIGNED_BYTE,count:1},pos:{type:D.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:D.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:W})=>(0,Y.Jb)(W)}}};class M extends k.N{constructor(){super(...arguments),this.vertexSpec=N}createTesselationParams(O){return null}}},79184:(ut,Q,r)=>{r.d(Q,{Lm:()=>p,e4:()=>T,eY:()=>B,w0:()=>G});var S=r(10467),k=r(72137),Y=r(73584),D=r(82870),N=r(98522),M=r(26248),W=r(1416),O=r(90731),g=r(50915);const p={createComputedParams:E=>E,optionalAttributes:M.Eq.optionalAttributes,attributes:{...M.Eq.attributes,bitset:{type:g.pe.UNSIGNED_BYTE,count:1,pack:E=>0},color:{type:g.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:E})=>(0,N.Jb)(E)}}},T={createComputedParams:E=>E,optionalAttributes:M.Eq.optionalAttributes,attributes:{...M.Eq.attributes,bitset:{type:g.pe.UNSIGNED_BYTE,count:1,pack:E=>(0,N.xo)([[O.Xx,!0]])},color:{type:g.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:E})=>(0,N.Jb)(E)}}};class B extends M.Bw{constructor(){super(...arguments),this.vertexSpec=T}}class G extends D.Y{constructor(u,c,l,m){super(u,c,l,m),this.vertexSpec=p,this._lineMeshWriter=this._createOutlineWriter(u,c,l,m)}_createOutlineWriter(u,c,l,m){return new B(u,c,l,m)}_write(u,c,l){const m=l?.asOptimized()??c.readGeometryForDisplay(),x=this._clip(m);x&&(u.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(u,c,x),this._lineMeshWriter.writeLineVertices(u,k.z.fromOptimizedCIM(x,"esriGeometryPolyline"),c),u.recordEnd())}_clip(u){return u?(0,Y.FE)(u,(0,W.Z0)(this.evaluatedMeshParams)):null}ensurePacked(u,c,l){super.ensurePacked(u,c,l),this._lineMeshWriter.ensurePacked(u,c,l)}enqueueRequest(u,c,l){super.enqueueRequest(u,c,l),this._lineMeshWriter.enqueueRequest(u,c,l)}loadDependencies(){var u=()=>super.loadDependencies,c=this;return(0,S.A)(function*(){yield Promise.all([u().call(c),c._lineMeshWriter.loadDependencies()])})()}}},76740:(ut,Q,r)=>{r.d(Q,{l:()=>D,m:()=>N});var S=r(47669),k=r(82870),Y=r(50915);const D={createComputedParams:M=>M,optionalAttributes:k.v.optionalAttributes,attributes:{...k.v.attributes,tlbr:{count:4,type:Y.pe.UNSIGNED_SHORT,pack:({sprite:M})=>{const{rect:W,width:O,height:g}=M,p=W.x+S.hM,T=W.y+S.hM;return[p,T,p+O,T+g]}},inverseRasterizationScale:{count:1,type:Y.pe.BYTE,packPrecisionFactor:16,pack:({sprite:M})=>1/M.rasterizationScale}}};class N extends k.Y{constructor(){super(...arguments),this.vertexSpec=D}_write(W,O,g){const p=g?.asOptimized()??O.readGeometryForDisplay(),T=this._clip(p);if(!T)return;const B=this.evaluatedMeshParams.sprite?.textureBinding;W.recordStart(this.instanceId,this.attributeLayout,B),this._writeGeometry(W,O,T),W.recordEnd()}}},7610:(ut,Q,r)=>{r.d(Q,{Q:()=>O});var S=r(10467),k=r(72137),Y=r(79184),D=r(76740);const N={optionalAttributes:D.l.optionalAttributes,createComputedParams:g=>g,attributes:{...D.l.attributes,...Y.Lm.attributes}},M={optionalAttributes:D.l.optionalAttributes,createComputedParams:g=>g,attributes:{...D.l.attributes,...Y.e4.attributes}};class W extends Y.eY{constructor(){super(...arguments),this.vertexSpec=M}}class O extends Y.w0{constructor(){super(...arguments),this.vertexSpec=N}_createOutlineWriter(p,T,B,G){return new W(p,T,B,G)}_write(p,T,B){const G=B?.asOptimized()??T.readGeometryForDisplay(),E=this._clip(G);if(!E)return;const u=this.evaluatedMeshParams.sprite?.textureBinding;p.recordStart(this.instanceId,this.attributeLayout,u),this._writeGeometry(p,T,E),this._lineMeshWriter.writeLineVertices(p,k.z.fromOptimizedCIM(E,"esriGeometryPolyline"),T),p.recordEnd()}ensurePacked(p,T,B){super.ensurePacked(p,T,B),this._lineMeshWriter.ensurePacked(p,T,B)}enqueueRequest(p,T,B){super.enqueueRequest(p,T,B),this._lineMeshWriter.enqueueRequest(p,T,B)}loadDependencies(){var p=()=>super.loadDependencies,T=this;return(0,S.A)(function*(){yield Promise.all([p().call(T),T._lineMeshWriter.loadDependencies()])})()}}},98522:(ut,Q,r)=>{r.d(Q,{By:()=>u,Jb:()=>T,My:()=>O,i8:()=>E,mR:()=>g,qE:()=>G,ue:()=>B,xo:()=>p});var S=r(68677),k=r(5922),Y=r(35150),D=r(65374);const N=()=>Y.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),M=0,W=100;function O(c,l){return[!!c?.minScale&&l.scaleToZoom(c.minScale)||M,!!c?.maxScale&&l.scaleToZoom(c.maxScale)||W]}function g(c){return 1<<c}function p(c){let l=0;for(const[m,x]of c)x&&(l|=1<<m);return l}function T(c){let l;if(!c)return[0,0,0,0];if("string"==typeof c){const J=S.A.fromString(c);if(!J)return N().errorOnce(new k.A("mapview:mesh-processing","Unable to parse string into color",{color:c})),[0,0,0,0];l=J.toArray()}else l=c;const[m,x,A,C]=l;return[m*(C/255),x*(C/255),A*(C/255),C]}function B(c){switch(c){case"butt":case D.uT.Butt:return D.xR.BUTT;case"round":case D.uT.Round:return D.xR.ROUND;case"square":case D.uT.Square:return D.xR.SQUARE}}function G(c){switch(c){case"bevel":case D.wd.Bevel:return D.JO.BEVEL;case"miter":case D.wd.Miter:return D.JO.MITER;case"round":case D.wd.Round:return D.JO.ROUND}}function E(c,l){return Math.round(Math.min(Math.sqrt(c*l),255))}function u(c,l){return Math.round(c*l)/l}},99046:(ut,Q,r)=>{r.d(Q,{h:()=>D});var S=r(9368),k=r(50915);const Y={createComputedParams:N=>N,optionalAttributes:{},attributes:{pos:{type:k.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:k.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:k.pe.UNSIGNED_BYTE,count:1},offset:{type:k.pe.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class D extends S.r{constructor(){super(...arguments),this.vertexSpec=Y}_write(M,W){M.recordStart(this.instanceId,this.attributeLayout);const O=W.getDisplayId();if("esriGeometryPoint"===W.geometryType){const g=W.readXForDisplay(),p=W.readYForDisplay();this._writeQuad(M,O,g,p)}else"esriGeometryMultipoint"===W.geometryType&&W.readGeometryForDisplay()?.forEachVertex((p,T)=>{p>=0&&p<=512&&T>=0&&T<=512&&this._writeQuad(M,O,p,T)});M.recordEnd()}_writeQuad(M,W,O,g){const p=M.vertexCount();this._writeVertex(M,W,O,g),M.indexWrite(p+0),M.indexWrite(p+1),M.indexWrite(p+2),M.indexWrite(p+1),M.indexWrite(p+3),M.indexWrite(p+2)}}},26248:(ut,Q,r)=>{r.d(Q,{Bw:()=>E,Eq:()=>T});var S=r(67685),k=r(72137),Y=r(47669),D=r(7933),N=r(73584),M=r(98522),W=r(9368),O=r(1416),g=r(50915);class p{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}}const T={createComputedParams:u=>u,optionalAttributes:{zoomRange:{type:g.pe.SHORT,count:2,packPrecisionFactor:Y.fq,pack:({scaleInfo:u},{tileInfo:c})=>(0,M.My)(u,c)}},attributes:{id:{type:g.pe.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:g.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:g.pe.UNSIGNED_BYTE,count:1},color:{type:g.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:u})=>(0,M.Jb)(u)},offset:{type:g.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:u,extrusionOffsetY:c})=>[(0,M.By)(u,16),(0,M.By)(c,16)]},normal:{type:g.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:u,normalY:c})=>[(0,M.By)(u,16),(0,M.By)(c,16)]},halfWidth:{type:g.pe.HALF_FLOAT,count:1,pack:({width:u})=>(0,S.Lz)(.5*u)},referenceHalfWidth:{type:g.pe.HALF_FLOAT,count:1,pack:({referenceWidth:u})=>(0,S.Lz)(.5*u)}}};class B{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}}class E extends W.r{constructor(c,l,m,x){super(c,l,m,x),this.vertexSpec=T,this._currentWrite=new B,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._tessParams=new p,this._initializeTessellator()}writeLineVertices(c,l,m){const x=this._getLines(l);null!=x&&this._writeVertices(c,m,x)}_initializeTessellator(){this._lineTessellator=new D.i(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(c,l,m){const x=m??k.z.fromFeatureSetReaderCIM(l);x&&this._writeGeometry(c,l,x)}_writeGeometry(c,l,m,x){c.recordStart(this.instanceId,this.attributeLayout,x),this.writeLineVertices(c,m,l),c.recordEnd()}_getLines(c){return(0,N.uS)(c,(0,O.Z0)(this.evaluatedMeshParams))}_writeVertices(c,l,m){const{_currentWrite:x,_tessellationOptions:A,evaluatedMeshParams:C}=this,{width:J,capType:ot,joinType:j,miterLimit:v,hasSizeVV:f}=C,R=(0,S.Lz)(.5*J);A.halfWidth=R,A.capType=(0,M.ue)(ot),A.joinType=(0,M.qE)(j),A.miterLimit=v;const V=!f;x.out=c,x.id=l.getDisplayId(),x.vertexCount=0,x.indexCount=0,x.vertexFrom=c.vertexCount(),x.vertexBounds=V&&R<Y.Gh?0:1;for(const{line:U,start:X}of m)A.initialDistance=X%65535,this._lineTessellator.tessellate(U,A,V)}_writeTesselatedVertex(c,l,m,x,A,C,J,ot,j,v,f){const{out:R,id:V,vertexBounds:U}=this._currentWrite;return this.hasEffects&&R.recordBounds(c,l,U,U),this._tessParams.extrusionOffsetX=J,this._tessParams.extrusionOffsetY=ot,this._tessParams.normalX=j,this._tessParams.normalY=v,this._tessParams.directionX=A,this._tessParams.directionY=C,this._tessParams.distance=f,this._writeVertex(R,V,c,l,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(c,l,m){const{out:x}=this._currentWrite;x.indexEnsureSize(3),x.indexWrite(c),x.indexWrite(l),x.indexWrite(m),this._currentWrite.indexCount+=3}}},26689:(ut,Q,r)=>{r.d(Q,{K:()=>O});var S=r(72137),k=r(47669),Y=r(98522),D=r(26248),N=r(90731),M=r(50915);const W={createComputedParams:g=>g,optionalAttributes:D.Eq.optionalAttributes,attributes:{...D.Eq.attributes,bitset:{type:M.pe.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:g,shouldScaleDash:p,isSDF:T})=>(0,Y.xo)([[N.cn,g],[N.kx,p],[N.b5,T]])},tlbr:{type:M.pe.UNSIGNED_SHORT,count:4,pack:({sprite:g})=>{const{rect:p,width:T,height:B}=g,G=p.x+k.hM,E=p.y+k.hM;return[G,E,G+T,E+B]}},accumulatedDistance:{type:M.pe.UNSIGNED_SHORT,count:1,packTessellation:({distance:g})=>g},segmentDirection:{type:M.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:g,directionY:p})=>[g,p]}}};class O extends D.Bw{constructor(p,T,B,G){super(p,T,B,G),this.vertexSpec=W,this._tessellationOptions.textured=!0}_write(p,T,B){const G=B??S.z.fromFeatureSetReaderCIM(T);if(!G)return;const{sprite:E}=this.evaluatedMeshParams;this._writeGeometry(p,T,G,E?.textureBinding)}}},37121:(ut,Q,r)=>{r.d(Q,{H:()=>ot});var S=r(67685),k=r(76329),Y=r(3672),D=r(83953),N=r(72137),M=r(84289),W=r(65374),O=r(71725),g=r(47669),p=r(98522),T=r(32117);class B{static from(v){return"width"in v?this.fromSimpleMeshParams(v):this.fromComplexMeshParams(v)}static fromSimpleMeshParams(v){const f=new B(v.sprite,v.color,v.outlineColor,v.minPixelBuffer,v.placement,v.scaleInfo,v.effects),{type:R,width:V,height:U,angle:X,alignment:b,outlineSize:n,referenceSize:a,sprite:L,overrideOutlineColor:z}=v;return f.rawWidth=(0,S.Lz)(V),f.rawHeight=(0,S.Lz)(U),f.angle=X,f.alignment=b,f.outlineSize=(0,S.Lz)(n),f.referenceSize=(0,S.Lz)(a),f.overrideOutlineColor=z,f.offsetX=(0,S.Lz)(v.offsetX),f.offsetY=(0,S.Lz)(v.offsetY),"simple"!==R||L.sdf||(f.rawWidth=L.width,f.rawHeight=L.height),f.sizeRatio=L.sdf?2:1,f._computeSize(v,!1),f}static fromComplexMeshParams(v){const f=new B(v.sprite,v.color,v.outlineColor,v.minPixelBuffer,v.placement,v.scaleInfo,v.effects);let{alignment:R,transforms:V,size:U,scaleX:X,anchorX:b,anchorY:n,angle:a,colorLocked:L,frameHeight:z,widthRatio:I,offsetX:w,offsetY:H,outlineSize:tt,referenceSize:rt,scaleFactor:Z,sizeRatio:st,isAbsoluteAnchorPoint:q,rotateClockwise:dt,scaleSymbolsProportionally:nt,sprite:mt}=v;if(V&&V.infos.length>0){const e=(0,T.zb)(U,a,dt,w,H,V);U=e.size,a=e.rotation,w=e.offsetX,H=e.offsetY,dt=!1}Z&&(U*=Z,w*=Z,H*=Z);const pt=X*(mt.width/mt.height);f.alignment=R,f.rawHeight=(0,S.Lz)(U),f.rawWidth=f.rawHeight*pt,f.referenceSize=(0,S.Lz)(rt),f.sizeRatio=st,f.angle=a,f.rotateClockwise=dt,f.anchorX=b,f.anchorY=n,f.offsetX=(0,S.Lz)(w),f.offsetY=(0,S.Lz)(H),q&&U&&(f.anchorX=mt.sdf?b/(U*I):b/(U*pt),f.anchorY=n/U);const lt=nt&&z?U/z:1;return f.outlineSize=0===tt||isNaN(tt)?0:(0,S.Lz)(tt)*lt,f.scaleSymbolsProportionally=nt,f.colorLocked=L,f._computeSize(v,!0),f}constructor(v,f,R,V,U,X,b){this.sprite=v,this.color=f,this.outlineColor=R,this.minPixelBuffer=V,this.placement=U,this.scaleInfo=X,this.effects=b,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.alignment=W.C1.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(v,f){const{sprite:R,hasSizeVV:V}=v,U=!!R.sdf,{rawWidth:X,rawHeight:b,sizeRatio:n,outlineSize:a}=this,L=X*n,z=b*n;if(U&&!V){const dt=b,nt=a+2;this.computedWidth=Math.min((f&&X>b?L:X)+nt,L),this.computedHeight=Math.min(dt+nt,z)}else this.computedWidth=L,this.computedHeight=z;const I=U?Math.max(R.width,R.height)/Math.max(L,z):1,w=.5*(L-this.computedWidth)*I,H=.5*(z-this.computedHeight)*I,tt=R.rect.x+g.hM+w,rt=R.rect.y+g.hM+H,Z=tt+R.width-2*w,st=rt+R.height-2*H;this.texXmin=Math.floor(tt),this.texYmin=Math.floor(rt),this.texXmax=Math.ceil(Z),this.texYmax=Math.ceil(st),this.computedWidth*=(this.texXmax-this.texXmin)/(Z-tt),this.computedHeight*=(this.texYmax-this.texYmin)/(st-rt),this.anchorX*=L/this.computedWidth,this.anchorY*=z/this.computedHeight}}var G=r(93300),E=r(23263),u=r(9368),c=r(50915);const m=128/Math.PI;const J={createComputedParams:j=>B.from(j),optionalAttributes:{zoomRange:{type:c.pe.SHORT,count:2,packPrecisionFactor:g.fq,pack:({scaleInfo:j},{tileInfo:v})=>(0,p.My)(j,v)}},attributes:{pos:{type:c.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:c.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:c.pe.UNSIGNED_BYTE,count:1,pack:({sprite:j,alignment:v,scaleSymbolsProportionally:f,overrideOutlineColor:R,colorLocked:V})=>{let U=0;return j.sdf&&(U|=(0,p.mR)(G.c.bitset.isSDF)),v===W.C1.MAP&&(U|=(0,p.mR)(G.c.bitset.isMapAligned)),f&&(U|=(0,p.mR)(G.c.bitset.scaleSymbolsProportionally)),R&&(U|=(0,p.mR)(G.c.bitset.overrideOutlineColor)),V&&(U|=(0,p.mR)(G.c.bitset.colorLocked)),U}},offset:{type:c.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:j,computedWidth:v,computedHeight:f,anchorX:R,anchorY:V,offsetX:U,offsetY:X,rotateClockwise:b})=>{const n=function C(j,v,f,R,V=!1){const U=(0,Y.vt)(),X=V?1:-1;return(0,k.D_)(U),(v||f)&&(0,k.Tl)(U,U,[v,-f]),R&&(0,k.e$)(U,U,.017453292519944444*X*-R),U}(0,U,X,-j,b),a=-(.5+R)*v,L=-(.5-V)*f,z=[a,L],I=[a+v,L],w=[a,L+f],H=[a+v,L+f];return(0,D.l0)(z,z,n),(0,D.l0)(I,I,n),(0,D.l0)(w,w,n),(0,D.l0)(H,H,n),[z,I,w,H]}}},textureUV:{type:c.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:j,texXmin:v,texYmax:f,texYmin:R})=>[[v,R],[j,R],[v,f],[j,f]]}},color:{type:c.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:j})=>(0,p.Jb)(j)},outlineColor:{type:c.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:j})=>(0,p.Jb)(j)},sizing:{type:c.pe.UNSIGNED_BYTE,count:4,pack:({rawWidth:j,rawHeight:v,outlineSize:f,referenceSize:R})=>{const V=Math.max(j,v);return[(0,p.i8)(V,128),(0,p.i8)(f,128),(0,p.i8)(R,128),0]}},placementAngle:{type:c.pe.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:j})=>function A(j){return function x(j,v){return j%=v,Math.abs(j>=0?j:j+v)}(j*m,256)}(j)},sizeRatio:{type:c.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:j})=>j}}};class ot extends u.r{constructor(){super(...arguments),this.vertexSpec=J}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(v,f,R){const V=this.evaluatedMeshParams.sprite?.textureBinding,U=f.getDisplayId();v.recordStart(this.instanceId,this.attributeLayout,V);const X=this.evaluatedMeshParams.minPixelBuffer,b=Math.max(this.evaluatedMeshParams.computedWidth,X),n=Math.max(this.evaluatedMeshParams.computedHeight,X),a=this.evaluatedMeshParams.offsetX,L=-this.evaluatedMeshParams.offsetY;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(v,f,R,b,n);else if(R?.nextPath()){R.nextPoint();const z=R.x,I=R.y;v.recordBounds(z+a,I+L,b,n),this._writeQuad(v,U,z,I)}else if("esriGeometryPolygon"===f.geometryType){const z=f.readCentroidForDisplay();if(!z)return;const[I,w]=z.coords;v.recordBounds(I+a,w+L,b,n),this._writeQuad(v,U,I,w)}else if("esriGeometryPoint"===f.geometryType){const z=f.readXForDisplay(),I=f.readYForDisplay();v.recordBounds(z+a,I+L,b,n),this._writeQuad(v,U,z,I)}else f.readGeometryForDisplay()?.forEachVertex((I,w)=>{v.recordBounds(I+a,w+L,b,n),Math.abs(I)>M.s||Math.abs(w)>M.s||this._writeQuad(v,U,I,w)});v.recordEnd()}_writePlacedMarkers(v,f,R,V,U){const X=R??N.z.fromFeatureSetReaderCIM(f)?.clone();if(!X)return;const n=O.l.getPlacement(X,-1,this.evaluatedMeshParams.placement,(0,S.Lz)(1),v.id,(0,E.z)());if(!n)return;const a=f.getDisplayId();let L=n.next();const z=this.evaluatedMeshParams.offsetX,I=-this.evaluatedMeshParams.offsetY;for(;null!=L;){const w=L.tx,H=-L.ty;if(Math.abs(w)>M.s||Math.abs(H)>M.s){L=n.next();continue}const tt=-L.getAngle();v.recordBounds(w+z,H+I,V,U),this._writeQuad(v,a,w,H,tt),L=n.next()}}_writeQuad(v,f,R,V,U){const X=v.vertexCount();this._writeVertex(v,f,R,V,null==U?null:{placementAngle:U}),v.indexWrite(X+0),v.indexWrite(X+1),v.indexWrite(X+2),v.indexWrite(X+1),v.indexWrite(X+3),v.indexWrite(X+2)}}},9368:(ut,Q,r)=>{r.d(Q,{r:()=>u});var S=r(10467),k=r(72137),Y=r(10223),D=r(23263),N=r(97550),W=(r(3248),r(1416)),O=r(50915);function g(c){switch(c){case O.pe.BYTE:case O.pe.UNSIGNED_BYTE:return 1;case O.pe.SHORT:case O.pe.UNSIGNED_SHORT:case O.pe.HALF_FLOAT:return 2;case O.pe.FLOAT:case O.pe.INT:case O.pe.UNSIGNED_INT:return 4}}class T{static fromVertexSpec(l,m){const{attributes:x,optionalAttributes:A}=l;let C,J,ot;const j=[];for(const b in x){const n=x[b];"position"===n.pack?C={...n,name:b,offset:0}:"id"===n.pack?J={...n,name:b,offset:4}:"bitset"===b?ot={...n,name:b,offset:7}:j.push({...n,name:b})}for(const b in A)!0===m[b]&&j.push({...A[b],name:b});const v=function p(c){const l=[],m=[],x=[];for(const A of c){const C=g(A.type)*A.count;switch(C%2||C%4||4){case 4:l.push(A);continue;case 2:m.push(A);continue;case 1:x.push(A);continue;default:throw new Error("Found unexpected dataType byte count")}}return l.push(...m),l.push(...x),l}(j),f=[];let R=8,V=1;for(const b of v)f.push({...b,offset:R}),R+=g(b.type)*b.count,b.packAlternating&&(V=Math.max(b.packAlternating.count,V));const U=Uint32Array.BYTES_PER_ELEMENT,X=R%U;return new T(C,J,ot,f,R+(X?U-X:0),V)}constructor(l,m,x,A,C,J){this.position=l,this.id=m,this.bitset=x,this.standardAttributes=A,this.stride=C,this.packVertexCount=J,A.push(x),this._attributes=[l,m,x,...A]}get attributeLayout(){if(!this._attributeLayout){const l=(0,W.hU)(this._attributes),m=this._attributes.map(x=>({name:x.name,count:x.count,offset:x.offset,type:x.type,packPrecisionFactor:x.packPrecisionFactor,normalized:x.normalized??!1}));this._attributeLayout={attributes:m,hash:l,stride:this.stride}}return this._attributeLayout}}var B=r(73991);class G{static fromVertexSpec(l,m){const x=T.fromVertexSpec(l,m);return new G(x)}constructor(l){this._spec=l,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(l,m,x,A,C,J){for(let ot=0;ot<this._spec.packVertexCount;ot++){const j=ot*this._spec.stride;this._packPosition(x,A,j),this._packId(m,j);const v=this._spec.bitset;if(J){if(v.packTessellation){const f=v.packTessellation(J,C);this._pack(f,v,j)}for(const f of this._spec.standardAttributes)if(null!=f.packTessellation){const R=f.packTessellation(J,C);this._pack(R,f,j)}else if(f.packAlternating?.packTessellation){const R=f.packAlternating.packTessellation(J,C);for(let V=0;V<this._spec.packVertexCount;V++)this._pack(R[V],f,V*this._spec.stride)}}}l.vertexWriteRegion(this._packedU32View)}pack(l,m){for(const x of this._spec.standardAttributes)if(x.pack&&"string"!=typeof x.pack){const A=x.pack(l,m);for(let C=0;C<this._spec.packVertexCount;C++)this._pack(A,x,C*this._spec.stride)}else if(x.packAlternating?.pack){const A=x.packAlternating.pack(l,m);for(let C=0;C<this._spec.packVertexCount;C++)this._pack(A[C],x,C*this._spec.stride)}}_packPosition(l,m,x){const{offset:A}=this._spec.position,C=this._spec.position.packPrecisionFactor??1,J=(0,N.M9)(l*C,m*C);this._dataView.setUint32(x+A,J,!0)}_packId(l,m){const x=l*(this._spec.id.packPrecisionFactor??1),A=4278190080&this._dataView.getUint32(m+this._spec.id.offset,!0);this._dataView.setUint32(m+this._spec.id.offset,x|A,!0)}_pack(l,m,x){(0,B.F)(this._dataView,l,m,x)}}class u{constructor(l,m,x,A){this._instanceId=l,this._evaluator=m,this._enabledOptionalAttributes=x,this._viewParams=A,this._evaluator.evaluator=C=>this.vertexSpec.createComputedParams(C)}get _vertexPack(){if(!this._cachedVertexPack){const l=G.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||l.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=l}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(l){this._references=l}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}loadDependencies(){var l=this;return(0,S.A)(function*(){(function E(c){if(!c)return!1;for(const l of c)switch(l.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1})(l._evaluator.inputMeshParams.effects?.effectInfos)&&(yield(0,D.R)())})()}enqueueRequest(l,m,x){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(l,m,x)}write(l,m,x,A,C){this.ensurePacked(m,x,A);const J=this.evaluatedMeshParams.effects;if(!J||0===J.length)return void this._write(l,x,void 0,C);const ot=x.readGeometryForDisplay()?.clone();if(!ot)return;const j=k.z.fromOptimizedCIM(ot,x.geometryType),v=(0,D.z)();j.invertY();const R=Y.V.executeEffects(J,j,l.id||"",v);let V;for(;V=R.next();)V.invertY(),this._write(l,x,V,C)}ensurePacked(l,m,x){if(!this._evaluator.hasDynamicProperties)return;const A=this._evaluator.evaluateMeshParams(l,m,x);this._vertexPack.pack(A,this._viewParams)}_writeVertex(l,m,x,A,C){this._vertexPack.writeVertex(l,m,x,A,this.evaluatedMeshParams,C)}}},23263:(ut,Q,r)=>{r.d(Q,{R:()=>D,z:()=>Y});var S=r(10467);let k=null;function Y(){return k}function D(){return N.apply(this,arguments)}function N(){return(N=(0,S.A)(function*(){k=yield Promise.all([r.e(3930),r.e(2076)]).then(r.bind(r,27815))})).apply(this,arguments)}},8052:(ut,Q,r)=>{r.d(Q,{v:()=>M});var S=r(67685),k=r(98522),Y=r(9368),D=r(50915);const N={createComputedParams:W=>W,optionalAttributes:{},attributes:{pos:{type:D.pe.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:D.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:D.pe.UNSIGNED_BYTE,count:1,pack:W=>0},offset:{type:D.pe.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:W})=>{const O=(0,S.Lz)(W),g=-O/2,p=-O/2;return[[g,p],[g+O,p],[g,p+O],[g+O,p+O]]}}},texCoords:{type:D.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:D.pe.UNSIGNED_BYTE,count:2,pack:({size:W})=>[W,W]},referenceSize:{type:D.pe.UNSIGNED_BYTE,count:1,pack:({size:W})=>(0,S.Lz)(W)},zoomRange:{type:D.pe.UNSIGNED_BYTE,count:2,pack:({scaleInfo:W},{tileInfo:O})=>(0,k.My)(W,O)}}};class M extends Y.r{constructor(){super(...arguments),this.vertexSpec=N}_write(O,g){const p=g.getDisplayId(),T=this.evaluatedMeshParams.minPixelBuffer,B=Math.max((0,S.Lz)(this.evaluatedMeshParams.size),T);let G,E;if("esriGeometryPoint"===g.geometryType)G=g.readXForDisplay(),E=g.readYForDisplay();else{const c=g.readCentroidForDisplay();if(!c)return;G=c?.coords[0],E=c?.coords[1]}O.recordStart(this.instanceId,this.attributeLayout),O.recordBounds(G,E,B,B);const u=O.vertexCount();this._writeVertex(O,p,G,E),O.indexWrite(u+0),O.indexWrite(u+1),O.indexWrite(u+2),O.indexWrite(u+1),O.indexWrite(u+3),O.indexWrite(u+2),O.recordEnd()}}},3991:(ut,Q,r)=>{r.d(Q,{G8:()=>U,GJ:()=>c});var S=r(69287),k=r(67685),Y=r(72137),D=r(71725),N=r(30365),M=r(47669),W=r(42058),O=r(98522),g=r(23263),p=r(9368),T=r(90731),B=r(32117);class E{constructor(n){const{offsetX:a,offsetY:L,postAngle:z,fontSize:I,scaleFactor:w,transforms:H}=n;if(this.offsetX=a,this.offsetY=L,this.postAngle=z,this.fontSize=Math.min(I,96),this.transforms=H,H&&H.infos.length>1){const tt=(0,B.zb)(I,z,!1,a,L,H);this.fontSize=Math.min(tt.size,96),this.postAngle=tt.rotation,this.offsetX=tt.offsetX,this.offsetY=tt.offsetY}w&&(this.fontSize*=w,this.offsetX*=w,this.offsetY*=w)}}var u=r(50915);const c=28,l=[4,4],m=[16,4],x={topLeft:m,topRight:m,bottomLeft:m,bottomRight:m},A=[4,2],C=[4,6],J={topLeft:A,topRight:A,bottomLeft:C,bottomRight:C},ot={topLeft:A,topRight:C,bottomLeft:A,bottomRight:C},j={topLeft:C,topRight:C,bottomLeft:l,bottomRight:l},v={topLeft:l,topRight:l,bottomLeft:C,bottomRight:C},f={topLeft:C,topRight:l,bottomLeft:C,bottomRight:l},R={topLeft:l,topRight:C,bottomLeft:l,bottomRight:C},V={createComputedParams:b=>b,optionalAttributes:{zoomRange:{type:u.pe.UNSIGNED_SHORT,count:2,packPrecisionFactor:M.fq,packTessellation:({minZoom:b,maxZoom:n})=>[b||0,n||c]},clipAngle:{type:u.pe.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:b})=>X(b||0)},referenceSymbol:{type:u.pe.BYTE,count:4,packPrecisionFactor:1,packTessellation:(b,n)=>{if(!b.referenceBounds)return[0,0,0,0];const a=(0,N.iT)(n.horizontalAlignment),L=(0,N.Dy)(n.verticalAlignment),{offsetX:z,offsetY:I,size:w}=b.referenceBounds;return[(0,k.Lz)(z),-(0,k.Lz)(I),(0,k.Lz)(w),a+1<<2|L+1]}}},attributes:{pos:{type:u.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:u.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:u.pe.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:b,mapAligned:n})=>(0,O.xo)([[T.bg,b],[T.ti,!!n]])},offset:{type:u.pe.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:b})=>{const{bottomLeft:n,bottomRight:a,topLeft:L,topRight:z}=b;return[L,z,n,a]}}},textureUV:{type:u.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:b})=>{const{bottomLeft:n,bottomRight:a,topLeft:L,topRight:z}=b;return[L,z,n,a]}}},color:{type:u.pe.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:b})=>b},fontSize:{type:u.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:b})=>(0,k.Lz)(b)},referenceSize:{type:u.pe.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:b},{referenceSize:n})=>(0,k.Lz)(n??b)},haloColor:{type:u.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:b})=>(0,O.Jb)(b)},haloFontSize:{type:u.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:b})=>(0,k.Lz)(b)}}};class U extends p.r{constructor(){super(...arguments),this.vertexSpec=V,this._textMeshParamsPropsInitialized=!1}ensurePacked(n,a,L){super.ensurePacked(n,a,L),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new E(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(n,a,L){const z=this._getShaping();if(!z)return;const I=a.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(n,a,z,L);if(L?.nextPath())return L.nextPoint(),this._writeGlyphs(n,I,L.x,L.y,z,0);if("esriGeometryPolygon"===a.geometryType){const tt=a.readCentroidForDisplay();if(!tt)return;const[rt,Z]=tt.coords;return this._writeGlyphs(n,I,rt,Z,z,0)}if("esriGeometryMultipoint"===a.geometryType)return void a.readGeometryForDisplay()?.forEachVertex((rt,Z)=>this._writeGlyphs(n,I,rt,Z,z,0));const w=a.readXForDisplay(),H=a.readYForDisplay();return this._writeGlyphs(n,I,w,H,z,0)}_writePlacedTextMarkers(n,a,L,z){const I=z??Y.z.fromFeatureSetReaderCIM(a);if(!I)return;const H=D.l.getPlacement(I,-1,this.evaluatedMeshParams.placement,(0,k.Lz)(1),n.id,(0,g.z)());if(!H)return;const tt=a.getDisplayId();let rt=H.next();for(;null!=rt;){const Z=rt.tx,st=-rt.ty,q=-rt.getAngle();this._writeGlyphs(n,tt,Z,st,L,q),rt=H.next()}}_getShaping(n){const a=this._textMeshTransformProps,L=this.evaluatedMeshParams;if(!L.glyphs?.glyphs.length)return null;const z=Math.round((0,k.Lz)(a.fontSize)),I=(0,k.Lz)(a.offsetX),w=(0,k.Lz)(a.offsetY),H=(0,S.qE)((0,k.Lz)(L.lineWidth),M.GR,M.cp),tt=M.DY*(0,S.qE)(L.lineHeightRatio,.25,4);return(0,W.Tl)(L.glyphs,{scale:z/M.eG,angle:a.postAngle,xOffset:I,yOffset:w,horizontalAlignment:L.horizontalAlignment,verticalAlignment:n||L.verticalAlignment,maxLineWidth:H,lineHeight:tt,decoration:L.decoration,borderLineSizePx:(0,k.Lz)(L.boxBorderLineSize),hasBackground:!!L.boxBackgroundColor,useCIMAngleBehavior:L.useCIMAngleBehavior})}_writeGlyphs(n,a,L,z,I,w,H,tt){const rt=this.evaluatedMeshParams,Z=this._textMeshTransformProps,st=Z.fontSize,q=(0,k.Lz)(Z.offsetX),dt=(0,k.Lz)(Z.offsetY),[nt,mt]=(0,O.My)(rt.scaleInfo,this.getTileInfo());0!==w&&I.setRotation(w);const pt=I.bounds,lt=L+pt.x+q,e=z+pt.y-dt,o=2*(rt.minPixelBuffer?rt.minPixelBuffer/st:1),i=Math.max(pt.width,pt.height)*o;I.textBox&&(n.recordStart(this.instanceId,this.attributeLayout,I.glyphs[0].textureBinding),n.recordBounds(lt,e,i,i),this._writeTextBox(n,a,L,z,I.textBox,H,tt),n.recordEnd());for(const h of I.glyphs){n.recordStart(this.instanceId,this.attributeLayout,h.textureBinding),n.recordBounds(lt,e,i,i);const{texcoords:s,offsets:_}=h;this._writeQuad(n,a,L,z,{texcoords:s,offsets:_,fontSize:st,color:(0,O.Jb)(rt.color),isBackground:!1,referenceBounds:H,minZoom:nt,maxZoom:mt,...tt}),n.recordEnd()}0!==w&&I.setRotation(-w)}_writeTextBox(n,a,L,z,I,w,H){const tt=this.evaluatedMeshParams,{fontSize:rt}=this._textMeshTransformProps,{boxBackgroundColor:Z,boxBorderLineColor:st}=tt,q={isBackground:!0,fontSize:rt,referenceBounds:w,...H};Z&&(this._writeQuad(n,a,L,z,{texcoords:x,offsets:I.main,color:(0,O.Jb)(Z),...q}),st||(this._writeQuad(n,a,L,z,{texcoords:j,offsets:I.top,color:(0,O.Jb)(Z),...q}),this._writeQuad(n,a,L,z,{texcoords:v,offsets:I.bot,color:(0,O.Jb)(Z),...q}),this._writeQuad(n,a,L,z,{texcoords:f,offsets:I.left,color:(0,O.Jb)(Z),...q}),this._writeQuad(n,a,L,z,{texcoords:R,offsets:I.right,color:(0,O.Jb)(Z),...q}))),st&&(this._writeQuad(n,a,L,z,{texcoords:J,offsets:I.top,color:(0,O.Jb)(st),...q}),this._writeQuad(n,a,L,z,{texcoords:J,offsets:I.bot,color:(0,O.Jb)(st),...q}),this._writeQuad(n,a,L,z,{texcoords:ot,offsets:I.left,color:(0,O.Jb)(st),...q}),this._writeQuad(n,a,L,z,{texcoords:ot,offsets:I.right,color:(0,O.Jb)(st),...q}))}_writeQuad(n,a,L,z,I){const w=n.vertexCount();this._writeVertex(n,a,L,z,I),n.indexWrite(w+0),n.indexWrite(w+1),n.indexWrite(w+2),n.indexWrite(w+1),n.indexWrite(w+3),n.indexWrite(w+2)}}const X=b=>Math.round(b*(254/360))}}]);