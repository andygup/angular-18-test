"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[2379],{40856:(Y,D,u)=>{u.d(D,{X_:()=>F,i1:()=>U,zx:()=>h});var A=u(69287),y=u(82663);const j=96;function F(g,O){const f=O||g.extent,B=g.width,$=(0,y.GA)(f?.spatialReference);return f&&B?f.width/B*$*y.dy*j:0}function U(g,O){return g/((0,y.GA)(O)*y.dy*j)}function h(g,O,f){return function m(g,O){return 0===O||(0,A.Sp)(g,O)||g<O}(g,O)&&function w(g,O){return 0===O||(0,A.Sp)(g,O)||g>O}(g,f)}},14916:(Y,D,u)=>{function A(F){const U=F.layer;return"floorInfo"in U&&U.floorInfo?.floorField&&"floors"in F.view?j(F.view.floors,U.floorInfo.floorField):null}function y(F,U){return"floorInfo"in U&&U.floorInfo?.floorField?j(F,U.floorInfo.floorField):null}function j(F,U){if(!F?.length)return null;const R=F.filter(x=>""!==x).map(x=>`'${x}'`);return R.push("''"),`${U} IN (${R.join(",")}) OR ${U} IS NULL`}u.d(D,{E:()=>A,f:()=>y})},87293:(Y,D,u)=>{u.d(D,{Sk:()=>j,Zx:()=>y,_X:()=>U});var A=u(26514);function y(R,x,I){return x.flatten(({sublayers:m})=>m).length!==R.length||!!R.some(m=>m.originIdOf("minScale")>I||m.originIdOf("maxScale")>I||m.originIdOf("renderer")>I||m.originIdOf("labelingInfo")>I||m.originIdOf("opacity")>I||m.originIdOf("labelsVisible")>I||m.originIdOf("source")>I)||!F(R,x)}function j(R,x,I){return!!R.some(h=>{const m=h.source,w=!m||"map-layer"===m.type&&m.mapLayerId===h.id&&(null==m.gdbVersion||m.gdbVersion===I);return h.commitProperty("renderer"),h.commitProperty("labelingInfo"),h.commitProperty("opacity"),h.commitProperty("labelsVisible"),!w||h.originIdOf("renderer")>A.Gr.SERVICE||h.originIdOf("labelingInfo")>A.Gr.SERVICE||h.originIdOf("opacity")>A.Gr.SERVICE||h.originIdOf("labelsVisible")>A.Gr.SERVICE})||!F(R,x)}function F(R,x){if(!R?.length||null==x)return!0;const I=x.slice().reverse().flatten(({sublayers:w})=>w&&w.toArray().reverse()).map(w=>w.id).toArray();if(R.length>I.length)return!1;let h=0;const m=I.length;for(const{id:w}of R){for(;h<m&&I[h]!==w;)h++;if(h>=m)return!1}return!0}function U(R){return!!R&&R.some(x=>null!=x.minScale||null!=x.layerDefinition?.minScale)}},47624:(Y,D,u)=>{u.d(D,{Uh:()=>H,ox:()=>Le});var A=u(10467),y=u(8189),j=u(81098),F=u(98877),U=u(89952),R=u(31178),x=u(5922),I=u(17715),h=u(3248),m=u(60797),w=u(56492),g=u(48900),O=u(82663),f=u(85211),$=(u(35150),u(76576)),k=u(28067),J=u(40856),he=u(86300),_=u(14916);function q(i,r){return r?"xoffset"in r&&r.xoffset?Math.max(i,Math.abs(r.xoffset)):"yoffset"in r&&r.yoffset?Math.max(i,Math.abs(r.yoffset||0)):i:i}function se(i,r){return"number"==typeof i?i:i?.stops?.length?function me(i){let r=0,o=0;for(let l=0;l<i.length;l++){const s=i[l].size;"number"==typeof s&&(r+=s,o++)}return r/o}(i.stops):r}function le(i){const r=i?.renderer,o=i?.pointerType,l="touch"===o?9:6;if(!r)return l;const s="visualVariables"in r?function ge(i,r){if(!r)return i;const o=r.filter(c=>"size"===c.type).map(c=>{const{maxSize:E,minSize:p}=c;return(se(E,i)+se(p,i))/2});let l=0;const s=o.length;if(0===s)return i;for(let c=0;c<s;c++)l+=o[c];const a=Math.floor(l/s);return Math.max(a,i)}(l,r.visualVariables):l;if("simple"===r.type)return q(s,r.symbol);if("unique-value"===r.type){let a=s;return r.uniqueValueInfos?.forEach(c=>{a=q(a,c.symbol)}),a}if("class-breaks"===r.type){let a=s;return r.classBreakInfos.forEach(c=>{a=q(a,c.symbol)}),a}return s}var ve=u(89563),xe=u(77098),ee=u(68800),Me=u(63484),ae=u(61320),be=u(58701),Ae=u(87293);var te,Oe=u(21152),Re=u(12849),ue=u(71065),we=u(55739),pe=(u(40707),u(50305)),Pe=u(32034);let M=te=class extends ue.oY{static from(i){return(0,we.PZ)(te,i)}constructor(i){super(i),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.historicMoment=null,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}writeHistoricMoment(i,r){r.historicMoment=i&&i.getTime()}};(0,y._)([(0,f.MZ)({type:Number,json:{write:!0}})],M.prototype,"dpi",void 0),(0,y._)([(0,f.MZ)()],M.prototype,"floors",void 0),(0,y._)([(0,f.MZ)({type:String,json:{write:!0}})],M.prototype,"gdbVersion",void 0),(0,y._)([(0,f.MZ)({types:Oe.yR,json:{read:ae.rS,write:!0}})],M.prototype,"geometry",void 0),(0,y._)([(0,f.MZ)({type:Number,json:{write:!0}})],M.prototype,"geometryPrecision",void 0),(0,y._)([(0,f.MZ)({type:Number,json:{write:!0}})],M.prototype,"height",void 0),(0,y._)([(0,f.MZ)({type:Date})],M.prototype,"historicMoment",void 0),(0,y._)([(0,pe.K)("historicMoment")],M.prototype,"writeHistoricMoment",null),(0,y._)([(0,f.MZ)({type:[Number],json:{write:!0}})],M.prototype,"layerIds",void 0),(0,y._)([(0,f.MZ)({type:["top","visible","all","popup"],json:{write:!0}})],M.prototype,"layerOption",void 0),(0,y._)([(0,f.MZ)({type:k.A,json:{write:!0}})],M.prototype,"mapExtent",void 0),(0,y._)([(0,f.MZ)({type:Number,json:{write:!0}})],M.prototype,"maxAllowableOffset",void 0),(0,y._)([(0,f.MZ)({type:Boolean,json:{write:!0}})],M.prototype,"returnFieldName",void 0),(0,y._)([(0,f.MZ)({type:Boolean,json:{write:!0}})],M.prototype,"returnGeometry",void 0),(0,y._)([(0,f.MZ)({type:Boolean,json:{write:!0}})],M.prototype,"returnM",void 0),(0,y._)([(0,f.MZ)({type:Boolean,json:{write:!0}})],M.prototype,"returnUnformattedValues",void 0),(0,y._)([(0,f.MZ)({type:Boolean,json:{write:!0}})],M.prototype,"returnZ",void 0),(0,y._)([(0,f.MZ)({type:Pe.A,json:{write:!0}})],M.prototype,"spatialReference",void 0),(0,y._)([(0,f.MZ)()],M.prototype,"sublayers",void 0),(0,y._)([(0,f.MZ)({type:Re.A,json:{write:!0}})],M.prototype,"timeExtent",void 0),(0,y._)([(0,f.MZ)({type:Number,json:{write:!0}})],M.prototype,"tolerance",void 0),(0,y._)([(0,f.MZ)({type:Number,json:{write:!0}})],M.prototype,"width",void 0),M=te=(0,y._)([(0,$.$)("esri.rest.support.IdentifyParameters")],M);const ye=M;var Ue=u(17221),Fe=u(6434);let C=class extends ue.oY{constructor(i){super(i),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(i,r){return j.A.fromJSON({attributes:{...r.attributes},geometry:{...r.geometry}})}writeFeature(i,r){if(!i)return;const{attributes:o,geometry:l}=i;o&&(r.attributes={...o}),null!=l&&(r.geometry=l.toJSON(),r.geometryType=Fe.Y.toJSON(l.type))}};(0,y._)([(0,f.MZ)({type:String,json:{write:!0}})],C.prototype,"displayFieldName",void 0),(0,y._)([(0,f.MZ)({type:j.A})],C.prototype,"feature",void 0),(0,y._)([(0,Ue.w)("feature",["attributes","geometry"])],C.prototype,"readFeature",null),(0,y._)([(0,pe.K)("feature")],C.prototype,"writeFeature",null),(0,y._)([(0,f.MZ)({type:Number,json:{write:!0}})],C.prototype,"layerId",void 0),(0,y._)([(0,f.MZ)({type:String,json:{write:!0}})],C.prototype,"layerName",void 0),C=(0,y._)([(0,$.$)("esri.rest.support.IdentifyResult")],C);const je=C;function re(){return(re=(0,A.A)(function*(i,r,o){const l=(r=function Ve(i){return ye.from(i)}(r)).geometry?[r.geometry]:[],s=(0,ee.Dl)(i);return s.path+="/identify",(0,xe.el)(l).then(a=>{const c=function Ie(i,r){const{dpi:o,gdbVersion:l,geometry:s,geometryPrecision:a,height:c,historicMoment:E,layerOption:p,mapExtent:P,maxAllowableOffset:d,returnFieldName:b,returnGeometry:v,returnUnformattedValues:G,returnZ:S,spatialReference:L,timeExtent:V,tolerance:T,width:Z}=i.toJSON(),{dynamicLayers:z,layerDefs:K,layerIds:Q}=function Ee(i){const{mapExtent:r,floors:o,width:l,sublayers:s,layerIds:a,layerOption:c,gdbVersion:E}=i,p=s?.find(S=>null!=S.layer)?.layer?.serviceSublayers,P="popup"===c,d={},b=(0,J.X_)({extent:r,width:l,spatialReference:r?.spatialReference}),v=[],G=S=>{if(S.visible&&(0===b||(0===S.minScale||b<=S.minScale)&&(0===S.maxScale||b>=S.maxScale)))if(S.sublayers)S.sublayers.forEach(G);else{if(!1===a?.includes(S.id)||P&&(!S.popupTemplate||!S.popupEnabled))return;v.unshift(S)}};if(s?.forEach(G),s&&!v.length)d.layerIds=[];else{const S=(0,Ae.Sk)(v,p,E),L=v.map(V=>{const T=(0,_.f)(o,V);return V.toExportImageJSON(T)});if(S)d.dynamicLayers=JSON.stringify(L);else{if(s){let T=v.map(({id:Z})=>Z);a&&(T=T.filter(Z=>a.includes(Z))),d.layerIds=T}else a?.length&&(d.layerIds=a);const V=function Se(i,r){const o=!!i?.length,l=r.filter(s=>null!=s.definitionExpression||o&&null!=s.floorInfo);return l.length?l.map(s=>{const a=(0,_.f)(i,s),c=(0,Me.m)(a,s.definitionExpression);return{id:s.id,definitionExpression:c??void 0}}):null}(o,v);if(null!=V&&V.length){const T={};for(const Z of V)Z.definitionExpression&&(T[Z.id]=Z.definitionExpression);Object.keys(T).length&&(d.layerDefs=JSON.stringify(T))}}}return d}(i),W=null!=r?.geometry?r.geometry:null,N={historicMoment:E,geometryPrecision:a,maxAllowableOffset:d,returnFieldName:b,returnGeometry:v,returnUnformattedValues:G,returnZ:S,tolerance:T},X=W?.toJSON()||s;N.imageDisplay=`${Z},${c},${o}`,l&&(N.gdbVersion=l),X&&(delete X.spatialReference,N.geometry=JSON.stringify(X),N.geometryType=(0,ae.$B)(X));const de=L??X?.spatialReference??P?.spatialReference;if(de&&(N.sr=(0,be.YX)(de)),N.time=V?[V.start,V.end].join(","):null,P){const{xmin:He,ymin:ze,xmax:Je,ymax:Qe}=P;N.mapExtent=`${He},${ze},${Je},${Qe}`}return K&&(N.layerDefs=K),z&&!K&&(N.dynamicLayers=z),N.layers="popup"===p?"visible":p,Q&&!z&&(N.layers+=`:${Q.join(",")}`),N}(r,{geometry:a?.[0]}),E=(0,ee.lF)({...s.query,f:"json",...c}),p=(0,ee.jV)(E,o);return(0,ve.A)(s.path,p).then(Te).then(P=>function Ze(i,r){if(!r?.length)return i;const o=new Map;r.forEach(function l(s){o.set(s.id,s),s.sublayers&&s.sublayers.forEach(l)});for(const s of i.results)s.feature.sourceLayer=o.get(s.layerId);return i}(P,r.sublayers))})})).apply(this,arguments)}function Te(i){const r=i.data;return r.results=r.results||[],r.exceededTransferLimit=!!r.exceededTransferLimit,r.results=r.results.map(o=>je.fromJSON(o)),r}var Ne=u(48218),fe=u(46602),ce=u(64935);let ne=null;function Le(i,r){return"tile"===r.type||"map-image"===r.type}let H=class extends F.A{constructor(i){var r;super(i),r=this,this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,w.sg)(function(){var o=(0,A.A)(function*(l){r.destroyed||r.updatingHandles.addPromise(r._updateHighlightedFeaturesGeometries(l).catch(()=>{}))});return function(l){return o.apply(this,arguments)}}())}initialize(){const i=r=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(r).catch(()=>{})),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,g.on)(()=>this.highlightGraphics,"change",r=>i(r.added),{onListenerAdd:r=>i(r)})])}fetchPopupFeaturesAtLocation(i,r){var o=this;return(0,A.A)(function*(){const{layerView:{layer:l,view:{scale:s}}}=o;if(!i)throw new x.A("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:l});const a=function De(i,r,o){const l=[];if(!i)return l;const s=a=>{if(a.visible&&(0===a.minScale||r<=a.minScale)&&(0===a.maxScale||r>=a.maxScale))if(a.sublayers)a.sublayers.forEach(s);else if(a.popupEnabled){const p=(0,ce.D8)(a,{...o,defaultPopupTemplateEnabled:!1});null!=p&&l.unshift({sublayer:a,popupTemplate:p})}};return i.map(s),l}(l.sublayers,s,r);if(!a.length)return[];const c=yield function Ce(i,r){return ie.apply(this,arguments)}(l,a);if(!((l.capabilities?.operations?.supportsIdentify??1)&&l.version>=10.5||c))throw new x.A("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:l});return c?o._fetchPopupFeaturesUsingQueries(i,a,r):o._fetchPopupFeaturesUsingIdentify(i,a,r)})()}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(i){const r=this.highlightGraphics;if(!r)return(0,I.hA)();let o=null;if(i instanceof j.A?o=[i]:R.A.isCollection(i)&&i.length>0?o=i.toArray():Array.isArray(i)&&i.length>0&&(o=i),o=o?.filter(U.Ru),!o?.length)return(0,I.hA)();for(const l of o){const s=l.sourceLayer;null!=s&&"geometryType"in s&&"point"===s.geometryType&&(l.visible=!1)}return r.addMany(o),(0,I.hA)(()=>r.removeMany(o??[]))}_updateHighlightedFeaturesSymbols(i){var r=this;return(0,A.A)(function*(){const{layerView:{view:o},highlightGraphics:l,highlightGraphicUpdated:s}=r;if(l&&s)for(const a of i){const c=a.sourceLayer&&"renderer"in a.sourceLayer&&a.sourceLayer.renderer;a.sourceLayer&&"geometryType"in a.sourceLayer&&"point"===a.sourceLayer.geometryType&&c&&"getSymbolAsync"in c&&c.getSymbolAsync(a).then(function(){var E=(0,A.A)(function*(p){p||=new fe.A;let P=null;const d="visualVariables"in c?c.visualVariables?.find(b=>"size"===b.type):void 0;d&&(ne||(ne=(yield Promise.resolve().then(u.bind(u,77522))).getSize),P=ne(d,a,{view:o.type,scale:o.scale,shape:"simple-marker"===p.type?p.style:null})),P||="width"in p&&"height"in p&&null!=p.width&&null!=p.height?Math.max(p.width,p.height):"size"in p?p.size:16,l.includes(a)&&(a.symbol=new fe.A({style:"square",size:P,xoffset:"xoffset"in p?p.xoffset:0,yoffset:"yoffset"in p?p.yoffset:0}),s(a,"symbol"),a.visible=!0)});return function(p){return E.apply(this,arguments)}}())}})()}_updateHighlightedFeaturesGeometries(i){var r=this;return(0,A.A)(function*(){const{layerView:{layer:o,view:l},highlightGraphics:s,highlightGraphicUpdated:a}=r;if(r._highlightGeometriesResolution=i,!a||!s?.length||!o.capabilities.operations.supportsQuery)return;const c=r._getTargetResolution(i),E=new Map;for(const d of s)(!r._featuresResolutions.has(d)||r._featuresResolutions.get(d)>c)&&(0,m.tE)(E,d.sourceLayer,()=>new Map).set(d.getObjectId(),d);const p=Array.from(E,([d,b])=>{const v=d.createQuery();return v.objectIds=[...b.keys()],v.outFields=[d.objectIdField],v.returnGeometry=!0,v.maxAllowableOffset=c,v.outSpatialReference=l.spatialReference,d.queryFeatures(v)}),P=yield Promise.all(p);if(!r.destroyed)for(const{features:d}of P)for(const b of d){const G=E.get(b.sourceLayer).get(b.getObjectId());G&&s.includes(G)&&(G.geometry=b.geometry,a(G,"geometry"),r._featuresResolutions.set(G,c))}})()}_getTargetResolution(i){const r=i*(0,O.GA)(this.layerView.view.spatialReference),o=r/16;return o<=10?0:i/r*o}_fetchPopupFeaturesUsingIdentify(i,r,o){var l=this;return(0,A.A)(function*(){const s=yield l._createIdentifyParameters(i,r,o);if(null==s)return[];const{results:a}=yield function Ge(i,r,o){return re.apply(this,arguments)}(l.layerView.layer.parsedUrl,s,o);return a.map(c=>c.feature)})()}_createIdentifyParameters(i,r,o){var l=this;return(0,A.A)(function*(){const{floors:s,layer:a,timeExtent:c,view:{spatialReference:E,scale:p}}=l.layerView;if(!r.length)return null;yield Promise.all(r.map(({sublayer:S})=>S.load(o).catch(()=>{})));const P=Math.min((0,h.A)("mapservice-popup-identify-max-tolerance"),a.allSublayers.reduce((S,L)=>L.renderer?le({renderer:L.renderer,pointerType:o?.pointerType}):S,2)),d=l.createFetchPopupFeaturesQueryGeometry(i,P),b=(0,J.i1)(p,E),v=Math.round(d.width/b),G=new k.A({xmin:d.center.x-b*v,ymin:d.center.y-b*v,xmax:d.center.x+b*v,ymax:d.center.y+b*v,spatialReference:d.spatialReference});return new ye({floors:s,gdbVersion:"gdbVersion"in a?a.gdbVersion:void 0,geometry:i,height:v,layerOption:"popup",mapExtent:G,returnGeometry:!0,spatialReference:E,sublayers:a.sublayers,timeExtent:c,tolerance:P,width:v})})()}_fetchPopupFeaturesUsingQueries(i,r,o){var l=this;return(0,A.A)(function*(){const{layerView:{floors:s,timeExtent:a}}=l,c=r.map(function(){var E=(0,A.A)(function*({sublayer:p,popupTemplate:P}){if(yield p.load(o).catch(()=>{}),p.capabilities&&!p.capabilities.operations.supportsQuery)return[];const d=p.createQuery(),b=le({renderer:p.renderer,pointerType:o?.pointerType}),v=l.createFetchPopupFeaturesQueryGeometry(i,b),G=new Set,[S]=yield Promise.all([(0,ce.TO)(p,P),p.renderer?.collectRequiredFields(G,p.fieldsIndex)]);(0,w.Te)(o),(0,he._w)(G,p.fieldsIndex,S);const L=Array.from(G).sort();if(d.geometry=v,d.outFields=L,d.timeExtent=a,s){const Q=s.clone(),W=(0,_.f)(Q,p);null!=W&&(d.where=d.where?`(${d.where}) AND (${W})`:W)}const V=l._getTargetResolution(v.width/b),T=yield function $e(i){return i.expressionInfos?.length||Array.isArray(i.content)&&i.content.some(r=>"expression"===r.type)?(0,Ne.lw)():Promise.resolve()}(P);(0,w.Te)(o);const Z="point"===p.geometryType||T&&T.arcadeUtils.hasGeometryOperations(P);Z||(d.maxAllowableOffset=V);let{features:z}=yield p.queryFeatures(d,o);const K=Z?0:V;z=yield function Be(i,r,o){return oe.apply(this,arguments)}(p,z,o);for(const Q of z)l._featuresResolutions.set(Q,K);return z});return function(p){return E.apply(this,arguments)}}());return(yield Promise.allSettled(c)).reduce((E,p)=>"fulfilled"===p.status?[...E,...p.value]:E,[]).filter(U.Ru)})()}};function ie(){return(ie=(0,A.A)(function*(i,r){if(i.capabilities?.operations?.supportsQuery)return!0;try{return yield Promise.any(r.map(({sublayer:o})=>o.load().then(()=>o.capabilities.operations.supportsQuery)))}catch{return!1}})).apply(this,arguments)}function oe(){return(oe=(0,A.A)(function*(i,r,o){const l=i.renderer;return l&&"defaultSymbol"in l&&!l.defaultSymbol&&(r=l.valueExpression?yield Promise.all(r.map(s=>l.getSymbolAsync(s,o).then(a=>a?s:null))).then(s=>s.filter(a=>null!=a)):r.filter(s=>null!=l.getSymbol(s))),r})).apply(this,arguments)}(0,y._)([(0,f.MZ)({constructOnly:!0})],H.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,y._)([(0,f.MZ)({constructOnly:!0})],H.prototype,"layerView",void 0),(0,y._)([(0,f.MZ)({constructOnly:!0})],H.prototype,"highlightGraphics",void 0),(0,y._)([(0,f.MZ)({constructOnly:!0})],H.prototype,"highlightGraphicUpdated",void 0),(0,y._)([(0,f.MZ)({constructOnly:!0})],H.prototype,"updatingHandles",void 0),H=(0,y._)([(0,$.$)("esri.views.layers.support.MapServiceLayerViewHelper")],H)},23868:(Y,D,u)=>{u.d(D,{V:()=>F}),u(21152);var y=u(82663),j=u(28067);function F(x,I,h,m=new j.A){let w=0;if("2d"===h.type)w=I*(h.resolution??0);else if("3d"===h.type){const k=h.overlayPixelSizeInMapUnits(x),J=h.basemapSpatialReference;w=null==J||J.equals(h.spatialReference)?I*k:(0,y.GA)(J)/(0,y.GA)(h.spatialReference)}const g=x.x-w,O=x.y-w,f=x.x+w,B=x.y+w,{spatialReference:$}=h;return m.xmin=Math.min(g,f),m.ymin=Math.min(O,B),m.xmax=Math.max(g,f),m.ymax=Math.max(O,B),m.spatialReference=$,m}new j.A}}]);