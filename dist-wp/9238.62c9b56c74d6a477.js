"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[9238,7340],{23506:(B,h,s)=>{s.d(h,{v:()=>f});var i=s(99305);function f(y){y?.writtenProperties&&y.writtenProperties.forEach(({target:c,propName:m,newOrigin:O})=>{(0,i.H)(c)&&O&&c.originOf(m)!==O&&c.updateOrigin(m,O)})}},99305:(B,h,s)=>{function i(f){return f&&"getAtOrigin"in f&&"originOf"in f}s.d(h,{H:()=>i})},54814:(B,h,s)=>{s.r(h),s.d(h,{save:()=>_,saveAs:()=>P});var i=s(10467),f=s(17994),y=s(15764),c=s(69927),m=s(3458);const O="Group Layer",R="group-layer-save",U="group-layer-save-as",A=c.mm.GROUP_LAYER_MAP;function I(e){return{isValid:"group"===e.type,errorMessage:"Layer.type should be 'group'"}}function T(e){return{isValid:(0,c.Y)(e,A),errorMessage:`Layer.portalItem.typeKeywords should have '${A}'`}}function x(e,t){return{...(0,y.m)(e,"web-map",!0),initiator:t}}function M(e){const t=e.layerJSON;return Promise.resolve(t&&Object.keys(t).length?t:null)}function a(e,t){return o.apply(this,arguments)}function o(){return(o=(0,i.A)(function*(e,t){t.title||=e.title,(0,c.OM)(t,c.mm.METADATA),(0,c.LG)(t,A)})).apply(this,arguments)}function _(e,t){return l.apply(this,arguments)}function l(){return l=(0,i.A)(function*(e,t){return(0,f.UN)({layer:e,itemType:O,validateLayer:I,validateItem:T,createJSONContext:n=>x(n,e),createItemData:M,errorNamePrefix:R,saveResources:(n=(0,i.A)(function*(u,p){return e.sourceIsPortalItem||(yield u.removeAllResources().catch(()=>{})),(0,m.r)(e.resourceReferences,p)}),function(p,r){return n.apply(this,arguments)})},t);var n}),l.apply(this,arguments)}function P(e,t,n){return g.apply(this,arguments)}function g(){return(g=(0,i.A)(function*(e,t,n){return(0,f.Uh)({layer:e,itemType:O,validateLayer:I,createJSONContext:u=>x(u,e),createItemData:M,errorNamePrefix:U,newItem:t,setItemProperties:a,saveResources:(u,p)=>(0,m.r)(e.resourceReferences,p)},n)})).apply(this,arguments)}},57340:(B,h,s)=>{s.r(h),s.d(h,{addOrUpdateResources:()=>R,contentToBlob:()=>_,fetchResources:()=>m,getSiblingOfSameType:()=>P,getSiblingOfSameTypeI:()=>g,removeAllResources:()=>T,removeResource:()=>A,splitPrefixFileNameAndExtension:()=>a});var i=s(10467),f=s(89563),y=s(5922),c=s(45272);function m(e){return O.apply(this,arguments)}function O(){return(O=(0,i.A)(function*(e,t={},n){yield e.load(n);const u=(0,c.fj)(e.itemUrl,"resources"),{start:p=1,num:r=10,sortOrder:d="asc",sortField:j="resource"}=t,v={query:{start:p,num:r,sortOrder:d,sortField:j,token:e.apiKey},signal:n?.signal},E=yield e.portal.request(u,v);return{total:E.total,nextStart:E.nextStart,resources:E.resources.map(({created:C,size:D,resource:L})=>({created:new Date(C),size:D,resource:e.resourceFromPath(L)}))}})).apply(this,arguments)}function R(e,t,n,u){return U.apply(this,arguments)}function U(){return(U=(0,i.A)(function*(e,t,n,u){const p=new Map;for(const{resource:d,content:j,compress:v,access:E}of t){if(!d.hasPath())throw new y.A(`portal-item-resource-${n}:invalid-path`,"Resource does not have a valid path");const[C,D]=M(d.path),L=`${C}/${v??""}/${E??""}`;p.has(L)||p.set(L,{prefix:C,compress:v,access:E,files:[]}),p.get(L).files.push({fileName:D,content:j})}yield e.load(u);const r=(0,c.fj)(e.userItemUrl,"add"===n?"addResources":"updateResources");for(const{prefix:d,compress:j,access:v,files:E}of p.values())for(let D=0;D<E.length;D+=25){const L=E.slice(D,D+25),b=new FormData;d&&"."!==d&&b.append("resourcesPrefix",d),j&&b.append("compress","true"),v&&b.append("access",v);let K=0;for(const{fileName:S,content:W}of L)b.append("file"+ ++K,W,S);b.append("f","json"),yield e.portal.request(r,{method:"post",body:b,signal:u?.signal})}})).apply(this,arguments)}function A(e,t,n){return I.apply(this,arguments)}function I(){return(I=(0,i.A)(function*(e,t,n){if(!t.hasPath())throw new y.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield e.load(n);const u=(0,c.fj)(e.userItemUrl,"removeResources");yield e.portal.request(u,{method:"post",query:{resource:t.path},signal:n?.signal}),t.portalItem=null})).apply(this,arguments)}function T(e,t){return x.apply(this,arguments)}function x(){return(x=(0,i.A)(function*(e,t){yield e.load(t);const n=(0,c.fj)(e.userItemUrl,"removeResources");return e.portal.request(n,{method:"post",query:{deleteAll:!0},signal:t?.signal})})).apply(this,arguments)}function M(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function a(e){const[t,n]=function o(e){const t=(0,c.Zo)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[u,p]=M(t);return[u,p,n]}function _(e){return l.apply(this,arguments)}function l(){return(l=(0,i.A)(function*(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(yield(0,f.A)(e.url,{responseType:"blob"})).data})).apply(this,arguments)}function P(e,t){if(!e.hasPath())return null;const[n,,u]=a(e.path);return e.portalItem.resourceFromPath((0,c.fj)(n,t+u))}function g(e,t){if(!e.hasPath())return null;const[n,,u]=a(e.path);return e.portalItem.resourceFromPath((0,c.fj)(n,t+u))}},3458:(B,h,s)=>{s.d(h,{S:()=>U,r:()=>O});var i=s(10467),f=s(5922),y=s(56492),c=s(43085),m=s(57340);function O(a,o,_){return R.apply(this,arguments)}function R(){return(R=(0,i.A)(function*(a,o,_){const l=yield I(a,o,_);yield x(l,o,_)})).apply(this,arguments)}function U(a,o,_,l,P){return A.apply(this,arguments)}function A(){return(A=(0,i.A)(function*(a,o,_,l,P){const g=yield I(_,l,P);yield a.update({data:o}),yield x(g,l,P)})).apply(this,arguments)}function I(a,o,_){return T.apply(this,arguments)}function T(){return(T=(0,i.A)(function*(a,o,_){if(!o?.resources)return;const l=o.portalItem===a.portalItem?new Set(a.paths):new Set;a.paths.length=0,a.portalItem=o.portalItem;const P=new Set(o.resources.toKeep.map(r=>r.resource.path)),g=new Set,e=[];P.forEach(r=>{l.delete(r),a.paths.push(r)});const t=[],n=[],u=[];for(const r of o.resources.toUpdate)if(l.delete(r.resource.path),P.has(r.resource.path)||g.has(r.resource.path)){const{resource:d,content:j,finish:v}=r,E=(0,m.getSiblingOfSameTypeI)(d,(0,c.lk)());a.paths.push(E.path),t.push({resource:E,content:yield(0,m.contentToBlob)(j),compress:r.compress}),v&&u.push(()=>v(E))}else{a.paths.push(r.resource.path),n.push({resource:r.resource,content:yield(0,m.contentToBlob)(r.content),compress:r.compress});const d=r.finish;d&&u.push(()=>d(r.resource)),g.add(r.resource.path)}for(const r of o.resources.toAdd)if(a.paths.push(r.resource.path),l.has(r.resource.path))l.delete(r.resource.path);else{t.push({resource:r.resource,content:yield(0,m.contentToBlob)(r.content),compress:r.compress});const d=r.finish;d&&u.push(()=>d(r.resource))}if(t.length||n.length){const{addOrUpdateResources:r}=yield Promise.resolve().then(s.bind(s,57340));yield r(o.portalItem,t,"add",_),yield r(o.portalItem,n,"update",_)}if(u.forEach(r=>r()),0===e.length)return l;const p=yield(0,y.Ol)(e);if((0,y.Te)(_),p.length>0)throw new f.A("save:resources","Failed to save one or more resources",{errors:p});return l})).apply(this,arguments)}function x(a,o,_){return M.apply(this,arguments)}function M(){return(M=(0,i.A)(function*(a,o,_){if(!a||!o.portalItem)return;const l=[];for(const P of a){const g=o.portalItem.resourceFromPath(P);l.push(g.portalItem.removeResource(g,_))}yield(0,y.Lx)(l)})).apply(this,arguments)}},96904:(B,h,s)=>{s.d(h,{X:()=>c});var i=s(23098),f=s(5922),y=s(2174);function c(m){if(i.A.apiKey&&(0,y.Q)(m.portal.url))throw new f.A("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${m.portal.url} when using an api key`)}}}]);