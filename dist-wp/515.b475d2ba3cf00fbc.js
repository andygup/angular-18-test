"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[515],{33594:(Ze,Ee,p)=>{p.d(Ee,{d:()=>kt});var x=p(10467),Te=p(89952),ee=p(5922),Le=p(71065),V=p(77806),re=p(11432),Ue=p(60611),j=p(56492),Re=p(82663),we=p(11817),xe=p(2296),de=p(51995),He=p(83065),ve=p(61320),he=p(77098),J=p(58701),We=p(31732),pe=p(33087),Ge=p(40013),Ce=p(38965);const Oe=new class je{constructor(t,i){this._cache=new pe.q(t),this._invalidCache=new pe.q(i)}get(t,i){const r=`${i.uid}:${t}`,o=this._cache.get(r);if(o)return o;if(null!=this._invalidCache.get(r))return null;try{const n=Ge.WhereClause.create(t,i);return this._cache.put(r,n),n}catch(n){return this._invalidCache.put(r,n),null}}getError(t,i){return this._invalidCache.get(`${i.uid}:${t}`)??null}}(50,500),Ne="unsupported-query",qe=" as ",Ye=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),$e=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),E=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...Ye,...$e]);function U(f,t,i={}){const r=K(t,f);if(!r){const n=Oe.getError(t,f);throw new ee.A(Ne,"invalid SQL expression",{expression:t,error:n})}const o=i.expressionName||"expression";if(i.validateStandardized&&!r.isStandardized)throw new ee.A(Ne,`${o} is not standard`,{expression:t});if(i.validateAggregate&&!r.isAggregate)throw new ee.A(Ne,`${o} does not contain a valid aggregate function`,{expression:t});return r.fieldNames}function K(f,t){return f?Oe.get(f,t):null}function ne(f){return/\((.*?)\)/.test(f)?f:f.split(qe)[0]}function y(f,t,i,r={}){const o=new Map;if(function S(f,t,i,r,o){const n=o.includes("*")?[...i,...o.filter(h=>"*"!==h)]:o;for(const h of n)if(t.get(h))M(f,t,i,r,h);else try{const d=U(t,ne(h),{validateStandardized:!0});for(const m of d)M(f,t,i,r,m)}catch(d){f.set(h,{type:"expression-error",expression:h,error:d})}}(o,f,t,r.allowedFieldTypes??E,i),o.size)throw new ee.A(Ne,`${r.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(o.values()),query:r.query})}function M(f,t,i,r,o){const n=t.get(o);n?i.has(n.name)?"all"!==r&&!1===r?.has(n.type)&&f.set(o,{type:"invalid-type",fieldName:n.name,fieldType:Ce.m.fromJSON(n.type),allowedFieldTypes:Array.from(r,h=>Ce.m.fromJSON(h))}):f.set(o,{type:"missing-field",fieldName:n.name}):f.set(o,{type:"invalid-field",fieldName:o})}var R=p(95985),Q=p(88840),se=p(78200),te=p(39239),fe=p(22442),X=p(721),Z=p(86300),ae=p(19093),P=p(59377),oe=p(48218);class me{constructor(t,i,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues??!1,this.fieldsIndex=r,this.featureAdapter=i;const o=t.outFields;if(o&&!o.includes("*")){this.outFields=o;let n=0;for(const h of o){const d=ne(h),m=this.fieldsIndex.get(d),g=m?null:K(d,r),_=m?m.name:h.split(qe)[1]||"FIELD_EXP_"+n++;this._fieldDataCache.set(h,{alias:_,clause:g})}}}countDistinctValues(t){return this.returnDistinctValues?(t.forEach(i=>this.getAttributes(i)),this._returnDistinctMap.size):t.length}getAttributes(t){const i=this._processAttributesForOutFields(t);return this._processAttributesForDistinctValues(i)}getFieldValue(t,i,r){const o=r?r.name:i;let n=null;return this._fieldDataCache.has(o)?n=this._fieldDataCache.get(o)?.clause:r||(n=K(i,this.fieldsIndex),this._fieldDataCache.set(o,{alias:o,clause:n})),r?this.featureAdapter.getAttribute(t,o):n?.calculateValue(t,this.featureAdapter)}getDataValues(t,i,r=!0){const o=i.normalizationType,n=i.normalizationTotal,h=this.fieldsIndex.get(i.field),d=(0,Z.zD)(h)||(0,Z.Ah)(h),m=(0,Z.OH)(h);return t.map(g=>{let _=i.field&&this.getFieldValue(g,i.field,this.fieldsIndex.get(i.field));if(i.field2?(_=`${(0,P.gJ)(_)}${i.fieldDelimiter}${(0,P.gJ)(this.getFieldValue(g,i.field2,this.fieldsIndex.get(i.field2)))}`,i.field3&&(_=`${_}${i.fieldDelimiter}${(0,P.gJ)(this.getFieldValue(g,i.field3,this.fieldsIndex.get(i.field3)))}`)):"string"==typeof _&&r&&(d?_=_?new Date(_).getTime():null:m&&(_=_?(0,ae.rb)(_):null)),o&&Number.isFinite(_)){const I="field"===o&&i.normalizationField?this.getFieldValue(g,i.normalizationField,this.fieldsIndex.get(i.normalizationField)):null;_=(0,P.zS)(_,o,I,n)}return _})}getExpressionValues(t,i,r,o,n){var h=this;return(0,x.A)(function*(){const{arcadeUtils:d}=yield(0,oe.lw)(),m=d.hasGeometryOperations(i);m&&(yield d.enableGeometryOperations());const g=d.createFunction(i),_=d.getViewInfo(r),I={fields:h.fieldsIndex.fields};return t.map(v=>{const b={attributes:h.featureAdapter.getAttributes(v),layer:I,geometry:m?{...(0,R.pL)(o.geometryType,o.hasZ,o.hasM,h.featureAdapter.getGeometry(v)),spatialReference:r?.spatialReference}:null},F=d.createExecContext(b,_,n);return d.executeFunction(g,F)})})()}validateItem(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:K(i,this.fieldsIndex)}),this._fieldDataCache.get(i)?.clause?.testFeature(t,this.featureAdapter)??!1}validateItems(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:K(i,this.fieldsIndex)}),this._fieldDataCache.get(i)?.clause?.testSet(t,this.featureAdapter)??!1}_processAttributesForOutFields(t){const i=this.outFields;if(!i?.length)return this.featureAdapter.getAttributes(t);const r={};for(const o of i){const{alias:n,clause:h}=this._fieldDataCache.get(o);r[n]=h?h.calculateValue(t,this.featureAdapter):this.featureAdapter.getAttribute(t,n)}return r}_processAttributesForDistinctValues(t){if(null==t||!this.returnDistinctValues)return t;const i=this.outFields,r=[];if(i)for(const h of i){const{alias:d}=this._fieldDataCache.get(h);r.push(t[d])}else for(const h in t)r.push(t[h]);const o=`${(i||["*"]).join(",")}=${r.join(",")}`;let n=this._returnDistinctMap.get(o)||0;return this._returnDistinctMap.set(o,++n),n>1?null:t}}function Ve(f,t,i){return{objectId:f,target:t,distance:i,type:"vertex"}}function Qe(f,t,i,r,o,n=!1){return{objectId:f,target:t,distance:i,type:"edge",start:r,end:o,draped:n}}class W{constructor(t,i,r){this.items=t,this.query=i,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const t=new me(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return t.countDistinctValues(this.items);const{groupByFieldsForStatistics:i,having:r,outStatistics:o}=this.query;if(!i?.length)return 1;const h=new Map,d=new Map,m=new Set;for(const g of o){const{statisticType:_}=g,I="exceedslimit"!==_?g.onStatisticField:void 0;if(!d.has(I)){const b=[];for(const F of i){const C=this._getAttributeValues(t,F,h);b.push(C)}d.set(I,this._calculateUniqueValues(b,t.returnDistinctValues))}const v=d.get(I);for(const b in v){const{data:F,items:C}=v[b],A=F.join(",");r&&!t.validateItems(C,r)||m.add(A)}}return m.size}createQueryResponse(){var t=this;return(0,x.A)(function*(){let i;if(i=t.query.outStatistics?t.query.outStatistics.some(r=>"exceedslimit"===r.statisticType)?t._createExceedsLimitQueryResponse(t.query):yield t._createStatisticsQueryResponse(t.query):t._createFeatureQueryResponse(t.query),t.query.returnQueryGeometry){const r=t.query.geometry;i.queryGeometry=(0,J.fn)(t.query.outSR)&&!(0,J.aI)(r.spatialReference,t.query.outSR)?(0,R.ag)({spatialReference:t.query.outSR,...(0,Q.Cv)(r,r.spatialReference,t.query.outSR)}):(0,R.ag)({spatialReference:t.query.outSR,...r})}return i})()}createSnappingResponse(t,i){const r=this.featureAdapter,o=ye(this.hasZ,this.hasM),{point:n,mode:h}=t,d="number"==typeof t.distance?t.distance:t.distance.x,m="number"==typeof t.distance?t.distance:t.distance.y,g={candidates:[]},_="esriGeometryPolygon"===this.geometryType,I=this._getPointCreator(h,this.spatialReference,i),v=new be(null,0),b=new be(null,0),F={x:0,y:0,z:0};for(const C of this.items){const A=r.getGeometry(C);if(null==A)continue;const{coords:L,lengths:H}=A;if(v.coords=L,b.coords=L,t.returnEdge){let k=0;for(let $=0;$<H.length;$++){const O=H[$];for(let D=0;D<O;D++,k+=o){const w=v;if(w.coordsIndex=k,D!==O-1){const z=b;z.coordsIndex=k+o;const ie=F;Ie(F,n,w,z);const Ae=(n.x-ie.x)/d,Pe=(n.y-ie.y)/m,et=Ae*Ae+Pe*Pe;et<=1&&g.candidates.push(Qe(r.getObjectId(C),I(ie),Math.sqrt(et),I(w),I(z)))}}}}if("none"!==t.vertexMode){const k=_?L.length-o:L.length;if("all"===t.vertexMode)for(let $=0;$<k;$+=o){const O=v;O.coordsIndex=$;const D=(n.x-O.x)/d,w=(n.y-O.y)/m,z=D*D+w*w;z<=1&&g.candidates.push(Ve(r.getObjectId(C),I(O),Math.sqrt(z)))}else if("ends"===t.vertexMode){const $=[0];_||$.push(L.length-o);for(const O of $){const D=v;D.coordsIndex=O;const w=(n.x-D.x)/d,z=(n.y-D.y)/m,ie=w*w+z*z;ie<=1&&g.candidates.push(Ve(r.getObjectId(C),I(D),Math.sqrt(ie)))}}}}return g.candidates.sort((C,A)=>C.distance-A.distance),g}_getPointCreator(t,i,r){const o=null==r||(0,J.aI)(i,r)?d=>d:d=>(0,Q.Cv)(d,i,r),{hasZ:n}=this;return"3d"===t?n?({x:d,y:m,z:g})=>o({x:d,y:m,z:g}):({x:d,y:m})=>o({x:d,y:m,z:0}):({x:d,y:m})=>o({x:d,y:m})}createSummaryStatisticsResponse(t){var i=this;return(0,x.A)(function*(){const{field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,minValue:m,maxValue:g,scale:_,timeZone:I}=t,v=i.fieldsIndex.get(r),b=(0,Z.vE)(v)||(0,Z.zD)(v)||(0,Z.Ah)(v),F=yield i._getDataValues({field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,scale:_,timeZone:I}),C=(0,P.Vb)({normalizationType:h,normalizationField:n,minValue:m,maxValue:g}),A={value:.5,fieldType:v?.type},L=(0,Z.yM)(v)?(0,P.z9)({values:F,supportsNullCount:C,percentileParams:A}):(0,P.G_)({values:F,minValue:m,maxValue:g,useSampleStdDev:!h,supportsNullCount:C,percentileParams:A});return(0,P.oZ)(L,b)})()}createUniqueValuesResponse(t){var i=this;return(0,x.A)(function*(){const{field:r,valueExpression:o,domains:n,returnAllCodedValues:h,scale:d,timeZone:m}=t,g=yield i._getDataValues({field:r,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,valueExpression:o,scale:d,timeZone:m},!1),_=(0,P.b3)(g);return(0,P.lv)(_,n,h,t.fieldDelimiter)})()}createClassBreaksResponse(t){var i=this;return(0,x.A)(function*(){const{field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:g,minValue:_,maxValue:I,numClasses:v,scale:b,timeZone:F}=t,C=yield i._getDataValues({field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,scale:b,timeZone:F}),A=(0,P.Rw)(C,{field:r,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:g,minValue:_,maxValue:I,numClasses:v});return(0,P.jM)(A,m)})()}createHistogramResponse(t){var i=this;return(0,x.A)(function*(){const{field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:g,minValue:_,maxValue:I,numBins:v,scale:b,timeZone:F}=t,C=yield i._getDataValues({field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,scale:b,timeZone:F});return(0,P.$y)(C,{field:r,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:g,minValue:_,maxValue:I,numBins:v})})()}_sortFeatures(t,i,r){if(t.length>1&&i?.length)for(const o of i.reverse()){const n=o.split(" "),h=n[0],d=this.fieldsIndex.get(h),m=!!n[1]&&"desc"===n[1].toLowerCase(),g=(0,P.FM)(d?.type,m);t.sort((_,I)=>{const v=r(_,h,d),b=r(I,h,d);return g(v,b)})}}_createFeatureQueryResponse(t){const i=this.items,{geometryType:r,hasM:o,hasZ:n,objectIdField:h,spatialReference:d}=this,{outFields:m,outSR:g,quantizationParameters:_,resultRecordCount:I,resultOffset:v,returnZ:b,returnM:F}=t,C=null!=I&&i.length>(v||0)+I,A=m&&(m.includes("*")?[...this.fieldsIndex.fields]:m.map(L=>this.fieldsIndex.get(L)));return{exceededTransferLimit:C,features:this._createFeatures(t,i),fields:A,geometryType:r,hasM:o&&F,hasZ:n&&b,objectIdFieldName:h,spatialReference:(0,R.ag)(g||d),transform:_&&(0,X.VV)(_)||null}}_createFeatures(t,i){const r=new me(t,this.featureAdapter,this.fieldsIndex),{hasM:o,hasZ:n}=this,{orderByFields:h,quantizationParameters:d,returnGeometry:m,returnCentroid:g,maxAllowableOffset:_,resultOffset:I,resultRecordCount:v,returnZ:b=!1,returnM:F=!1}=t,C=n&&b,A=o&&F;let L=[],H=0;const k=[...i];if(this._sortFeatures(k,h,(O,D,w)=>r.getFieldValue(O,D,w)),this.geometryType&&(m||g)){const O=(0,X.VV)(d)??void 0,D="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(m&&!g)for(const w of k){const z=this.featureAdapter.getGeometry(w),ie={attributes:r.getAttributes(w),geometry:(0,R.pL)(this.geometryType,this.hasZ,this.hasM,z,_,O,C,A)};D&&z&&!ie.geometry&&(ie.centroid=(0,R.LQ)(this,this.featureAdapter.getCentroid(w,this),O)),L[H++]=ie}else if(!m&&g)for(const w of k)L[H++]={attributes:r.getAttributes(w),centroid:(0,R.LQ)(this,this.featureAdapter.getCentroid(w,this),O)};else for(const w of k)L[H++]={attributes:r.getAttributes(w),centroid:(0,R.LQ)(this,this.featureAdapter.getCentroid(w,this),O),geometry:(0,R.pL)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(w),_,O,C,A)}}else for(const O of k){const D=r.getAttributes(O);D&&(L[H++]={attributes:D})}const $=I||0;return null!=v&&(L=L.slice($,Math.min(L.length,$+v))),L}_createExceedsLimitQueryResponse(t){let i=!1,r=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const h of t.outStatistics??[])if("exceedslimit"===h.statisticType){r=null!=h.maxPointCount?h.maxPointCount:Number.POSITIVE_INFINITY,o=null!=h.maxRecordCount?h.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=h.maxVertexCount?h.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)i=this.items.length>r;else if(this.items.length>o)i=!0;else{const h=ye(this.hasZ,this.hasM),d=this.featureAdapter;i=this.items.reduce((m,g)=>{const _=d.getGeometry(g);return m+(null!=_&&_.coords.length||0)},0)/h>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(i)}}]}}_createStatisticsQueryResponse(t){var i=this;return(0,x.A)(function*(){const r={attributes:{}},o=[],n=new Map,h=new Map,d=new Map,m=new Map,g=new me(t,i.featureAdapter,i.fieldsIndex),_=t.outStatistics,{groupByFieldsForStatistics:I,having:v,orderByFields:b,resultRecordCount:F}=t,C=I?.length,A=!!C,L=A?I[0]:null,H=A&&!i.fieldsIndex.get(L);for(const $ of _??[]){const{outStatisticFieldName:O,statisticType:D}=$,w=$,z="exceedslimit"!==D?$.onStatisticField:void 0,ie="percentile_disc"===D||"percentile_cont"===D,Ae="EnvelopeAggregate"===D||"CentroidAggregate"===D||"ConvexHullAggregate"===D,Pe=A&&1===C&&(z===L||H)&&"count"===D;if(A){if(!d.has(z)){const tt=[];for(const ht of I){const st=i._getAttributeValues(g,ht,n);tt.push(st)}d.set(z,i._calculateUniqueValues(tt,!Ae&&g.returnDistinctValues))}const Fe=d.get(z);if(!Fe)continue;const dt=Object.keys(Fe);for(const tt of dt){const{count:ht,data:st,items:xt,itemPositions:Zt}=Fe[tt],vt=st.join(",");if(!v||g.validateItems(xt,v)){const ze=m.get(vt)||{attributes:{}};if(Ae){ze.aggregateGeometries||(ze.aggregateGeometries={});const{aggregateGeometries:Se,outStatisticFieldName:ke}=yield i._getAggregateGeometry(w,xt);ze.aggregateGeometries[ke]=Se}else{let Se=null;if(Pe)Se=ht;else{const ke=i._getAttributeValues(g,z,n),At=Zt.map(Wt=>ke[Wt]);Se=ie&&"statisticParameters"in w?i._getPercentileValue(w,At):i._getStatisticValue(w,At,null,g.returnDistinctValues)}ze.attributes[O]=Se}let Ht=0;I.forEach((Se,ke)=>ze.attributes[i.fieldsIndex.get(Se)?Se:"EXPR_"+ ++Ht]=st[ke]),m.set(vt,ze)}}}else if(Ae){r.aggregateGeometries||(r.aggregateGeometries={});const{aggregateGeometries:Fe,outStatisticFieldName:dt}=yield i._getAggregateGeometry(w,i.items);r.aggregateGeometries[dt]=Fe}else{const Fe=i._getAttributeValues(g,z,n);r.attributes[O]=ie&&"statisticParameters"in w?i._getPercentileValue(w,Fe):i._getStatisticValue(w,Fe,h,g.returnDistinctValues)}const et="min"!==D&&"max"!==D||!(0,Z.yM)(i.fieldsIndex.get(z))&&!i._isAnyDateField(z)?null:i.fieldsIndex.get(z)?.type;o.push({name:O,alias:O,type:et||"esriFieldTypeDouble"})}const k=A?Array.from(m.values()):[r];return i._sortFeatures(k,b,($,O)=>$.attributes[O]),F&&(k.length=Math.min(F,k.length)),{fields:o,features:k}})()}_isAnyDateField(t){const i=this.fieldsIndex.get(t);return(0,Z.vE)(i)||(0,Z.zD)(i)||(0,Z.Ah)(i)||(0,Z.OH)(i)}_getAggregateGeometry(t,i){var r=this;return(0,x.A)(function*(){const{convexHull:o,union:n}=yield Promise.all([p.e(3930),p.e(2076)]).then(p.bind(p,27815)),{statisticType:h,outStatisticFieldName:d}=t,{featureAdapter:m,spatialReference:g,geometryType:_,hasZ:I,hasM:v}=r,b=i.map(A=>(0,R.pL)(_,I,v,m.getGeometry(A))),F=o(g,b,!0)[0],C={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===h){const A=F?(0,fe.v)(F):(0,fe.HA)(n(g,b));C.aggregateGeometries={...A,spatialReference:g},C.outStatisticFieldName=d||"extent"}else if("CentroidAggregate"===h){const A=F?(0,te.l8)(F):(0,te.Z4)((0,fe.HA)(n(g,b)));C.aggregateGeometries={x:A[0],y:A[1],spatialReference:g},C.outStatisticFieldName=d||"centroid"}else"ConvexHullAggregate"===h&&(C.aggregateGeometries=F,C.outStatisticFieldName=d||"convexHull");return C})()}_getStatisticValue(t,i,r,o){const{onStatisticField:n,statisticType:h}=t;let d=null;return d=r?.has(n)?r.get(n):(0,Z.yM)(this.fieldsIndex.get(n))||this._isAnyDateField(n)?(0,P.z9)({values:i,returnDistinct:o}):(0,P.G_)({values:o?[...new Set(i)]:i,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(n,d),d["var"===h?"variance":h]}_getPercentileValue(t,i){const{onStatisticField:r,statisticParameters:o,statisticType:n}=t,{value:h,orderBy:d}=o,m=this.fieldsIndex.get(r);return(0,P.qg)(i,{value:h,orderBy:d,fieldType:m?.type,isDiscrete:"percentile_disc"===n})}_getAttributeValues(t,i,r){if(r.has(i))return r.get(i);const o=this.fieldsIndex.get(i),n=this.items.map(h=>t.getFieldValue(h,i,o));return r.set(i,n),n}_calculateUniqueValues(t,i){const r={},o=this.items,n=o.length;for(let h=0;h<n;h++){const d=o[h],m=[];for(const _ of t)m.push(_[h]);const g=m.join(",");null==r[g]?r[g]={count:1,data:m,items:[d],itemPositions:[h]}:(i||r[g].count++,r[g].items.push(d),r[g].itemPositions.push(h))}return r}_getDataValues(t,i=!0){var r=this;return(0,x.A)(function*(){const o=new me(r.query,r.featureAdapter,r.fieldsIndex),{valueExpression:n,scale:h,timeZone:d}=t;return n?o.getExpressionValues(r.items,n,{viewingMode:"map",scale:h,spatialReference:r.query.outSR||r.spatialReference},{geometryType:r.geometryType,hasZ:r.hasZ,hasM:r.hasM},d):o.getDataValues(r.items,(0,V.o8)(t),i)})()}}function Ie(f,t,i,r){const o=r.x-i.x,n=r.y-i.y,m=Math.min(1,Math.max(0,((t.x-i.x)*o+(t.y-i.y)*n)/(o*o+n*n)));f.x=i.x+o*m,f.y=i.y+n*m}function ye(f,t){return f?t?4:3:t?3:2}class be{constructor(t,i){this.coords=t,this.coordsIndex=i}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}var le=p(871),Y=p(18633);const ue="unsupported-query";function q(f,t){return De.apply(this,arguments)}function De(){return(De=(0,x.A)(function*(f,{fieldsIndex:t,geometryType:i,spatialReference:r,availableFields:o}){if((f.distance??0)<0||null!=f.geometryPrecision||f.multipatchOption&&"xyFootprint"!==f.multipatchOption||f.pixelSize||f.relationParam||f.text)throw new ee.A(ue,"Unsupported query options",{query:f});return Ke(t,o,f),function St(f,t,i){const{outStatistics:r,groupByFieldsForStatistics:o,having:n}=i,h=o?.length,d=r?.length;if(n){if(!h||!d)throw new ee.A(ue,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:i});!function B(f,t,i,r,o){if(!i)return!0;const n="having clause",h=U(f,i,{validateAggregate:!0,expressionName:n});if(y(f,t,h,{expressionName:n,query:o}),!K(i,f)?.getExpressions().every(g=>{const{aggregateType:_,field:I}=g,v=f.get(I)?.name;return r.some(b=>{const{onStatisticField:F,statisticType:C}=b;return f.get(F)?.name===v&&C.toLowerCase().trim()===_})}))throw new ee.A(Ne,"expressions in having clause should also exist in outStatistics",{having:i})}(f,t,n,r,i)}if(d){if(!function Ot(f){return null!=f&&f.every(t=>"exceedslimit"!==t.statisticType)}(r))return;y(f,t,r.map(g=>g.onStatisticField).filter(Boolean),{expressionName:"onStatisticFields",query:i}),h&&y(f,t,o,{expressionName:"groupByFieldsForStatistics",query:i});for(const g of r){const{onStatisticField:_,statisticType:I}=g;if("percentile_disc"!==I&&"percentile_cont"!==I||!("statisticParameters"in g))f.get(_)&&"count"!==I&&"min"!==I&&"max"!==I&&y(f,t,[_],{expressionName:`outStatistics with '${I}' statistic type`,allowedFieldTypes:Ft,query:i});else{const{statisticParameters:v}=g;if(!v)throw new ee.A(ue,"statisticParameters should be set for percentile type",{definition:g,query:i})}}}}(t,o,f),Promise.all([(0,Y.c0)(f,i,r),(0,Q.Nk)(r,f.outSR)]).then(()=>f)})).apply(this,arguments)}function Ke(f,t,i){const{outFields:r,orderByFields:o,returnDistinctValues:n,outStatistics:h}=i,d=h?h.map(m=>m.outStatisticFieldName&&m.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(o&&o.length>0){const m=" asc",g=" desc";y(f,t,o.map(I=>{const v=I.toLowerCase();return v.includes(m)?v.split(m)[0]:v.includes(g)?v.split(g)[0]:I}).filter(I=>!d.includes(I)),{expressionName:"orderByFields",query:i})}if(r&&r.length>0)y(f,t,r,{expressionName:"outFields",query:i,allowedFieldTypes:"all"});else if(n)throw new ee.A(ue,"outFields should be specified for returnDistinctValues",{query:i});!function G(f,t,i,r){if(!i)return!0;const o="where clause";y(f,t,U(f,i,{validateStandardized:!0,expressionName:o}),{expressionName:o,query:r})}(f,t,i.where,i)}const Ft=new Set([...Ye,...$e]);function it(){return(it=(0,x.A)(function*(f,t,{fieldsIndex:i,geometryType:r,spatialReference:o,availableFields:n}){if((f.distance??0)<0||null!=f.geometryPrecision||f.multipatchOption||f.pixelSize||f.relationParam||f.text||f.outStatistics||f.groupByFieldsForStatistics||f.having||f.orderByFields)throw new ee.A(ue,"Unsupported query options",{query:f});return Ke(i,n,f),Promise.all([Ct(i,n,t,f),(0,Y.c0)(f,r,o),(0,Q.Nk)(o,f.outSR)]).then(()=>f)})).apply(this,arguments)}function Ct(f,t,i,r){return rt.apply(this,arguments)}function rt(){return(rt=(0,x.A)(function*(f,t,i,r){let o=[];if(i.valueExpression){const{arcadeUtils:n}=yield(0,oe.lw)();o=n.extractFieldNames(i.valueExpression)}if(i.field&&o.push(i.field),i.field2&&o.push(i.field2),i.field3&&o.push(i.field3),i.normalizationField&&o.push(i.normalizationField),!o.length&&!i.valueExpression)throw new ee.A(ue,"field or valueExpression is required",{params:i});y(f,t,o,{expressionName:"statistics",query:r})})).apply(this,arguments)}var ft=p(76980),Nt=p(73258),bt=p(86807),Dt=(p(3248),p(35150)),nt=p(13316),at=p(12438),ot=p(48900),lt=p(54029),ge=p(82595);const mt=Symbol("Yield");class Mt{constructor(){this._tasks=new Array,this._runningTasks=(0,lt.v)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(t){if(0===this.length)return mt;for(;!t.done&&this._process(t);)t.madeProgress()}push(t,i,r){return++this._runningTasks.value,new Promise((o,n)=>this._tasks.push(new gt(o,n,t,i,r))).finally(()=>--this._runningTasks.value)}unshift(t,i,r){return++this._runningTasks.value,new Promise((o,n)=>this._tasks.unshift(new gt(o,n,t,i,r))).finally(()=>--this._runningTasks.value)}_process(t){if(0===this._tasks.length)return!1;const i=this._tasks.shift();try{const r=(0,j.G4)(i.signal);if(r&&!i.abortCallback)i.reject((0,j.NK)());else{const o=r?i.abortCallback?.((0,j.NK)()):i.callback(t);(0,j.$X)(o)?o.then(i.resolve,i.reject):i.resolve(o)}}catch(r){i.reject(r)}return!0}cancelAll(){const t=(0,j.NK)();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(t);i.resolve(r)}else i.reject(t);this._tasks.length=0}}class gt{constructor(t,i,r,o=void 0,n=void 0){this.resolve=t,this.reject=i,this.callback=r,this.signal=o,this.abortCallback=n}}var ut=p(8189),Pt=p(98877),pt=p(85211),Lt=(p(40707),p(76576));let Be=class extends Pt.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,ut._)([(0,pt.MZ)()],Be.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,ut._)([(0,pt.MZ)()],Be.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),Be=(0,ut._)([(0,Lt.$)("esri.views.support.debugFlags")],Be);const Ut=new Be;var ce,f,N;(f=ce||(ce={}))[f.ANIMATING=0]="ANIMATING",f[f.INTERACTING=1]="INTERACTING",f[f.IDLE=2]="IDLE",function(f){f.RESOURCE_CONTROLLER_IMMEDIATE="immediate",f.RESOURCE_CONTROLLER="schedule",f.SLIDE="slide",f.STREAM_DATA_LOADER="stream loader",f.ELEVATION_QUERY="elevation query",f.TERRAIN_SURFACE="terrain",f.SURFACE_GEOMETRY_UPDATES="surface geometry updates",f.LOD_RENDERER="LoD renderer",f.GRAPHICS_CORE="Graphics3D",f.I3S_CONTROLLER="I3S",f.POINT_CLOUD_LAYER="point cloud",f.FEATURE_TILE_FETCHER="feature fetcher",f.OVERLAY="overlay",f.STAGE="stage",f.GRAPHICS_DECONFLICTOR="graphics deconflictor",f.FILTER_VISIBILITY="Graphics3D filter visibility",f.SCALE_VISIBILITY="Graphics3D scale visibility",f.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",f.POINT_OF_INTEREST_FREQUENT="POI frequent",f.POINT_OF_INTEREST_INFREQUENT="POI infrequent",f.LABELER="labeler",f.FEATURE_QUERY_ENGINE="feature query",f.FEATURE_TILE_TREE="feature tile tree",f.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",f.ELEVATION_ALIGNMENT="elevation alignment",f.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",f.TEXT_TEXTURE_ATLAS="text texture atlas",f.TEXTURE_UNLOAD="texture unload",f.LINE_OF_SIGHT_TOOL="line of sight tool",f.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",f.ELEVATION_PROFILE="elevation profile",f.SNAPPING="snapping",f.SHADOW_ACCUMULATOR="shadow accumulator",f.CLOUDS_GENERATOR="clouds generator",f[f.NONE=0]="NONE",f[f.TEST_PRIO=1]="TEST_PRIO"}(N||(N={}));const yt=new Map([[N.RESOURCE_CONTROLLER_IMMEDIATE,0],[N.RESOURCE_CONTROLLER,4],[N.SLIDE,0],[N.STREAM_DATA_LOADER,0],[N.ELEVATION_QUERY,0],[N.TERRAIN_SURFACE,1],[N.SURFACE_GEOMETRY_UPDATES,1],[N.LOD_RENDERER,2],[N.GRAPHICS_CORE,2],[N.I3S_CONTROLLER,2],[N.POINT_CLOUD_LAYER,2],[N.FEATURE_TILE_FETCHER,2],[N.OVERLAY,4],[N.STAGE,4],[N.GRAPHICS_DECONFLICTOR,4],[N.FILTER_VISIBILITY,4],[N.SCALE_VISIBILITY,4],[N.FRUSTUM_VISIBILITY,4],[N.CLOUDS_GENERATOR,4],[N.POINT_OF_INTEREST_FREQUENT,6],[N.POINT_OF_INTEREST_INFREQUENT,30],[N.LABELER,8],[N.FEATURE_QUERY_ENGINE,8],[N.FEATURE_TILE_TREE,16],[N.FEATURE_TILE_TREE_ACTIVE,0],[N.ELEVATION_ALIGNMENT,12],[N.ELEVATION_ALIGNMENT_SCENE,14],[N.TEXT_TEXTURE_ATLAS,12],[N.TEXTURE_UNLOAD,12],[N.LINE_OF_SIGHT_TOOL,16],[N.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[N.SNAPPING,0],[N.SHADOW_ACCUMULATOR,30]]);function _t(f){return yt.has(f)?yt.get(f):"number"==typeof f?f:1}const wt=(0,ge.l5)(6.5),Et=(0,ge.l5)(1),Gt=(0,ge.l5)(30),Vt=(0,ge.l5)(1e3/30),Qt=(0,ge.l5)(100);var Je,Me;(function(f){f.Scheduler=class t{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=(0,lt.v)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new nt.A("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=ce.INTERACTING,this._tasks=new at.A,this._runQueue=new at.A,this._load=0,this._idleStateCallbacks=new at.A,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,ot.wB)(()=>Ut.SCHEDULER_LOG_SLOW_TASKS,n=>this._debug=n,ot.Vh);for(const n of Object.keys(N))this.performanceInfo.tasks.set(N[n],new nt.A(N[n]))}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),(0,re.xt)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,h){const d=new i(this,n,h);return this._tasks.push(d),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new nt.A(n)),d}registerIdleStateCallbacks(n,h){const d={idleBegin:n,idleEnd:h};this._idleStateCallbacks.push(d),this.state===ce.IDLE&&this._idleUpdatesStartFired&&d.idleBegin();const m=this;return{remove:()=>this._removeIdleStateCallbacks(d),set idleBegin(g){m._idleUpdatesStartFired&&(d.idleEnd(),m._state===ce.IDLE&&g()),d.idleBegin=g},set idleEnd(g){d.idleEnd=g}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==ce.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(h=>h.idleEnd())))}get state(){return this._state}updateBudget(n){++this._frameNumber;let h=wt,d=n.frameDuration,m=Et;switch(this.state){case ce.IDLE:h=(0,ge.l5)(0),d=(0,ge.l5)(Math.max(Qt,n.frameDuration)),m=Gt;break;case ce.INTERACTING:d=(0,ge.l5)(Math.max(Vt,n.frameDuration))}return d=(0,ge.l5)(d-n.elapsedFrameTime-h),this.state!==ce.IDLE&&d<Et&&!this._forceTask?(this._forceTask=!0,!1):(d=(0,ge.l5)(Math.max(d,m)),this._budget.reset(d,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case ce.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case ce.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset((0,ge.l5)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(h=>{h.name===n&&h.setPriority(n)})}_getState(n){if(this._runQueue.some(d=>d.name===n))return Me.SCHEDULED;let h=Me.IDLE;return this._tasks.forAll(d=>{d.name===n&&d.needsUpdate&&(d.schedulePriority<=1?h=Me.READY:h!==Me.READY&&(h=Me.WAITING))}),h}_getRuntime(n){let h=0;return this._tasks.forAll(d=>{d.name===n&&(h+=d.runtime)}),h}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(d=>{d.needsUpdate&&n.set(d.name,(n.get(d.name)||0)+1)}),0===n.size)return null;let h="";return n.forEach((d,m)=>{h+=d>1?` ${d}x ${m}`:` ${m}`}),h}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((h,d)=>d.needsUpdate?++h:h,0);this._load=.9*this._load+n*(1-.9)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{0===n.basePriority&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});0===this._runQueue.length;){let n=!1,h=0;if(this._tasks.forAll(d=>{d.needsUpdate&&0!==d.schedulePriority&&0!==d.basePriority&&d.blockFrame!==this._frameNumber&&(n=!0,h=Math.max(h,d.basePriority),1===d.schedulePriority?(d.schedulePriority=0,this._runQueue.push(d)):--d.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const h=this._budget.now(),d=this._runQueue.pop();this._budget.resetProgress();try{d.task.runTask(this._budget)===mt&&(d.blockFrame=this._frameNumber)}catch(g){Dt.A.getLogger("esri.views.support.Scheduler").error(`Exception in task "${d.name}"`,g),d.blockFrame=this._frameNumber}!this._budget.hasProgressed&&d.blockFrame!==this._frameNumber&&d.needsUpdate&&(d.blockFrame=this._frameNumber),d.schedulePriority=d.basePriority;const m=this._budget.now()-h;if(d.runtime+=m,this._frameTaskTimes.set(d.priority,this._frameTaskTimes.get(d.priority)+m),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(N))this._frameTaskTimes.set(N[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((h,d)=>this.performanceInfo.tasks.get(d).record(h)),this.performanceInfo.total.record(n)}get test(){}};class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,h,d){this._scheduler=n,this.name=h,this.blockFrame=0,this.runtime=0,this._queue=new Mt,this._handles=new bt.A,this._basePriority=_t(h),this.schedulePriority=this._basePriority,this._task=(0,lt.v)(d??this._queue),this._handles.add((0,ot.z7)(()=>this.task.running,m=>n.taskRunningChanged(m)))}remove(){this.processQueue(Xe),this._scheduler.removeTask(this),this.schedule=It.schedule,this.reschedule=It.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const h=_t(n);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=h),this._basePriority=h}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,h,d){return this._queue.push(n,h,d)}reschedule(n,h,d){return this._queue.unshift(n,h,d)}processQueue(n){return this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=ce.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(!0===n()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,h){this._begin=this.now(),this._budget=n,this._state=h,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}f.Budget=r})(Je||(Je={})),function(f){f.SCHEDULED="s",f.READY="r",f.WAITING="w",f.IDLE="i"}(Me||(Me={}));const Xe=(()=>{const f=new Je.Budget;return f.enabled=!1,f})(),It=new class zt{remove(){}processQueue(){}schedule(t,i,r){try{if((0,j.G4)(i)){const o=(0,j.NK)();return r?Promise.resolve(r(o)):Promise.reject(o)}return(0,j.z7)(t(Xe))}catch(o){return Promise.reject(o)}}reschedule(t,i,r){return this.schedule(t,i,r)}},$t=new Ue.F(2e6);let Bt=0;class kt{constructor(t){this._geometryQueryCache=null,this._changeHandle=null,this.capabilities={query:se.F},this.geometryType=t.geometryType,this.hasM=!!t.hasM,this.hasZ=!!t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache()),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new Ue.Mn(Bt+++"$$",$t)),this.fieldsIndex=(0,Le.Wj)(t.fieldsIndex)?t.fieldsIndex:Nt.A.fromJSON(t.fieldsIndex),this.availableFields=!t.availableFields||1===t.availableFields.length&&"*"===t.availableFields[0]?new Set(this.fieldsIndex.fields.map(i=>i.name)):new Set(t.availableFields.map(i=>this.fieldsIndex.get(i)?.name).filter(i=>null!=i)),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}destroy(){this._frameTask=(0,re.xt)(this._frameTask),this.clearCache(),(0,re.pR)(this._geometryQueryCache),this._changeHandle=(0,re.xt)(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}executeQuery(t,i){var r=this;return(0,x.A)(function*(){const o=(0,j.Mq)(i);try{return(yield r._executeQuery(t,{},o)).createQueryResponse()}catch(n){if(n!==le.v8)throw n;return new W([],t,r).createQueryResponse()}})()}executeQueryForCount(t={},i){var r=this;return(0,x.A)(function*(){const o=(0,j.Mq)(i);try{return(yield r._executeQuery(t,{returnGeometry:!1,returnCentroid:!1,outSR:null},o)).createQueryResponseForCount()}catch(n){if(n!==le.v8)throw n;return 0}})()}executeQueryForExtent(t,i){var r=this;return(0,x.A)(function*(){const o=(0,j.Mq)(i),n=t.outSR;try{const h=yield r._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},o),d=h.size;return d?{count:d,extent:yield r._getBounds(h.items,h.spatialReference,n||r.spatialReference)}:{count:0,extent:null}}catch(h){if(h===le.v8)return{count:0,extent:null};throw h}})()}executeQueryForIds(t,i){var r=this;return(0,x.A)(function*(){return r.executeQueryForIdSet(t,i).then(o=>Array.from(o))})()}executeQueryForIdSet(t,i){var r=this;return(0,x.A)(function*(){const o=(0,j.Mq)(i);try{const n=yield r._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},o),h=n.items,d=new Set;return yield r._reschedule(()=>{for(const m of h)d.add(n.featureAdapter.getObjectId(m))},o),d}catch(n){if(n===le.v8)return new Set;throw n}})()}executeQueryForSnapping(t,i){var r=this;return(0,x.A)(function*(){const o=(0,j.Mq)(i),{point:n,distance:h,returnEdge:d,vertexMode:m}=t;if(!d&&"none"===m)return{candidates:[]};let g=(0,V.o8)(t.query);g=yield r._schedule(()=>(0,le.T2)(g,r.definitionExpression,r.spatialReference),o),g=yield r._reschedule(()=>q(g,{availableFields:r.availableFields,fieldsIndex:r.fieldsIndex,geometryType:r.geometryType,spatialReference:r.spatialReference}),o);const _=!(0,J.aI)(n.spatialReference,r.spatialReference);_&&(yield(0,Q.Nk)(n.spatialReference,r.spatialReference));const I="number"==typeof h?h:h.x,v="number"==typeof h?h:h.y,b={xmin:n.x-I,xmax:n.x+I,ymin:n.y-v,ymax:n.y+v,spatialReference:n.spatialReference},F=_?(0,Q.Cv)(b,r.spatialReference):b;if(!F)return{candidates:[]};const C=(yield(0,he.el)((0,ve.rS)(n),null,{signal:o}))[0],A=(yield(0,he.el)((0,ve.rS)(F),null,{signal:o}))[0];if(null==C||null==A)return{candidates:[]};const L=new W(yield r._reschedule(()=>r._searchFeatures(ct(A.toJSON())),o),g,r);yield r._reschedule(()=>r._executeObjectIdsQuery(L),o),yield r._reschedule(()=>r._executeTimeQuery(L),o),yield r._reschedule(()=>r._executeAttributesQuery(L),o),yield r._reschedule(()=>r._executeGeometryQueryForSnapping(L,o),o);const H=C.toJSON(),k=_?(0,Q.Cv)(H,r.spatialReference):H,$=_?Math.max(F.xmax-F.xmin,F.ymax-F.ymin)/2:h;return L.createSnappingResponse({...t,point:k,distance:$},n.spatialReference)})()}executeQueryForLatestObservations(t,i){var r=this;return(0,x.A)(function*(){const o=(0,j.Mq)(i);if(!r.timeInfo?.trackIdField)throw new ee.A("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:r.timeInfo});try{const n=yield r._executeQuery(t,{},o);return yield r._reschedule(()=>r._filterLatest(n),o),n.createQueryResponse()}catch(n){if(n!==le.v8)throw n;return new W([],t,r).createQueryResponse()}})()}executeQueryForSummaryStatistics(t={},i,r){var o=this;return(0,x.A)(function*(){const n=(0,j.Mq)(r),{field:h,normalizationField:d,valueExpression:m}=i;return(yield o._executeQueryForStatistics(t,{field:h,normalizationField:d,valueExpression:m},n)).createSummaryStatisticsResponse(i)})()}executeQueryForUniqueValues(t={},i,r){var o=this;return(0,x.A)(function*(){const n=(0,j.Mq)(r),{field:h,field2:d,field3:m,valueExpression:g}=i;return(yield o._executeQueryForStatistics(t,{field:h,field2:d,field3:m,valueExpression:g},n)).createUniqueValuesResponse(i)})()}executeQueryForClassBreaks(t={},i,r){var o=this;return(0,x.A)(function*(){const n=(0,j.Mq)(r),{field:h,normalizationField:d,valueExpression:m}=i;return(yield o._executeQueryForStatistics(t,{field:h,normalizationField:d,valueExpression:m},n)).createClassBreaksResponse(i)})()}executeQueryForHistogram(t={},i,r){var o=this;return(0,x.A)(function*(){const n=(0,j.Mq)(r),{field:h,normalizationField:d,valueExpression:m}=i;return(yield o._executeQueryForStatistics(t,{field:h,normalizationField:d,valueExpression:m},n)).createHistogramResponse(i)})()}fetchRecomputedExtents(t){var i=this;return(0,x.A)(function*(){const r=(0,j.Mq)(t);i._timeExtentPromise||=(0,ft.W)(i.timeInfo,i.featureStore);const[o,n]=yield Promise.all([i._getFullExtent(),i._timeExtentPromise]);return(0,j.Te)(r),{fullExtent:o,timeExtent:n}})()}_getBounds(t,i,r){var o=this;return(0,x.A)(function*(){const n=(0,xe.hZ)((0,xe.vt)(),xe.qv);yield o.featureStore.forEachBounds(t,m=>(0,xe.RF)(n,m));const h={xmin:n[0],ymin:n[1],xmax:n[3],ymax:n[4],spatialReference:(0,R.ag)(o.spatialReference)};o.hasZ&&isFinite(n[2])&&isFinite(n[5])&&(h.zmin=n[2],h.zmax=n[5],h.hasZ=!0);const d=(0,Q.Cv)(h,i,r);if(d.spatialReference=(0,R.ag)(r),d.xmax-d.xmin==0){const m=(0,Re.GA)(d.spatialReference);d.xmin-=m,d.xmax+=m}if(d.ymax-d.ymin==0){const m=(0,Re.GA)(d.spatialReference);d.ymin-=m,d.ymax+=m}if(o.hasZ&&null!=d.zmin&&null!=d.zmax&&d.zmax-d.zmin==0){const m=(0,Re.GA)(d.spatialReference);d.zmin-=m,d.zmax+=m}return d})()}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(t=>this._getBounds(t,this.spatialReference,this.spatialReference)),this._fullExtentPromise}_schedule(t,i){var r=this;return(0,x.A)(function*(){return null!=r._frameTask?r._frameTask.schedule(t,i):t(Xe)})()}_reschedule(t,i){var r=this;return(0,x.A)(function*(){return null!=r._frameTask?r._frameTask.reschedule(t,i):t(Xe)})()}_getAllFeaturesQueryEngineResult(t){var i=this;return(0,x.A)(function*(){return new W(yield i._getAllFeatures(),t,i)})()}_getAllFeatures(){var t=this;return(0,x.A)(function*(){if(null==t._allFeaturesPromise){const o=[];t._allFeaturesPromise=(0,x.A)(function*(){yield t.featureStore.forEach(n=>o.push(n))})().then(()=>o)}const i=t._allFeaturesPromise,r=yield i;return i===t._allFeaturesPromise?r.slice():t._getAllFeatures()})()}_executeQuery(t,i,r){var o=this;return(0,x.A)(function*(){t=(0,V.o8)(t),t=yield o._schedule(()=>(0,le.GC)(t,o.definitionExpression,o.spatialReference),r),t=yield o._reschedule(()=>q(t,{availableFields:o.availableFields,fieldsIndex:o.fieldsIndex,geometryType:o.geometryType,spatialReference:o.spatialReference}),r),t={...t,...i};const n=yield o._reschedule(()=>o._executeSceneFilterQuery(t,r),r),h=yield o._reschedule(()=>o._executeGeometryQuery(t,n,r),r);return yield o._reschedule(()=>o._executeAggregateIdsQuery(h),r),yield o._reschedule(()=>o._executeObjectIdsQuery(h),r),yield o._reschedule(()=>o._executeTimeQuery(h),r),yield o._reschedule(()=>o._executeAttributesQuery(h),r),h})()}_executeSceneFilterQuery(t,i){var r=this;return(0,x.A)(function*(){if(null==t.sceneFilter)return null;const{outSR:o,returnGeometry:n,returnCentroid:h}=t,d=r.featureStore.featureSpatialReference,m=t.sceneFilter.geometry,g=null==d||(0,J.aI)(d,m.spatialReference)?m:(0,Q.Cv)(m,d);if(!g)return null;const _=n||h,I=(0,J.fn)(o)&&!(0,J.aI)(r.spatialReference,o)&&_?function(){var A=(0,x.A)(function*(L){return r._project(L,o)});return function(L){return A.apply(this,arguments)}}():A=>A,v=r.featureAdapter,b=yield r._reschedule(()=>r._searchFeatures(ct(g)),i);if("disjoint"===t.sceneFilter.spatialRelationship){if(!b.length)return null;const A=new Set;for(const k of b)A.add(v.getObjectId(k));const L=yield r._reschedule(()=>r._getAllFeatures(),i);return I(yield r._reschedule((0,x.A)(function*(){const k=yield(0,Y.xt)("esriSpatialRelDisjoint",g,r.geometryType,r.hasZ,r.hasM),O=yield r._runSpatialFilter(L,D=>!A.has(v.getObjectId(D))||k(v.getGeometry(D)),i);return new W(O,t,r)}),i))}if(!b.length)return new W([],t,r);if(r._canExecuteSinglePass(g,t))return I(new W(b,t,r));const F=yield(0,Y.xt)("esriSpatialRelContains",g,r.geometryType,r.hasZ,r.hasM),C=yield r._runSpatialFilter(b,A=>F(v.getGeometry(A)),i);return I(new W(C,t,r))})()}_executeGeometryQuery(t,i,r){var o=this;return(0,x.A)(function*(){if(null!=i&&0===i.items.length)return i;t=null!=i?i.query:t;const{geometry:n,outSR:h,spatialRel:d,returnGeometry:m,returnCentroid:g}=t,_=o.featureStore.featureSpatialReference,I=!n||null==_||(0,J.aI)(_,n.spatialReference)?n:(0,Q.Cv)(n,_),v=m||g,b=(0,J.fn)(h)&&!(0,J.aI)(o.spatialReference,h),F=o._geometryQueryCache&&null==i?JSON.stringify(b&&v?{originalFilterGeometry:n,spatialRelationship:d,outSpatialReference:h}:{originalFilterGeometry:n,spatialRelationship:d}):null,C=F?o._geometryQueryCache.get(F):null;if(null!=C)return new W(C,t,o);const A=function(){var O=(0,x.A)(function*(D){return b&&v&&(yield o._project(D,h)),F&&o._geometryQueryCache.put(F,D.items,D.items.length+1),D});return function(w){return O.apply(this,arguments)}}();if(!I)return A(i??(yield o._getAllFeaturesQueryEngineResult(t)));const L=o.featureAdapter;let H=yield o._reschedule(()=>o._searchFeatures(ct(n)),r);if("esriSpatialRelDisjoint"===d){if(!H.length)return A(i??(yield o._getAllFeaturesQueryEngineResult(t)));const O=new Set;for(const z of H)O.add(L.getObjectId(z));const D=null!=i?i.items:yield o._reschedule(()=>o._getAllFeatures(),r);return A(yield o._reschedule((0,x.A)(function*(){const z=yield(0,Y.xt)(d,I,o.geometryType,o.hasZ,o.hasM),Ae=yield o._runSpatialFilter(D,Pe=>!O.has(L.getObjectId(Pe))||z(L.getGeometry(Pe)),r);return new W(Ae,t,o)}),r))}if(null!=i){const O=new Te.vW;H=H.filter(D=>(0,Te.qh)(i.items,D,i.items.length,O)>=0)}if(!H.length){const O=new W([],t,o);return F&&o._geometryQueryCache.put(F,O.items,1),O}if(o._canExecuteSinglePass(I,t))return A(new W(H,t,o));const k=yield(0,Y.xt)(d,I,o.geometryType,o.hasZ,o.hasM),$=yield o._runSpatialFilter(H,O=>k(L.getGeometry(O)),r);return A(new W($,t,o))})()}_executeGeometryQueryForSnapping(t,i){var r=this;return(0,x.A)(function*(){const{query:o}=t,{spatialRel:n}=o;if(!t?.items?.length||!o.geometry||!n)return;const h=yield(0,Y.xt)(n,o.geometry,r.geometryType,r.hasZ,r.hasM),d=yield r._runSpatialFilter(t.items,m=>h(m.geometry),i);t.items=d})()}_executeAggregateIdsQuery(t){if(0===t.items.length||!t.query.aggregateIds?.length||null==this.aggregateAdapter)return;const i=new Set;for(const o of t.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(o).forEach(n=>i.add(n));const r=this.featureAdapter.getObjectId;t.items=t.items.filter(o=>i.has(r(o)))}_executeObjectIdsQuery(t){if(0===t.items.length||!t.query.objectIds?.length)return;const i=new Set(t.query.objectIds),r=this.featureAdapter.getObjectId;t.items=t.items.filter(o=>i.has(r(o)))}_executeTimeQuery(t){if(0===t.items.length)return;const i=(0,ft.I)(this.timeInfo,t.query.timeExtent,this.featureAdapter);null!=i&&(t.items=t.items.filter(i))}_executeAttributesQuery(t){if(0===t.items.length)return;const i=K(t.query.where,this.fieldsIndex);if(i){if(!i.isStandardized)throw new TypeError("Where clause is not standardized");t.items=t.items.filter(r=>i.testFeature(r,this.featureAdapter))}}_runSpatialFilter(t,i,r){var o=this;return(0,x.A)(function*(){if(!i)return t;if(null==o._frameTask)return t.filter(m=>i(m));let n=0;const h=new Array,d=function(){var m=(0,x.A)(function*(g){for(;n<t.length;){const _=t[n++];i(_)&&(h.push(_),g.madeProgress()),g.done&&(yield o._reschedule(I=>d(I),r))}});return function(_){return m.apply(this,arguments)}}();return o._reschedule(m=>d(m),r).then(()=>h)})()}_filterLatest(t){const{trackIdField:i,startTimeField:r,endTimeField:o}=this.timeInfo,n=o||r,h=new Map,d=this.featureAdapter.getAttribute;for(const m of t.items){const g=d(m,i),_=d(m,n),I=h.get(g);(!I||_>d(I,n))&&h.set(g,m)}t.items=Array.from(h.values())}_canExecuteSinglePass(t,i){const{spatialRel:r}=i;return(0,Y.tC)(t)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}_project(t,i){var r=this;return(0,x.A)(function*(){if(!i||(0,J.aI)(r.spatialReference,i))return t;const o=r.featureAdapter;let n;try{const d=yield r._getFullExtent();n=(0,we.getTransformation)(r.spatialReference,i,d)}catch{}const h=yield(0,Q.lK)(t.items.map(d=>(0,R.pL)(r.geometryType,r.hasZ,r.hasM,o.getGeometry(d))),r.spatialReference,i,n);return t.items=h.map((d,m)=>o.cloneWithGeometry(t.items[m],(0,We.Ux)(d,r.hasZ,r.hasM))),t})()}_searchFeatures(t){var i=this;return(0,x.A)(function*(){const r=new Set;yield Promise.all(t.map(n=>i.featureStore.forEachInBounds(n,h=>r.add(h))));const o=Array.from(r.values());return r.clear(),o})()}_executeQueryForStatistics(t,i,r){var o=this;return(0,x.A)(function*(){t=(0,V.o8)(t);try{t=yield o._schedule(()=>(0,le.GC)(t,o.definitionExpression,o.spatialReference),r),t=yield o._reschedule(()=>function Rt(f,t,i){return it.apply(this,arguments)}(t,i,{availableFields:o.availableFields,fieldsIndex:o.fieldsIndex,geometryType:o.geometryType,spatialReference:o.spatialReference}),r);const n=yield o._reschedule(()=>o._executeSceneFilterQuery(t,r),r),h=yield o._reschedule(()=>o._executeGeometryQuery(t,n,r),r);return yield o._reschedule(()=>o._executeAggregateIdsQuery(h),r),yield o._reschedule(()=>o._executeObjectIdsQuery(h),r),yield o._reschedule(()=>o._executeTimeQuery(h),r),yield o._reschedule(()=>o._executeAttributesQuery(h),r),h}catch(n){if(n!==le.v8)throw n;return new W([],t,o)}})()}}function ct(f){if((0,Y.tC)(f)){if((0,ve.ZC)(f))return[(0,de.fA)(Math.min(f.xmin,f.xmax),Math.min(f.ymin,f.ymax),Math.max(f.xmin,f.xmax),Math.max(f.ymin,f.ymax))];if((0,ve.Bi)(f))return f.rings.map(t=>(0,de.fA)(Math.min(t[0][0],t[2][0]),Math.min(t[0][1],t[2][1]),Math.max(t[0][0],t[2][0]),Math.max(t[0][1],t[2][1])))}return[(0,He.Rg)((0,de.vt)(),f)]}},78200:(Ze,Ee,p)=>{p.d(Ee,{F:()=>x});const x={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},50690:(Ze,Ee,p)=>{p.d(Ee,{T:()=>Le});var x=p(27999),Te=p(42086),ee=p(13682);const Le={getObjectId:V=>V.objectId,getAttributes:V=>V.attributes,getAttribute:(V,re)=>V.attributes[re],cloneWithGeometry:(V,re)=>new Te.Om(re,V.attributes,null,V.objectId),getGeometry:V=>V.geometry,getCentroid:(V,re)=>(null==V.centroid&&(V.centroid=(0,x.Q)(new ee.A,V.geometry,re.hasZ,re.hasM)),V.centroid)}},19093:(Ze,Ee,p)=>{p.d(Ee,{$r:()=>pe,Jc:()=>Ce,gV:()=>Ge,rb:()=>je});var x=p(10467),Le=(p(21152),p(5922),p(67685)),V=p(97442),re=p(32034),Ue=p(721),j=p(58701),Re=p(86300),we=p(78592),xe=p(43039),de=p(59377),He=p(48218),ve=p(1749);let he=null;const J=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function pe(T,y,S,M){const R=(0,j.d9)(S)?(0,j.Vp)(S):null,Q=R?Math.round((R.valid[1]-R.valid[0])/y.scale[0]):null;return T.map(se=>{const te=new ve.A(se.geometry);return(0,Ue.Gy)(y,te,te),se.geometry=R?function We(T,y,S){return T.x<0?T.x+=y:T.x>S&&(T.x-=y),T}(te,Q??0,M[0]):te,se})}function Ge(T,y=18,S,M,R){const Q=new Float64Array(M*R);y=Math.round((0,Le.Lz)(y));let se=Number.POSITIVE_INFINITY,te=Number.NEGATIVE_INFINITY;const fe=(0,we.YW)(S);for(const{geometry:X,attributes:Z}of T){const{x:ae,y:P}=X,oe=Math.max(0,ae-y),me=Math.max(0,P-y),Ve=Math.min(R,P+y),Qe=Math.min(M,ae+y),W=+fe(Z);for(let Ie=me;Ie<Ve;Ie++)for(let ye=oe;ye<Qe;ye++){const be=Ie*M+ye,le=(0,we.hv)(ye-ae,Ie-P,y)*W,Y=Q[be]+=le;se=Math.min(se,Y),te=Math.max(te,Y)}}return{min:se,max:te}}function je(T){const y=J.exec(T);if(!y)return null;const{hh:S,mm:M,ss:R,ms:Q}=y.groups;return Number(S)*V.vf.hours+Number(M)*V.vf.minutes+Number(R)*V.vf.seconds+Number(Q||0)}function Ce(T,y){return Oe.apply(this,arguments)}function Oe(){return(Oe=(0,x.A)(function*(T,y,S=!0){if(!y)return[];const{field:M,field2:R,field3:Q,fieldDelimiter:se,fieldInfos:te,timeZone:fe}=T,X=M&&te?.find(Y=>Y.name.toLowerCase()===M.toLowerCase()),Z=!!X&&(0,Re.OH)(X),ae=!!X&&(0,xe.fs)(X),P=T.valueExpression,oe=T.normalizationType,me=T.normalizationField,Ve=T.normalizationTotal,Qe=[],W=T.viewInfoParams;let Ie=null,ye=null;if(P){if(!he){const{arcadeUtils:Y}=yield(0,He.lw)();he=Y}he.hasGeometryOperations(P)&&(yield he.enableGeometryOperations()),Ie=he.createFunction(P),ye=W?he.getViewInfo({viewingMode:W.viewingMode,scale:W.scale,spatialReference:new re.A(W.spatialReference)}):null}const be=T.fieldInfos,le=y[0]&&"declaredClass"in y[0]&&"esri.Graphic"===y[0].declaredClass||!be?null:{fields:be};return y.forEach(Y=>{const ue=Y.attributes;let q;if(P){const De=le?{...Y,layer:le}:Y,Ke=he.createExecContext(De,ye,fe);q=he.executeFunction(Ie,Ke)}else ue&&(q=ue[M],R?(q=`${(0,de.gJ)(q)}${se}${(0,de.gJ)(ue[R])}`,Q&&(q=`${q}${se}${(0,de.gJ)(ue[Q])}`)):"string"==typeof q&&S&&(ae?q=q?new Date(q).getTime():null:Z&&(q=q?je(q):null)));if(oe&&"number"==typeof q&&isFinite(q)){const De=ue&&parseFloat(ue[me]);q=(0,de.zS)(q,oe,De,Ve)}Qe.push(q)}),Qe})).apply(this,arguments)}},43039:(Ze,Ee,p)=>{p.d(Ee,{fs:()=>ve,i0:()=>$e});var x=p(48266),Te=p(86300),V=(p(48218),p(71470),p(22639));function ve(E){return(0,Te.vE)(E)||(0,Te.zD)(E)||(0,Te.Ah)(E)}function $e(E,U){const{format:G,timeZoneOptions:B,fieldType:K}=U??{};let ne,T;if(B&&({timeZone:ne,timeZoneName:T}=(0,V.hv)(B.layerTimeZone,B.datesInUnknownTimezone,B.viewTimeZone,(0,x.J2)(G||"short-date-short-time"),K)),"string"==typeof E&&isNaN(Date.parse("time-only"===K?`1970-01-01T${E}Z`:E)))return E;switch(K){case"date-only":{const y=(0,x.J2)(G||"short-date");return"string"==typeof E?(0,x.iS)(E,{...y}):(0,x.Yq)(E,{...y,timeZone:V.n$})}case"time-only":{const y=(0,x.J2)(G||"short-time");return"string"==typeof E?(0,x.F8)(E,y):(0,x.Yq)(E,{...y,timeZone:V.n$})}case"timestamp-offset":{if(!ne&&"string"==typeof E&&new Date(E).toISOString()!==E)return E;const y=G||B?(0,x.J2)(G||"short-date-short-time"):void 0,S=y?{...y,timeZone:ne,timeZoneName:T}:void 0;return"string"==typeof E?(0,x.Ey)(E,S):(0,x.Yq)(E,S)}default:{const y=G||B?(0,x.J2)(G||"short-date-short-time"):void 0;return(0,x.Yq)("string"==typeof E?new Date(E):E,y?{...y,timeZone:ne,timeZoneName:T}:void 0)}}}}}]);