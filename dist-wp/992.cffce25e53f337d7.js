"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[992],{22818:(be,J,m)=>{m.d(J,{YS:()=>Pe,n_:()=>kt,Wn:()=>Gt});var F=m(47669),E=m(69473);class N{constructor(){this.drawPhase=E.S5.MAP|E.S5.HITTEST|E.S5.HIGHLIGHT|E.S5.DEBUG}startup(){}shutdown(i){}}class R extends N{constructor(){super(...arguments),this.overrideStencilRef=null,this.symbologyPlane=E.uC.FILL,this.postProcessingEnabled=!1}postProcess(i,r){}}var h=m(23070),I=m(8137),u=m(8189),d=m(24821),s=m(3902),U=m(4196),$=m(16585);class ae extends d.ZA{}(0,u._)([(0,d.C5)(0,s.ZY)],ae.prototype,"pos",void 0);class le extends d.k2{}(0,u._)([(0,d.Pi)(s.nt)],le.prototype,"dotSize",void 0);class re extends d.k2{}(0,u._)([(0,d.Pi)(s.z7)],re.prototype,"locations",void 0),(0,u._)([(0,d.Pi)(s.nt)],re.prototype,"pixelRatio",void 0),(0,u._)([(0,d.Pi)(s.nt)],re.prototype,"tileZoomFactor",void 0);class y extends d.A{vertex(i){const r=new s.U(1,0,0,0,-1,0,0,1,1).multiply(new s.eB(i.pos.xy.divide(F.CQ),1)),n=(0,s.US)(this.draw.locations,r.xy),o=(0,s.T9)(this.instance.dotSize.divide(2),new s.nt(1));let l=new s.nt(0);l=l.add((0,s.PM)(n.a,new s.nt(1e-6)).multiply(2));let p=o.add(this.instance.dotSize);const f=this.view.displayViewScreenMat3.multiply(new s.eB(i.pos.add(.5),1)),x=new s.Zb(f.xy,l,1),V=this.instance.dotSize.divide(p),w=new s.nt(-1).divide(o.divide(p));return p=p.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:x,glPointSize:p,color:n,ratio:V,invEdgeRatio:w}}fragment(i){const r=(0,s.Bw)(i.glPointCoord.subtract(.5)).multiply(2),n=(0,s.TF)(new s.nt(0),new s.nt(1),i.invEdgeRatio.multiply(r.subtract(i.ratio)).add(1)),o=new d.mm;return o.glFragColor=i.color.multiply(n),o}}(0,u._)([(0,d.Pi)(le)],y.prototype,"instance",void 0),(0,u._)([(0,d.Pi)(re)],y.prototype,"draw",void 0),(0,u._)([(0,d.Pi)($.o)],y.prototype,"view",void 0),(0,u._)([(0,u.a)(0,(0,d.hF)(ae))],y.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.hF)(class pe extends U.DM{}))],y.prototype,"fragment",null);var _=m(6702),z=m(875);class H extends U.rz{}(0,u._)([(0,d.C5)(3,s.nt)],H.prototype,"inverseArea",void 0);class ee extends d.k2{}(0,u._)([(0,d.Pi)(s.My.ofType(s.Zb,2))],ee.prototype,"isActive",void 0),(0,u._)([(0,d.Pi)(s.My.ofType(s.Zb,8))],ee.prototype,"colors",void 0),(0,u._)([(0,d.Pi)(s.nt)],ee.prototype,"dotValue",void 0);class S extends d.k2{}(0,u._)([(0,d.Pi)(s.z7)],S.prototype,"dotTexture0",void 0),(0,u._)([(0,d.Pi)(s.z7)],S.prototype,"dotTexture1",void 0),(0,u._)([(0,d.Pi)(s.nt)],S.prototype,"tileZoomFactor",void 0),(0,u._)([(0,d.Pi)(s.nt)],S.prototype,"pixelRatio",void 0),(0,u._)([(0,d.Pi)(s.nt)],S.prototype,"tileDotsOverArea",void 0);class a extends U.f_{_dotThreshold(i,r,n){return i.divide(r).divide(n)}vertex(i){const r=new s.U(2/F.CQ,0,0,0,-2/F.CQ,0,-1,1,1).multiply(new s.eB(i.pos,1)),n=this.clip(i.id),o=new s.Zb(r.xy,n,1),l=this.storage.getVVData(i.id).multiply(this.instance.isActive.get(0)).multiply(i.inverseArea),p=this.storage.getDataDrivenData0(i.id).multiply(this.instance.isActive.get(1)).multiply(i.inverseArea),f=this.draw.tileZoomFactor.multiply(F.CQ).divide(this.draw.pixelRatio),x=this._dotThreshold(l,this.instance.dotValue,this.draw.tileDotsOverArea),V=this._dotThreshold(p,this.instance.dotValue,this.draw.tileDotsOverArea),w=i.pos.add(.5).divide(f);return{glPosition:o,color:new s.Zb(0,0,0,0),textureCoords:w,thresholds0:x,thresholds1:V}}fragment(i){const r=new d.mm,n=(0,s.US)(this.draw.dotTexture0,i.textureCoords),o=(0,s.US)(this.draw.dotTexture1,i.textureCoords),l=i.thresholds0.subtract(n),p=i.thresholds1.subtract(o);let f;const x=s.$I.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),V=s.$I.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const w=(0,s.PM)(new s.nt(0),l),M=(0,s.PM)(new s.nt(0),p),P=(0,s.Om)(w,l).add((0,s.Om)(M,p)),C=(0,s.PM)(P,new s.nt(0)),B=new s.nt(1).subtract(C),L=P.add(C),Z=l.multiply(w).divide(L),Y=p.multiply(M).divide(L),ie=x.multiply(Z).add(V.multiply(Y));f=B.multiply(ie)}else{const w=(0,s.T9)((0,z.xf)(l),(0,z.xf)(p)),M=(0,s.PM)(w,new s.nt(0)),P=new s.nt(1).subtract(M),C=(0,s.PM)(w,l),B=(0,s.PM)(w,p),L=x.multiply(C).add(V.multiply(B));f=P.multiply(L)}return r.glFragColor=f,r}hittest(i){return(0,_.My)(this.hittestRequest)}}(0,u._)([d.E8],a.prototype,"blending",void 0),(0,u._)([(0,d.Pi)(ee)],a.prototype,"instance",void 0),(0,u._)([(0,d.Pi)(S)],a.prototype,"draw",void 0),(0,u._)([(0,u.a)(0,(0,d.hF)(H))],a.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.hF)(U.DM))],a.prototype,"fragment",null);var b=m(40707),c=m(50915);const v={[c.pe.BYTE]:1,[c.pe.UNSIGNED_BYTE]:1,[c.pe.SHORT]:2,[c.pe.UNSIGNED_SHORT]:2,[c.pe.HALF_FLOAT]:2,[c.pe.INT]:4,[c.pe.UNSIGNED_INT]:4,[c.pe.FLOAT]:4};var T=m(32788),O=m(45513),G=m(30454);class W{constructor(i,r){this._boundPart=null;const n=[];for(const l of r.vertex){const p=T.g.createVertex(i,c._U.STATIC_DRAW,l);n.push(p)}const o=[];for(const l of r.index||[]){const p=T.g.createIndex(i,c._U.STATIC_DRAW,l);o.push(p)}this.groups=[];for(const l of r.groups){let p;if(null!=l.index){if(!r.index)throw new Error("No index data.");const{BYTES_PER_ELEMENT:P}=r.index[l.index];2===P?p=c.pe.UNSIGNED_SHORT:4===P&&(p=c.pe.UNSIGNED_INT)}const f=null!=l.index?o[l.index]:null,x=new Map,V={},w={};for(const P of l.attributes){const{name:C,count:B,type:L,offset:Z,normalized:Y,divisor:ie,stride:de,vertex:ve,location:q}=P,Q=`vertex-buffer-${ve}`;let k=V[Q];k||(k=V[Q]=[]);const se=new G._(C,B,L,Z,de,Y,ie);k.push(se),x.set(C,q),w[Q]=n[ve]}const M=new O.Z(i,x,V,w,f);this.groups.push({...l,vertexArray:M,locations:x,layout:V,indexing:p})}this.parts=r.parts}bind(i,r){this._boundPart=r;const{group:n}=this.parts[this._boundPart],{vertexArray:o}=this.groups[n];i.bindVAO(o)}draw(i){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:r,count:n}=this.parts[this._boundPart],{group:o}=this.parts[this._boundPart],{indexing:l,primitive:p}=this.groups[o];l?i.drawElements(p,n,l,r*v[l]):i.drawArrays(p,r,n)}unbind(i){this._boundPart=null,i.bindVAO(null)}destroy(){for(const{vertexArray:i}of this.groups)i.dispose()}}var j=m(1416);class X extends W{static create(i,r){const n=[];let{stride:o,hash:l}=r.layout;if(null==o){o=0;for(const{count:P,type:C,offset:B}of r.layout.attributes){if(null!=B)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");o+=P*v[C]}}let p=0,f=0;for(const{count:P,name:C,offset:B,type:L,normalized:Z}of r.layout.attributes)null!=B&&(f=B),n.push({name:C,location:p,vertex:0,count:P,type:L,offset:f,stride:o,divisor:0,normalized:null!=Z&&Z}),p++,f+=P*v[L];const x={attributes:n,primitive:r.primitive};null!=r.index&&(x.index=0);let{count:V}=r;if(null==V&&(V=r.index?r.index.length:r.vertex.byteLength/o,Math.floor(V)!==V))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${o}.`);const M={vertex:[r.vertex],parts:[{start:0,count:V,group:0,primitive:r.primitive}],groups:[x]};return null!=r.index&&(M.index=[r.index]),null==l&&(l=(0,j.hU)(n)),new X(i,M,{hash:l,attributes:n,stride:o})}constructor(i,r,n){super(i,r),this.layout=n}bind(i,r=0){super.bind(i,r)}}var oe=m(79061),Ae=m(17107),Ze=m(49950),Ne=m(26136),ze=m(4931);class lt{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(i){if(null==this._dotFBO){const r=F.CQ,n=F.CQ,o=new ze.R(r,n);o.samplingMode=c.Cj.NEAREST,o.wrapMode=c.pF.CLAMP_TO_EDGE;const l=new Ae.l(i,new Ze.q(c.yQ.DEPTH_STENCIL,r,n));this._dotFBO=new oe.H(i,o,l)}return this._dotFBO}getDotDensityMesh(i){if(null==this._dotMesh){const r=F.CQ,n=r*r,o=2,l=new Int16Array(n*o);for(let x=0;x<r;x++)for(let V=0;V<r;V++)l[o*(V+x*r)]=V,l[o*(V+x*r)+1]=x;const p=[{count:2,type:c.pe.UNSIGNED_SHORT,name:"a_position",offset:0}],f={hash:(0,j.hU)(p),attributes:p,stride:4};this._dotMesh=X.create(i,{primitive:c.WR.POINTS,vertex:l,count:n,layout:f})}return this._dotMesh}getDotDensityTextures(i,r,n){if(this._dotTextureSize===r&&this._seed===n||(this._disposeTextures(),this._dotTextureSize=r,this._seed=n),null===this._dotTextures){const o=new b.A(n);this._dotTextures=[this._allocDotDensityTexture(i,r,o),this._allocDotDensityTexture(i,r,o)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let i=0;i<this._dotTextures.length;i++)this._dotTextures[i].dispose();this._dotTextures=null}}_allocDotDensityTexture(i,r,n){const o=new Float32Array(r*r*4);for(let p=0;p<o.length;p++)o[p]=n.getFloat();const l=new ze.R;return l.dataType=c.ld.FLOAT,l.samplingMode=c.Cj.NEAREST,l.width=r,l.height=r,new Ne.g(i,l,o)}}var He=m(35891),ct=m(61254);function Se(g){const i=1/g;return{antialiasing:i,blur:0+i}}var pt=m(80302),mt=m(3772),vt=m(61312),gt=m(89148),St=m(35150),je=m(11432),Ee=m(5922);class We{constructor(i,r,n,o){this.dataType=i,this.samplingMode=r,this.pixelFormat=n,this.internalFormat=o}}class Vt{destroy(){this._accumulateFramebuffer=(0,je.WD)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,je.WD)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(i){if(null==this._qualityProfile){const r=function _t(g,i){const{textureFloatLinear:r,colorBufferFloat:n}=g.capabilities,o=n?.textureFloat,l=n?.textureHalfFloat,p=n?.floatBlend,f=g.driverTest.floatBufferBlend.result;if(!o&&!l)throw new Ee.A("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(p&&f||l))throw new Ee.A("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(f?"":" This device claims support for EXT_float_blend, but does not actually support it."));const x=o&&p&&f,V=l,w=r,M=!!n?.R32F,P=!!n?.R16F;if(x&&w)return w||i.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new We(c.ld.FLOAT,w?c.Cj.LINEAR:c.Cj.NEAREST,M?c.Ab.RED:c.Ab.RGBA,M?c.H0.R32F:c.Ab.RGBA);if(V)return new We(c.ld.HALF_FLOAT,c.Cj.LINEAR,P?c.Ab.RED:c.Ab.RGBA,P?c.H0.R16F:c.Ab.RGBA);throw new Ee.A("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(i,St.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...r,defines:{usesHalfFloatPrecision:r.dataType!==c.ld.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(i,r,n){if(null==this._accumulateFramebuffer){const{dataType:o,samplingMode:l,pixelFormat:p,internalFormat:f}=this.loadQualityProfile(i),x=new ze.R(r,n);x.pixelFormat=p,x.internalFormat=f,x.dataType=o,x.samplingMode=l,x.wrapMode=c.pF.CLAMP_TO_EDGE;const V=new Ze.q(c.yQ.DEPTH_STENCIL,r,n);this._accumulateFramebuffer=new oe.H(i,x,V)}else{const{width:o,height:l}=this._accumulateFramebuffer;o===r&&l===n||this._accumulateFramebuffer.resize(r,n)}return this._accumulateFramebuffer}ensureResolveGradientTexture(i,r,n){if(null==this._resolveGradientTexture){const o=new ze.R;o.wrapMode=c.pF.CLAMP_TO_EDGE,this._resolveGradientTexture=new Ne.g(i,o)}else this._prevGradientHash!==r&&(this._resolveGradientTexture.resize(n.length/4,1),this._resolveGradientTexture.setData(n),this._prevGradientHash=r);return this._resolveGradientTexture}}function Ye(g){return g?.25:1}class Ke extends U.rz{}(0,u._)([(0,d.C5)(5,s.ZY)],Ke.prototype,"offset",void 0);class Re extends d.k2{}(0,u._)([(0,d.Pi)(s.nt)],Re.prototype,"radius",void 0),(0,u._)([(0,d.Pi)(s.nt)],Re.prototype,"isFieldActive",void 0);class _e extends U.f_{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(i){const{radius:r,isFieldActive:n}=this.kernelControls,o=i.offset,l=n.multiply(this.storage.getVVData(i.id).x).add(new s.nt(1).subtract(n)),p=this.view.displayViewScreenMat3.multiply(new s.eB(i.pos,1)).add(this.view.displayViewMat3.multiply(new s.eB(o,0)).multiply(r)),f=this.clip(i.id);return{glPosition:new s.Zb(p.xy,f,1),offset:o,fieldValue:l,color:new s.Zb(0),...this.maybeRunHittest(i,{},null)}}fragment(i){const{offset:r,fieldValue:n}=i,o=(0,s.Bw)(r),l=(0,s.PM)(o,new s.nt(1)),p=new s.nt(1).subtract(o.multiply(o)),f=p.multiply(p),x=l.multiply(f).multiply(n).multiply(new s.nt(Ye(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new s.Zb(x),i)}hittest(i){const{viewMat3:r,tileMat3:n}=this.view,o=r.multiply(n).multiply(new s.eB(i.pos,1));return(0,_.g$)(o.xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,u._)([d.E8],_e.prototype,"usesHalfFloatPrecision",void 0),(0,u._)([(0,d.Pi)(Re)],_e.prototype,"kernelControls",void 0),(0,u._)([(0,u.a)(0,(0,d.hF)(Ke))],_e.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.hF)(class Mt extends U.DM{}))],_e.prototype,"fragment",null);class Qe extends d.ZA{}(0,u._)([(0,d.C5)(0,s.ZY)],Qe.prototype,"pos",void 0);class Te extends d.k2{}(0,u._)([(0,d.Pi)(s.z7)],Te.prototype,"texture",void 0),(0,u._)([(0,d.Pi)(s.ZY)],Te.prototype,"minAndInvRange",void 0),(0,u._)([(0,d.Pi)(s.nt)],Te.prototype,"normalization",void 0);class Ge extends d.k2{}(0,u._)([(0,d.Pi)(s.z7)],Ge.prototype,"texture",void 0);class xe extends d.A{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(i){return{glPosition:new s.Zb(i.pos.multiply(2).subtract(1),1,1),uv:i.pos}}fragment(i){const{accumulatedDensity:r,gradient:n}=this;let o=(0,s.US)(r.texture,i.uv).r.multiply(new s.nt(Ye(this.usesHalfFloatPrecision)));o=o.multiply(r.normalization),o=o.subtract(r.minAndInvRange.x).multiply(r.minAndInvRange.y);const l=(0,s.US)(n.texture,new s.ZY(o,.5)),p=new d.mm;return p.glFragColor=new s.Zb(l.rgb.multiply(l.a),l.a),p}}function ke(g){return g.key.level+1}(0,u._)([d.E8],xe.prototype,"usesHalfFloatPrecision",void 0),(0,u._)([(0,d.Pi)(Te)],xe.prototype,"accumulatedDensity",void 0),(0,u._)([(0,d.Pi)(Ge)],xe.prototype,"gradient",void 0),(0,u._)([(0,u.a)(0,(0,d.hF)(Qe))],xe.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.hF)(class Pt extends d.HS{}))],xe.prototype,"fragment",null);const $e={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:ke,compare:c.MT.GEQUAL,mask:255,op:{fail:c.eA.KEEP,zFail:c.eA.KEEP,zPass:c.eA.REPLACE}}}},Ct={...$e,stencil:!1},At={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function Xe(g,i){const{referenceScale:r,radius:n}=g.uniforms;return n*(0!==r?r/i.scale:1)}var ne=m(90731),Oe=m(28580),qe=m(79677),Je=m(35255);class Fe extends d.k2{getVVRotationMat4(i){return(0,s.Tk)((0,z.M8)(i),s.$I.identity(),()=>{const r=this._getNormalizedAngle(i).multiply(ne.os),n=(0,s.F8)(r),o=(0,s.gn)(r);return new s.$I(o,n,0,0,n.multiply(new s.nt(-1)),o,0,0,0,0,1,0,0,0,0,1)})}getVVRotationMat3(i){return(0,s.Tk)((0,z.M8)(i),s.U.identity(),()=>{const r=this._getNormalizedAngle(i).multiply(ne.os),n=(0,s.F8)(r),o=(0,s.gn)(r);return new s.U(o,n,0,n.multiply(new s.nt(-1)),o,0,0,0,1)})}_getNormalizedAngle(i){const r=(0,s.LC)(this.rotationType,new s.nt(ne.H_.Arithmatic));return(0,s.Tk)(r,new s.nt(90).subtract(i),i)}}(0,u._)([(0,d.Pi)(s.nt)],Fe.prototype,"rotationType",void 0);var et=m(2098),tt=m(14082),it=m(25688),st=m(47150),ge=m(95171);const Et=360/254;class ue extends U.rz{}(0,u._)([(0,d.C5)(3,s.Zb)],ue.prototype,"color",void 0),(0,u._)([(0,d.C5)(4,s.ZY)],ue.prototype,"offset",void 0),(0,u._)([(0,d.C5)(5,s.ZY)],ue.prototype,"textureUV",void 0),(0,u._)([(0,d.C5)(6,s.nt)],ue.prototype,"fontSize",void 0),(0,u._)([(0,d.C5)(7,s.nt)],ue.prototype,"referenceSize",void 0),(0,u._)([(0,d.C5)(8,s.nt)],ue.prototype,"haloFontSize",void 0),(0,u._)([(0,d.C5)(9,s.Zb)],ue.prototype,"haloColor",void 0),(0,u._)([(0,d.C5)(10,s.ZY)],ue.prototype,"zoomRange",void 0),(0,u._)([(0,d.C5)(11,s.nt)],ue.prototype,"clipAngle",void 0),(0,u._)([(0,d.C5)(12,s.Zb)],ue.prototype,"referenceSymbol",void 0);class De extends d.Y7{}(0,u._)([(0,d.C5)(13,s.ZY)],De.prototype,"offsetNextVertex1",void 0),(0,u._)([(0,d.C5)(14,s.ZY)],De.prototype,"offsetNextVertex2",void 0);class te extends U.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.isHaloPass=!1,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(i,r,n){const o=r.multiply(Et),l=(0,s.tn)(this.view.rotation.subtract(o)),p=(0,s.jk)(new s.nt(360).subtract(l),l);let f=new s.nt(0);const x=(0,s.RI)(this.view.currentZoom.multiply(F.fq)).divide(F.fq),V=i.x,w=i.y,M=new s.nt(1).subtract((0,s.PM)(V,x)).multiply(2),P=(0,s.PM)(new s.nt(90),p).multiply(2),C=new s.nt(2).multiply(new s.nt(1).subtract((0,s.PM)(x,w)));return f=f.add(n.multiply(M)),f=f.add(n.multiply(P)),f=f.add(C),f}vertex(i,r){const n=(0,z.mh)(i.bitset,ne.bg),o=new s.nt(1).subtract(n);let l=i.fontSize,p=l.divide(ne.au);const f=this.isHaloPass?i.haloColor:this._getVertexColor(i),x=this.isLabel?this.storage.getAnimationValue(i.id):new s.nt(1),V=this.isLabel?f.multiply(x):f,w=this.view.displayViewScreenMat3.multiply(new s.eB(i.pos,1));let M=i.offset,P=new s.nt(1),C=s.U.identity(),B=new s.ZY(0);if(this.isLabel){if(!i.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const Q=i.referenceSymbol,k=Q.xy,se=Q.z,K=this._unpackDirection(Q.w),Be=(0,ge.Mg)(this,i.id,se).divide(2),Ue=K.multiply(Be.add(F.C2));B=k.add(Ue),M=M.add(B)}else P=(0,ge.Mg)(this,i.id,i.referenceSize).divide(i.referenceSize),l=l.multiply(P),p=p.multiply(P),M=M.multiply(P),C=(0,ge.TL)(this,i.id),M=C.multiply(new s.eB(M,0)).xy;const L=(0,z.mh)(i.bitset,ne.ti),Z=this._getViewRotationMatrix(L).multiply(new s.eB(M,0));let Y=this.isLabel?this.clipLabel(i.zoomRange,i.clipAngle,L):this.clip(i.id,i.zoomRange);Y=Y.add(this.isBackgroundPass?o.multiply(2):n.multiply(2));const ie=this.isLabel?(0,s.or)((0,s.MM)(Y,new s.nt(1)),(0,s.LC)(x,new s.nt(0))):new s.x(!1),de=new s.Zb(w.xy.add(Z.xy),Y,1),ve=i.textureUV.divide(this.mosaicInfo.size);let q=new s.nt(0);return this.isHaloPass&&(q=i.haloFontSize.divide(p).divide(ne.$w)),{glPosition:de,color:V,size:p,textureUV:ve,antialiasingWidth:new s.nt(.105*ne.au).divide(l).divide(this.view.pixelRatio),haloDistanceOffset:q,...this.maybeRunHittest(i,r,{vvSizeAdjustment:P,vvRotation:C,labelOffset:B,labelClipped:ie})}}_getViewRotationMatrix(i){const r=this.view.displayViewMat3,n=this.view.displayMat3,o=new s.nt(1).subtract(i);return r.multiply(i).add(n.multiply(o))}fragment(i){const r=new s.nt(.25),n=new s.nt(1).subtract(r),o=(0,s.US)(this.mosaicInfo.texture,i.textureUV).a;let l=n.subtract(i.haloDistanceOffset);this.highlight&&(l=l.divide(2));const p=i.antialiasingWidth,f=(0,s.TF)(l.subtract(p),l.add(p),o);return this.getFragmentOutput(i.color.multiply(f),i)}hittest(i,r,{vvSizeAdjustment:n,vvRotation:o,labelOffset:l,labelClipped:p}){let f,x,V;this.isLabel?(f=new s.eB(i.offset.add(l),0),x=new s.eB(r.offsetNextVertex1.add(l),0),V=new s.eB(r.offsetNextVertex2.add(l),0)):(f=o.multiply(new s.eB(i.offset.multiply(n),0)),x=o.multiply(new s.eB(r.offsetNextVertex1.multiply(n),0)),V=o.multiply(new s.eB(r.offsetNextVertex2.multiply(n),0)));const{viewMat3:w,tileMat3:M}=this.view,P=w.multiply(M).multiply(new s.eB(i.pos,1)),C=P.add(M.multiply(f)).xy,B=P.add(M.multiply(x)).xy,L=P.add(M.multiply(V)).xy,Z=(0,_.Bo)(this.hittestRequest.position,C.xy,B.xy,L.xy);return this.isLabel?(0,s.Tk)(p,(0,_.My)(this.hittestRequest),Z):Z}_unpackDirection(i){const r=new s.Ai(i),n=(0,s.Sj)(r,new s.Ai(2)),o=(0,s.nf)(r,new s.Ai(3));return new s.ZY(new s.nt(n).subtract(1),new s.nt(o).subtract(1))}_getVertexColor(i){let r=i.color;if(this.visualVariableColor){const n=this.storage.getColorValue(i.id);r=this.visualVariableColor.getColor(n,i.color,new s.x(!1))}if(this.visualVariableOpacity){const n=this.storage.getOpacityValue(i.id),o=this.visualVariableOpacity.getOpacity(n);r=r.multiply(o)}return r}}(0,u._)([(0,d.uK)(qe._)],te.prototype,"visualVariableColor",void 0),(0,u._)([(0,d.uK)(Je.i)],te.prototype,"visualVariableOpacity",void 0),(0,u._)([(0,d.uK)(Fe)],te.prototype,"visualVariableRotation",void 0),(0,u._)([(0,d.uK)(et.n)],te.prototype,"visualVariableSizeMinMaxValue",void 0),(0,u._)([(0,d.uK)(tt.F)],te.prototype,"visualVariableSizeScaleStops",void 0),(0,u._)([(0,d.uK)(it.N)],te.prototype,"visualVariableSizeStops",void 0),(0,u._)([(0,d.uK)(st.d)],te.prototype,"visualVariableSizeUnitValue",void 0),(0,u._)([(0,d.Pi)(Oe.b)],te.prototype,"mosaicInfo",void 0),(0,u._)([d.E8],te.prototype,"isHaloPass",void 0),(0,u._)([d.E8],te.prototype,"isBackgroundPass",void 0),(0,u._)([d.E8],te.prototype,"isLabel",void 0),(0,u._)([(0,u.a)(0,(0,d.hF)(ue)),(0,u.a)(1,(0,d.hF)(De))],te.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.hF)(class Rt extends U.DM{}))],te.prototype,"fragment",null);var we=m(95827),Dt=m(84289);class Ce extends we.Xc{}(0,u._)([(0,d.C5)(9,s.nt)],Ce.prototype,"accumulatedDistance",void 0),(0,u._)([(0,d.C5)(10,s.ZY)],Ce.prototype,"segmentDirection",void 0),(0,u._)([(0,d.C5)(11,s.Zb)],Ce.prototype,"tlbr",void 0);class Ie extends we.cM{_getLineWidthRatio(i,r){const n=new s.nt(Dt.$),o=(0,z.mh)(i.bitset,ne.kx);return o.multiply((0,s.T9)(r,new s.nt(.25))).add(new s.nt(1).subtract(o)).divide(n)}_getSDFAlpha(i){const{halfWidth:r,normal:n,tlbr:o,patternSize:l,accumulatedDistance:p,lineWidthRatio:f}=i,x=l.x.multiply(new s.nt(2)).multiply(f),V=(0,s.jc)(p.divide(x)),w=new s.nt(.25).multiply(n.y).add(new s.nt(.5)),M=(0,s.jh)(o.xy,o.zw,new s.ZY(V,w)),P=(0,z.Rj)((0,s.US)(this.mosaicInfo.texture,M)).subtract(new s.nt(.5)).multiply(r),C=(0,s.qE)(new s.nt(.5).subtract(P),new s.nt(0),new s.nt(1));return new s.Zb(C)}_getPatternColor(i){const{halfWidth:r,normal:n,color:o,accumulatedDistance:l,patternSize:p,sampleAlphaOnly:f,tlbr:x}=i,V=p.y.multiply(new s.nt(2).multiply(r).divide(p.x)),w=(0,s.jc)(l.divide(V)),M=new s.nt(.5).multiply(n.y).add(new s.nt(.5)),P=(0,s.jh)(x.xy,x.zw,new s.ZY(M,w));let C=(0,s.US)(this.mosaicInfo.texture,P);return null!=this.visualVariableColor&&(C=(0,s.Tk)((0,s.MM)(f,new s.nt(.5)),new s.Zb(o.a),o)),C}vertex(i,r){const{segmentDirection:n,tlbr:o,bitset:l}=i,p=(0,we.$0)(this,i),f=i.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,s.Om)(n,p.scaledOffset)),x=new s.ZY(o.z.subtract(o.x),o.w.subtract(o.y)),V=o.divide(this.mosaicInfo.size.xyxy),w=(0,z.mh)(l,ne.b5),M=(0,z.mh)(l,ne.cn),P=(0,s.Tk)((0,s.MM)(w,new s.nt(.5)),this._getLineWidthRatio(i,p.scaledHalfWidth),new s.nt(1));return{...p,tlbr:V,patternSize:x,accumulatedDistance:f,isSDF:w,sampleAlphaOnly:M,lineWidthRatio:P,...this.maybeRunHittest(i,r,p.halfWidth)}}fragment(i){const{color:r,opacity:n,isSDF:o}=i,l=(0,we.xw)(i,this.antialiasingControls.blur),p=(0,s.Tk)((0,s.MM)(o,new s.nt(.5)),this._getSDFAlpha(i),this._getPatternColor(i)),f=r.multiply(n).multiply(l).multiply(p);return this.getFragmentOutput(f,i)}}(0,u._)([(0,d.Pi)(Oe.b)],Ie.prototype,"mosaicInfo",void 0),(0,u._)([(0,u.a)(0,(0,d.hF)(Ce)),(0,u.a)(1,(0,d.hF)(U.$Z))],Ie.prototype,"vertex",null);var Ve=m(93300);class me extends U.rz{}(0,u._)([(0,d.C5)(3,s.Zb)],me.prototype,"color",void 0),(0,u._)([(0,d.C5)(4,s.Zb)],me.prototype,"outlineColor",void 0),(0,u._)([(0,d.C5)(5,s.ZY)],me.prototype,"offset",void 0),(0,u._)([(0,d.C5)(6,s.ZY)],me.prototype,"textureUV",void 0),(0,u._)([(0,d.C5)(7,s.Zb)],me.prototype,"sizing",void 0),(0,u._)([(0,d.C5)(8,s.nt)],me.prototype,"placementAngle",void 0),(0,u._)([(0,d.C5)(9,s.nt)],me.prototype,"sizeRatio",void 0),(0,u._)([(0,d.C5)(10,s.ZY)],me.prototype,"zoomRange",void 0);class Me extends d.Y7{}function ye(g,i,r,n){return i.multiply(g.x).add(r.multiply(g.y)).add(n.multiply(g.z))}function Le(g){return g.multiply(g).divide(128)}(0,u._)([(0,d.C5)(12,s.ZY)],Me.prototype,"offsetNextVertex1",void 0),(0,u._)([(0,d.C5)(13,s.ZY)],Me.prototype,"offsetNextVertex2",void 0),(0,u._)([(0,d.C5)(14,s.ZY)],Me.prototype,"textureUVNextVertex1",void 0),(0,u._)([(0,d.C5)(15,s.ZY)],Me.prototype,"textureUVNextVertex2",void 0);class ce extends U.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(i,r){const n=Le(i.sizing.x),o=Le(i.sizing.y),l=Le(i.sizing.z),p=i.placementAngle,f=(0,z.mh)(i.bitset,Ve.c.bitset.isSDF),x=(0,z.mh)(i.bitset,Ve.c.bitset.isMapAligned),V=(0,z.mh)(i.bitset,Ve.c.bitset.scaleSymbolsProportionally),w=(0,z.K5)(i.bitset,Ve.c.bitset.colorLocked),M=(0,ge.cF)(this,i.id),P=(0,ge.G7)(this,i.id,i.color,w).multiply(M),C=this.view.displayViewScreenMat3.multiply(new s.eB(i.pos.xy,1)),B=(0,ge.Mg)(this,i.id,l).divide(l),L=n.multiply(B),Z=i.offset.xy.multiply(B);let Y=o.multiply(V.multiply(B.subtract(1)).add(1));Y=(0,s.jk)(Y,(0,s.T9)(L.subtract(.99),new s.nt(0)));const ie=(0,s.T9)(Y,new s.nt(1)),de=(0,s.jk)(Y,new s.nt(1)),ve=s.U.fromRotation(p.multiply(ne.rp)),q=(0,ge.TL)(this,i.id),Q=this._getViewRotationMatrix(x).multiply(q).multiply(ve).multiply(new s.eB(Z.xy,0)),k=this.clip(i.id,i.zoomRange),se=new s.Zb(C.xy.add(Q.xy),k,1),K=i.textureUV.divide(this.mosaicInfo.size),Be=i.outlineColor.multiply(de),Ue=(0,z.mh)(i.bitset,Ve.c.bitset.overrideOutlineColor),at=i.sizeRatio.multiply(L).multiply(.5);return{glPosition:se,color:P,textureUV:K,outlineColor:Be,outlineSize:ie,distanceToPx:at,isSDF:f,overrideOutlineColor:Ue,...this.maybeRunHittest(i,r,{pos:i.pos,size:L,sizeCorrection:B,isMapAligned:x,outlineSize:ie,distanceToPx:at,isSDF:f})}}fragment(i){const r=this._getColor(i.textureUV,i);return this.getFragmentOutput(r,i)}hittest(i,r,n){return(0,s.Tk)((0,s.Xe)(n.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(i,r,n),this._hittestMarker(i,r,n))}_getViewRotationMatrix(i){const r=this.view.displayViewMat3,n=this.view.displayMat3,o=new s.nt(1).subtract(i);return r.multiply(i).add(n.multiply(o))}_getViewScreenMatrix(i){const r=this.view.viewMat3.multiply(this.view.tileMat3),n=this.view.tileMat3,o=new s.nt(1).subtract(i);return r.multiply(i).add(n.multiply(o))}_getColor(i,r){return(0,s.Tk)((0,s.LC)(r.isSDF,new s.nt(1)),this._getSDFColor(i,r),this._getSpriteColor(i,r))}_getSpriteColor(i,r){return(0,s.US)(this.mosaicInfo.texture,i).multiply(r.color)}_getSDFColor(i,r){const n=(0,s.US)(this.mosaicInfo.texture,i),o=new s.nt(.5).subtract((0,z.Rj)(n)).multiply(r.distanceToPx).multiply(ne.V5),l=(0,s.qE)(new s.nt(.5).subtract(o),new s.nt(0),new s.nt(1)),p=r.color.multiply(l);let f=r.outlineSize;this.highlight&&(f=(0,s.T9)(f,r.overrideOutlineColor.multiply(4)));const x=f.multiply(.5),V=(0,s.tn)(o).subtract(x),w=(0,s.qE)(new s.nt(.5).subtract(V),new s.nt(0),new s.nt(1)),M=(0,s.jh)(r.outlineColor,r.color,r.overrideOutlineColor).multiply(w);return new s.nt(1).subtract(M.a).multiply(p).add(M)}_hittestSmallMarker(i,r,n){const{position:o,distance:l,smallSymbolDistance:p}=this.hittestRequest,f=l.subtract(p),{viewMat3:x,tileMat3:V}=this.view,w=x.multiply(V).multiply(new s.eB(n.pos,1)).xy,M=n.size.multiply(.5);return(0,s.Io)(w,o).subtract(M).add(f)}_hittestMarker(i,r,n){const{pos:o,sizeCorrection:l,isMapAligned:p}=n,f=new s.eB(i.offset.multiply(l),0),x=new s.eB(r.offsetNextVertex1.multiply(l),0),V=new s.eB(r.offsetNextVertex2.multiply(l),0),{viewMat3:w,tileMat3:M}=this.view,P=w.multiply(M).multiply(new s.eB(o,1)),C=this._getViewScreenMatrix(p),B=P.add(C.multiply(f)).xy,L=P.add(C.multiply(x)).xy,Z=P.add(C.multiply(V)).xy,ie=this.hittestRequest.distance,de=(0,_.Bo)(this.hittestRequest.position,o,L,Z);return(0,s.Tk)((0,s.MM)(de,ie),de,this._hittestSamples(B,L,Z,i,r,n))}_hittestSamples(i,r,n,o,l,p){const{outlineSize:f,isSDF:x,distanceToPx:V}=p,w=this.hittestRequest.position,M=this.hittestRequest.distance,P=(0,_.Bs)(w.add(new s.ZY((0,s.ze)(M),(0,s.ze)(M))),i,r,n),C=(0,_.Bs)(w.add(new s.ZY(0,(0,s.ze)(M))),i,r,n),B=(0,_.Bs)(w.add(new s.ZY(M,(0,s.ze)(M))),i,r,n),L=(0,_.Bs)(w.add(new s.ZY((0,s.ze)(M),0)),i,r,n),Z=(0,_.Bs)(w,i,r,n),Y=(0,_.Bs)(w.add(new s.ZY(M,0)),i,r,n),ie=(0,_.Bs)(w.add(new s.ZY((0,s.ze)(M),M)),i,r,n),de=(0,_.Bs)(w.add(new s.ZY(0,M)),i,r,n),ve=(0,_.Bs)(w.add(new s.ZY(M,M)),i,r,n),q=o.textureUV.divide(this.mosaicInfo.size),Q=l.textureUVNextVertex1.divide(this.mosaicInfo.size),k=l.textureUVNextVertex2.divide(this.mosaicInfo.size),se={color:new s.Zb(1),outlineColor:new s.Zb(1),overrideOutlineColor:new s.nt(1),outlineSize:f,distanceToPx:V,isSDF:x};let K=new s.nt(0);return K=K.add((0,_.kW)(P).multiply(this._getColor(ye(P,q,Q,k),se).a)),K=K.add((0,_.kW)(C).multiply(this._getColor(ye(C,q,Q,k),se).a)),K=K.add((0,_.kW)(B).multiply(this._getColor(ye(B,q,Q,k),se).a)),K=K.add((0,_.kW)(L).multiply(this._getColor(ye(L,q,Q,k),se).a)),K=K.add((0,_.kW)(Z).multiply(this._getColor(ye(Z,q,Q,k),se).a)),K=K.add((0,_.kW)(Y).multiply(this._getColor(ye(Y,q,Q,k),se).a)),K=K.add((0,_.kW)(ie).multiply(this._getColor(ye(ie,q,Q,k),se).a)),K=K.add((0,_.kW)(de).multiply(this._getColor(ye(de,q,Q,k),se).a)),K=K.add((0,_.kW)(ve).multiply(this._getColor(ye(ve,q,Q,k),se).a)),(0,s.PM)(K,new s.nt(.05)).multiply((0,_.My)(this.hittestRequest))}}(0,u._)([(0,d.uK)(qe._)],ce.prototype,"visualVariableColor",void 0),(0,u._)([(0,d.uK)(Je.i)],ce.prototype,"visualVariableOpacity",void 0),(0,u._)([(0,d.uK)(Fe)],ce.prototype,"visualVariableRotation",void 0),(0,u._)([(0,d.uK)(et.n)],ce.prototype,"visualVariableSizeMinMaxValue",void 0),(0,u._)([(0,d.uK)(tt.F)],ce.prototype,"visualVariableSizeScaleStops",void 0),(0,u._)([(0,d.uK)(it.N)],ce.prototype,"visualVariableSizeStops",void 0),(0,u._)([(0,d.uK)(st.d)],ce.prototype,"visualVariableSizeUnitValue",void 0),(0,u._)([(0,d.Pi)(Oe.b)],ce.prototype,"mosaicInfo",void 0),(0,u._)([(0,u.a)(0,(0,d.hF)(me)),(0,u.a)(1,(0,d.hF)(Me))],ce.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.hF)(class Lt extends U.DM{}))],ce.prototype,"fragment",null);var Ut=m(1119),Zt=m(77989);class Nt{constructor(){this.computeAttributes={}}get locationsMap(){const i=new Map;for(const r in this.locations)i.set(r,this.locations[r].index);return i}get optionPropertyKeys(){if(!this._optionPropertyKeys){const i=new Set(Object.keys(this.options));this._optionPropertyKeys=i}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const i=this.locationsMap,r=Array.from(i.entries()).map(([o,l])=>`${o}.${l}`).join("."),n=(0,Ut.Wm)(r);this._locationInfo={hash:n,locations:i,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const i=new Map;for(const[r,n]of this.locationsMap.entries())i.set("a_"+r,n);return i}getShaderKey(i,r,n){return`${Object.keys(i).map(o=>`${o}.${i[o]}`).join(".")}.${Object.keys(n).filter(o=>n[o]).map(o=>`${o}_${n[o].toString()}`).join(".")}.${Object.keys(r).filter(o=>this.optionPropertyKeys.has(o)).join(".")}`}getProgram(i,r,n,o){let l="",p="";for(const f in n)if(n[f]){const x="boolean"==typeof n[f]?`#define ${f}\n`:`#define ${f} ${n[f]}\n`;l+=x,p+=x}return l+=this.vertexShader,p+=this.fragmentShader,new Zt.K(l,p,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(r),this._transformFeedbackBindings)}_getUniformBindings(i){const r=[];for(const n in this.required){const o=this.required[n];r.push({uniformHydrated:null,shaderModulePath:n,uniformName:n,uniformType:o.type,uniformArrayElementType:rt(o),uniformArrayLength:ot(o)})}for(const n in i){const o=this.options[n];if(i[n])for(const l in o){const p=o[l];r.push({uniformHydrated:null,shaderModulePath:`${n}.${l}`,uniformName:l,uniformType:p.type,uniformArrayElementType:rt(p),uniformArrayLength:ot(p)})}}return r}}const rt=g=>"array"===g.type?g.elementType?.type:void 0,ot=g=>"array"===g.type?g.size:void 0;var nt=m(73539);const Ht={hittestDist:s.nt,hittestPos:s.ZY},jt={filterFlags:s.z7,animation:s.z7,visualVariableData:s.z7,dataDriven0:s.z7,dataDriven1:s.z7,dataDriven2:s.z7,gpgpu:s.z7,size:s.nt},Wt={displayViewScreenMat3:s.U,displayViewMat3:s.U,displayMat3:s.U,viewMat3:s.U,tileMat3:s.U,displayZoomFactor:s.nt,requiredZoomFactor:s.nt,tileOffset:s.ZY,currentScale:s.nt,currentZoom:s.nt,metersPerSRUnit:s.nt};class Yt extends Nt{constructor(){super(...arguments),this.vertexShader=(0,nt.Q)("materials/pie/pie.vert"),this.fragmentShader=(0,nt.Q)("materials/pie/pie.frag"),this.required={...jt,...Wt,outlineWidth:s.nt,colors:s.My,defaultColor:s.Zb,othersColor:s.Zb,outlineColor:s.Zb,donutRatio:s.nt,sectorThreshold:s.nt},this.options={hittestUniforms:Ht,visualVariableSizeMinMaxValue:{minMaxValueAndSize:s.Zb},visualVariableSizeScaleStops:{sizes:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8},values:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8}},visualVariableSizeStops:{sizes:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8},values:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:s.nt},visualVariableOpacity:{opacities:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8},opacityValues:{...s.My.ofType(s.nt,8),type:"array",elementType:s.nt,size:8}}},this.locations={pos:{index:0,type:s.ZY},id:{index:1,type:s.eB},bitset:{index:2,type:s.nt},offset:{index:3,type:s.ZY},texCoords:{index:4,type:s.ZY},size:{index:5,type:s.ZY},referenceSize:{index:6,type:s.nt},zoomRange:{index:7,type:s.ZY}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(i){this.required.colors={...s.My.ofType(s.Zb,i),type:"array",elementType:s.Zb,size:i}}}const Pe={fill:new class ft extends R{constructor(){super(...arguments),this.type=I.N.Fill,this.shaders={geometry:new He.z}}render(i,r){const{painter:n}=i,o=r.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,o.uniforms),...(0,h.QA)(i,r.target)},defines:(0,h.vT)(i),optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)}),n.setPipelineState((0,h.Qu)(i)),n.submitDraw(i,r)}},patternFill:new class bt extends R{constructor(){super(...arguments),this.type=I.N.PatternFill,this.shaders={geometry:new vt.vx}}render(i,r){const{context:n,painter:o}=i,l=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,l.uniforms),...(0,h.QA)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey),localTileOffset:(0,h.Pr)(r.target)},defines:{...(0,h.vT)(i)},optionalAttributes:l.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)}),o.setPipelineState((0,h.Qu)(i)),o.submitDraw(i,r)}},complexFill:new class dt extends R{constructor(){super(...arguments),this.type=I.N.ComplexFill,this.shaders={geometry:new ct.Ps}}render(i,r){const{context:n,painter:o}=i,l=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,l.uniforms),...(0,h.QA)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey),localTileOffset:(0,h.Pr)(r.target)},defines:{...(0,h.vT)(i)},optionalAttributes:l.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)}),o.setPipelineState((0,h.Qu)(i)),o.submitDraw(i,r)}},outlineFill:new class yt extends R{constructor(){super(...arguments),this.type=I.N.OutlineFill,this.shaders={geometry:new mt.nj}}render(i,r){const{painter:n,pixelRatio:o}=i,l=r.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,l.uniforms),...(0,h.QA)(i,r.target),antialiasingControls:Se(o)},defines:{...(0,h.vT)(i)},optionalAttributes:l.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)}),n.setPipelineState((0,h.Qu)(i)),n.submitDraw(i,r)}},patternOutlineFill:new class xt extends R{constructor(){super(...arguments),this.type=I.N.PatternOutlineFill,this.shaders={geometry:new gt.tA}}render(i,r){const{context:n,painter:o,pixelRatio:l}=i,p=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,p.uniforms),...(0,h.QA)(i,r.target),antialiasingControls:Se(l),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey),localTileOffset:(0,h.Pr)(r.target)},defines:{...(0,h.vT)(i)},optionalAttributes:p.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)}),o.setPipelineState((0,h.Qu)(i)),o.submitDraw(i,r)}},complexOutlineFill:new class ht extends R{constructor(){super(...arguments),this.type=I.N.ComplexOutlineFill,this.shaders={geometry:new pt.RH}}render(i,r){const{context:n,painter:o,pixelRatio:l}=i,p=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,p.uniforms),...(0,h.QA)(i,r.target),antialiasingControls:Se(l),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey),localTileOffset:(0,h.Pr)(r.target)},defines:{...(0,h.vT)(i)},optionalAttributes:p.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)}),o.setPipelineState((0,h.Qu)(i)),o.submitDraw(i,r)}},marker:new class Bt extends R{constructor(){super(...arguments),this.type=I.N.Marker,this.shaders={geometry:new ce},this.symbologyPlane=E.uC.MARKER}render(i,r){const{context:n,painter:o}=i,l=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,l.uniforms),...(0,h.QA)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey,!0)},defines:{...(0,h.vT)(i)},optionalAttributes:l.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)}),o.setPipelineState((0,h.Qu)(i)),o.submitDraw(i,r)}},pieChart:new class Kt extends R{constructor(){super(...arguments),this.type=I.N.PieChart,this.shaders={geometry:new Yt},this.symbologyPlane=E.uC.MARKER}render(i,r){const{painter:n}=i,{instance:o,target:l}=r,p=this.shaders.geometry,f=o.getInput(),x=f.uniforms.numberOfFields,V=(0,h.Eq)(i),w=(0,h.QA)(i,l),M=(0,h.vT)(i);p.setNumberOfFields(x),n.setShader({shader:p,uniforms:{...(0,h.r3)(i,r.target,f.uniforms.shader),...w.storage,...w.view,hittestUniforms:w.hittestRequest?{hittestDist:w.hittestRequest?.distance,hittestPos:w.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!f.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!f.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!f.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!f.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!f.uniforms.shader.visualVariableOpacity,HITTEST:V,highlight:w.highlight?1:0,...M,numberOfFields:x},optionalAttributes:{},useComputeBuffer:V}),n.setPipelineState((0,h.Qu)(i)),n.submitDraw(i,r)}},line:new class Ft extends R{constructor(){super(...arguments),this.type=I.N.Line,this.shaders={geometry:new we.cM},this.symbologyPlane=E.uC.LINE}render(i,r){const{painter:n,pixelRatio:o}=i,l=r.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,l.uniforms),...(0,h.QA)(i,r.target),antialiasingControls:Se(o)},defines:{...(0,h.vT)(i)},optionalAttributes:l.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)}),n.setPipelineState((0,h.Qu)(i)),n.submitDraw(i,r)}},texturedLine:new class It extends R{constructor(){super(...arguments),this.type=I.N.TexturedLine,this.shaders={geometry:new Ie},this.symbologyPlane=E.uC.LINE}render(i,r){const{context:n,painter:o,pixelRatio:l}=i,p=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,p.uniforms),...(0,h.QA)(i,r.target),antialiasingControls:Se(l),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey)},defines:{...(0,h.vT)(i)},optionalAttributes:p.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)}),o.setPipelineState((0,h.Qu)(i)),o.submitDraw(i,r)}},text:new class Qt extends R{constructor(){super(...arguments),this.type=I.N.Text,this.shaders={geometry:new te},this.symbologyPlane=E.uC.TEXT}render(i,r){const{context:n,painter:o}=i,l=(0,h.vT)(i),p=r.instance.getInput(),f={shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,p.uniforms),...(0,h.QA)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey)},defines:{...l,isHaloPass:!1,isBackgroundPass:!0,isLabel:!1},optionalAttributes:p.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)};o.setShader(f),o.setPipelineState((0,h.Qu)(i)),o.submitDraw(i,r),o.setShader({...f,defines:{...l,isHaloPass:!0,isBackgroundPass:!1,isLabel:!1}}),o.submitDraw(i,r),o.setShader({...f,defines:{...l,isHaloPass:!1,isBackgroundPass:!1,isLabel:!1}}),o.submitDraw(i,r)}},label:new class Ot extends R{constructor(){super(...arguments),this.type=I.N.Label,this.shaders={geometry:new te},this.drawPhase=E.S5.LABEL|E.S5.LABEL_ALPHA|E.S5.HITTEST,this.symbologyPlane=E.uC.TEXT}render(i,r){const{context:n,painter:o}=i,l=(0,h.vT)(i),p={...(0,h.Qu)(i)},f=r.instance.getInput(),x={shader:this.shaders.geometry,uniforms:{...(0,h.r3)(i,r.target,f.uniforms),...(0,h.QA)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(n,r.textureKey)},defines:{...l,isHaloPass:!1,isBackgroundPass:!0,isLabel:!0},optionalAttributes:f.optionalAttributes,useComputeBuffer:(0,h.Eq)(i)};o.setShader(x),o.setPipelineState(p),o.submitDraw(i,r),o.setShader({...x,defines:{...l,isHaloPass:!0,isBackgroundPass:!1,isLabel:!0}}),o.setPipelineState(p),o.submitDraw(i,r),o.setShader({...x,defines:{...l,isHaloPass:!1,isBackgroundPass:!1,isLabel:!0}}),o.setPipelineState(p),o.submitDraw(i,r)}},heatmap:new class zt extends R{constructor(){super(...arguments),this.type=I.N.Heatmap,this.shaders={accumulate:new _e,resolve:new xe},this.postProcessingEnabled=!0,this._isBound=!1,this._resources=new Map,this.overrideStencilRef=ke}shutdown(i){super.shutdown(i),this._resources.get(i)?.destroy(),this._resources.delete(i),this._prevFBO=null,this._unbind()}render(i,r){const{context:n,painter:o,state:l}=i,p=r.instance.getInput(),{isFieldActive:f}=p.uniforms,x=this._getOrCreateResourcesRecord(n),V=x.loadQualityProfile(n);if((0,h.dJ)(i))return;(0,h.Eq)(i)||this._bind(i,x,p),o.setShader({shader:this.shaders.accumulate,uniforms:{...(0,h.QA)(i,r.target),kernelControls:{radius:Xe(p,l),isFieldActive:f?1:0}},defines:{...(0,h.vT)(i),...V.defines},optionalAttributes:{},useComputeBuffer:(0,h.Eq)(i)});const w=(0,h.Eq)(i)?Ct:$e;o.setPipelineState(w),o.submitDraw(i,r)}postProcess(i,r){if((0,h.Eq)(i)||(0,h.dJ)(i))return;const{context:n,painter:o}=i,l=this._resources.get(n);if(null==this._prevFBO||null==this._prevViewport||!l?.initialized)return;const{defines:p}=l.loadQualityProfile(n),{minDensity:f,maxDensity:x,radius:V}=r.getInput().uniforms,P=l.accumulateFramebuffer,C=l.resolveGradientTexture;o.setShader({shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:P.colorTexture},minAndInvRange:[f,1/(x-f)],normalization:3/(V*V*Math.PI)},gradient:{texture:{unit:9,texture:C}}},defines:p,optionalAttributes:{},useComputeBuffer:!1}),n.bindFramebuffer(this._prevFBO),n.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),n.bindTexture(P.colorTexture,8),n.bindTexture(C,9),o.setPipelineState(At),o.submitDrawQuad(n),this._unbind()}_getOrCreateResourcesRecord(i){let r=this._resources.get(i);return null==r&&(r=new Vt,this._resources.set(i,r)),r}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(i,r,n){if(this._isBound)return;const{context:o,state:l,pixelRatio:p}=i,f=o.getBoundFramebufferObject(),x=o.getViewport();this._prevFBO=f,this._prevViewport=x;const{gradient:V,gradientHash:w}=n.uniforms;r.ensureResolveGradientTexture(o,w,V);const{width:M,height:P}=x,C=function Tt(g,i){const r=i>1.5?.25:.5;return g<1/(2*r)?1:r}(Xe(n,l),p),Z=r.ensureAccumulateFBO(o,M*C,P*C);o.blitFramebuffer(f,Z,0,0,f.width,f.height,0,0,Z.width,Z.height,c.hn.STENCIL_BUFFER_BIT,c.Cj.NEAREST),o.bindFramebuffer(Z),o.setViewport(0,0,Z.width,Z.height),o.setColorMask(!0,!0,!0,!0),o.setClearColor(0,0,0,0),o.clear(c.hn.COLOR_BUFFER_BIT),this._isBound=!0}},dotDensity:new class ut extends R{constructor(){super(...arguments),this.type=I.N.DotDensity,this.shaders={polygon:new a,point:new y,fill:new He.z},this._resources=new Map}render(i,r){(0,h.dJ)(i)||(0,h.Eq)(i)?this._renderPolygons(i,r):this._renderDotDensity(i,r)}_renderPolygons(i,r){const{painter:n}=i;n.setShader({shader:this.shaders.fill,uniforms:{...(0,h.QA)(i,r.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,h.vT)(i)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,h.Eq)(i)}),n.setPipelineState((0,h.Qu)(i)),n.submitDraw(i,r)}_renderDotDensity(i,r){const{context:n,painter:o,requiredLevel:l}=i,p=r.instance.getInput().uniforms,f=this._getOrCreateResourcesRecord(n),x=f.getDotDensityTextures(n,F.CQ,p.seed),V=1/2**(l-r.target.key.level),w=F.CQ,M=w*window.devicePixelRatio*w*window.devicePixelRatio,B=p.dotValue*(p.dotScale?i.state.scale/p.dotScale:1)*(1/V*(1/V));o.setShader({shader:this.shaders.polygon,uniforms:{...(0,h.QA)(i,r.target),instance:{isActive:p.isActive,colors:p.colors,dotValue:Math.max(1,B)},draw:{dotTexture0:{unit:F.Cp,texture:x[0]},dotTexture1:{unit:F.vN,texture:x[1]},tileZoomFactor:V,pixelRatio:window.devicePixelRatio,tileDotsOverArea:M/(F.CQ*window.devicePixelRatio*F.CQ*window.devicePixelRatio)}},defines:{...(0,h.vT)(i),blending:p.blending},optionalAttributes:{},useComputeBuffer:!1}),o.setPipelineState((0,h.Qu)(i));const L=n.getViewport();n.setViewport(0,0,F.CQ,F.CQ);const Z=n.getBoundFramebufferObject(),Y=f.getFBO(n);n.bindFramebuffer(Y),n.setClearColor(0,0,0,0),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.updatePipelineState(n),n.clear(c.hn.COLOR_BUFFER_BIT),o.submitDraw(i,r),n.bindFramebuffer(Z),n.setViewport(L.x,L.y,L.width,L.height);const ie=f.getFBO(n).colorTexture;o.setShader({shader:this.shaders.point,uniforms:{view:(0,h.L4)(i,r.target),instance:{dotSize:p.dotSize},draw:{locations:{unit:F.Cp,texture:ie},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,h.vT)(i)},optionalAttributes:{},useComputeBuffer:!1}),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.submitDrawMesh(n,f.getDotDensityMesh(n))}shutdown(i){super.shutdown(i),this._resources.get(i)?.destroy(),this._resources.delete(i)}_getOrCreateResourcesRecord(i){let r=this._resources.get(i);return null==r&&(r=new lt,this._resources.set(i,r)),r}}};function Gt(){for(const g in Pe)Pe[g].startup()}function kt(g){for(const i in Pe)Pe[i].shutdown(g)}},84836:(be,J,m)=>{m.d(J,{Jz:()=>$,T9:()=>h});var F=m(89952),E=m(69473),N=m(79213),R=m(54551);function h(y,_){return{type:"simple",filters:_,capabilities:{maxTextureSize:(0,R.C)().maxTextureSize},bindings:u(y)}}function I(y){switch(y){case"opacity":return E.Gn.OPACITY;case"color":return E.Gn.COLOR;case"rotation":return E.Gn.ROTATION;case"size":return E.Gn.SIZE;default:return null}}function u(y){if(!y)return[];switch(y.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return $(y);case"dot-density":return function d(y){const _=[];for(const z of y.attributes)_.push({binding:_.length,expression:z.valueExpression,field:z.field});return _}(y);case"pie-chart":return function s(y){const _=$(y);let z=4;for(const H of y.attributes)_.push({binding:z++,expression:H.valueExpression,field:H.field});return _}(y);case"heatmap":return function U({valueExpression:y,field:_}){return y||_?[{binding:0,expression:y,field:_}]:[]}(y)}}function $(y){return"visualVariables"in y&&y.visualVariables?.length?(0,N.R)(y.visualVariables).map(_=>function he(y){switch(y.type){case"size":return function ae(y){return"$view.scale"===y.valueExpression?null:{binding:I(y.type),field:y.field,normalizationField:y.normalizationField,expression:y.valueExpression,valueRepresentation:y.valueRepresentation}}(y);case"color":return function pe(y){return{binding:I(y.type),field:y.field,normalizationField:y.normalizationField,expression:y.valueExpression}}(y);case"opacity":return function le(y){return{binding:I(y.type),field:y.field,normalizationField:y.normalizationField,expression:y.valueExpression}}(y);case"rotation":return function re(y){return{binding:I(y.type),expression:y.valueExpression,field:y.field}}(y)}}(_)).filter(F.Ru):[]}},13220:(be,J,m)=>{m.d(J,{Dk:()=>H,K4:()=>ee,j0:()=>fe}),m(3248);var E=m(67685),N=m(82663),R=m(48716),h=m(47669),I=m(90731),u=m(29822),d=m(79213);const s=1.25,U=128,$=128;function ae(a){if(!a.stops?.length)return null;const b=a.stops.sort((O,G)=>O.value-G.value),c=(0,u.r)(b,8);return{values:c.map(({value:O})=>O),colors:c.map(({color:O})=>(0,u.p)(O))}}function pe(a){if(!a.stops?.length)return null;const b=a.stops.sort((v,T)=>v.value-T.value),c=(0,u.r)(b,8);return{opacityValues:c.map(({value:v})=>v),opacities:c.map(({opacity:v})=>v)}}function le(a){return{rotationType:"geographic"===a.rotationType?I.H_.Geographic:I.H_.Arithmatic}}function re(a){if(!a.stops?.length)return null;if(a.stops.some(v=>v.useMaxValue||v.useMinValue))return(v,T)=>{const O=v.statisticsByLevel.get(T.key.level),G=a.stops.map(j=>({value:j.useMaxValue?O?.get(a.field)?.maxValue??0:j.useMinValue?O?.get(a.field)?.minValue??0:j.value,size:j.size?(0,E.Lz)(j.size):h.qM})).sort((j,X)=>j.value-X.value),W=(0,u.r)(G,8);return{values:W.map(({value:j})=>j),sizes:W.map(({size:j})=>j)}};const b=a.stops.sort((v,T)=>v.value-T.value),c=(0,u.r)(b,8);return{values:c.map(({value:v})=>v),sizes:c.map(({size:v})=>(0,E.Lz)(v))}}function y(a){return b=>{const{state:c}=b;return{unitValueToPixelsRatio:(0,N.GA)(c.spatialReference)/R.j[a.valueUnit]/c.resolution}}}function _(a,b){const c=b.length;if(a<b[0].value||1===c)return b[0].size;for(let v=1;v<c;v++)if(a<b[v].value)return b[v-1].size+(a-b[v-1].value)/(b[v].value-b[v-1].value)*(b[v].size-b[v-1].size);return b[c-1].size}function z(a){const{minDataValue:b,maxDataValue:c,minSize:v,maxSize:T}=a;if("object"==typeof v&&"object"==typeof T)return(O,G)=>{const W=O.state.scale,j=(0,E.Lz)(_(W,v.stops)),X=(0,E.Lz)(_(W,T.stops));return{minMaxValueAndSize:[b,c,j,X]}};if("object"==typeof v||"object"==typeof T)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[b,c,(0,E.Lz)(v),(0,E.Lz)(T)]}}const H={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function fe(a,b=$,c=s){if(a.visualVariableSizeMinMaxValue)return a.visualVariableSizeMinMaxValue instanceof Function?U:Math.max(a.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*c,b);if(a.visualVariableSizeScaleStops){if(a.visualVariableSizeScaleStops instanceof Function)return U;const v=a.visualVariableSizeScaleStops.sizes;return Math.max(v[v.length-1]*c,b)}if(a.visualVariableSizeStops){if(a.visualVariableSizeStops instanceof Function)return U;const v=a.visualVariableSizeStops.sizes;return Math.max(v[v.length-1]*c,b)}return a.visualVariableSizeUnitValue?2*U:0}function ee(a){const b={...H};if(!a||!("visualVariables"in a)||!a.visualVariables)return b;for(const c of(0,d.R)(a.visualVariables))switch(c.type){case"color":b.visualVariableColor=ae(c);break;case"opacity":b.visualVariableOpacity=pe(c);break;case"rotation":b.visualVariableRotation=le(c);break;case"size":switch(S(c)){case"field-stops":b.visualVariableSizeStops=re(c);break;case"scale-stops":"outline"===c.target?b.visualVariableSizeOutlineScaleStops=re(c):b.visualVariableSizeScaleStops=re(c);break;case"min-max":b.visualVariableSizeMinMaxValue=z(c);break;case"unit-value":b.visualVariableSizeUnitValue=y(c)}}return b}function S(a){if("number"==typeof a.minDataValue&&"number"==typeof a.maxDataValue&&null!=a.minSize&&null!=a.maxSize)return"min-max";if("$view.scale"===a?.valueExpression&&Array.isArray(a.stops))return"scale-stops";if((null!=a.field||"$view.scale"!==a?.valueExpression)&&(Array.isArray(a.stops)||"levels"in a&&a.levels))return"field-stops";if((null!=a.field||"$view.scale"!==a?.valueExpression)&&null!=a.valueUnit)return"unit-value";throw new Error("InternalError: Found unknown sizeVV type")}},29822:(be,J,m)=>{function F(N,R){const h=N.slice(0,R),I=R-h.length;for(let u=0;u<I;u++)h.push(h[h.length-1]);return h}function E(N){if(!N)return[0,0,0,0];const{r:R,g:h,b:I,a:u}=N;return[R*(u/255),h*(u/255),I*(u/255),u]}m.d(J,{p:()=>E,r:()=>F})},34155:(be,J,m)=>{m.d(J,{EM:()=>H,Gn:()=>le,IQ:()=>ee,Jk:()=>s,NZ:()=>z,TY:()=>u,Zi:()=>ae,oF:()=>he});var F=m(10467),E=m(26747),N=m(46988),R=m(22818),h=m(13220),I=m(99845);function u(S){return S.minScale||S.maxScale?{minScale:S.minScale??0,maxScale:S.maxScale??0}:null}function d(S){if(null==S)return null;if(Array.isArray(S)){const[a,b,c,v]=S;return[a,b,c,255*v]}return"string"==typeof S?S:{...S,defaultValue:d(S?.defaultValue)}}function s(S,a){return U.apply(this,arguments)}function U(){return(U=(0,F.A)(function*(S,a){const{cimResourceManager:b,cimAnalyzer:c,scaleExpression:v}=a.schemaOptions;yield Promise.all(E.wp.fetchResources(S.symbol,b,[]));const T=c.analyzeSymbolReference(S,!1),O={scaleInfo:u(S),scaleExpression:v},G=[];for(const W of T)switch(W.type){case"marker":G.push(...$(W,a,O));break;case"fill":G.push(...re(W,a,O));break;case"line":G.push(...y(W,a,O));break;case"text":G.push(...fe(W,a,O))}return G})).apply(this,arguments)}function $(S,a,b){const{uniforms:c,schemaOptions:v}=a,{store:T}=v,O=S.isOutline?{...h.Dk,visualVariableSizeScaleStops:c.visualVariableSizeOutlineScaleStops}:{visualVariableColor:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity,visualVariableSizeMinMaxValue:c.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:c.visualVariableSizeScaleStops,visualVariableSizeStops:c.visualVariableSizeStops,visualVariableSizeUnitValue:c.visualVariableSizeUnitValue,visualVariableRotation:c.visualVariableRotation};return ae(T.ensureInstance(R.YS.marker,{uniforms:O,optionalAttributes:{zoomRange:!!b.scaleInfo}}),S,c,b)}function ae(S,a,b,{scaleInfo:c,scaleExpression:v}){const T=(0,I.I)(b);return[S.createMeshInfo({size:a.size,scaleX:a.scaleX,anchorX:a.anchorPoint.x,anchorY:a.anchorPoint.y,angle:a.rotation,color:d(a.color)??[0,0,0,0],colorLocked:a.colorLocked,frameHeight:a.frameHeight,widthRatio:a.widthRatio,scaleInfo:c,offsetX:a.offsetX,offsetY:a.offsetY,outlineColor:d(a.outlineColor)??[0,0,0,0],outlineSize:a.outlineWidth,referenceSize:a.referenceSize||N.D.CIMVectorMarker.size,rotateClockwise:a.rotateClockwise,scaleFactor:v??1,sizeRatio:a.sizeRatio,alignment:a.alignment,isAbsoluteAnchorPoint:a.isAbsoluteAnchorPoint,scaleSymbolsProportionally:a.scaleSymbolsProportionally,sprite:a.spriteRasterizationParam,hasSizeVV:T,placement:a.markerPlacement,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null,transforms:a.transform,minPixelBuffer:(0,h.j0)(b)})]}function le(S,a,{scaleInfo:b}){return[S.createMeshInfo({color:d(a.color)??[0,0,0,0],scaleInfo:b,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null})]}function re(S,a,b){if(!S.spriteRasterizationParam)return function pe(S,a,b){const{uniforms:c,schemaOptions:v}=a,{store:T}=v;return le(T.ensureInstance(R.YS.fill,{uniforms:{visualVariableColor:S.colorLocked?null:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity},optionalAttributes:{zoomRange:!!b.scaleInfo}}),S,b)}(S,a,b);const{uniforms:c,schemaOptions:v}=a,{store:T}=v;return he(T.ensureInstance(R.YS.complexFill,{uniforms:{visualVariableColor:S.colorLocked?null:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity},optionalAttributes:{zoomRange:!!b.scaleInfo}}),S,null!=c.visualVariableColor,b)}function he(S,a,b,{scaleInfo:c}){if(!a.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const T=a.sampleAlphaOnly&&!(a.hasUnresolvedReplacementColor&&(!b||a.colorLocked)),O=a.spriteRasterizationParam;return[S.createMeshInfo({color:d(a.color)??[0,0,0,0],height:a.height,aspectRatio:a.scaleX,offsetX:a.offsetX,offsetY:a.offsetY,scaleX:1,scaleY:1,angle:a.angle,applyRandomOffset:a.applyRandomOffset,sampleAlphaOnly:T,scaleProportionally:"CIMHatchFill"===O.resource.type,sprite:O,scaleInfo:c,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null})]}function y(S,a,b){const{uniforms:c,schemaOptions:v}=a,{store:T}=v,O=S.isOutline?{...h.Dk,visualVariableSizeScaleStops:c.visualVariableSizeOutlineScaleStops}:{visualVariableColor:S.colorLocked?null:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity,visualVariableSizeMinMaxValue:c.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:c.visualVariableSizeScaleStops,visualVariableSizeStops:c.visualVariableSizeStops,visualVariableSizeUnitValue:c.visualVariableSizeUnitValue},G={uniforms:O,optionalAttributes:{zoomRange:!!b.scaleInfo}},W=!!(O.visualVariableSizeMinMaxValue||O.visualVariableSizeScaleStops||O.visualVariableSizeStops||O.visualVariableSizeUnitValue);return S.spriteRasterizationParam?H(T.ensureInstance(R.YS.texturedLine,G),S,W,b):z(T.ensureInstance(R.YS.line,G),S,W,b)}function _(S,a,{scaleInfo:b}){return{color:d(S.color)??[0,0,0,0],width:S.width,referenceWidth:S.referenceWidth,capType:S.cap,joinType:S.join,miterLimit:S.miterLimit,scaleInfo:b,hasSizeVV:a,effects:S.effects?{type:"cim-effect-infos",effectInfos:S.effects}:null}}function z(S,a,b,c){if(a.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const v=_(a,b,c);return[S.createMeshInfo(v)]}function H(S,a,b,c){const{spriteRasterizationParam:v,scaleDash:T,sampleAlphaOnly:O}=a;if(!v)throw new Error("InternalError: Sprite should be defined");return[S.createMeshInfo({..._(a,b,c),shouldScaleDash:T??!1,shouldSampleAlphaOnly:O,isSDF:"CIMPictureStroke"!==v.resource.type,sprite:v})]}function fe(S,a,b){const{uniforms:c,schemaOptions:v}=a,{store:T}=v;return ee(T.ensureInstance(R.YS.text,{uniforms:{visualVariableColor:S.colorLocked?null:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity,visualVariableRotation:c.visualVariableRotation,visualVariableSizeMinMaxValue:c.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:c.visualVariableSizeScaleStops,visualVariableSizeStops:c.visualVariableSizeStops,visualVariableSizeUnitValue:c.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!b.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),S,c,b)}function ee(S,a,b,{scaleInfo:c,scaleExpression:v}){return[S.createMeshInfo({boxBackgroundColor:d(a.backgroundColor),boxBorderLineColor:d(a.borderLineColor),boxBorderLineSize:a.borderLineWidth??0,color:d(a.color)??[0,0,0,0],offsetX:a.offsetX,offsetY:a.offsetY,postAngle:a.angle,fontSize:a.size,referenceSize:a.referenceSize,decoration:a.decoration,haloColor:d(a.outlineColor)??[0,0,0,0],haloFontSize:a.outlineSize,lineWidth:a.lineWidth||512,lineHeightRatio:1,horizontalAlignment:a.horizontalAlignment??"center",verticalAlignment:a.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:a.textRasterizationParam,scaleInfo:c,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null,placement:a.markerPlacement,transforms:a.transform,scaleFactor:v??1,minPixelBuffer:(0,h.j0)(b),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1})]}},99845:(be,J,m)=>{function F(N){return!!(N.visualVariableSizeMinMaxValue||N.visualVariableSizeScaleStops||N.visualVariableSizeStops||N.visualVariableSizeUnitValue||N.visualVariableSizeOutlineScaleStops)}function E(N){return!!N.visualVariableRotation}m.d(J,{I:()=>F,N:()=>E})},79213:(be,J,m)=>{m.d(J,{R:()=>d,e:()=>he});var F=m(5922),E=m(35150),N=m(67685),R=m(54551);const h=8,I=h-2,u=()=>E.A.getLogger("esri.views.2d.layers.features.support.rendererUtils");function d(y){return y.map(_=>function s(y){return("size"===y.type||"color"===y.type||"opacity"===y.type)&&null!=y.stops}(_)?function U(y){return y.stops=function le(y,_){return _.length<=h?_:(u().warn(`Found ${_.length} Visual Variable stops, but MapView only supports ${h}. Displayed stops will be simplified.`),_.length>2*h?function ae(y,_){const[z,...H]=_,fe=H.pop(),ee=H[0].value,S=H[H.length-1].value,a=(S-ee)/I,b=[];for(let c=ee;c<S;c+=a){let v=0;for(;c>=H[v].value;)v++;const T=H[v],O=_[v-1],W=T.value===O.value?1:(c-O.value)/(T.value-O.value);if("color"===y){const j=H[v],X=_[v-1],oe=j.color.clone();oe.r=$(X.color.r,oe.r,W),oe.g=$(X.color.g,oe.g,W),oe.b=$(X.color.b,oe.b,W),oe.a=$(X.color.a,oe.a,W),b.push({value:c,color:oe,label:j.label})}else if("size"===y){const j=H[v],X=_[v-1],oe=(0,N.cr)(j.size),Ae=$((0,N.cr)(X.size),oe,W);b.push({value:c,size:Ae,label:j.label})}else{const j=H[v],X=$(_[v-1].opacity,j.opacity,W);b.push({value:c,opacity:X,label:j.label})}}return[z,...b,fe]}(y,_):function pe(y){const[_,...z]=y,H=z.pop();for(;z.length>I;){let fe=0,ee=0;for(let S=1;S<z.length;S++){const c=Math.abs(z[S].value-z[S-1].value);c>ee&&(ee=c,fe=S)}z.splice(fe,1)}return[_,...z,H]}(_))}(y.type,y.stops??[]),y}(_.clone()):_)}function $(y,_,z){return(1-z)*y+z*_}function he(y){if(!y)return!0;switch(y.type){case"dot-density":break;case"heatmap":if(!function re(){const{supportsColorBufferFloat:y,supportsColorBufferFloatBlend:_,supportsColorBufferHalfFloat:z}=(0,R.C)();return y&&_||z}()){const _=(0,R.C)(),z=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(H=>!_[H]).join(", ");return u().errorOnce(new F.A("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${z}`)),!1}}return!0}},31411:(be,J,m)=>{m.d(J,{A:()=>h});var F=m(10467),E=m(56492),N=m(35547),R=m(56330);class h{constructor(u){this.updateTracking=new N.F({debugName:"FeatureCommandQueue"}),this._queueProcessor=new R.e({concurrency:1,process:u.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}push(u){var d=this;return(0,F.A)(function*(){return(0,E.QZ)(d.updateTracking.addPromise(d._doPush(u)))})()}_doPush(u){var d=this;return(0,F.A)(function*(){const s=d._queueProcessor,U=s.last();switch(u.type){case"update":case"highlight":return U?.type===u.type?void 0:s.push(u);case"edit-by-id":case"edit-by-feature":return s.push(u)}})()}}}}]);