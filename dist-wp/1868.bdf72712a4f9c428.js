"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[1868],{76582:(A,y,t)=>{t.d(y,{LG:()=>M,mb:()=>D,yr:()=>v});var g=t(10467),u=t(56492),_=t(31610),E=t(12273),h=t(88532),T=t(63888),P=t(28399),c=t(50915),n=t(26136),d=t(4931);function M(o){return o&&"render"in o}function v(o){const i=document.createElement("canvas");return i.width=o.width,i.height=o.height,o.render(i.getContext("2d")),i}class D extends T.q{constructor(i=null,a=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=a,this.source=i,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(i){this._height=i}get source(){return this._source}set source(i){null==i&&null==this._source||(this._source=i,this.invalidateTexture(),this.requestRender())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(i){this._width=i}beforeRender(i){super.beforeRender(i),this.updateTexture(i)}setSourceAsync(i,a){var s=this;return(0,g.A)(function*(){null!=s._uploadStatus&&s._uploadStatus.controller.abort();const x=new AbortController,p=(0,u.Tw)();return(0,u.NY)(a,()=>x.abort()),(0,u.NY)(x,f=>p.reject(f)),s._uploadStatus={controller:x,resolver:p},s.source=i,p.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(i,a){i>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(i,a)}setTransform(i){const a=(0,_.D_)(this.transforms.displayViewScreenMat3),[s,x]=i.toScreenNoRotation([0,0],[this.x,this.y]),p=this.resolution/this.pixelRatio/i.resolution,f=p*this.width,m=p*this.height,e=Math.PI*this.rotation/180;(0,_.Tl)(a,a,(0,h.fA)(s,x)),(0,_.Tl)(a,a,(0,h.fA)(f/2,m/2)),(0,_.e$)(a,a,-e),(0,_.Tl)(a,a,(0,h.fA)(-f/2,-m/2)),(0,_.Oe)(a,a,(0,h.fA)(f,m)),(0,_.lw)(this.transforms.displayViewScreenMat3,i.displayViewMat3,a)}setSamplingProfile(i){this._texture&&(i.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(i.samplingMode))}bind(i,a){this._texture&&i.bindTexture(this._texture,a)}updateTexture({context:i,painter:a}){var s=this;return(0,g.A)(function*(){if(!s._textureInvalidated)return;if(s._textureInvalidated=!1,s._texture||(s._texture=s._createTexture(i)),!s.source)return void s._texture.setData(null);s._texture.resize(s._sourceWidth,s._sourceHeight);const x=function R(o){return M(o)?o instanceof P.A?o.getRenderedRasterPixels()?.renderedRasterPixels:v(o):o}(s.source);try{if(null!=s._uploadStatus){const{controller:p,resolver:f}=s._uploadStatus,m={signal:p.signal},{width:e,height:r}=s,l=s._texture;yield a.textureUploadManager.enqueueTextureUpdate({data:x,texture:l,width:e,height:r},m),f.resolve(),s._uploadStatus=null}else s._texture.setData(x);s.ready()}catch(p){(0,u.jH)(p)}})()}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:(0,E.vt)()}}_createTexture(i){const a=this.immutable,s=new d.R;return s.internalFormat=a?c.H0.RGBA8:c.Ab.RGBA,s.wrapMode=c.pF.CLAMP_TO_EDGE,s.isImmutable=a,s.width=this._sourceWidth,s.height=this._sourceHeight,new n.g(i,s)}}},28399:(A,y,t)=>{t.d(y,{A:()=>g});class g{constructor(_,E,h){this.pixelBlock=_,this.extent=E,this.originalPixelBlock=h}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(_){const E=this.pixelBlock;if(null==E)return;const h=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??E});if(null==h.pixelBlock)return;h.pixelBlock.maskIsAlpha&&(h.pixelBlock.premultiplyAlpha=!0);const T=h.pixelBlock.getAsRGBA(),P=_.createImageData(h.pixelBlock.width,h.pixelBlock.height);P.data.set(T),_.putImageData(P,0,0)}getRenderedRasterPixels(){const _=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==_.pixelBlock?null:(_.pixelBlock.maskIsAlpha&&(_.pixelBlock.premultiplyAlpha=!0),{width:_.pixelBlock.width,height:_.pixelBlock.height,renderedRasterPixels:new Uint8Array(_.pixelBlock.getAsRGBA().buffer)})}}},37188:(A,y,t)=>{t.d(y,{A:()=>P});var g=t(3248),u=t(69473),_=t(54382),E=t(89298),h=t(99065);const T=(c,n)=>c.key.level-n.key.level!=0?c.key.level-n.key.level:c.key.row-n.key.row!=0?c.key.row-n.key.row:c.key.col-n.key.col;class P extends _.A{constructor(n){super(),this._tileInfoView=n}renderChildren(n){this.sortChildren(T),this.setStencilReference(n),super.renderChildren(n)}createRenderParams(n){const{state:d}=n,M=super.createRenderParams(n);return M.requiredLevel=this._tileInfoView.getClosestInfoForScale(d.scale).level,M.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(d.scale),M}prepareRenderPasses(n){const d=super.prepareRenderPasses(n);return d.push(n.registerRenderPass({name:"stencil",brushes:[E.A],drawPhase:u.S5.DEBUG|u.S5.MAP|u.S5.HIGHLIGHT|u.S5.LABEL,target:()=>this.getStencilTarget()})),(0,g.A)("esri-tiles-debug")&&d.push(n.registerRenderPass({name:"tileInfo",brushes:[h.A],drawPhase:u.S5.DEBUG,target:()=>this.children})),d}getStencilTarget(){return this.children}setStencilReference(n){let d=1;for(const M of this.children)M.stencilRef=d++}}},57216:(A,y,t)=>{t.r(y),t.d(y,{default:()=>m});var g=t(10467),u=t(8189),_=t(35150),E=t(56492),h=t(85211),c=(t(3248),t(40707),t(76576)),n=t(58701),d=t(96604),M=t(29459),v=t(86131),R=t(54290),D=t(74847),o=t(67347),i=t(77031),a=t(41474),s=t(96081);const x=new Set([102113,102100,3857,3785,900913]),p=[0,0];let f=class extends((0,s.A)((0,d.Y)((0,M.e)(a.A)))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}get tileMatrixSet(){const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(e.id!==this.layer.activeLayer.tileMatrixSetId&&(this.layer.activeLayer.tileMatrixSetId=e.id),e):null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume()}attach(){const e=this.tileMatrixSet?.tileInfo;e&&(this._tileInfoView=new R.A(e),this._fetchQueue=new o.A({tileInfoView:this._tileInfoView,concurrency:16,process:(r,l)=>this.fetchTile(r,l)}),this._tileStrategy=new i.A({cachePolicy:"keep",resampling:!0,acquireTile:r=>this.acquireTile(r),releaseTile:r=>this.releaseTile(r),tileInfoView:this._tileInfoView}),this.addAttachHandles(this._updatingHandles.add(()=>[this.layer?.activeLayer?.styleId,this.tileMatrixSet],()=>this.doRefresh())),super.attach())}detach(){super.detach(),this._tileStrategy?.destroy(),this._fetchQueue?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return this.layer.activeLayer.tileMatrixSets?.some(r=>(0,n.aI)(r.tileInfo?.spatialReference,e))??!1}doRefresh(){var e=this;return(0,g.A)(function*(){if(e.attached){if(e.suspended)return e._tileStrategy.clear(),void e.requestUpdate();e._fetchQueue.reset(),e._tileStrategy.refresh(r=>e._updatingHandles.addPromise(e._enqueueTileFetch(r)))}})()}acquireTile(e){const r=this._bitmapView.createTile(e),l=r.bitmap;return[l.x,l.y]=this._tileInfoView.getTileCoords(p,r.key),l.resolution=this._tileInfoView.getTileResolution(r.key),[l.width,l.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(r)),this._bitmapView.addChild(r),this.requestUpdate(),r}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",()=>e.destroy()),this.requestUpdate()}fetchTile(e,r={}){var l=this;return(0,g.A)(function*(){const I="tilemapCache"in l.layer?l.layer.tilemapCache:null,{signal:B,resamplingLevel:S=0}=r;if(!I)return l._fetchImage(e,B);const O=new D.A(0,0,0,0);let w;try{yield I.fetchAvailabilityUpsample(e.level,e.row,e.col,O,{signal:B}),w=yield l._fetchImage(O,B)}catch(L){if((0,E.zf)(L))throw L;if(S<3){const C=l._tileInfoView.getTileParentId(e.id);if(C){const U=new D.A(C),W=yield l.fetchTile(U,{...r,resamplingLevel:S+1});return(0,v.t)(l._tileInfoView,W,U,e)}}throw L}return(0,v.t)(l._tileInfoView,w,O,e)})()}canResume(){return super.canResume()&&null!==this.tileMatrixSet}_enqueueTileFetch(e){var r=this;return(0,g.A)(function*(){if(!r._fetchQueue.has(e.key.id)){try{const l=yield r._fetchQueue.push(e.key);e.bitmap.source=l,e.bitmap.width=r._tileInfoView.tileInfo.size[0],e.bitmap.height=r._tileInfoView.tileInfo.size[1],e.once("attach",()=>r.requestUpdate())}catch(l){(0,E.zf)(l)||_.A.getLogger(r).error(l)}r.requestUpdate()}})()}_fetchImage(e,r){var l=this;return(0,g.A)(function*(){return l.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:r})})()}_getTileMatrixSetBySpatialReference(e){const r=this.view.spatialReference;if(!e.tileMatrixSets)return null;let l=e.tileMatrixSets.find(I=>(0,n.aI)(I.tileInfo?.spatialReference,r));return!l&&r.isWebMercator&&(l=e.tileMatrixSets.find(I=>x.has(I.tileInfo?.spatialReference.wkid??-1))),l}};(0,u._)([(0,h.MZ)({readOnly:!0})],f.prototype,"tileMatrixSet",null),f=(0,u._)([(0,c.$)("esri.views.2d.layers.WMTSLayerView2D")],f);const m=f}}]);