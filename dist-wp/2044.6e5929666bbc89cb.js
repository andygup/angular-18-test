"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[2044],{2044:(te,q,f)=>{f.r(q),f.d(q,{constructAssociationMetaDataFeatureSetFromUrl:()=>He,constructFeatureSet:()=>ne,constructFeatureSetFromPortalItem:()=>it,constructFeatureSetFromRelationship:()=>et,constructFeatureSetFromUrl:()=>me,convertToFeatureSet:()=>st,createFeatureSetCollectionFromMap:()=>rt,createFeatureSetCollectionFromService:()=>nt,initialiseMetaDataCache:()=>Xe});var S=f(10467),z=f(89563);class Q{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}featureSetByName(e,t=!0,r=["*"]){var n=this;return(0,S.A)(function*(){return void 0===n._layerByName[e]?null:n._layerByName[e]})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,S.A)(function*(){return void 0===n._layerById[e]?null:n._layerById[e]})()}castToText(e=!1){return"object, FeatureSetCollection"}}var N=f(42686),L=f(888),k=f(81098),M=f(36455),C=f(93571),F=f(31033),R=f(85922),x=f(71505),A=f(58314),g=f(7981),b=f(97089),h=f(7425),T=f(40013);class w{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const e=new w;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,t,r,n){const l=new w;l.field=e;const s=T.WhereClause.create(t,r,n),d=function O(D){if("function"===D.parseTree.type){if(0===D.parseTree.args.value.length)return{name:D.parseTree.name,expr:null};if(D.parseTree.args.value.length>1)throw new F.L8(F.Z7.MissingStatisticParameters);const e=T.WhereClause.create((0,b.Mi)(D.parseTree.args.value[0],g.zl.Standardised,D.parameters),D.fieldsIndex,D.timeZone);return{name:D.parseTree.name,expr:e}}return null}(s);if(null===d)throw new F.L8(F.Z7.UnsupportedSqlFunction,{function:""});const i=d.name.toUpperCase().trim();if("MIN"===i){if(l.typeofstat="MIN",l.workingexpr=d.expr,null===s)throw new F.L8(F.Z7.InvalidFunctionParameters,{function:"min"})}else if("MAX"===i){if(l.typeofstat="MAX",l.workingexpr=d.expr,null===s)throw new F.L8(F.Z7.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===i)l.typeofstat="COUNT",l.workingexpr=d.expr;else if("STDEV"===i){if(l.typeofstat="STDDEV",l.workingexpr=d.expr,null===s)throw new F.L8(F.Z7.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===i){if(l.typeofstat="SUM",l.workingexpr=d.expr,null===s)throw new F.L8(F.Z7.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===i){if(l.typeofstat="AVG",l.workingexpr=d.expr,null===s)throw new F.L8(F.Z7.InvalidFunctionParameters,{function:i})}else if("AVG"===i){if(l.typeofstat="AVG",l.workingexpr=d.expr,null===s)throw new F.L8(F.Z7.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==i)throw new F.L8(F.Z7.UnsupportedSqlFunction,{function:i});if(l.typeofstat="VAR",l.workingexpr=d.expr,null===s)throw new F.L8(F.Z7.InvalidFunctionParameters,{function:"var"})}return l}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}var p=f(55144),u=f(87257),m=f(16924),c=f(29752),_=f(32034),y=f(29141),B=f(73258);function G(D){if(!D)return"COUNT";switch(D.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class Z extends R.A{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(e){var t=this;return(0,S.A)(function*(){if(null===t._wset){const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,t._wset}return t._wset})()}_isInFeatureSet(){return g.J6.InFeatureSet}_nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,r=1;const n=this._parent?this._parent.getFieldsIndex():new B.A([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let s=!1;for(let d=0;d<this._config.groupbyfields.length;d++)if(this._config.groupbyfields[d].name.toLowerCase()===this.objectIdField.toLowerCase()){s=!0;break}if(!1===s)for(let d=0;d<this._config.statsfields.length;d++)if(this._config.statsfields[d].name.toLowerCase()===this.objectIdField.toLowerCase()){s=!0;break}!1===s?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(const s of this._config.statsfields){const d=new w;d.field=s.name,d.tofieldname=s.name,d.workingexpr=s.expression instanceof T.WhereClause?s.expression:T.WhereClause.create(s.expression,n,this.dateFieldsTimeZoneDefaultUTC),d.typeofstat=G(s.statistic),this._decodedStatsfield.push(d)}this._decodedGroupbyfield=[];for(const s of this._config.groupbyfields){const d={name:s.name,singlefield:null,tofieldname:s.name,expression:s.expression instanceof T.WhereClause?s.expression:T.WhereClause.create(s.expression,n,this.dateFieldsTimeZoneDefaultUTC),sqlType:null};this._decodedGroupbyfield.push(d)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const s of this._parent.fields)e[s.name.toUpperCase()]=1;this.types=null,this.subtypes=null,this.subtypeField=""}else this.geometryType=g.ik.point,this.typeIdField="",this.types=null,this.subtypes=null,this.subtypeField="",this.spatialReference=new _.A({wkid:4326});this.fields=[];const l=new w;l.field=this._nextUniqueName(e),l.tofieldname=this.objectIdField,l.workingexpr=T.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC),l.typeofstat="MIN",this._decodedStatsfield.push(l);for(const s of this._decodedGroupbyfield){const d=new y.A;if(s.name=this._nextUniqueName(e),d.name=s.tofieldname,d.alias=d.name,(0,b.DA)(s.expression)){const i=this._parent.getField((0,b.YY)(s.expression,g.zl.Standardised));if(!i)throw new F.dr(F.D_.AggregationFieldNotFound);s.name=i.name,s.singlefield=i.name,this.phsyicalgroupbyfields.push(i.name),d.type=i.type,s.sqlType=i.type}else{d.type=this._convertToEsriFieldType((0,b.IY)(s.expression,this._parent.fields));const i=new y.A;i.name=s.name,i.alias=i.name,this.phsyicalgroupbyfields.push(s.name),this._adaptedFields.push(new M.Gr(i,s.expression)),this._candosimplegroupby=!1,s.sqlType=d.type}this.fields.push(d)}if(this._adaptedFields.length>0)for(const s of this._parent.fields)this._adaptedFields.push(new M.IO(s));for(let s=0;s<this._decodedStatsfield.length;s++){const d=new y.A;let i=null;const I=this._decodedStatsfield[s];I.field=this._nextUniqueName(e),I.tofieldname===this.objectIdField&&(this._internalObjectIdField=I.field),d.name=I.tofieldname,d.alias=d.name;const v=null!==I.workingexpr&&(0,b.DA)(I.workingexpr)?(0,b.YY)(I.workingexpr,g.zl.Standardised):"";switch(this._decodedStatsfield[s].typeofstat){case"SUM":if(""!==v){if(i=this._parent.getField(v),!i)throw new F.dr(F.D_.AggregationFieldNotFound);d.type=i.type}else d.type="double";break;case"MIN":case"MAX":if(""!==v){if(i=this._parent.getField(v),!i)throw new F.dr(F.D_.AggregationFieldNotFound);d.type=i.type}else d.type="double";break;case"COUNT":d.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==v&&(i=this._parent.getField(v),!i))throw new F.dr(F.D_.AggregationFieldNotFound);d.type="double"}this.fields.push(d)}}_canDoAggregates(){return(0,S.A)(function*(){return!1})()}_getFeatures(e,t,r,n){var l=this;return(0,S.A)(function*(){const s=l._maxQuery;return!0===l._checkIfNeedToExpandKnownPage(e,s)?(yield l._expandPagedSet(e,s,0,0,n),l._getFeatures(e,t,r,n)):"success"})()}_getFilteredSet(e,t,r,n,l){var s=this;return(0,S.A)(function*(){if(""!==e)return new x.A([],[],!0,null);let d=null;const i={ordered:!1,nowhereclause:!1};if(yield s._ensureLoaded(),null!==r)for(let v=0;v<s._decodedStatsfield.length;v++)if(!0===(0,b.Ju)(r,s._decodedStatsfield[v].tofieldname)){i.nowhereclause=!0,r=null;break}if(null!==n){i.ordered=!0;for(let v=0;v<s._decodedStatsfield.length;v++)if(!0===n.scanForField(s._decodedStatsfield[v].tofieldname)){n=null,i.ordered=!1;break}if(null!==n)for(const v of s._decodedGroupbyfield)if(null===v.singlefield&&!0===n.scanForField(v.tofieldname)){n=null,i.ordered=!1;break}}if(!1!==s._candosimplegroupby&&(yield s._parent._canDoAggregates(s.phsyicalgroupbyfields,s._decodedStatsfield,"",null,null))){let v=null;r&&(v=s._reformulateWhereClauseWithoutGroupByFields(r));let P=null;n&&(P=s._reformulateOrderClauseWithoutGroupByFields(n));const j=yield s._parent._getAggregatePagesDataSourceDefinition(s.phsyicalgroupbyfields,s._decodedStatsfield,"",null,v,P,s._internalObjectIdField);return s._checkCancelled(l),d=!0===i.nowhereclause?new x.A(j._candidates.slice(0).concat(j._known.slice(0)),[],!0===i.ordered&&j._ordered,s._clonePageDefinition(j.pagesDefinition)):new x.A(j._candidates.slice(0),j._known.slice(0),!0===i.ordered&&j._ordered,s._clonePageDefinition(j.pagesDefinition)),d}let I=s._parent;if(s._adaptedFields.length>0&&(I=new M.a({parentfeatureset:s._parent,adaptedFields:s._adaptedFields,extraFilter:null})),!0===i.nowhereclause)d=new x.A(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:s._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new C.A({parentfeatureset:I,orderbyclause:new A.A(s.phsyicalgroupbyfields.join(",")+","+s._parent.objectIdField+" ASC")})}});else{let v=I;if(null!==r){let P=null;r&&(P=s._reformulateWhereClauseWithoutGroupByFields(r)),v=new L.A({parentfeatureset:v,whereclause:P})}d=new x.A(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:s._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new C.A({parentfeatureset:v,orderbyclause:new A.A(s.phsyicalgroupbyfields.join(",")+","+s._parent.objectIdField+" ASC")})}})}return d})()}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=(0,b.bD)(e,t.tofieldname,(0,b.YY)(t.workingexpr,g.zl.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=(0,b.bD)(e,t.tofieldname,(0,b.YY)(t.expression,g.zl.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const r of this._decodedGroupbyfield)r.tofieldname!==r.name&&t.push({field:r.tofieldname,newfield:r.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(e,t,r){var n=this;return(0,S.A)(function*(){return!0===n._checkIfNeedToExpandCandidatePage(e,n._maxQuery)?(yield n._expandPagedSet(e,n._maxQuery,0,0,r),n._refineSetBlock(e,t,r)):(n._checkCancelled(r),n._refineKnowns(e,t),e)})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_getPhysicalPage(e,t,r){var n=this;return(0,S.A)(function*(){if(!0===e.pagesDefinition.aggregatefeaturesetpagedefinition)return n._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]);const l=yield n._getAgregagtePhysicalPage(e,t,r);for(const s of l){const d={geometry:s.geometry,attributes:{}},i={};for(const I in s.attributes)i[I.toLowerCase()]=s.attributes[I];for(const I of n._decodedGroupbyfield)d.attributes[I.tofieldname]=i[I.name.toLowerCase()];for(const I of n._decodedStatsfield)d.attributes[I.tofieldname]=i[I.field.toLowerCase()];n._featureCache[d.attributes[n.objectIdField]]=new k.A(d)}return l.length})()}_sequentialGetPhysicalItem(e,t,r,n){return new Promise((l,s)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?l(n.length):this._nextAggregateItem(e,t,r,n,d=>{l(null===d?n.length:this._sequentialGetPhysicalItem(e,t-=1,r,n))},s)})}_nextAggregateItem(e,t,r,n,l,s){try{(0,N.a0)(e.pagesDefinition.internal.iterator.next()).then(d=>{if(null===d)if(null!==e.pagesDefinition.internal.workingItem){const i=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(i),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(i.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,l(null)}else e.pagesDefinition.internal.fullyResolved=!0,l(null);else{const i=this._generateAggregateHash(d);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[d],id:i};else{if(i!==e.pagesDefinition.internal.workingItem.id){const I=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(I),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(I.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[d],id:i},void l(I)}e.pagesDefinition.internal.workingItem.features.push(d)}this._nextAggregateItem(e,t,r,n,l,s)}},s)}catch(d){s(d)}}_calculateFieldStat(e,t,r){const n=[];for(let l=0;l<e.features.length;l++)if(null!==t.workingexpr){const s=t.workingexpr.calculateValue(e.features[l]);null!==s&&n.push(s instanceof u.n||s instanceof c.k?s.toNumber():s instanceof m.g?s.toMilliseconds():s)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=(0,h.tQ)("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=(0,h.tQ)("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=(0,h.tQ)("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=(0,h.tQ)("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=(0,h.tQ)("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=(0,h.tQ)("avg",n,-1)}return!0}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const n of this._decodedGroupbyfield){const l=n.singlefield?e.features[0].attributes[n.singlefield]:T.WhereClause.convertValueToStorageFormat(n.expression.calculateValue(e.features[0]),n.sqlType);t.attributes[n.tofieldname]=l}for(const n of this._decodedStatsfield)this._calculateFieldStat(e,n,t);const r=[];for(let n=0;n<this._decodedStatsfield.length;n++)r.push(this._calculateFieldStat(e,this._decodedStatsfield[n],t));return this._featureCache[t.attributes[this.objectIdField]]=new k.A({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const r of this._decodedGroupbyfield){const n=r.singlefield?e.attributes[r.singlefield]:r.expression.calculateValue(e);t+=null==n?":":":"+n.toString()}return(0,p.d)(t,p.T.String)}_stat(){return(0,S.A)(function*(){return{calculated:!1}})()}getFeatureByObjectId(){return(0,S.A)(function*(){return null})()}static registerAction(){R.A._featuresetFunctions.groupby=function(e,t){return new Z({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}var U=f(57120),E=f(53437),K=f(77469),V=f(84462),oe=f(53787),re=f(61320),ce=f(58701),ie=f(35940),Oe=f(5922),Pe=f(3248),Le=f(56492),ue=f(6829),Ne=f(93164),he=f(34687),Me=f(11170),je=f(93327),ae=f(87086);function fe(){return fe=(0,S.A)(function*(D,e,t,r){return function Ge(D,e,t,r){return _e.apply(this,arguments)}(e,yield function ke(D,e,t,r){return pe.apply(this,arguments)}(D,e,t,r),t,r)}),fe.apply(this,arguments)}function pe(){return(pe=(0,S.A)(function*(D,e,t,r){const n={...r},l=function We(D,e){let t=ae.A.from(D);t.sourceSpatialReference=t.sourceSpatialReference??e?.sourceSpatialReference??null,(e?.gdbVersion||e?.dynamicDataSource)&&(t=t===D?t.clone():t,t.gdbVersion=D.gdbVersion||e.gdbVersion,t.dynamicDataSource=D.dynamicDataSource?Ne.L.from(D.dynamicDataSource):e.dynamicDataSource);const r=e?.infoFor3D;if(null!=r&&be(D,r)){t=t===D?t.clone():t,t.formatOf3DObjects=null;const{supportedFormats:n,queryFormats:l}=r,s=(0,ue.R_)("model/gltf-binary",n)??(0,ue.E1)("glb",n),d=(0,ue.R_)("model/gltf+json",n)??(0,ue.E1)("gtlf",n);for(const i of l){if(i===s){t.formatOf3DObjects=i;break}i!==d||t.formatOf3DObjects||(t.formatOf3DObjects=i)}if(!t.formatOf3DObjects)throw new Oe.A("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==t.outFields||!t.outFields.includes("*")){t=t===D?t.clone():t,null==t.outFields&&(t.outFields=[]);const{originX:i,originY:I,originZ:v,translationX:P,translationY:j,translationZ:W,scaleX:J,scaleY:$,scaleZ:H,rotationX:ee,rotationY:Y,rotationZ:le,rotationDeg:se}=r.transformFieldRoles;t.outFields.push(i,I,v,P,j,W,J,$,H,ee,Y,le,se)}}return t}(e,t),s=null!=e.outStatistics?.[0],d=(0,Pe.A)("featurelayer-pbf-statistics"),i=!s||d;let I;if("pbf"===t?.format&&i)try{I=yield(0,Me.S)(D,l,n)}catch(v){if("query:parsing-pbf"!==v.name)throw v;t.format="json"}return"json"!==t?.format&&i||(I=yield(0,he.e)(D,l,n)),function Be(D,e){if(null!=D&&null!=e)for(const t of e){const r=D.get(t.name);r&&Object.assign(t,r.toJSON())}}(t?.fieldsIndex,I.fields),I})).apply(this,arguments)}function _e(){return(_e=(0,S.A)(function*(D,e,t,r){const n=t?.infoFor3D;if(!be(D,n)||null==n||!e.assetMaps||!e.features?.length)return je.A.fromJSON(e);const{meshFeatureSetFromJSON:l}=yield(0,Le.qr)(Promise.all([f.e(5434),f.e(3647),f.e(143),f.e(2767),f.e(1698)]).then(f.bind(f,71698)),r);return l(D,n,e)})).apply(this,arguments)}function be(D,e){return null!=e&&!0===D.returnGeometry&&"xyFootprint"!==D.multipatchOption&&!D.outStatistics}f(23098),f(40707),f(45272),f(70994);var Ze=f(52466),Ke=f(33063),Qe=(f(21152),f(35150),f(55861),f(93615),f(20914),f(47258),f(55912),f(82663),f(87477),f(87342)),Te=(f(2296),f(69287),f(28067),f(59487)),Re=(f(61569),f(16842));class de extends R.A{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return g.gO}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(e){const t=this.urlQueryPath+","+(0,g.JB)(e.toJSON());return(0,p.d)(t,p.T.String)}loadImpl(){var e=this;return(0,S.A)(function*(){return!0===e._layer.loaded?(e._initialiseFeatureSet(),e):(yield e._layer.load(),e._initialiseFeatureSet(),e)})()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=g.zl.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=g.zl.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=g.zl.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=g.zl.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);"subtype-group"===this._layer.type?(this.subtypeField=this._layer.subtypeField??"",this.subtypes=this._layer.subtypes,this.types=null,this.typeIdField=null):"oriented-imagery"===this._layer.type?(this.subtypeField=null,this.subtypes=null,this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types):(this.subtypeField=this._layer.subtypeField,this.subtypes=this._layer.subtypes,this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types)}_isInFeatureSet(){return g.J6.InFeatureSet}_refineSetBlock(e){return(0,S.A)(function*(){return e})()}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,S.A)(function*(){if(null===t._wset){yield t._ensureLoaded();const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,r}return t._wset})()}_runDatabaseProbe(e){var t=this;return(0,S.A)(function*(){yield t._ensureLoaded();const r=new ae.A;t.datesInUnknownTimezone&&(r.timeReferenceUnknownClient=!0),r.where=e.replace("OBJECTID",t._layer.objectIdField);try{return yield t._layer.queryObjectIds(r),!0}catch{return!1}})()}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){const t=this._layer?.capabilities?.query;return!e.outStatistics&&!0===t?.supportsFormatPBF&&!0===t?.supportsQuantizationEditMode}queryPBF(e){var t=this;return(0,S.A)(function*(){return e.quantizationParameters={mode:"edit"},(yield function Ue(D,e,t,r){return fe.apply(this,arguments)}(t._layer.parsedUrl,e,{format:"pbf"},{})).unquantize()})()}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title??"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){e.returnZ=this.hasZ,e.returnM=this.hasM;const r="execute"===t?he.s:"executeForCount"===t?Ke.I:Qe.V,n="execute"===t&&this.pbfSupportedForQuery(e);let l=null;if(this.recentlyUsedQueries){const s=this.convertQueryToLruCacheKey(e);l=this.recentlyUsedQueries.getFromCache(s),null===l&&(l=!0!==n?r(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,l),l=l.catch(d=>{throw this.recentlyUsedQueries?.removeFromCache(s),d}))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===l&&(l=!0!==n?r(this._layer.parsedUrl.path,e):this.queryPBF(e)),l}_getFilteredSet(e,t,r,n,l){var s=this;return(0,S.A)(function*(){const d=yield s.databaseType();if(s.isTable()&&t&&null!==e&&""!==e)return new x.A([],[],!0,null);if(s._canUsePagination())return s._getFilteredSetUsingPaging(e,t,r,n,l);let i="",I=!1;null!==n&&s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsOrderBy&&(i=n.constructClause(),I=!0);const v=new ae.A;s.datesInUnknownTimezone&&(v.timeReferenceUnknownClient=!0),v.where=null===r?null===t?"1=1":"":(0,b.YY)(r,d),s._requestStandardised&&(v.sqlFormat="standard"),v.spatialRelationship=s._makeRelationshipEnum(e),v.outSpatialReference=s.spatialReference,v.orderByFields=""!==i?i.split(","):null,v.geometry=null===t?null:t,v.relationParameter=s._makeRelationshipParam(e);let P=yield s.executeQuery(v,"executeForIds");return null===P&&(P=[]),s._checkCancelled(l),new x.A([],P,I,null)})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_getFilteredSetUsingPaging(e,t,r,n,l){var s=this;return(0,S.A)(function*(){let d="",i=!1;null!==n&&s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsOrderBy&&(d=n.constructClause(),i=!0);const I=yield s.databaseType();let v=null===r?null===t?"1=1":"":(0,b.YY)(r,I);s._layer.definitionExpression&&s._useDefinitionExpression&&(v=""!==v?"(("+s._layer.definitionExpression+") AND ("+v+"))":s._layer.definitionExpression);let P=s._maxQueryRate();const j=s._layer.capabilities?.query.maxRecordCount;null!=j&&j<P&&(P=j);let W=null;if(!0===s._pageJustIds)W=new x.A([],["GETPAGES"],i,{spatialRel:s._makeRelationshipEnum(e),relationParam:s._makeRelationshipParam(e),outFields:s._layer.objectIdField,resultRecordCount:P,resultOffset:0,geometry:null===t?null:t,where:v,orderByFields:d,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let J=!0;!0===s._removeGeometry&&(J=!1);const $=s._overrideFields??s._fieldsIncludingObjectId(["*"]);W=new x.A([],["GETPAGES"],i,{spatialRel:s._makeRelationshipEnum(e),relationParam:s._makeRelationshipParam(e),outFields:$.join(","),resultRecordCount:P,resultOffset:0,geometry:null===t?null:t,where:v,orderByFields:d,returnGeometry:J,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return yield s._expandPagedSet(W,P,0,1,l),W})()}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){var n=this;return(0,S.A)(function*(){const l=e.pagesDefinition.internal.lastRetrieved,s=l,d=e.pagesDefinition.internal.lastPage,i=new ae.A;n._requestStandardised&&(i.sqlFormat="standard"),n.datesInUnknownTimezone&&(i.timeReferenceUnknownClient=!0),i.spatialRelationship=e.pagesDefinition.spatialRel,i.relationParameter=e.pagesDefinition.relationParam,i.outFields=e.pagesDefinition.outFields.split(","),i.num=e.pagesDefinition.resultRecordCount,i.start=e.pagesDefinition.internal.lastPage,i.geometry=e.pagesDefinition.geometry,i.where=e.pagesDefinition.where,i.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,i.returnGeometry=e.pagesDefinition.returnGeometry,i.outSpatialReference=n.spatialReference;const I=yield n.executeQuery(i,"execute");if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==d)return"done";const v=n._layer.objectIdField;for(let P=0;P<I.features.length;P++)e.pagesDefinition.internal.set[s+P]=I.features[P].attributes[v];if(!1===n._pageJustIds)for(let P=0;P<I.features.length;P++)n._featureCache[I.features[P].attributes[v]]=I.features[P];return(void 0===I.exceededTransferLimit&&I.features.length!==e.pagesDefinition.resultRecordCount||!1===I.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=l+I.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFeatures(e,t,r,n){var l=this;return(0,S.A)(function*(){const s=[];if(-1!==t&&void 0===l._featureCache[t]&&s.push(t),!0===l._checkIfNeedToExpandKnownPage(e,l._maxProcessingRate()))return yield l._expandPagedSet(e,l._maxProcessingRate(),0,0,n),l._getFeatures(e,t,r,n);let d=0;for(let P=e._lastFetchedIndex;P<e._known.length;P++){if(e._lastFetchedIndex+=1,d++,void 0===l._featureCache[e._known[P]]){let j=!1;if(null!=l._layer._mode){const W=l._layer._mode;if(void 0!==W._featureMap[e._known[P]]){const J=W._featureMap[e._known[P]];null!==J&&(j=!0,l._featureCache[e._known[P]]=J)}}if(!1===j&&(e._known[P]!==t&&s.push(e._known[P]),s.length>=l._maxProcessingRate()-1))break}if(d>=r&&0===s.length)break}if(0===s.length)return"success";const i=new ae.A;l._requestStandardised&&(i.sqlFormat="standard"),l.datesInUnknownTimezone&&(i.timeReferenceUnknownClient=!0),i.objectIds=s,i.outFields=l._overrideFields??l._fieldsIncludingObjectId(["*"]),i.returnGeometry=!0,!0===l._removeGeometry&&(i.returnGeometry=!1),i.outSpatialReference=l.spatialReference;const I=yield l.executeQuery(i,"execute");if(l._checkCancelled(n),void 0!==I.error)throw new F.dr(F.D_.RequestFailed,{reason:I.error});const v=l._layer.objectIdField;for(let P=0;P<I.features.length;P++)l._featureCache[I.features[P].attributes[v]]=I.features[P];return"success"})()}_getDistinctPages(e,t,r,n,l,s,d,i,I){var v=this;return(0,S.A)(function*(){yield v._ensureLoaded();const P=yield v.databaseType();let j=r.parseTree.column;const W=v._layer.fields??[];for(let Y=0;Y<W.length;Y++)if(W[Y].name.toLowerCase()===j.toLowerCase()){j=W[Y].name;break}const J=new ae.A;v._requestStandardised&&(J.sqlFormat="standard"),v.datesInUnknownTimezone&&(J.timeReferenceUnknownClient=!0);let $=null===s?null===l?"1=1":"":(0,b.YY)(s,P);v._layer.definitionExpression&&v._useDefinitionExpression&&($=""!==$?"(("+v._layer.definitionExpression+") AND ("+$+"))":v._layer.definitionExpression),J.where=$,J.spatialRelationship=v._makeRelationshipEnum(n),J.relationParameter=v._makeRelationshipParam(n),J.geometry=null===l?null:l,J.returnDistinctValues=!0,J.returnGeometry=!1,J.outFields=[j];const H=yield v.executeQuery(J,"execute");if(v._checkCancelled(I),!H.hasOwnProperty("features"))throw new F.dr(F.D_.InvalidStatResponse);let ee=!1;for(let Y=0;Y<W.length;Y++)if(W[Y].name===j){"date"===W[Y].type&&(ee=!0);break}for(let Y=0;Y<H.features.length;Y++){if(ee){const le=H.features[Y].attributes[j];i.push(null!==le?new Date(le):le)}else i.push(H.features[Y].attributes[j]);if(i.length>=d)break}return 0===H.features.length?i:H.features.length===v._layer.capabilities?.query.maxRecordCount&&i.length<d?{calculated:!0,result:yield v._getDistinctPages(e+H.features.length,t,r,n,l,s,d,i,I)}:i})()}_distinctStat(e,t,r,n,l,s,d){var i=this;return(0,S.A)(function*(){return{calculated:!0,result:yield i._getDistinctPages(0,e,t,r,n,l,s,[],d)}})()}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}_countstat(e,t,r,n){var l=this;return(0,S.A)(function*(){const s=yield l.databaseType(),d=new ae.A;if(l._requestStandardised&&(d.sqlFormat="standard"),l.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};let i=null===n?null===r?"1=1":"":(0,b.YY)(n,s);return l._layer.definitionExpression&&l._useDefinitionExpression&&(i=""!==i?"(("+l._layer.definitionExpression+") AND ("+i+"))":l._layer.definitionExpression),d.where=i,l.datesInUnknownTimezone&&(d.timeReferenceUnknownClient=!0),d.where=i,d.spatialRelationship=l._makeRelationshipEnum(t),d.relationParameter=l._makeRelationshipParam(t),d.geometry=null===r?null:r,d.returnGeometry=!1,{calculated:!0,result:yield l.executeQuery(d,"executeForCount")}})()}_stats(e,t,r,n,l,s,d){var i=this;return(0,S.A)(function*(){yield i._ensureLoaded();const I=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsSqlExpression,v=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsStatistics,P=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsDistinct;if("count"===e)return P?i._countstat(e,r,n,l):{calculated:!1};if(!1===v||!1===(0,b.DA)(t)&&!1===I||!1===t.isStandardized)return""!==r||null!==l?{calculated:!1}:i._manualStat(e,t,s,d);if("distinct"===e)return!1===P?""!==r||null!==l?{calculated:!1}:i._manualStat(e,t,s,d):i._distinctStat(e,t,r,n,l,s,d);const j=yield i.databaseType();if(i.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};const W=new ae.A;i._requestStandardised&&(W.sqlFormat="standard");let J=null===l?null===n?"1=1":"":(0,b.YY)(l,j);i._layer.definitionExpression&&i._useDefinitionExpression&&(J=""!==J?"(("+i._layer.definitionExpression+") AND ("+J+"))":i._layer.definitionExpression),W.where=J,W.spatialRelationship=i._makeRelationshipEnum(r),W.relationParameter=i._makeRelationshipParam(r),W.geometry=null===n?null:n,i.datesInUnknownTimezone&&(W.timeReferenceUnknownClient=!0);const $=new Re.A;$.statisticType=(0,h.Dp)(e),$.onStatisticField=(0,b.YY)(t,j),$.outStatisticFieldName="ARCADE_STAT_RESULT",W.returnGeometry=!1;let H="ARCADE_STAT_RESULT";W.outStatistics=[$];const ee=yield i.executeQuery(W,"execute");if(!ee.hasOwnProperty("features")||0===ee.features.length)throw new F.dr(F.D_.InvalidStatResponse);let Y=!1;const le=ee.fields??[];for(let se=0;se<le.length;se++)if("ARCADE_STAT_RESULT"===le[se].name.toUpperCase()){H=le[se].name,"date"===le[se].type&&(Y=!0);break}if(Y){let se=ee.features[0].attributes[H];return null!==se&&(se=new Date(ee.features[0].attributes[H])),{calculated:!0,result:se}}return{calculated:!0,result:ee.features[0].attributes[H]}})()}_stat(e,t,r,n,l,s,d){return this._stats(e,t,r,n,l,s,d)}_canDoAggregates(e,t){var r=this;return(0,S.A)(function*(){yield r._ensureLoaded();let n=!1;const l=r._layer.capabilities?.query,s=!0===l?.supportsSqlExpression;if(null!=l&&!0===l.supportsStatistics&&!0===l.supportsOrderBy&&(n=!0),n)for(let d=0;d<t.length-1;d++)(!1===t[d].workingexpr?.isStandardized||!1===(0,b.DA)(t[d].workingexpr)&&!1===s)&&(n=!1);return!1!==n})()}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,t,r,n,l,s,d){var i=this;return(0,S.A)(function*(){yield i._ensureLoaded();const I=yield i.databaseType();let v="",P=!1,j=!1;null!==s&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(v=s.constructClause(),j=!0),i._layer.capabilities&&i._layer.capabilities.query&&!1===i._layer.capabilities.query.supportsPagination&&(j=!1,P=!0,v=i._layer.objectIdField);const W=[];for(let ee=0;ee<t.length;ee++){const Y=new Re.A;Y.onStatisticField=null!==t[ee].workingexpr?(0,b.YY)(t[ee].workingexpr,I):"",Y.outStatisticFieldName=t[ee].field,Y.statisticType=t[ee].toStatisticsName(),W.push(Y)}""===v&&(v=e.join(","));let J=i._maxQueryRate();const $=i._layer.capabilities?.query.maxRecordCount;null!=$&&$<J&&(J=$);let H=null===l?null===n?"1=1":"":(0,b.YY)(l,I);return i._layer.definitionExpression&&i._useDefinitionExpression&&(H=""!==H?"(("+i._layer.definitionExpression+") AND ("+H+"))":i._layer.definitionExpression),new x.A([],["GETPAGES"],j,{groupbypage:!0,spatialRel:i._makeRelationshipEnum(r),relationParam:i._makeRelationshipParam(r),outFields:["*"],useOIDpagination:P,generatedOid:d,resultRecordCount:J,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:W,geometry:null===n?null:n,where:H,orderByFields:v,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})})()}_getAgregagtePhysicalPage(e,t,r){var n=this;return(0,S.A)(function*(){let l=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(l=""!==l?"("+l+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const s=e.pagesDefinition.internal.lastRetrieved,d=s,i=e.pagesDefinition.internal.lastPage,I=new ae.A;if(n._requestStandardised&&(I.sqlFormat="standard"),I.where=l,I.spatialRelationship=e.pagesDefinition.spatialRel,I.relationParameter=e.pagesDefinition.relationParam,I.outFields=e.pagesDefinition.outFields,I.outStatistics=e.pagesDefinition.outStatistics,I.geometry=e.pagesDefinition.geometry,I.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,I.num=e.pagesDefinition.resultRecordCount,I.start=e.pagesDefinition.internal.lastPage,I.returnGeometry=e.pagesDefinition.returnGeometry,n.datesInUnknownTimezone&&(I.timeReferenceUnknownClient=!0),I.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,n.isTable()&&I.geometry&&I.spatialRelationship)return[];const v=yield n.executeQuery(I,"execute");if(n._checkCancelled(r),!v.hasOwnProperty("features"))throw new F.dr(F.D_.InvalidStatResponse);const P=[];if(e.pagesDefinition.internal.lastPage!==i)return[];v.features.length>0&&void 0===v.features[0].attributes[e.pagesDefinition.generatedOid]&&(e.pagesDefinition.generatedOid=e.pagesDefinition.generatedOid.toLowerCase());for(let j=0;j<v.features.length;j++)e.pagesDefinition.internal.set[d+j]=v.features[j].attributes[e.pagesDefinition.generatedOid];for(let j=0;j<v.features.length;j++)P.push(new k.A({attributes:v.features[j].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===v.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=v.features[v.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===v.exceededTransferLimit&&v.features.length!==e.pagesDefinition.resultRecordCount||!1===v.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=s+v.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,P})()}static create(e,t,r,n,l){const s=new ie.default({url:e,outFields:null===t?["*"]:t});return new de({layer:s,spatialReference:r,lrucache:n,interceptor:l})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON?.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,g.Qi)(this._layer.parsedUrl.path)}queryAttachments(e,t,r,n,l){var s=this;return(0,S.A)(function*(){const i=s._layer;if(function d(I){const v=I.capabilities;return v?.data.supportsAttachment&&v?.operations.supportsQueryAttachments}(i)){const I={objectIds:[e],returnMetadata:l};(t&&t>0||r&&r>0)&&(I.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(I.attachmentTypes=n),s.featureSetQueryInterceptor&&s.featureSetQueryInterceptor.preLayerQueryCallback({layer:i,query:I,method:"attachments"});const v=yield i.queryAttachments(new Ze.A(I)),P=[];return v&&v[e]&&v[e].forEach(j=>{const W=s._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+j.id.toString();let J=null;l&&j.exifInfo&&(J=oe.A.convertJsonToArcade(j.exifInfo,"system",!0)),P.push(new V.A(j.id,j.name,j.contentType,j.size,W,J,j.keywords??null))}),P}return[]})()}queryRelatedFeatures(e){var t=this;return(0,S.A)(function*(){const r={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields?.join(","),returnGeometry:e.returnGeometry.toString()};null!=e.resultOffset&&(r.resultOffset=e.resultOffset.toString()),null!=e.resultRecordCount&&(r.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(r.orderByFields=e.orderByFields.join(",")),e.objectIds&&e.objectIds.length>0&&(r.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(r.outSR=(0,ce.YX)(e.outSpatialReference)),t.featureSetQueryInterceptor&&t.featureSetQueryInterceptor.preRequestCallback({layer:t._layer,queryPayload:r,method:"relatedrecords",url:t._layer.parsedUrl.path+"/queryRelatedRecords"});const n=yield(0,z.A)(t._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:r});if(n.data){const l={},s=n.data;if(s?.relatedRecordGroups){const d=s.spatialReference;for(const i of s.relatedRecordGroups){const I=i.objectId,v=[];for(const P of i.relatedRecords){P.geometry&&(P.geometry.spatialReference=d);const j=new k.A({geometry:P.geometry?(0,re.rS)(P.geometry):null,attributes:P.attributes});v.push(j)}l[I]={features:v,exceededTransferLimit:!0===s.exceededTransferLimit}}}return l}throw new F.dr(F.D_.InvalidRequest)})()}getFeatureByObjectId(e,t){var r=this;return(0,S.A)(function*(){const n=new ae.A;n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=r.spatialReference,n.where=r.objectIdField+"="+e.toString(),r.datesInUnknownTimezone&&(n.timeReferenceUnknownClient=!0),r.featureSetQueryInterceptor&&r.featureSetQueryInterceptor.preLayerQueryCallback({layer:r._layer,query:n,method:"execute"});const l=yield(0,he.s)(r._layer.parsedUrl.path,n);return 1===l.features.length?l.features[0]:null})()}getIdentityUser(){var e=this;return(0,S.A)(function*(){yield e.load();const t=K.id?.findCredential(e._layer.url);return t?t.userId:null})()}getOwningSystemUrl(){var e=this;return(0,S.A)(function*(){yield e.load();const t=K.id?.findServerInfo(e._layer.url);if(t)return t.owningSystemUrl;let r=e._layer.url;const n=r.toLowerCase().indexOf("/rest/services");if(r=n>-1?r.substring(0,n):r,r){r+="/rest/info";try{const l=yield(0,z.A)(r,{query:{f:"json"}});let s="";return l.data?.owningSystemUrl&&(s=l.data.owningSystemUrl),s}catch{return""}}return""})()}getDataSourceFeatureSet(){const e=new de({layer:this._layer,spatialReference:this.spatialReference??void 0,outFields:this._overrideFields??void 0,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries??void 0,interceptor:this.featureSetQueryInterceptor??void 0});return e._useDefinitionExpression=!1,e}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone??!1}get editFieldsInfo(){return this._layer.editFieldsInfo??null}get timeInfo(){return this._layer.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,S.A)(function*(){if(e.fsetInfo)return e.fsetInfo;let t=null,r=e._layer.serviceItemId??null;const n=e._layer.parsedUrl.path;if(n){const s=yield(0,z.A)(n,{responseType:"json",query:{f:"json"}});t=s?.data?.name??null,r=s?.data?.serviceItemId??null}const l=e._layer.title&&null!==(e._layer.parent??null);return e.featureSetInfo={layerId:e._layer.layerId,layerName:""===t?null:t,itemId:""===r?null:r,serviceLayerUrl:""===n?null:n,webMapLayerId:l?e._layer.id??null:null,webMapLayerTitle:l?e._layer.title??null:null,className:null,objectClassId:null},e.fsetInfo})()}}var Ve=f(6491);class Je extends R.A{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return g.gO}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var e=this;return(0,S.A)(function*(){return yield Promise.all([e._layer.load(),e._relatedLayer?.load()]),e._initialiseFeatureSet(),e})()}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(0),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const t=[],r=[];for(const n of this.fields)if("oid"===n.type)t.push(n),r.push(n.name);else for(const l of this._overrideFields)if(l.toLowerCase()===n.name.toLowerCase()){t.push(n),r.push(n.name);break}this.fields=t,this._overrideFields=r}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types,this.subtypeField=this._relatedLayer.subtypeField,this.subtypes=this._relatedLayer.subtypes}databaseType(){var e=this;return(0,S.A)(function*(){return yield e._relatedLayer.databaseType(),e._databaseType=e._relatedLayer._databaseType,e._databaseType})()}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return g.J6.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,S.A)(function*(){if(null===t._wset){yield t._ensureLoaded();const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,r}return t._wset})()}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new k.A({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,r,n,l){var s=this;return(0,S.A)(function*(){if(yield s.databaseType(),s.isTable()&&t&&null!==e&&""!==e)return new x.A([],[],!0,null);const d=s._layer.nativeCapabilities();if(!1===d.canQueryRelated)return new x.A([],[],!0,null);if(d.capabilities?.queryRelated.supportsPagination)return s._getFilteredSetUsingPaging(e,t,r,n,l);let i="",I=!1;null!==n&&!0===d.capabilities?.queryRelated.supportsOrderBy&&(i=n.constructClause(),I=!0);const v=new Te.default;v.objectIds=[s._findObjectId];const P=null!==s._overrideFields?s._overrideFields:s._fieldsIncludingObjectId(s._relatedLayer.fields?s._relatedLayer.fields.map(Y=>Y.name):["*"]);v.outFields=P,v.relationshipId=s.relationship.id,v.where="1=1";let j=!0;!0===s._removeGeometry&&(j=!1),v.returnGeometry=j,s._requestStandardised&&(v.sqlFormat="standard"),v.outSpatialReference=s.spatialReference,v.orderByFields=""!==i?i.split(","):null;const W=yield d.source.queryRelatedFeatures(v);s._checkCancelled(l);const J=W[s._findObjectId]?W[s._findObjectId].features:[],$=[];for(let Y=0;Y<J.length;Y++)s._featureCache[J[Y].attributes[s._relatedLayer.objectIdField]]=J[Y],$.push(J[Y].attributes[s._relatedLayer.objectIdField]);const H=t&&null!==e&&""!==e,ee=null!=r;return new x.A(H||ee?$:[],H||ee?[]:$,I,null)})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFilteredSetUsingPaging(e,t,r,n,l){var s=this;return(0,S.A)(function*(){let d="",i=!1;const I=s._layer.nativeCapabilities();null!==n&&!0===I.capabilities?.queryRelated.supportsOrderBy&&(d=n.constructClause(),i=!0),yield s.databaseType();let P=s._maxQueryRate();const j=I.capabilities?.query.maxRecordCount;null!=j&&j<P&&(P=j);const W=t&&null!==e&&""!==e,J=null!=r;let $=null,H=!0;!0===s._removeGeometry&&(H=!1);const ee=null!==s._overrideFields?s._overrideFields:s._fieldsIncludingObjectId(s._relatedLayer.fields?s._relatedLayer.fields.map(Y=>Y.name):["*"]);return $=new x.A(W||J?["GETPAGES"]:[],W||J?[]:["GETPAGES"],i,{outFields:ee.join(","),resultRecordCount:P,resultOffset:0,objectIds:[s._findObjectId],where:"1=1",orderByFields:d,returnGeometry:H,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),yield s._expandPagedSet($,P,0,0,l),$})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){var n=this;return(0,S.A)(function*(){const l=e.pagesDefinition.internal.lastRetrieved,s=l,d=e.pagesDefinition.internal.lastPage,i=n._layer.nativeCapabilities(),I=new Te.default;!0===n._requestStandardised&&(I.sqlFormat="standard"),I.relationshipId=n.relationship.id,I.objectIds=e.pagesDefinition.objectIds,I.resultOffset=e.pagesDefinition.internal.lastPage,I.resultRecordCount=e.pagesDefinition.resultRecordCount,I.outFields=e.pagesDefinition.outFields.split(","),I.where=e.pagesDefinition.where,I.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,I.returnGeometry=e.pagesDefinition.returnGeometry,I.outSpatialReference=n.spatialReference;const v=yield i.source.queryRelatedFeatures(I);if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==d)return 0;const P=v[n._findObjectId]?v[n._findObjectId].features:[];for(let W=0;W<P.length;W++)e.pagesDefinition.internal.set[s+W]=P[W].attributes[n._relatedLayer.objectIdField];for(let W=0;W<P.length;W++)n._featureCache[P[W].attributes[n._relatedLayer.objectIdField]]=P[W];return P.length!==e.pagesDefinition.resultRecordCount&&(!v[n._findObjectId]||!1===v[n._findObjectId].exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=l+P.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,P.length})()}_getFeatures(e,t,r,n){var l=this;return(0,S.A)(function*(){const s=[];-1!==t&&void 0===l._featureCache[t]&&s.push(t);const d=l._maxQueryRate();if(!0===l._checkIfNeedToExpandKnownPage(e,d))return yield l._expandPagedSet(e,d,0,0,n),l._getFeatures(e,t,r,n);let i=0;for(let I=e._lastFetchedIndex;I<e._known.length&&(i++,i<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[I]&&void 0===l._featureCache[e._known[I]]&&(e._known[I]!==t&&s.push(e._known[I]),s.length>r)))&&!(i>=r&&0===s.length);I++);if(0===s.length)return"success";throw new F.dr(F.D_.MissingFeatures)})()}_refineSetBlock(e,t,r){return(0,S.A)(function*(){return e})()}_stat(e,t,r,n,l,s,d){return(0,S.A)(function*(){return{calculated:!1}})()}get gdbVersion(){return this._relatedLayer.gdbVersion}_canDoAggregates(e,t,r,n,l){return(0,S.A)(function*(){return!1})()}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(e,t,r,n,l){return this._relatedLayer.queryAttachments(e,t,r,n,l)}getFeatureByObjectId(e,t){return this._relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeZone(){return this._relatedLayer?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._relatedLayer?.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._relatedLayer?.datesInUnknownTimezone}get editFieldsInfo(){return this._relatedLayer?.editFieldsInfo??null}get timeInfo(){return this._relatedLayer?.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,S.A)(function*(){return e.fsetInfo??e._layer.featureSetInfo})()}}var X=f(89812),Ee=f(55098),ze=f(95478),Ye=f(46577);function Xe(){null===X.A.applicationCache&&(X.A.applicationCache=new X.A)}function ye(D,e){return ge.apply(this,arguments)}function ge(){return(ge=(0,S.A)(function*(D,e){if(X.A.applicationCache){const t=X.A.applicationCache.getLayerInfo(D);if(t){const l=yield t;return new ie.default({url:D,outFields:e,sourceJSON:l})}const r=new ie.default({url:D,outFields:e}),n=(0,S.A)(function*(){return yield r.load(),r.sourceJSON})();if(X.A.applicationCache){X.A.applicationCache.setLayerInfo(D,n);try{return yield n,r}catch(l){throw X.A.applicationCache.clearLayerInfo(D),l}}return yield n,r}return new ie.default({url:D,outFields:e})})).apply(this,arguments)}function me(D,e,t,r,n){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,S.A)(function*(D,e,t,r,n,l=null){return ne(yield ye(D,["*"]),e,t,r,n,l)})).apply(this,arguments)}function ne(D,e=null,t=null,r=!0,n=null,l=null){if("catalog-footprint"===D.type)return ne(D.parent,e,t,r,n,l);if("subtype-sublayer"===D.type){const s=ne(D.parent,e,t,r,n,l);return s.filter(T.WhereClause.create(D.parent.subtypeField+"="+D.subtypeCode.toString(),D.parent.fieldsIndex,s.dateFieldsTimeZoneDefaultUTC))}if((0,g.NI)(D)){const s={layer:D,spatialReference:e,outFields:t,includeGeometry:r,lrucache:n,interceptor:l};return D.url||!D.source?new de(s):new Ve.A(s)}throw new Error(`Unsupported layer type: ${D.type}`)}function Ie(){return(Ie=(0,S.A)(function*(D){if(null!==X.A.applicationCache){const t=X.A.applicationCache.getLayerInfo(D);if(null!==t)return t}const e=(0,S.A)(function*(){const t=yield(0,z.A)(D,{responseType:"json",query:{f:"json"}});return t.data?t.data:null})();if(null!==X.A.applicationCache){X.A.applicationCache.setLayerInfo(D,e);try{return yield e}catch(t){throw X.A.applicationCache.clearLayerInfo(D),t}}return e})).apply(this,arguments)}function Se(){return(Se=(0,S.A)(function*(D,e){const t="QUERYDATAELEMTS:"+e.toString()+":"+D;if(null!==X.A.applicationCache){const n=X.A.applicationCache.getLayerInfo(t);if(null!==n)return n}const r=(0,S.A)(function*(){const n=yield(0,z.A)(D+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([e.toString()]),f:"json"}});if(n.data){const l=n.data;if(l.layerDataElements?.[0])return l.layerDataElements[0]}throw new F.dr(F.D_.DataElementsNotFound)})();if(null!==X.A.applicationCache){X.A.applicationCache.setLayerInfo(t,r);try{return yield r}catch(n){throw X.A.applicationCache.clearLayerInfo(t),n}}return r})).apply(this,arguments)}function xe(D){return Ae.apply(this,arguments)}function Ae(){return(Ae=(0,S.A)(function*(D){if(null!==X.A.applicationCache){const t=X.A.applicationCache.getLayerInfo(D);if(null!==t)return t}const e=(0,S.A)(function*(){const t=yield(0,z.A)(D,{responseType:"json",query:{f:"json"}});if(t.data){const r=t.data;return r.layers||(r.layers=[]),r.tables||(r.tables=[]),r}return{layers:[],tables:[]}})();if(null!==X.A.applicationCache){X.A.applicationCache.setLayerInfo(D,e);try{return yield e}catch(t){throw X.A.applicationCache.clearLayerInfo(D),t}}return e})).apply(this,arguments)}function He(D,e){return ve.apply(this,arguments)}function ve(){return ve=(0,S.A)(function*(D,e){const t={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},r=yield xe(D);if(t.metadata=r,void 0!==r.controllerDatasetLayers?.utilityNetworkLayerId&&null!==r.controllerDatasetLayers.utilityNetworkLayerId){if(r.layers)for(const s of r.layers)t.layerNameLkp[s.id]=s.name;if(r.tables)for(const s of r.tables)t.layerNameLkp[s.id]=s.name;const n=r.controllerDatasetLayers.utilityNetworkLayerId;t.networkId=n;const l=yield function $e(D,e){return Se.apply(this,arguments)}(D,n);if(l){t.queryelem=l,t.queryelem?.dataElement&&void 0!==t.queryelem.dataElement.schemaGeneration&&(t.unVersion=t.queryelem.dataElement.schemaGeneration),t.lkp={},t.queryelem.dataElement.domainNetworks||(t.queryelem.dataElement.domainNetworks=[]);for(const d of t.queryelem.dataElement.domainNetworks){for(const i of d.edgeSources??[]){const I={layerId:i.layerId,sourceId:i.sourceId,className:t.layerNameLkp[i.layerId]??null};I.className&&(t.lkp[I.className]=I)}for(const i of d.junctionSources??[]){const I={layerId:i.layerId,sourceId:i.sourceId,className:t.layerNameLkp[i.layerId]??null};I.className&&(t.lkp[I.className]=I)}}if(t.queryelem.dataElement.terminalConfigurations)for(const d of t.queryelem.dataElement.terminalConfigurations)for(const i of d.terminals)t.terminals.push({terminalId:i.terminalId,terminalName:i.terminalName});const s=yield function qe(D){return Ie.apply(this,arguments)}(D+"/"+n);if(void 0!==s.systemLayers?.associationsTableId&&null!==s.systemLayers.associationsTableId){const d=[];t.unVersion>=4&&(d.push("STATUS"),d.push("PERCENTALONG"));let i=yield me(D+"/"+s.systemLayers.associationsTableId.toString(),e,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...d],!1,null,null);return yield i.load(),t.unVersion>=4&&(i=i.filter(T.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62, 63)",i.getFieldsIndex(),i.dateFieldsTimeZoneDefaultUTC)),yield i.load()),{lkp:t.lkp,associations:i,unVersion:t.unVersion,terminals:t.terminals}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}),ve.apply(this,arguments)}function et(D,e,t){return De.apply(this,arguments)}function De(){return(De=(0,S.A)(function*(D,e,t,r=null,n=null,l=!0,s=null,d=null){let i=D.serviceUrl();if(!i)return null;i="/"===i.charAt(i.length-1)?i+e.relatedTableId.toString():i+"/"+e.relatedTableId.toString();const I=yield me(i,r,n,l,s,d);return new Je({layer:D,relatedLayer:I,relationship:e,objectId:t,spatialReference:r,outFields:n,includeGeometry:l,lrucache:s,interceptor:d})})).apply(this,arguments)}L.A.registerAction(),Z.registerAction(),C.A.registerAction(),U.A.registerAction(),E.A.registerAction();class tt extends Q{constructor(e,t=null,r=null,n=null){super(),this._map=e,this._overridespref=t,this._lrucache=r,this._interceptor=n,this._instantLayers=[]}_makeAndAddFeatureSet(e,t=!0,r=null){const n=ne(e,this._overridespref,null===r?["*"]:r,t,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}featureSetByName(e,t=!0,r=null){var n=this;return(0,S.A)(function*(){if(Ee.A.isLoadable(n._map)&&!n._map.loaded)return yield n._map.load(),n.featureSetByName(e,t,r);null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let d=0;d<n._instantLayers.length;d++){const i=n._instantLayers[d];if(i.opitem.title===e&&i.includeGeometry===t&&i.outFields===l)return n._instantLayers[d].featureset}const s=n._map.allLayers.find(d=>(0,g.eB)(d)&&d.title===e);if(null!=s)return n._makeAndAddFeatureSet(s,t,r);if(n._map.tables){const d=n._map.tables.find(i=>i.title===e);if(null!=d){if(d instanceof ie.default)return n._makeAndAddFeatureSet(d,t,r);if(null==d._materializedTable){const i=d.outFields?d:{...d,outFields:["*"]};d._materializedTable=new ie.default(i)}return yield d._materializedTable.load(),n._makeAndAddFeatureSet(d._materializedTable,t,r)}}return null})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,S.A)(function*(){if(Ee.A.isLoadable(n._map)&&!n._map.loaded)return yield n._map.load(),n.featureSetById(e,t,r);null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let d=0;d<n._instantLayers.length;d++){const i=n._instantLayers[d];if(i.opitem.id===e&&i.includeGeometry===t&&i.outFields===l)return n._instantLayers[d].featureset}const s=n._map.allLayers.find(d=>(0,g.eB)(d)&&d.id===e);if(s)return n._makeAndAddFeatureSet(s,t,r);if(n._map.tables){const d=n._map.tables.find(i=>i.id===e);if(null!=d){if(d instanceof ie.default)return n._makeAndAddFeatureSet(d,t,r);if(null==d._materializedTable){const i={...d,outFields:["*"]};d._materializedTable=new ie.default(i)}return yield d._materializedTable.load(),n._makeAndAddFeatureSet(d._materializedTable,t,r)}}return null})()}}class Ce extends Q{constructor(e,t=null,r=null,n=null){super(),this._url=e,this._overridespref=t,this._lrucache=r,this._interceptor=n,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(e,t=!0,r=null){const n=ne(e,this._overridespref,null===r?["*"]:r,t,this._lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}_loadMetaData(){var e=this;return(0,S.A)(function*(){const t=yield xe(e._url);return e.metadata=t,t})()}load(){return this._loadMetaData()}clone(){return new Ce(this._url,this._overridespref,this._lrucache,this._interceptor)}featureSetByName(e,t=!0,r=null){var n=this;return(0,S.A)(function*(){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let i=0;i<n._instantLayers.length;i++){const I=n._instantLayers[i];if(I.opitem.title===e&&I.includeGeometry===t&&I.outFields===l)return n._instantLayers[i].featureset}const s=yield n._loadMetaData();let d=null;for(const i of s.layers??[])i.name===e&&(d=i);if(!d)for(const i of s.tables??[])i.name===e&&(d=i);if(d){const i=yield ye(n._url+"/"+d.id,["*"]);return n._makeAndAddFeatureSet(i,t,r)}return null})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,S.A)(function*(){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);e=null!=e?e.toString():"";for(let i=0;i<n._instantLayers.length;i++){const I=n._instantLayers[i];if(I.opitem.id===e&&I.includeGeometry===t&&I.outFields===l)return n._instantLayers[i].featureset}const s=yield n._loadMetaData();let d=null;for(const i of s.layers??[])null!=i.id&&i.id.toString()===e&&(d=i);if(!d)for(const i of s.tables??[])null!=i.id&&i.id.toString()===e&&(d=i);if(d){const i=yield ye(n._url+"/"+d.id,["*"]);return n._makeAndAddFeatureSet(i,t,r)}return null})()}}function rt(D,e,t=null,r=null){return new tt(D,e,t,r)}function nt(D,e,t=null,r=null){return new Ce(D,e,t,r)}function st(D,e,t,r,n){if(null===D)return null;if((0,N.u)(D)){switch(e){case"datasource":return D.getDataSourceFeatureSet();case"parent":return D;case"root":return D.getRootFeatureSet()}return null}if(D instanceof ze.A&&(0,g.NI)(D)){const l=D;switch(e){case"datasource":return ne(l,n,l.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return ne(l,n,l.outFields,!0,t,r)}return null}if((0,N.$)(D)){switch(e){case"datasource":return ne(D.parent,n,D.parent.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return ne(D,n,D.parent.outFields,!0,t,r)}return null}return null}function it(D,e,t,r,n,l,s){return we.apply(this,arguments)}function we(){return(we=(0,S.A)(function*(D,e,t,r,n,l,s,d=null){if(X.A.applicationCache){const I=X.A.applicationCache.getLayerInfo(D+":"+l.url);if(I){const v=yield I;return ne(new ie.default({url:(0,g.Qi)(v.url)+"/"+e,outFields:["*"]}),t,r,n,s,d)}}const i=new Ye.default({id:D,portal:l}).load();X.A.applicationCache&&X.A.applicationCache.setLayerInfo(D+":"+l.url,i);try{const I=yield i;return ne(new ie.default({url:(0,g.Qi)(I.url??"")+"/"+e,outFields:["*"]}),t,r,n,s,d)}catch(I){throw X.A.applicationCache&&X.A.applicationCache.clearLayerInfo(D+":"+l.url),I}})).apply(this,arguments)}},36455:(te,q,f)=>{f.d(q,{Gr:()=>T,IO:()=>g,a:()=>O,bV:()=>h,p8:()=>b});var S=f(10467),z=f(81098),Q=f(73446),N=f(31033),L=f(85922),k=f(71505),M=f(7981),C=f(97089),F=f(11432),R=f(40013),x=f(32034);class A{constructor(p){this.field=p,this.sqlRewritable=!1}postInitialization(p,u){}}class g extends A{constructor(p){super(p),this.sqlRewritable=!0}extractValue(p){return p.attributes[this.field.name]}rewriteSql(p){return{rewritten:this.sqlRewritable,where:p}}}class b extends A{constructor(p,u,m){super((0,M.ke)(p)),this.originalField=p,this.sqlRewritable=!0,this.field.name=u,this.field.alias=m}rewriteSql(p,u){return{rewritten:this.sqlRewritable,where:(0,C.bD)(p,this.field.name,this.originalField.name,u.getFieldsIndex())}}extractValue(p){return p.attributes[this.originalField.name]}}let h=(()=>{class w extends A{constructor(u,m,c){super(u),this.codefield=m,this.lkp=c,this.reverseLkp={};for(const _ in c)this.reverseLkp[c[_]]=_;this.sqlRewritable=!0}rewriteSql(u,m){const c=this.evaluateNodeToWhereClause(u.parseTree,M.zl.Standardised,this.field.name,this.codefield instanceof R.WhereClause?(0,C.YY)(this.codefield,M.zl.Standardised):this.codefield,u.parameters);return c.includes(w.BADNESS)?{rewritten:!1,where:u}:{rewritten:this.sqlRewritable,where:R.WhereClause.create(c,m._parent.getFieldsIndex(),m.dateFieldsTimeZoneDefaultUTC)}}evaluateNodeToWhereClause(u,m,c=null,_=null,y){let B,G,Z,U;switch(u.type){case"interval":return(0,C.oj)(this.evaluateNodeToWhereClause(u.value,m,c,_,y),u.qualifier,u.op);case"case-expression":{let E=" CASE ";"simple"===u.format&&(E+=this.evaluateNodeToWhereClause(u.operand,m,c,w.BADNESS,y));for(let K=0;K<u.clauses.length;K++)E+=" WHEN "+this.evaluateNodeToWhereClause(u.clauses[K].operand,m,c,w.BADNESS,y)+" THEN "+this.evaluateNodeToWhereClause(u.clauses[K].value,m,c,w.BADNESS,y);return null!==u.else&&(E+=" ELSE "+this.evaluateNodeToWhereClause(u.else,m,c,w.BADNESS,y)),E+=" END ",E}case"parameter":{const E=y[u.value.toLowerCase()];if("string"==typeof E)return"'"+E.toString().replaceAll("'","''")+"'";if((0,M.$P)(E)||(0,M.Lk)(E))return(0,C.bm)(E,m);if((0,M.eg)(E))return(0,C.F1)(E,m);if((0,M.rX)(E))return(0,C.R8)(E,m);if((0,M.f0)(E))return(0,C.Nf)(E,m);if(Array.isArray(E)){const K=[];for(let V=0;V<E.length;V++)"string"==typeof E[V]?K.push("'"+E[V].toString().replaceAll("'","''")+"'"):(0,M.$P)(E[V])||(0,M.Lk)(E[V])?K.push((0,C.bm)(E[V],m)):(0,M.eg)(E[V])?K.push((0,C.F1)(E[V],m)):(0,M.rX)(E[V])?K.push((0,C.R8)(E[V],m)):(0,M.f0)(E[V])?K.push((0,C.Nf)(E[V],m)):K.push(E[V].toString());return K}return E.toString()}case"expression-list":G=[];for(const E of u.value)G.push(this.evaluateNodeToWhereClause(E,m,c,_,y));return G;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(u.expr,m,c,w.BADNESS,y)+" ) ";case"binary-expression":switch(u.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" AND "+this.evaluateNodeToWhereClause(u.right,m,c,_,y)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" OR "+this.evaluateNodeToWhereClause(u.right,m,c,_,y)+") ";case"IS":if("null"!==u.right.type)throw new N.L8(N.Z7.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" IS NULL )";case"ISNOT":if("null"!==u.right.type)throw new N.L8(N.Z7.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" IS NOT NULL )";case"IN":if(B=[],"expression-list"===u.right.type){if("column-reference"===u.left.type&&u.left.column.toUpperCase()===this.field.name.toUpperCase()){const E=[];let K=!0;for(const V of u.right.value){if("string"!==V.type){K=!1;break}if(void 0===this.lkp[V.value]){K=!1;break}E.push(this.lkp[V.value].toString())}if(K)return" ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" IN ("+E.join(",")+")) "}return B=this.evaluateNodeToWhereClause(u.right,m,c,_,y)," ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" IN ("+B.join(",")+")) "}return U=this.evaluateNodeToWhereClause(u.right,m,c,_,y),Array.isArray(U)?" ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" IN ("+U.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" IN ("+U+")) ";case"NOT IN":if(B=[],"expression-list"===u.right.type){if("column-reference"===u.left.type&&u.left.column.toUpperCase()===this.field.name.toUpperCase()){const E=[];let K=!0;for(const V of u.right.value){if("string"!==V.type){K=!1;break}if(void 0===this.lkp[V.value]){K=!1;break}E.push(this.lkp[V.value].toString())}if(K)return" ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" NOT IN ("+E.join(",")+")) "}return B=this.evaluateNodeToWhereClause(u.right,m,c,_,y)," ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" NOT IN ("+B.join(",")+")) "}return U=this.evaluateNodeToWhereClause(u.right,m,c,_,y),Array.isArray(U)?" ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" NOT IN ("+U.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(u.left,m,c,_,y)+" NOT IN ("+U+")) ";case"BETWEEN":return Z=this.evaluateNodeToWhereClause(u.right,m,c,w.BADNESS,y)," ("+this.evaluateNodeToWhereClause(u.left,m,c,w.BADNESS,y)+" BETWEEN "+Z[0]+" AND "+Z[1]+" ) ";case"NOTBETWEEN":return Z=this.evaluateNodeToWhereClause(u.right,m,c,w.BADNESS,y)," ("+this.evaluateNodeToWhereClause(u.left,m,c,w.BADNESS,y)+" NOT BETWEEN "+Z[0]+" AND "+Z[1]+" ) ";case"LIKE":return""!==u.escape?" ("+this.evaluateNodeToWhereClause(u.left,m,c,w.BADNESS,y)+" LIKE "+this.evaluateNodeToWhereClause(u.right,m,c,w.BADNESS,y)+" ESCAPE '"+u.escape+"') ":" ("+this.evaluateNodeToWhereClause(u.left,m,c,w.BADNESS,y)+" LIKE "+this.evaluateNodeToWhereClause(u.right,m,c,w.BADNESS,y)+") ";case"NOT LIKE":return""!==u.escape?" ("+this.evaluateNodeToWhereClause(u.left,m,c,w.BADNESS,y)+" NOT LIKE "+this.evaluateNodeToWhereClause(u.right,m,c,w.BADNESS,y)+" ESCAPE '"+u.escape+"') ":" ("+this.evaluateNodeToWhereClause(u.left,m,c,w.BADNESS,y)+" NOT LIKE "+this.evaluateNodeToWhereClause(u.right,m,c,w.BADNESS,y)+") ";case"<>":case"=":if("column-reference"===u.left.type&&"string"===u.right.type){if(u.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[u.right.value.toString()])return" ("+_+" "+u.operator+" "+this.lkp[u.right.value.toString()].toString()+") "}else if("column-reference"===u.right.type&&"string"===u.left.type&&u.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[u.right.value.toString()].toString()+" "+u.operator+" "+_+") ";return" ("+this.evaluateNodeToWhereClause(u.left,m,c,w.BADNESS,y)+" "+u.operator+" "+this.evaluateNodeToWhereClause(u.right,m,c,w.BADNESS,y)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(u.left,m,c,w.BADNESS,y)+" "+u.operator+" "+this.evaluateNodeToWhereClause(u.right,m,c,w.BADNESS,y)+") "}case"null":return"null";case"boolean":return!0===u.value?"1":"0";case"string":return"'"+u.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${u.value}'`;case"date":return`date '${u.value}'`;case"time":return`time '${u.value}'`;case"number":return u.value.toString();case"current-time":return(0,C.C6)("date"===u.mode,m);case"column-reference":return c&&c.toLowerCase()===u.column.toLowerCase()?"("+_+")":u.column;case"data-type":return u.value;case"function":{const E=this.evaluateNodeToWhereClause(u.args,m,c,w.BADNESS,y);return(0,C.F6)(u.name,E,m)}}throw new N.L8(N.Z7.UnsupportedSyntax,{node:u.type})}extractValue(u){return this.codefield instanceof R.WhereClause?this.reverseLkp[R.WhereClause.convertValueToStorageFormat(this.codefield.calculateValueCompiled(u))]:this.reverseLkp[u.attributes[this.codefield]]}}return w.BADNESS="_!!!_BAD_LKP_!!!!",w})();class T extends A{constructor(p,u){super(p),this._sql=u}rewriteSql(p,u){return{rewritten:!0,where:(0,C.bD)(p,this.field.name,(0,C.YY)(this._sql,M.zl.Standardised),u.getFieldsIndex())}}extractValue(p){return R.WhereClause.convertValueToStorageFormat(this._sql.calculateValueCompiled(p),this.field.type)}}class O extends L.A{static findField(p,u){for(const m of p)if(m.name.toLowerCase()===u.toString().toLowerCase())return m;return null}constructor(p){super(p),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=p.extraFilter,this._parent=p.parentfeatureset,this._maxProcessing=30,this.adaptedFields=p.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new x.A({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=M.ik.point,this.typeIdField="",this.types=null,this.subtypeField=null,this.subtypes=null),this.fields=[];for(const p of this.adaptedFields)p.postInitialization(this,this._parent),this.fields.push(p.field)}_getSet(p){var u=this;return(0,S.A)(function*(){if(null===u._wset){yield u._ensureLoaded();let m=null;return m=u._extraFilter?yield u._getFilteredSet("",null,null,null,p):yield u._parent?._getSet(p),u._checkCancelled(p),(0,F.Lw)(m),u._wset=new k.A(m._candidates.slice(0),m._known.slice(0),m._ordered,u._clonePageDefinition(m.pagesDefinition)),u._wset}return u._wset})()}_isInFeatureSet(p){return this._parent._isInFeatureSet(p)}_getFeatures(p,u,m,c){var _=this;return(0,S.A)(function*(){const y=[];-1!==u&&void 0===_._featureCache[u]&&y.push(u);const B=_._maxQueryRate();if(!0===_._checkIfNeedToExpandKnownPage(p,B))return yield _._expandPagedSet(p,B,0,0,c),_._getFeatures(p,u,m,c);let G=0;for(let E=p._lastFetchedIndex;E<p._known.length&&(G++,G<=m&&(p._lastFetchedIndex+=1),!(void 0===_._featureCache[p._known[E]]&&(p._known[E]!==u&&y.push(p._known[E]),y.length>=B)));E++);if(0===y.length)return"success";p=new k.A([],y,p._ordered,null);const Z=Math.min(y.length,m);yield _._parent?._getFeatures(p,-1,Z,c),_._checkCancelled(c);const U=[];for(let E=0;E<Z;E++){const K=_._parent?._featureFromCache(y[E]);void 0!==K&&U.push({geometry:K.geometry,attributes:K.attributes,id:y[E]})}for(const E of U){const K=[];for(const V of _.adaptedFields)K[V.field.name]=V.extractValue(E);_._featureCache[E.id]=new z.A({attributes:K,geometry:(0,Q.Yq)(E.geometry)})}return"success"})()}_fetchAndRefineFeatures(){return(0,S.A)(function*(){throw new N.dr(N.D_.NeverReach)})()}_getFilteredSet(p,u,m,c,_){var y=this;return(0,S.A)(function*(){let B=!1;const G=y._reformulateWithoutAdaptions(m);B=G.cannot,m=G.where;let Z=!1;if(null!==c){Z=!0;const K=[];for(const V of y.adaptedFields)if(!(V instanceof g)&&!0===c.scanForField(V.field.name)){if(!(V instanceof b)){c=null,Z=!1;break}K.push({field:V.field.name,newfield:V.originalField.name})}c&&K.length>0&&(c=c.replaceFields(K))}null!==m?null!==y._extraFilter&&(m=(0,C.kg)(y._extraFilter,m)):m=y._extraFilter,yield y._ensureLoaded();const U=yield y._parent._getFilteredSet(p,u,m,c,_);let E;return y._checkCancelled(_),E=!0===B?new k.A(U._candidates.slice(0).concat(U._known.slice(0)),[],!0===Z&&U._ordered,y._clonePageDefinition(U.pagesDefinition)):new k.A(U._candidates.slice(0),U._known.slice(0),!0===Z&&U._ordered,y._clonePageDefinition(U.pagesDefinition)),E})()}_reformulateWithoutAdaptions(p){const u={cannot:!1,where:p};if(null!==p)for(const m of this.adaptedFields)if(!0===(0,C.Ju)(p,m.field.name)){const c=m.rewriteSql(p,this);if(!0!==c.rewritten){u.cannot=!0,u.where=null;break}u.where=c.where}return u}_stat(p,u,m,c,_,y,B){var G=this;return(0,S.A)(function*(){let Z=!1,U=G._reformulateWithoutAdaptions(u);if(Z=U.cannot,u=U.where,U=G._reformulateWithoutAdaptions(_),Z=Z||U.cannot,null!==(_=U.where)?null!==G._extraFilter&&(_=(0,C.kg)(G._extraFilter,_)):_=G._extraFilter,!0===Z)return null===_&&""===m&&null===c?G._manualStat(p,u,y,B):{calculated:!1};const E=yield G._parent._stat(p,u,m,c,_,y,B);return!1===E.calculated?null===_&&""===m&&null===c?G._manualStat(p,u,y,B):{calculated:!1}:E})()}_canDoAggregates(p,u,m,c,_){var y=this;return(0,S.A)(function*(){if(null===y._parent)return!1;for(let Z=0;Z<p.length;Z++)for(const U of y.adaptedFields)if(p[Z].toLowerCase()===U.field.name.toLowerCase()&&!(U instanceof g))return!1;const B=[];for(let Z=0;Z<u.length;Z++){const U=u[Z];if(null!==U.workingexpr){const E=y._reformulateWithoutAdaptions(U.workingexpr);if(E.cannot)return!1;const K=U.clone();K.workingexpr=E.where,B.push(K)}else B.push(U)}const G=y._reformulateWithoutAdaptions(_);return!G.cannot&&(null!==(_=G.where)?null!==y._extraFilter&&(_=(0,C.kg)(y._extraFilter,_)):_=y._extraFilter,y._parent._canDoAggregates(p,B,m,c,_))})()}_getAggregatePagesDataSourceDefinition(p,u,m,c,_,y,B){var G=this;return(0,S.A)(function*(){if(null===G._parent)throw new N.dr(N.D_.NeverReach);const Z=[];for(let E=0;E<u.length;E++){const K=u[E];if(null!==K.workingexpr){const V=G._reformulateWithoutAdaptions(K.workingexpr);if(V.cannot)throw new N.dr(N.D_.NeverReach);const oe=K.clone();oe.workingexpr=V.where,Z.push(oe)}else Z.push(K)}const U=G._reformulateWithoutAdaptions(_);if(U.cannot)throw new N.dr(N.D_.NeverReach);return null!==(_=U.where)?null!==G._extraFilter&&(_=(0,C.kg)(G._extraFilter,_)):_=G._extraFilter,G._parent._getAggregatePagesDataSourceDefinition(p,Z,m,c,_,y,B)})()}}},888:(te,q,f)=>{f.d(q,{A:()=>R});var S=f(10467),z=f(31033),Q=f(85922),N=f(71505),L=f(7981),k=f(97089),M=f(56492),C=f(40013),F=f(32034);class R extends Q.A{constructor(A){super(A),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=A.parentfeatureset,A.whereclause instanceof C.WhereClause?(this._whereclause=A.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=A.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types,this.subtypeField=this._parent.subtypeField,this.subtypes=this._parent.subtypes):(this.fields=[],this.typeIdField="",this.subtypeField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new F.A({wkid:4326}),this.geometryType=L.ik.point)}_getSet(A){var g=this;return(0,S.A)(function*(){if(null===g._wset){yield g._ensureLoaded();const b=yield g._parent._getFilteredSet("",null,g._whereclause,null,A);return g._checkCancelled(A),g._wset=null!==g._whereClauseFunction?new N.A(b._candidates.slice(0).concat(b._known.slice(0)),[],b._ordered,g._clonePageDefinition(b.pagesDefinition)):new N.A(b._candidates.slice(0),b._known.slice(0),b._ordered,g._clonePageDefinition(b.pagesDefinition)),g._wset}return g._wset})()}_isInFeatureSet(A){let g=this._parent?._isInFeatureSet(A);return g===L.J6.NotInFeatureSet?g:(g=this._idstates[A],void 0===g?L.J6.Unknown:g)}_getFeature(A,g,b){return this._parent._getFeature(A,g,b)}_getFeatures(A,g,b,h){return this._parent._getFeatures(A,g,b,h)}_featureFromCache(A){return this._parent._featureFromCache(A)}executeWhereClause(A){return this._whereclause?.testFeature(A)??!1}executeWhereClauseDeferred(A){var g=this;return(0,S.A)(function*(){if(null!==g._whereClauseFunction){const b=g._whereClauseFunction(A);return(0,M.$X)(b),b}return g.executeWhereClause(A)})()}_fetchAndRefineFeatures(A,g,b){var h=this;return(0,S.A)(function*(){const T=new N.A([],A,!1,null),O=Math.min(g,A.length);if(yield h._parent?._getFeatures(T,-1,O,b),h._checkCancelled(b),null==h._whereClauseFunction){for(let p=0;p<O;p++){const u=h._parent?._featureFromCache(A[p]);h._idstates[A[p]]=!0===h.executeWhereClause(u)?L.J6.InFeatureSet:L.J6.NotInFeatureSet}return"success"}const w=[];for(let p=0;p<O;p++){const u=h._parent?._featureFromCache(A[p]);w.push(yield h.executeWhereClauseDeferred(u))}for(let p=0;p<g;p++)h._idstates[A[p]]=!0===w[p]?L.J6.InFeatureSet:L.J6.NotInFeatureSet;return"success"})()}_getFilteredSet(A,g,b,h,T){var O=this;return(0,S.A)(function*(){null!==O._whereClauseFunction||(null!==b?null!==O._whereclause&&(b=(0,k.kg)(O._whereclause,b)):b=O._whereclause),yield O._ensureLoaded();const w=yield O._parent._getFilteredSet(A,g,b,h,T);let p;return O._checkCancelled(T),p=null!==O._whereClauseFunction?new N.A(w._candidates.slice(0).concat(w._known.slice(0)),[],w._ordered,O._clonePageDefinition(w.pagesDefinition)):new N.A(w._candidates.slice(0),w._known.slice(0),w._ordered,O._clonePageDefinition(w.pagesDefinition)),p})()}_stat(A,g,b,h,T,O,w){var p=this;return(0,S.A)(function*(){if(null!==p._whereClauseFunction)return null===T&&""===b&&null===h?p._manualStat(A,g,O,w):{calculated:!1};let u=p._whereclause;null!==T&&null!==p._whereclause&&(u=(0,k.kg)(p._whereclause,T));const m=yield p._parent._stat(A,g,b,h,u,O,w);return!1===m.calculated?null===T&&""===b&&null===h?p._manualStat(A,g,O,w):{calculated:!1}:m})()}_canDoAggregates(A,g,b,h,T){var O=this;return(0,S.A)(function*(){return null===O._whereClauseFunction&&(null!==T?null!==O._whereclause&&(T=(0,k.kg)(O._whereclause,T)):T=O._whereclause,null!==O._parent&&O._parent._canDoAggregates(A,g,b,h,T))})()}_getAggregatePagesDataSourceDefinition(A,g,b,h,T,O,w){var p=this;return(0,S.A)(function*(){if(null===p._parent)throw new z.dr(z.D_.NeverReach);return null!==T?null!==p._whereclause&&(T=(0,k.kg)(p._whereclause,T)):T=p._whereclause,p._parent._getAggregatePagesDataSourceDefinition(A,g,b,h,T,O,w)})()}static registerAction(){Q.A._featuresetFunctions.filter=function(A){if("function"==typeof A)return new R({parentfeatureset:this,whereclause:A});let g=null;return A instanceof C.WhereClause&&(g=A),new R({parentfeatureset:this,whereclause:g})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},93571:(te,q,f)=>{f.d(q,{A:()=>M});var S=f(10467),z=f(42686),Q=f(31033),N=f(85922),L=f(71505),k=f(58314);class M extends N.A{constructor(F){super(F),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=F.orderbyclause,this._parent=F.parentfeatureset}_getSet(F){var R=this;return(0,S.A)(function*(){if(null===R._wset){yield R._ensureLoaded();const x=yield R._getFilteredSet("",null,null,R._orderbyclause,F);return R._checkCancelled(F),R._wset=x,R._wset}return R._wset})()}manualOrderSet(F,R){var x=this;return(0,S.A)(function*(){const A=yield x.getIdColumnDictionary(F,[],-1,R);x._orderbyclause?.order(A);const g=new L.A([],[],!0,null);for(let b=0;b<A.length;b++)g._known.push(A[b].id);return g})()}getIdColumnDictionary(F,R,x,A){var g=this;return(0,S.A)(function*(){if(x<F._known.length-1){const b=g._maxQueryRate();if("GETPAGES"===F._known[x+1])return yield(0,z.a0)(g._parent._expandPagedSet(F,b,0,0,A)),g.getIdColumnDictionary(F,R,x,A);let h=x+1;const T=[];for(;h<F._known.length&&"GETPAGES"!==F._known[h];)T.push(F._known[h]),h++;x+=T.length;const O=yield(0,z.a0)(g._parent._getFeatureBatch(T,A));g._checkCancelled(A);for(const w of O)R.push({id:w.attributes[g.objectIdField],feature:w});return g.getIdColumnDictionary(F,R,x,A)}return F._candidates.length>0?(yield(0,z.a0)(g._refineSetBlock(F,g._maxProcessingRate(),A)),g._checkCancelled(A),g.getIdColumnDictionary(F,R,x,A)):R})()}_isInFeatureSet(F){return this._parent._isInFeatureSet(F)}_getFeatures(F,R,x,A){return this._parent._getFeatures(F,R,x,A)}_featureFromCache(F){if(void 0===this._featureCache[F]){const R=this._parent._featureFromCache(F);return void 0===R?void 0:null===R?null:(this._featureCache[F]=R,R)}return this._featureCache[F]}_fetchAndRefineFeatures(){return(0,S.A)(function*(){throw new Q.dr(Q.D_.NeverReach)})()}_getFilteredSet(F,R,x,A,g){var b=this;return(0,S.A)(function*(){yield b._ensureLoaded();const h=yield b._parent._getFilteredSet(F,R,x,null===A?b._orderbyclause:A,g);b._checkCancelled(g);const T=new L.A(h._candidates.slice(0),h._known.slice(0),h._ordered,b._clonePageDefinition(h.pagesDefinition));let O=!0;if(h._candidates.length>0&&(O=!1),!1===T._ordered){let w=yield b.manualOrderSet(T,g);return!1===O&&(null===R&&null===x||(w=new L.A(w._candidates.slice(0).concat(w._known.slice(0)),[],w._ordered,b._clonePageDefinition(w.pagesDefinition)))),w}return T})()}static registerAction(){N.A._featuresetFunctions.orderBy=function(F){return""===F?this:new M({parentfeatureset:this,orderbyclause:new k.A(F)})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},53437:(te,q,f)=>{f.d(q,{A:()=>k});var S=f(10467),z=f(31033),Q=f(85922),N=f(71505),L=f(7981);class k extends Q.A{constructor(C){super(C),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=C.topnum,this._parent=C.parentfeatureset}_getSet(C){var F=this;return(0,S.A)(function*(){if(null===F._wset){yield F._ensureLoaded();const R=yield F._parent._getSet(C);return F._wset=new N.A(R._candidates.slice(0),R._known.slice(0),!1,F._clonePageDefinition(R.pagesDefinition)),F._setKnownLength(F._wset)>F._topnum&&(F._wset._known=F._wset._known.slice(0,F._topnum)),F._setKnownLength(F._wset)>=F._topnum&&(F._wset._candidates=[]),F._wset}return F._wset})()}_setKnownLength(C){return C._known.length>0&&"GETPAGES"===C._known[C._known.length-1]?C._known.length-1:C._known.length}_isInFeatureSet(C){const F=this._parent._isInFeatureSet(C);if(F===L.J6.NotInFeatureSet)return F;const R=this._idstates[C];return R===L.J6.InFeatureSet||R===L.J6.NotInFeatureSet?R:F===L.J6.InFeatureSet&&void 0===R?this._countedin<this._topnum?(this._idstates[C]=L.J6.InFeatureSet,this._countedin++,L.J6.InFeatureSet):(this._idstates[C]=L.J6.NotInFeatureSet,L.J6.NotInFeatureSet):L.J6.Unknown}_expandPagedSet(C,F,R,x,A){var g=this;return(0,S.A)(function*(){if(null===g._parent)throw new z.dr(z.D_.NotImplemented);if(F>g._topnum&&(F=g._topnum),g._countedin>=g._topnum&&C.pagesDefinition.internal.set.length<=C.pagesDefinition.resultOffset){let h=C._known.length;return h>0&&"GETPAGES"===C._known[h-1]&&(C._known.length=h-1),h=C._candidates.length,h>0&&"GETPAGES"===C._candidates[h-1]&&(C._candidates.length=h-1),"success"}const b=yield g._parent._expandPagedSet(C,F,R,x,A);return g._setKnownLength(C)>g._topnum&&(C._known.length=g._topnum),g._setKnownLength(C)>=g._topnum&&(C._candidates.length=0),b})()}_getFeatures(C,F,R,x){var A=this;return(0,S.A)(function*(){const g=[],b=A._maxQueryRate();if(!0===A._checkIfNeedToExpandKnownPage(C,b))return yield A._expandPagedSet(C,b,0,0,x),A._getFeatures(C,F,R,x);-1!==F&&void 0===A._featureCache[F]&&g.push(F);let h=0;for(let w=C._lastFetchedIndex;w<C._known.length&&(h++,h<=R&&(C._lastFetchedIndex+=1),!(void 0===A._featureCache[C._known[w]]&&(C._known[w]!==F&&g.push(C._known[w]),g.length>b)));w++);if(0===g.length)return"success";const T=new N.A([],g,!1,null),O=Math.min(g.length,R);yield A._parent._getFeatures(T,-1,O,x);for(let w=0;w<O;w++){const p=A._parent._featureFromCache(g[w]);void 0!==p&&(A._featureCache[g[w]]=p)}return"success"})()}_getFilteredSet(C,F,R,x,A){var g=this;return(0,S.A)(function*(){yield g._ensureLoaded();const b=yield g._getSet(A);return new N.A(b._candidates.slice(0).concat(b._known.slice(0)),[],!1,g._clonePageDefinition(b.pagesDefinition))})()}_refineKnowns(C,F){let R=0,x=null;const A=[];for(let g=0;g<C._candidates.length;g++){const b=this._isInFeatureSet(C._candidates[g]);if(b===L.J6.InFeatureSet){if(C._known.push(C._candidates[g]),R+=1,null===x?x={start:g,end:g}:x.end===g-1?x.end=g:(A.push(x),x={start:g,end:g}),C._known.length>=this._topnum)break}else if(b===L.J6.NotInFeatureSet)null===x?x={start:g,end:g}:x.end===g-1?x.end=g:(A.push(x),x={start:g,end:g}),R+=1;else if(b===L.J6.Unknown)break;if(R>=F)break}null!==x&&A.push(x);for(let g=A.length-1;g>=0;g--)C._candidates.splice(A[g].start,A[g].end-A[g].start+1);this._setKnownLength(C)>this._topnum&&(C._known=C._known.slice(0,this._topnum)),this._setKnownLength(C)>=this._topnum&&(C._candidates=[])}_stat(){return(0,S.A)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,S.A)(function*(){return!1})()}static registerAction(){Q.A._featuresetFunctions.top=function(C){return new k({parentfeatureset:this,topnum:C})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},6491:(te,q,f)=>{f.d(q,{A:()=>g});var S=f(10467),z=f(81098),Q=f(31033),N=f(85922),L=f(71505),k=f(7981),M=f(97089),C=f(68643),F=f(35940),R=f(47063),x=f(29141),A=f(87086);class g extends N.A{constructor(h){super(h),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,h.spatialReference&&(this.spatialReference=h.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=h.layer,this._wset=null,!0===h.isTable&&(this._forceIsTable=!0),void 0!==h.outFields&&(this._overrideFields=h.outFields),void 0!==h.includeGeometry&&(this._removeGeometry=!1===h.includeGeometry)}_maxQueryRate(){return k.gO}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var h=this;return(0,S.A)(function*(){return!0===h._layer.loaded?(h._initialiseFeatureSet(),h):(yield h._layer.load(),h._initialiseFeatureSet(),h)})()}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const h=[],T=[];for(const O of this.fields)if("oid"===O.type)h.push(O),T.push(O.name);else for(const w of this._overrideFields)if(w.toLowerCase()===O.name.toLowerCase()){h.push(O),T.push(O.name);break}this.fields=h,this._overrideFields=T}this.objectIdField=this._layer.objectIdField;for(const h of this.fields)"global-id"===h.type&&(this.globalIdField=h.name);this._databaseType=k.zl.Standardised,this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,"subtype-group"===this._layer.type?(this.subtypeField=this._layer.subtypeField??"",this.subtypes=this._layer.subtypes,this.types=null,this.typeIdField=null):"oriented-imagery"===this._layer.type?(this.subtypeField=null,this.subtypes=null,this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types):(this.subtypeField=this._layer.subtypeField,this.subtypes=this._layer.subtypes,this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types)}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return k.J6.InFeatureSet}_candidateIdTransform(h){return h}_getSet(h){var T=this;return(0,S.A)(function*(){if(null===T._wset){yield T._ensureLoaded();const O=yield T._getFilteredSet("",null,null,null,h);return T._wset=O,O}return T._wset})()}_changeFeature(h){const T={};for(const O of this.fields)T[O.name]=h.attributes[O.name];return new z.A({geometry:!0===this._removeGeometry?null:h.geometry,attributes:T})}_getFilteredSet(h,T,O,w,p){var u=this;return(0,S.A)(function*(){let m="",c=!1;if(null!==w&&(m=w.constructClause(),c=!0),u.isTable()&&T&&null!==h&&""!==h)return new L.A([],[],!0,null);const _=new A.A;_.returnZ=u.hasZ,_.returnM=u.hasM,_.where=null===O?null===T?"1=1":"":(0,M.YY)(O,k.zl.Standardised),_.spatialRelationship=u._makeRelationshipEnum(h),_.outSpatialReference=u.spatialReference,_.orderByFields=""!==m?m.split(","):null,_.geometry=null===T?null:T,_.returnGeometry=!0,_.relationParameter=u._makeRelationshipParam(h);const y=yield u._layer.queryFeatures(_);if(null===y)return new L.A([],[],c,null);u._checkCancelled(p);const B=[];return y.features.forEach(G=>{const Z=G.attributes[u._layer.objectIdField];B.push(Z),u._featureCache[Z]=u._changeFeature(G)}),new L.A([],B,c,null)})()}_makeRelationshipEnum(h){if(h.includes("esriSpatialRelRelation"))return"relation";switch(h){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return h}_makeRelationshipParam(h){return h.includes("esriSpatialRelRelation")?h.split(":")[1]:""}_queryAllFeatures(){var h=this;return(0,S.A)(function*(){if(h._wset)return h._wset;const T=new A.A;if(T.where="1=1",yield h._ensureLoaded(),h._layer.source&&h._layer.source.items){const p=[];return h._layer.source.items.forEach(u=>{const m=u.attributes[h._layer.objectIdField];p.push(m),h._featureCache[m]=h._changeFeature(u)}),h._wset=new L.A([],p,!1,null),h._wset}T.returnZ=h.hasZ,T.returnM=h.hasM;const O=yield h._layer.queryFeatures(T),w=[];return O.features.forEach(p=>{const u=p.attributes[h._layer.objectIdField];w.push(u),h._featureCache[u]=h._changeFeature(p)}),h._wset=new L.A([],w,!1,null),h._wset})()}_getFeatures(h,T,O){var w=this;return(0,S.A)(function*(){const p=[];-1!==T&&void 0===w._featureCache[T]&&p.push(T);for(let u=h._lastFetchedIndex;u<h._known.length&&(h._lastFetchedIndex+=1,!(void 0===w._featureCache[h._known[u]]&&(h._known[u]!==T&&p.push(h._known[u]),p.length>O)));u++);if(0===p.length)return"success";throw new Q.dr(Q.D_.MissingFeatures)})()}_refineSetBlock(h){return(0,S.A)(function*(){return h})()}_stat(){return(0,S.A)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,S.A)(function*(){return!1})()}relationshipMetaData(){return[]}static _cloneAttr(h){const T={};for(const O in h)T[O]=h[O];return T}nativeCapabilities(){return{title:this._layer.title??"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(h,T){let O=h.layerDefinition.objectIdField;const w=h.layerDefinition.typeIdField??"",p=[];if(h.layerDefinition.types)for(const U of h.layerDefinition.types)p.push(R.A.fromJSON(U));let u=h.layerDefinition.geometryType;void 0===u&&(u=h.featureSet.geometryType||"");let m=h.featureSet.features;const c=T.toJSON();if(!O){let U=!1;for(const E of h.layerDefinition.fields)if("oid"===E.type||"esriFieldTypeOID"===E.type){O=E.name,U=!0;break}if(!1===U){let E="FID",K=!0,V=0;for(;K;){let re=!0;for(const ce of h.layerDefinition.fields)if(ce.name===E){re=!1;break}!0===re?K=!1:(V++,E="FID"+V.toString())}h.layerDefinition.fields.push({type:"esriFieldTypeOID",name:E,alias:E});const oe=[];for(let re=0;re<m.length;re++)oe.push({geometry:h.featureSet.features[re].geometry,attributes:h.featureSet.features[re].attributes?this._cloneAttr(h.featureSet.features[re].attributes):{}}),oe[re].attributes[E]=re;m=oe,O=E}}const _=[];for(const U of h.layerDefinition.fields)_.push(U instanceof x.A?U:x.A.fromJSON(U));let y=u;switch(y||(y=""),y){case"esriGeometryPoint":y="point";break;case"esriGeometryPolyline":y="polyline";break;case"esriGeometryPolygon":y="polygon";break;case"esriGeometryEnvelope":y="extent";break;case"esriGeometryMultipoint":y="multipoint";break;case"":case"esriGeometryNull":y="esriGeometryNull"}if("esriGeometryNull"!==y)for(const U of m)U.geometry&&!(U.geometry instanceof C.A)&&(U.geometry.type=y,void 0===U.geometry.spatialReference&&(U.geometry.spatialReference=c));else for(const U of m)U.geometry&&(U.geometry=null);const B={outFields:["*"],source:m,fields:_,hasZ:!0===h?.layerDefinition?.hasZ||!0===h?.featureSet?.hasZ,hasM:!0===h?.layerDefinition?.hasM||!0===h?.featureSet?.hasM,types:p,typeIdField:w,objectIdField:O,spatialReference:T},G="esriGeometryNull"===y||null===y;G||(B.geometryType=y);const Z=new F.default(B);return h?.layerDefinition?.subtypeField&&h?.layerDefinition?.subtypes&&Z.read({subtypes:h.layerDefinition.subtypes,subtypeField:h.layerDefinition.subtypeField}),new g({layer:Z,spatialReference:T,isTable:G})}queryAttachments(){return(0,S.A)(function*(){return[]})()}getFeatureByObjectId(h){var T=this;return(0,S.A)(function*(){const O=new A.A;O.where=T.objectIdField+"="+h.toString(),O.returnZ=T.hasZ,O.returnM=T.hasM;const w=yield T._layer.queryFeatures(O);return 1===w.features.length?w.features[0]:null})()}getOwningSystemUrl(){return(0,S.A)(function*(){return""})()}getIdentityUser(){return(0,S.A)(function*(){return""})()}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone??!1}get editFieldsInfo(){return this._layer.editFieldsInfo}get timeInfo(){return this._layer?.timeInfo}getFeatureSetInfo(){var h=this;return(0,S.A)(function*(){const T=h._layer.title&&h._layer.parent;return h.fsetInfo??{layerId:null,layerName:null,itemId:null,serviceLayerUrl:null,webMapLayerId:T?h._layer.id??null:null,webMapLayerTitle:T?h._layer.title??null:null,className:null,objectClassId:null}})()}}},58314:(te,q,f)=>{function S(Q,N){return Q===N?0:null===Q?-1:null===N?1:Q<N?-1:1}f.d(q,{A:()=>z});class z{constructor(N){const L=N.split(",");this._fields=[],this._directions=[];for(let k=0;k<L.length;k++){const M=L[k].match(/\S+/g);this._fields.push(M[0]),2===M.length?"asc"===M[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let N="";for(let L=0;L<this._fields.length;L++)0!==L&&(N+=","),N+=this._fields[L],N+=1===this._directions[L]?" ASC":" DESC";return N}order(N){N.sort((L,k)=>{for(let M=0;M<this._fields.length;M++){const C=this.featureValue(L.feature,this._fields[M],M),F=this.featureValue(k.feature,this._fields[M],M);let R=0;if(R=1===this._directions[M]?S(C,F):-1*S(C,F),0!==R)return R}return 0})}scanForField(N){for(let L=0;L<this._fields.length;L++)if(this._fields[L].toLowerCase().trim()===N.toLowerCase().trim())return!0;return!1}replaceFields(N){let L="";for(let k=0;k<this._fields.length;k++){0!==k&&(L+=",");let M=this._fields[k];for(const C of N)if(M.toLowerCase()===C.field.toLowerCase()){M=C.newfield;break}L+=M,L+=1===this._directions[k]?" ASC":" DESC"}return new z(L)}featureValue(N,L,k){const M=N.attributes[L];if(void 0!==M)return M;for(const C in N.attributes)if(L.toLowerCase()===C.toLowerCase())return this._fields[k]=C,N.attributes[C];return null}}},6829:(te,q,f)=>{f.d(q,{E1:()=>M,Fm:()=>C,JZ:()=>w,R_:()=>k,fu:()=>z,oF:()=>Q,rq:()=>F});const S=[["binary","application/octet-stream","bin",""]];function z(p,u){return null!=g(u.name,p?.supportedFormats??[])}function Q(p,u){if(!p)return!1;const m=F(u,p.supportedFormats??[]);return null!=m&&p.editFormats.includes(m)}function k(p,u){return b(function A(p,u){const m=p.toLowerCase();return R(u).find(c=>h(c)===m)}(p,u))}function M(p,u){return b(g(p,u))}function C(p,u){return h(function x(p,u){return R(u).find(m=>b(m)===p)}(p,u))}function F(p,u){return M(p.name,u)??k(p.type,u)}function R(p){return[...S,...p]}function g(p,u){const m=p.toLowerCase();return R(u).find(c=>function T(p){return p?.[2].split(",").map(u=>u.toLowerCase())??[]}(c).some(_=>m.endsWith(_)))}function b(p){return p?.[0]}function h(p){return p?.[1].toLowerCase()}function w(p){return p.tables?.find(u=>"assetMaps"===u.role)}},33063:(te,q,f)=>{f.d(q,{I:()=>L});var S=f(10467),z=f(68800),Q=f(1277),N=f(87086);function L(M,C,F){return k.apply(this,arguments)}function k(){return(k=(0,S.A)(function*(M,C,F){const R=(0,z.Dl)(M),{data:x}=yield(0,Q.gW)(R,N.A.from(C),F);return x.count})).apply(this,arguments)}},87342:(te,q,f)=>{f.d(q,{V:()=>L});var S=f(10467),z=f(68800),Q=f(1277),N=f(87086);function L(M,C,F){return k.apply(this,arguments)}function k(){return(k=(0,S.A)(function*(M,C,F){const R=(0,z.Dl)(M),{data:x}=yield(0,Q.Pk)(R,N.A.from(C),F);return x.objectIds})).apply(this,arguments)}},34687:(te,q,f)=>{f.d(q,{e:()=>C,s:()=>k});var S=f(10467),z=f(68800),Q=f(1277),N=f(93327),L=f(87086);function k(R,x,A){return M.apply(this,arguments)}function M(){return(M=(0,S.A)(function*(R,x,A){const g=yield C(R,x,A);return N.A.fromJSON(g)})).apply(this,arguments)}function C(R,x,A){return F.apply(this,arguments)}function F(){return(F=(0,S.A)(function*(R,x,A){const g=(0,z.Dl)(R),b={...A},h=L.A.from(x),{data:T}=yield(0,Q.eW)(g,h,h.sourceSpatialReference,b);return T})).apply(this,arguments)}},11170:(te,q,f)=>{f.d(q,{S:()=>p});var S=f(10467),z=f(68800),Q=f(11432),N=f(23743),L=f(31732);function k(m,c){return c}function M(m,c,_,y){switch(_){case 0:return x(m,c+y,0);case 1:return"lowerLeft"===m.originPosition?x(m,c+y,1):function A({translate:m,scale:c},_,y){return m[y]-_*c[y]}(m,c+y,1)}}function C(m,c,_,y){return 2===_?x(m,c,2):M(m,c,_,y)}function F(m,c,_,y){return 2===_?0===c?0:x(m,c,3):M(m,c,_,y)}function R(m,c,_,y){return 3===_?0===c?0:x(m,c,3):C(m,c,_,y)}function x({translate:m,scale:c},_,y){return m[y]+_*c[y]}class g{constructor(c){this._options=c,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=k,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(c){if(this._options.applyTransform&&(c.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!c.hasZ)return;const _=(0,N.N)(c.geometryType,this._options.sourceSpatialReference,c.spatialReference);if(null!=_)for(const y of c.features)_(y.geometry)}createSpatialReference(){return{}}addField(c,_){const y=c.fields;(0,Q.Lw)(y),y.push(_);const B=y.map(G=>G.name);this._attributesConstructor=function(){for(const G of B)this[G]=null}}addFeature(c,_){c.features.push(_)}prepareFeatures(c){switch(this._transform=c.transform,this._options.applyTransform&&c.transform&&(this._applyTransform=this._deriveApplyTransform(c)),this._mValueOffset=null,this._vertexDimension=2,c.hasZ&&this._vertexDimension++,c.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),c.geometryType){case"esriGeometryPoint":this.addCoordinate=(_,y,B)=>this.addCoordinatePoint(_,y,B),this.createGeometry=_=>this.createPointGeometry(_);break;case"esriGeometryPolygon":this.addCoordinate=(_,y,B)=>this._addCoordinatePolygon(_,y,B),this.createGeometry=_=>this._createPolygonGeometry(_);break;case"esriGeometryPolyline":this.addCoordinate=(_,y,B)=>this._addCoordinatePolyline(_,y,B),this.createGeometry=_=>this._createPolylineGeometry(_);break;case"esriGeometryMultipoint":this.addCoordinate=(_,y,B)=>this._addCoordinateMultipoint(_,y,B),this.createGeometry=_=>this._createMultipointGeometry(_)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(c,_,y){0===this._lengths.length&&(this._toAddInCurrentPath=_),this._lengths.push(_)}addQueryGeometry(c,_){const{queryGeometry:y,queryGeometryType:B}=_,G=(0,L.Ch)(y.clone(),y,!1,!1,this._transform),Z=(0,L.zv)(G,B,!1,!1);c.queryGeometryType=B,c.queryGeometry={...Z}}createPointGeometry(c){const _={x:0,y:0,spatialReference:c.spatialReference};return c.hasZ&&(_.z=0),c.hasM&&(_.m=0),_}addCoordinatePoint(c,_,y){switch(_=this._applyTransform(this._transform,_,y,0),y){case 0:c.x=_;break;case 1:c.y=_;break;case 2:"z"in c?c.z=_:c.m=_;break;case 3:c.m=_}}_transformPathLikeValue(c,_){let y=0;return _<=1&&(y=this._previousCoordinate[_],this._previousCoordinate[_]+=c),null===this._mValueOffset||0!==c||_%this._mValueOffset?this._applyTransform(this._transform,c,_,y):0}_addCoordinatePolyline(c,_,y){this._dehydratedAddPointsCoordinate(c.paths,_,y)}_addCoordinatePolygon(c,_,y){this._dehydratedAddPointsCoordinate(c.rings,_,y)}_addCoordinateMultipoint(c,_,y){0===y&&c.points.push([]);const B=this._transformPathLikeValue(_,y);c.points[c.points.length-1].push(B)}_createPolygonGeometry(c){return{rings:[[]],spatialReference:c.spatialReference,hasZ:!!c.hasZ,hasM:!!c.hasM}}_createPolylineGeometry(c){return{paths:[[]],spatialReference:c.spatialReference,hasZ:!!c.hasZ,hasM:!!c.hasM}}_createMultipointGeometry(c){return{points:[],spatialReference:c.spatialReference,hasZ:!!c.hasZ,hasM:!!c.hasM}}_dehydratedAddPointsCoordinate(c,_,y){0===y&&0==this._toAddInCurrentPath--&&(c.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const B=this._transformPathLikeValue(_,y),G=c[c.length-1];0===y&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),G.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=B}_deriveApplyTransform(c){const{hasZ:_,hasM:y}=c;return _&&y?R:_?C:y?F:M}}var b=f(1277),T=(f(93327),f(87086));function p(m,c,_){return u.apply(this,arguments)}function u(){return(u=(0,S.A)(function*(m,c,_){const y=(0,z.Dl)(m),B={..._},G=T.A.from(c),Z=!G.quantizationParameters,{data:U}=yield(0,b.IJ)(y,G,new g({sourceSpatialReference:G.sourceSpatialReference,applyTransform:Z}),B);return U})).apply(this,arguments)}},70994:(te,q,f)=>{f.d(q,{A:()=>g});var R,S=f(8189),z=f(71065),Q=f(85211),N=f(55739),M=(f(40707),f(3248),f(76576));const x={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let A=R=class extends z.oY{constructor(b){super(b),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:b}=this,h=function C(b){const{exifInfo:h,exifName:T,tagName:O}=b;if(!h||!T||!O)return null;const w=h.find(p=>p.name===T);return w?function F(b){const{tagName:h,tags:T}=b;return T&&h&&T.find(w=>w.name===h)?.value||null}({tagName:O,tags:w.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:b});return x[h]||null}clone(){return new R({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,S._)([(0,Q.MZ)({type:String})],A.prototype,"contentType",void 0),(0,S._)([(0,Q.MZ)()],A.prototype,"exifInfo",void 0),(0,S._)([(0,Q.MZ)({readOnly:!0})],A.prototype,"orientationInfo",null),(0,S._)([(0,Q.MZ)({type:N.jz})],A.prototype,"id",void 0),(0,S._)([(0,Q.MZ)({type:String})],A.prototype,"globalId",void 0),(0,S._)([(0,Q.MZ)({type:String})],A.prototype,"keywords",void 0),(0,S._)([(0,Q.MZ)({type:String})],A.prototype,"name",void 0),(0,S._)([(0,Q.MZ)({json:{read:!1}})],A.prototype,"parentGlobalId",void 0),(0,S._)([(0,Q.MZ)({json:{read:!1}})],A.prototype,"parentObjectId",void 0),(0,S._)([(0,Q.MZ)({type:N.jz})],A.prototype,"size",void 0),(0,S._)([(0,Q.MZ)({json:{read:!1}})],A.prototype,"url",void 0),A=R=(0,S._)([(0,M.$)("esri.rest.query.support.AttachmentInfo")],A);const g=A}}]);