"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[109],{13869:(I,R,_)=>{function m(w,i){const y=w.count;i||(i=new w.TypedArrayConstructor(y));for(let h=0;h<y;h++)i[h]=w.get(h);return i}_.d(R,{m:()=>m}),Object.freeze(Object.defineProperty({__proto__:null,makeDense:m},Symbol.toStringTag,{value:"Module"}))},23225:(I,R,_)=>{_.d(R,{a:()=>E,f:()=>i,n:()=>w});var m=_(79139);function E(h,a){w(h.typedBuffer,a.typedBuffer,h.typedBufferStride,a.typedBufferStride)}function w(h,a,d=2,b=d){const c=a.length/2;let s=0,f=0;if((0,m.cy)(a)||(0,m.dk)(a)){for(let T=0;T<c;++T)h[s]=a[f],h[s+1]=a[f+1],s+=d,f+=b;return}const p=(0,m.a3)(a);if((0,m.JI)(a))for(let T=0;T<c;++T)h[s]=Math.max(a[f]/p,-1),h[s+1]=Math.max(a[f+1]/p,-1),s+=d,f+=b;else for(let T=0;T<c;++T)h[s]=a[f]/p,h[s+1]=a[f+1]/p,s+=d,f+=b}function i(h,a,d,b){const c=h.typedBuffer,s=h.typedBufferStride,f=b?.count??h.count;let p=(b?.dstIndex??0)*s;for(let T=0;T<f;++T)c[p]=a,c[p+1]=d,p+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:i,normalizeIntegerBuffer:w,normalizeIntegerBufferView:E},Symbol.toStringTag,{value:"Module"}))},18201:(I,R,_)=>{function m(y,h){E(y.typedBuffer,h.typedBuffer,y.typedBufferStride,h.typedBufferStride)}function E(y,h,a=3,d=a){const b=h.length/d;let c=0,s=0;for(let f=0;f<b;++f)y[c]=h[s],y[c+1]=h[s+1],y[c+2]=h[s+2],c+=a,s+=d}function w(y,h,a,d,b){const c=y.typedBuffer,s=y.typedBufferStride,f=b?.count??y.count;let p=(b?.dstIndex??0)*s;for(let T=0;T<f;++T)c[p]=h,c[p+1]=a,c[p+2]=d,p+=s}_.d(R,{a:()=>m,c:()=>E,f:()=>w}),Object.freeze(Object.defineProperty({__proto__:null,copy:E,copyView:m,fill:w},Symbol.toStringTag,{value:"Module"}))},25590:(I,R,_)=>{function m(y,h){E(y.typedBuffer,h,y.typedBufferStride)}function E(y,h,a=4){const d=h.typedBuffer,b=h.typedBufferStride,c=h.count;let s=0,f=0;for(let p=0;p<c;++p)y[s]=d[f],y[s+1]=d[f+1],y[s+2]=d[f+2],y[s+3]=d[f+3],s+=a,f+=b}function w(y,h,a,d,b,c){const s=y.typedBuffer,f=y.typedBufferStride,p=c?.count??y.count;let T=(c?.dstIndex??0)*f;for(let x=0;x<p;++x)s[T]=h,s[T+1]=a,s[T+2]=d,s[T+3]=b,T+=f}_.d(R,{a:()=>m,c:()=>E,f:()=>w}),Object.freeze(Object.defineProperty({__proto__:null,copy:E,copyView:m,fill:w},Symbol.toStringTag,{value:"Module"}))},44703:(I,R,_)=>{function m(y){switch(y){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}_.d(R,{GJ:()=>m})},85303:(I,R,_)=>{_.d(R,{R:()=>a});var m=_(10467),E=_(89563),w=_(89447),i=_(5922),y=_(56492),h=_(45272);class a{constructor(c){this._streamDataRequester=c}loadJSON(c,s){var f=this;return(0,m.A)(function*(){return f._load("json",c,s)})()}loadBinary(c,s){var f=this;return(0,m.A)(function*(){return(0,h.DB)(c)?((0,y.Te)(s),(0,h.lJ)(c)):f._load("binary",c,s)})()}loadImage(c,s){var f=this;return(0,m.A)(function*(){return f._load("image",c,s)})()}_load(c,s,f){var p=this;return(0,m.A)(function*(){if(null==p._streamDataRequester)return(yield(0,E.A)(s,{responseType:d[c]})).data;const T=yield(0,w.Ke)(p._streamDataRequester.request(s,c,f));if(!0===T.ok)return T.value;throw(0,y.QP)(T.error),new i.A("",`Request for resource failed: ${T.error}`)})()}}const d={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},61362:(I,R,_)=>{_.d(R,{x:()=>i});var m=_(79139),E=_(83034),w=_(50915);function i(d,b){switch(b){case w.WR.TRIANGLES:return function y(d){return"number"==typeof d?(0,E.tM)(d):(0,m.mg)(d)?new Uint16Array(d):d}(d);case w.WR.TRIANGLE_STRIP:return function h(d){const b="number"==typeof d?d:d.length;if(b<3)return[];const c=b-2,s=(0,E.my)(3*c);if("number"==typeof d){let f=0;for(let p=0;p<c;p+=1)p%2==0?(s[f++]=p,s[f++]=p+1,s[f++]=p+2):(s[f++]=p+1,s[f++]=p,s[f++]=p+2)}else{let f=0;for(let p=0;p<c;p+=1)p%2==0?(s[f++]=d[p],s[f++]=d[p+1],s[f++]=d[p+2]):(s[f++]=d[p+1],s[f++]=d[p],s[f++]=d[p+2])}return s}(d);case w.WR.TRIANGLE_FAN:return function a(d){const b="number"==typeof d?d:d.length;if(b<3)return new Uint16Array(0);const c=b-2,s=c<=65536?new Uint16Array(3*c):new Uint32Array(3*c);if("number"==typeof d){let x=0;for(let N=0;N<c;++N)s[x++]=0,s[x++]=N+1,s[x++]=N+2;return s}const f=d[0];let p=d[1],T=0;for(let x=0;x<c;++x){const N=d[x+2];s[T++]=f,s[T++]=p,s[T++]=N,p=N}return s}(d)}}},39690:(I,R,_)=>{_.d(R,{KB:()=>h,Xi:()=>i,pn:()=>d,x3:()=>y});var m=_(10467),E=_(3248),w=_(67496);class i{constructor(s){this.data=s,this.type="encoded-mesh-texture",this.encoding=w.JS.KTX2_ENCODING}}function y(c){return"encoded-mesh-texture"===c?.type}function h(c){return a.apply(this,arguments)}function a(){return(a=(0,m.A)(function*(c){const s=new Blob([c]),f=yield s.text();return JSON.parse(f)})).apply(this,arguments)}function d(c,s){return b.apply(this,arguments)}function b(){return(b=(0,m.A)(function*(c,s){if(s===w.JS.KTX2_ENCODING)return new i(c);const f=new Blob([c],{type:s}),p=URL.createObjectURL(f),T=new Image;if((0,E.A)("esri-iPhone"))return new Promise((x,N)=>{const H=()=>{B(),x(T)},P=j=>{B(),N(j)},B=()=>{URL.revokeObjectURL(p),T.removeEventListener("load",H),T.removeEventListener("error",P)};T.addEventListener("load",H),T.addEventListener("error",P),T.src=p});try{T.src=p,yield T.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(p),T})).apply(this,arguments)}},52867:(I,R,_)=>{_.d(R,{y:()=>Te});var B,j,n,m=_(10467),E=_(35150),w=_(62789),i=_(50915),a=_(5922),d=_(60797),b=_(56492),c=_(45272),s=_(43420),f=_(92771),p=_(19890),T=_(14214),x=_(45434),N=_(13869);_(3248);class P{constructor(t){this._data=t,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const t=this._offset4;return this._offset4+=1,this._dataUint32[t]}readUint8Array(t){const r=4*this._offset4;return this._offset4+=t/4,new Uint8Array(this._data,r,t)}remainingBytes(){return this._data.byteLength-4*this._offset4}}(n=B||(B={})).SCALAR="SCALAR",n.VEC2="VEC2",n.VEC3="VEC3",n.VEC4="VEC4",n.MAT2="MAT2",n.MAT3="MAT3",n.MAT4="MAT4",function(n){n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(j||(j={}));var ne=_(69690);const z={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},oe={pbrMetallicRoughness:z,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},se={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},X=(n={})=>{const t={...z,...n.pbrMetallicRoughness},r=function ae(n){switch(n.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:(0,ne.Xb)(n.ESRI_externalColorMixMode),n.ESRI_externalColorMixMode="tint"}return n}({...se,...n.extras});return{...oe,...n,pbrMetallicRoughness:t,extras:r}},ie={magFilter:i.Cj.LINEAR,minFilter:i.Cj.LINEAR_MIPMAP_LINEAR,wrapS:i.pF.REPEAT,wrapT:i.pF.REPEAT};var G=_(39690);class L{constructor(t,r,o,e){if(this._context=t,this.uri=r,this.json=o,this._glbBuffer=e,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=function le(n){let t,r;return n.replace(/^(.*\/)?([^/]*)$/,(o,e,u)=>(t=e||"",r=u||"","")),{dirPart:t,filePart:r}}(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),null==o.scenes)throw new a.A("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==o.meshes)throw new a.A("gltf-loader-unsupported-feature","Meshes must be defined");if(null==o.nodes)throw new a.A("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static load(t,r,o){var e=this;return(0,m.A)(function*(){if((0,c.DB)(r)){const g=(0,c.r$)(r);if(g&&"model/gltf-binary"!==g.mediaType)try{const S=JSON.parse(g.isBase64?atob(g.data):g.data);return new L(t,r,S)}catch{}const v=(0,c.lJ)(r);if(L._isGLBData(v))return e._fromGLBData(t,r,v)}if(me.test(r)||"gltf"===o?.expectedType){const g=yield t.loadJSON(r,o);return new L(t,r,g)}const u=yield t.loadBinary(r,o);if(L._isGLBData(u))return e._fromGLBData(t,r,u);if(he.test(r)||"glb"===o?.expectedType)throw new a.A("gltf-loader-invalid-glb","This is not a valid glb file.");const l=yield t.loadJSON(r,o);return new L(t,r,l)})()}static _isGLBData(t){if(null==t)return!1;const r=new P(t);return r.remainingBytes()>=4&&1179937895===r.readUint32()}static _fromGLBData(t,r,o){return(0,m.A)(function*(){const e=yield L._parseGLBData(o);return new L(t,r,e.json,e.binaryData)})()}static _parseGLBData(t){return(0,m.A)(function*(){const r=new P(t);if(r.remainingBytes()<12)throw new a.A("gltf-loader-error","glb binary data is insufficiently large.");const o=r.readUint32(),e=r.readUint32(),u=r.readUint32();if(1179937895!==o)throw new a.A("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(t.byteLength<u)throw new a.A("gltf-loader-error","glb binary data is smaller than header specifies.");if(2!==e)throw new a.A("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let l,g,v=0;for(;r.remainingBytes()>=8;){const S=r.readUint32(),O=r.readUint32();if(0===v){if(1313821514!==O)throw new a.A("gltf-loader-error","First glb chunk must be JSON.");if(S<0)throw new a.A("gltf-loader-error","No JSON data found.");l=yield(0,G.KB)(r.readUint8Array(S))}else if(1===v){if(5130562!==O)throw new a.A("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");g=r.readUint8Array(S)}else E.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");v+=1}if(!l)throw new a.A("gltf-loader-error","No glb JSON chunk detected.");return{json:l,binaryData:g}})()}getBuffer(t,r){var o=this;return(0,m.A)(function*(){const e=o.json.buffers[t];if(null==e.uri){if(null==o._glbBuffer)throw new a.A("gltf-loader-error","glb buffer not present");return o._glbBuffer}const u=yield o._getBufferLoader(t,r);if(u.byteLength!==e.byteLength)throw new a.A("gltf-loader-error","Buffer byte lengths should match.");return u})()}_getBufferLoader(t,r){var o=this;return(0,m.A)(function*(){const e=o._bufferLoaders.get(t);if(e)return e;const l=o._context.loadBinary(o._resolveUri(o.json.buffers[t].uri),r).then(g=>new Uint8Array(g));return o._bufferLoaders.set(t,l),l})()}getAccessor(t,r){var o=this;return(0,m.A)(function*(){if(!o.json.accessors)throw new a.A("gltf-loader-unsupported-feature","Accessors missing.");const e=o.json.accessors[t];if(null==e?.bufferView)throw new a.A("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(e.type in[B.MAT2,B.MAT3,B.MAT4])throw new a.A("gltf-loader-unsupported-feature",`AttributeType ${e.type} is not supported`);const u=o.json.bufferViews[e.bufferView],l=yield o.getBuffer(u.buffer,r),g=de[e.type],v=pe[e.componentType],S=g*v,O=u.byteStride||S;return{raw:l.buffer,byteStride:O,byteOffset:l.byteOffset+(u.byteOffset||0)+(e.byteOffset||0),entryCount:e.count,isDenselyPacked:O===S,componentCount:g,componentByteSize:v,componentType:e.componentType,min:e.min,max:e.max,normalized:!!e.normalized}})()}getIndexData(t,r){var o=this;return(0,m.A)(function*(){if(null==t.indices)return;const e=yield o.getAccessor(t.indices,r);if(e.isDenselyPacked)switch(e.componentType){case i.pe.UNSIGNED_BYTE:return new Uint8Array(e.raw,e.byteOffset,e.entryCount);case i.pe.UNSIGNED_SHORT:return new Uint16Array(e.raw,e.byteOffset,e.entryCount);case i.pe.UNSIGNED_INT:return new Uint32Array(e.raw,e.byteOffset,e.entryCount)}else switch(e.componentType){case i.pe.UNSIGNED_BYTE:return(0,N.m)(C(x.SL,e));case i.pe.UNSIGNED_SHORT:return(0,N.m)(C(x.h,e));case i.pe.UNSIGNED_INT:return(0,N.m)(C(x.P,e))}})()}getPositionData(t,r){var o=this;return(0,m.A)(function*(){if(null==t.attributes.POSITION)throw new a.A("gltf-loader-unsupported-feature","No POSITION vertex data found.");const e=yield o.getAccessor(t.attributes.POSITION,r);if(e.componentType!==i.pe.FLOAT)throw new a.A("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+i.pe[e.componentType]);if(3!==e.componentCount)throw new a.A("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+e.componentCount.toFixed());return C(x.xs,e)})()}getNormalData(t,r){var o=this;return(0,m.A)(function*(){if(null==t.attributes.NORMAL)throw new a.A("gltf-loader-error","No NORMAL vertex data found.");const e=yield o.getAccessor(t.attributes.NORMAL,r);if(e.componentType!==i.pe.FLOAT)throw new a.A("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+i.pe[e.componentType]);if(3!==e.componentCount)throw new a.A("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+e.componentCount.toFixed());return C(x.xs,e)})()}getTangentData(t,r){var o=this;return(0,m.A)(function*(){if(null==t.attributes.TANGENT)throw new a.A("gltf-loader-error","No TANGENT vertex data found.");const e=yield o.getAccessor(t.attributes.TANGENT,r);if(e.componentType!==i.pe.FLOAT)throw new a.A("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+i.pe[e.componentType]);if(4!==e.componentCount)throw new a.A("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+e.componentCount.toFixed());return new x.Eq(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)})()}getTextureCoordinates(t,r){var o=this;return(0,m.A)(function*(){if(null==t.attributes.TEXCOORD_0)throw new a.A("gltf-loader-error","No TEXCOORD_0 vertex data found.");const e=yield o.getAccessor(t.attributes.TEXCOORD_0,r);if(2!==e.componentCount)throw new a.A("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+e.componentCount.toFixed());if(e.componentType===i.pe.FLOAT)return C(x.gH,e);if(!e.normalized)throw new a.A("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return function _e(n){switch(n.componentType){case i.pe.BYTE:return new x.D6(n.raw,n.byteOffset,n.byteStride,n.byteOffset+n.byteStride*n.entryCount);case i.pe.UNSIGNED_BYTE:return new x.LC(n.raw,n.byteOffset,n.byteStride,n.byteOffset+n.byteStride*n.entryCount);case i.pe.SHORT:return new x.mJ(n.raw,n.byteOffset,n.byteStride,n.byteOffset+n.byteStride*n.entryCount);case i.pe.UNSIGNED_SHORT:return new x.Yi(n.raw,n.byteOffset,n.byteStride,n.byteOffset+n.byteStride*n.entryCount);case i.pe.UNSIGNED_INT:return new x.An(n.raw,n.byteOffset,n.byteStride,n.byteOffset+n.byteStride*n.entryCount);case i.pe.FLOAT:return new x.gH(n.raw,n.byteOffset,n.byteStride,n.byteOffset+n.byteStride*n.entryCount)}}(e)})()}getVertexColors(t,r){var o=this;return(0,m.A)(function*(){if(null==t.attributes.COLOR_0)throw new a.A("gltf-loader-error","No COLOR_0 vertex data found.");const e=yield o.getAccessor(t.attributes.COLOR_0,r);if(4!==e.componentCount&&3!==e.componentCount)throw new a.A("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+e.componentCount.toFixed());if(4===e.componentCount){if(e.componentType===i.pe.FLOAT)return C(x.Eq,e);if(e.componentType===i.pe.UNSIGNED_BYTE)return C(x.XP,e);if(e.componentType===i.pe.UNSIGNED_SHORT)return C(x.Uz,e)}else if(3===e.componentCount){if(e.componentType===i.pe.FLOAT)return C(x.xs,e);if(e.componentType===i.pe.UNSIGNED_BYTE)return C(x.eI,e);if(e.componentType===i.pe.UNSIGNED_SHORT)return C(x.nS,e)}throw new a.A("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+i.pe[e.componentType])})()}hasPositions(t){return void 0!==t.attributes.POSITION}hasNormals(t){return void 0!==t.attributes.NORMAL}hasVertexColors(t){return void 0!==t.attributes.COLOR_0}hasTextureCoordinates(t){return void 0!==t.attributes.TEXCOORD_0}hasTangents(t){return void 0!==t.attributes.TANGENT}getMaterial(t,r,o){var e=this;return(0,m.A)(function*(){let u=t.material?e._materialCache.get(t.material):void 0;if(!u){const l=null!=t.material?X(e.json.materials[t.material]):X(),g=l.pbrMetallicRoughness,v=e.hasVertexColors(t),S=e.getTexture(g.baseColorTexture,r),O=e.getTexture(l.normalTexture,r),M=o?e.getTexture(l.occlusionTexture,r):void 0,A=o?e.getTexture(l.emissiveTexture,r):void 0,D=o?e.getTexture(g.metallicRoughnessTexture,r):void 0,U=null!=t.material?t.material:-1;u={alphaMode:l.alphaMode,alphaCutoff:l.alphaCutoff,color:g.baseColorFactor,doubleSided:!!l.doubleSided,colorTexture:yield S,normalTexture:yield O,name:l.name,id:U,occlusionTexture:yield M,emissiveTexture:yield A,emissiveFactor:l.emissiveFactor,metallicFactor:g.metallicFactor,roughnessFactor:g.roughnessFactor,metallicRoughnessTexture:yield D,hasVertexColors:v,ESRI_externalColorMixMode:l.extras.ESRI_externalColorMixMode,colorTextureTransform:g?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:l.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:l.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:l.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:g?.metallicRoughnessTexture?.extensions?.KHR_texture_transform,receiveAmbientOcclusion:l.extras.ESRI_receiveAmbientOcclusion,receiveShadows:l.extras.ESRI_receiveShadows}}return u})()}getTexture(t,r){var o=this;return(0,m.A)(function*(){if(!t)return;if(0!==(t.texCoord||0))throw new a.A("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const e=t.index,u=o.json.textures[e],l=(n=>({...ie,...n}))(null!=u.sampler?o.json.samplers[u.sampler]:{}),g=$(u),v=o.json.images[g],S=yield o._loadTextureImageData(e,u,r);return(0,d.tE)(o._textureCache,e,()=>{const O=A=>33071===A||33648===A||10497===A,M=A=>{throw new a.A("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${A}`)};return{data:S,wrapS:O(l.wrapS)?l.wrapS:M(l.wrapS),wrapT:O(l.wrapT)?l.wrapT:M(l.wrapT),minFilter:l.minFilter,name:v.name,id:e}})})()}getNodeTransform(t){if(void 0===t)return fe;let r=this._nodeTransformCache.get(t);if(!r){const o=this.getNodeTransform(this._getNodeParent(t)),e=this.json.nodes[t];e.matrix?r=(0,f.lw)((0,w.vt)(),o,e.matrix):e.translation||e.rotation||e.scale?(r=(0,w.o8)(o),e.translation&&(0,f.Tl)(r,r,e.translation),e.rotation&&(V[3]=(0,p.Xd)(V,e.rotation),(0,f.e$)(r,r,V[3],V)),e.scale&&(0,f.hs)(r,r,e.scale)):r=(0,w.o8)(o),this._nodeTransformCache.set(t,r)}return r}_resolveUri(t){return(0,c.s2)(t,this._baseUri)}_getNodeParent(t){return this._nodeParentMap.get(t)}_checkVersionSupported(){const t=s.R.parse(this.json.asset.version,"glTF");ce.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json;if(t.extensionsRequired&&!t.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new a.A("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,r)=>{t.children&&t.children.forEach(o=>{this._nodeParentMap.set(o,r)})})}_loadTextureImageData(t,r,o){var e=this;return(0,m.A)(function*(){const u=e._textureLoaders.get(t);if(u)return u;const l=e._createTextureLoader(r,o);return e._textureLoaders.set(t,l),l})()}_createTextureLoader(t,r){var o=this;return(0,m.A)(function*(){const e=$(t),u=o.json.images[e];if(u.uri){if(u.uri.endsWith(".ktx2")){const S=yield o._context.loadBinary(o._resolveUri(u.uri),r);return new G.Xi(new Uint8Array(S))}return o._context.loadImage(o._resolveUri(u.uri),r)}if(null==u.bufferView)throw new a.A("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==u.mimeType)throw new a.A("gltf-loader-unsupported-feature","Image mimeType must be defined.");const l=o.json.bufferViews[u.bufferView],g=yield o.getBuffer(l.buffer,r);if(null!=l.byteStride)throw new a.A("gltf-loader-unsupported-feature","byteStride not supported for image buffer");return(0,G.pn)(new Uint8Array(g.buffer,g.byteOffset+(l.byteOffset||0),l.byteLength),u.mimeType)})()}getLoadedBuffersSize(){var t=this;return(0,m.A)(function*(){if(t._glbBuffer)return t._glbBuffer.byteLength;const r=yield(0,b.nA)(Array.from(t._bufferLoaders.values())),o=yield(0,b.nA)(Array.from(t._textureLoaders.values()));return r.reduce((e,u)=>e+(u?.byteLength??0),0)+o.reduce((e,u)=>e+(u?(0,G.x3)(u)?u.data.byteLength:u.width*u.height*4:0),0)})()}}const fe=(0,f.hM)((0,w.vt)(),Math.PI/2),ce=new s.R(2,0,"glTF"),V=(0,T.vt)(),de={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pe={[i.pe.BYTE]:1,[i.pe.UNSIGNED_BYTE]:1,[i.pe.SHORT]:2,[i.pe.UNSIGNED_SHORT]:2,[i.pe.HALF_FLOAT]:2,[i.pe.FLOAT]:4,[i.pe.INT]:4,[i.pe.UNSIGNED_INT]:4};function C(n,t){return new n(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}function $(n){if(void 0!==n.extensions&&null!==n.extensions.KHR_texture_basisu)return n.extensions.KHR_texture_basisu.source;if(null!==n.source)return n.source;throw new a.A("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}const me=/\.gltf$/i,he=/\.glb$/i;let ye=0;function Te(n,t){return W.apply(this,arguments)}function W(){return W=(0,m.A)(function*(n,t,r={},o=!0){const e=yield L.load(n,t,r),u="gltf_"+ye++,l={lods:[],materials:new Map,textures:new Map,meta:ge(e)},g=!(!e.json.asset.extras||"symbolResource"!==e.json.asset.extras.ESRI_type),v=e.json.asset.extras?.ESRI_webstyleSymbol?.webstyle,S=new Map;yield function xe(n,t){return J.apply(this,arguments)}(e,function(){var M=(0,m.A)(function*(A,D,U,k){const Y=S.get(U)??0;S.set(U,Y+1);const F=void 0!==A.mode?A.mode:i.WR.TRIANGLES,Q=F===i.WR.TRIANGLES||F===i.WR.TRIANGLE_STRIP||F===i.WR.TRIANGLE_FAN?F:null;if(null==Q)return void E.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+i.WR[F]+"). Skipping primitive.");if(!e.hasPositions(A))return void E.A.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const Ee=e.getPositionData(A,r),ve=e.getMaterial(A,r,o),Z=e.hasNormals(A)?e.getNormalData(A,r):null,q=e.hasTangents(A)?e.getTangentData(A,r):null,ee=e.hasTextureCoordinates(A)?e.getTextureCoordinates(A,r):null,te=e.hasVertexColors(A)?e.getVertexColors(A,r):null,Se=e.getIndexData(A,r),Re={name:k,transform:(0,w.o8)(D),attributes:{position:yield Ee,normal:Z?yield Z:null,texCoord0:ee?yield ee:null,color:te?yield te:null,tangent:q?yield q:null},indices:yield Se,primitiveType:Q,material:Ae(l,yield ve,u)};let re=null;null!=l.meta?.ESRI_lod&&"screenSpaceRadius"===l.meta.ESRI_lod.metric&&(re=l.meta.ESRI_lod.thresholds[U]),l.lods[U]=l.lods[U]||{parts:[],name:k,lodThreshold:re},l.lods[U].parts[Y]=Re});return function(A,D,U,k){return M.apply(this,arguments)}}());for(const M of l.lods)M.parts=M.parts.filter(A=>!!A);const O=yield e.getLoadedBuffersSize();return{model:l,meta:{isEsriSymbolResource:g,uri:e.uri,ESRI_webstyle:v},customMeta:{},size:O}}),W.apply(this,arguments)}function ge(n){let r=null;return n.json.nodes.forEach(o=>{const e=o.extras;null!=e&&(e.ESRI_proxyEllipsoid||e.ESRI_lod)&&(r=e)}),r}function J(){return J=(0,m.A)(function*(n,t){const r=n.json,o=r.scenes[r.scene||0].nodes,e=o.length>1,u=[];for(const v of o){const S=r.nodes[v];u.push(l(v,0)),be(S)&&!e&&S.extensions.MSFT_lod.ids.forEach((O,M)=>l(O,M+1))}function l(v,S){return g.apply(this,arguments)}function g(){return(g=(0,m.A)(function*(v,S){const O=r.nodes[v],M=n.getNodeTransform(v);if(null!=O.weights&&E.A.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),null!=O.mesh){const A=r.meshes[O.mesh];for(const D of A.primitives)u.push(t(D,M,S,A.name))}for(const A of O.children||[])u.push(l(A,S))})).apply(this,arguments)}yield Promise.all(u)}),J.apply(this,arguments)}function be(n){return n.extensions?.MSFT_lod&&Array.isArray(n.extensions.MSFT_lod.ids)}function Ae(n,t,r){const o=u=>{const l=`${r}_tex_${u&&u.id}${u?.name?"_"+u.name:""}`;if(u&&!n.textures.has(l)){const g=function h(n,t={}){return{data:n,parameters:{wrap:{s:i.pF.REPEAT,t:i.pF.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}(u.data,{wrap:{s:u.wrapS,t:u.wrapT},mipmap:we.has(u.minFilter),noUnpackFlip:!0});n.textures.set(l,g)}return l},e=`${r}_mat_${t.id}_${t.name}`;if(!n.materials.has(e)){const u=function y(n={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...n}}({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?o(t.colorTexture):void 0,textureNormal:t.normalTexture?o(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?o(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?o(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?o(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform,metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor,receiveShadows:t.receiveShadows,receiveAmbientOcclustion:t.receiveAmbientOcclusion});n.materials.set(e,u)}return e}const we=new Set([i.Cj.LINEAR_MIPMAP_LINEAR,i.Cj.LINEAR_MIPMAP_NEAREST])},61605:(I,R,_)=>{_.d(R,{T:()=>m});const m=2.1}}]);