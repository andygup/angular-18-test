"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[1747,9557],{40856:(nt,Pe,A)=>{A.d(Pe,{X_:()=>he,i1:()=>U,zx:()=>J});var k=A(69287),_=A(82663);const de=96;function he(te,ue){const q=ue||te.extent,Q=te.width,V=(0,_.GA)(q?.spatialReference);return q&&Q?q.width/Q*V*_.dy*de:0}function U(te,ue){return te/((0,_.GA)(ue)*_.dy*de)}function J(te,ue,q){return function be(te,ue){return 0===ue||(0,k.Sp)(te,ue)||te<ue}(te,ue)&&function ge(te,ue){return 0===ue||(0,k.Sp)(te,ue)||te>ue}(te,q)}},42086:(nt,Pe,A)=>{A.d(Pe,{N3:()=>de,Om:()=>_});var k=A(13682);class _{constructor(I=null,me={},le,J){this.geometry=I,this.attributes=me,this.centroid=le,this.objectId=J,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(I,me){const le=I.geometry?k.A.fromJSON(I.geometry):null,J=I.centroid?k.A.fromJSON(I.centroid):null;return new _(le,I.attributes,J,I.attributes[me])}weakClone(){const I=new _(this.geometry,this.attributes,this.centroid,this.objectId);return I.displayId=this.displayId,I.geohashX=this.geohashX,I.geohashY=this.geohashY,I}clone(){const I=this.geometry?.clone(),me=new _(I,{...this.attributes},this.centroid?.clone(),this.objectId);return me.displayId=this.displayId,me.geohashX=this.geohashX,me.geohashY=this.geohashY,me}}function de(U){return!!U.geometry?.coords?.length}},61808:(nt,Pe,A)=>{A.d(Pe,{A:()=>k});class k{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const de=new k;return de.objectIdFieldName=this.objectIdFieldName,de.globalIdFieldName=this.globalIdFieldName,de.geohashFieldName=this.geohashFieldName,de.geometryProperties=this.geometryProperties,de.geometryType=this.geometryType,de.spatialReference=this.spatialReference,de.hasZ=this.hasZ,de.hasM=this.hasM,de.features=this.features,de.fields=this.fields,de.transform=this.transform,de.exceededTransferLimit=this.exceededTransferLimit,de.uniqueIdField=this.uniqueIdField,de.queryGeometry=this.queryGeometry,de.queryGeometryType=this.queryGeometryType,de}}},13682:(nt,Pe,A)=>{A.d(Pe,{A:()=>_});class _{constructor(he=[],U=[],I=!1){this.lengths=he??[],this.coords=U??[],this.hasIndeterminateRingOrder=I}static fromJSON(he){return new _(he.lengths,he.coords,he.hasIndeterminateRingOrder)}static fromRect(he){const[U,I,me,le]=he,J=me-U,be=le-I;return new _([5],[U,I,J,0,0,be,-J,0,0,-be])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((he,U)=>he+U)}forEachVertex(he){let U=0;this.lengths.length||he(this.coords[0],this.coords[1]);for(let I=0;I<this.lengths.length;I++){const me=this.lengths[I];for(let le=0;le<me;le++)he(this.coords[2*(le+U)],this.coords[2*(le+U)+1]);U+=me}}deltaDecode(){const he=this.clone(),{coords:U,lengths:I}=he;let me=0;for(const le of I){for(let J=1;J<le;J++)U[2*(me+J)]+=U[2*(me+J)-2],U[2*(me+J)+1]+=U[2*(me+J)-1];me+=le}return he}clone(he){if(0===this.lengths.length)return new _([],[this.coords[0],this.coords[1]]);const U=2*(0===this.lengths.length?1:this.lengths.reduce((me,le)=>me+le)),I=this.coords.slice(0,U);return he?(he.set(I),new _(this.lengths,he,this.hasIndeterminateRingOrder)):new _(Array.from(this.lengths),Array.from(I),this.hasIndeterminateRingOrder)}}},91515:(nt,Pe,A)=>{A.d(Pe,{GP:()=>ge,LI:()=>J,lc:()=>me,u5:()=>le}),A(13242);var _=A(68479);const de=/^-?(\d+)(\.(\d+))?$/i;function he(te,ue){return te-ue}function U(te,ue){let q,Q;return q=Number(te.toFixed(ue)),q<te?Q=q+1/10**ue:(Q=q,q-=1/10**ue),q=Number(q.toFixed(ue)),Q=Number(Q.toFixed(ue)),[q,Q]}function I(te,ue,q,Q,V){const D=le(te,ue,q,Q);return(null==D.previous||D.previous<=V)&&(null==D.next||D.next<=V)||D.previous+D.next<=2*V}function me(te){const ue=String(te),q=ue.match(de);if(q?.[1])return{integer:q[1].split("").length,fractional:q[3]?q[3].split("").length:0};if(ue.toLowerCase().includes("e")){const Q=ue.split("e"),V=Q[0],D=Q[1];if(V&&D){const x=Number(V);let T=Number(D);const G=T>0;G||(T=Math.abs(T));const O=me(x);return G?(O.integer+=T,T>O.fractional?O.fractional=0:O.fractional-=T):(O.fractional+=T,T>O.integer?O.integer=1:O.integer-=T),O}}return{integer:0,fractional:0}}function le(te,ue,q,Q){const V={previous:null,next:null};if(null!=q){const D=te-q;V.previous=Math.floor(Math.abs(100*(ue-q-D)/D))}if(null!=Q){const D=Q-te;V.next=Math.floor(Math.abs(100*(Q-ue-D)/D))}return V}function J(te,ue={}){const q=te.slice(0),{tolerance:Q=2,strictBounds:V=!1,indexes:D=q.map((x,T)=>T)}=ue;D.sort(he);for(let x=0;x<D.length;x++){const T=D[x],G=q[T],O=0===T?null:q[T-1],z=T===q.length-1?null:q[T+1],j=me(G).fractional;if(j){let se,re=0,xe=!1;for(;re<=j&&!xe;){const X=U(G,re);se=V&&0===x?X[1]:X[0],xe=I(G,se,O,z,Q),re++}xe&&(q[T]=se)}}return q}const be={maximumFractionDigits:20};function ge(te){return(0,_.ZV)(te,be)}},34687:(nt,Pe,A)=>{A.d(Pe,{e:()=>le,s:()=>I});var k=A(10467),_=A(68800),de=A(1277),he=A(93327),U=A(87086);function I(be,ge,te){return me.apply(this,arguments)}function me(){return(me=(0,k.A)(function*(be,ge,te){const ue=yield le(be,ge,te);return he.A.fromJSON(ue)})).apply(this,arguments)}function le(be,ge,te){return J.apply(this,arguments)}function J(){return(J=(0,k.A)(function*(be,ge,te){const ue=(0,_.Dl)(be),q={...te},Q=U.A.from(ge),{data:V}=yield(0,de.eW)(ue,Q,Q.sourceSpatialReference,q);return V})).apply(this,arguments)}},70994:(nt,Pe,A)=>{A.d(Pe,{A:()=>ue});var be,k=A(8189),_=A(71065),de=A(85211),he=A(55739),me=(A(40707),A(3248),A(76576));const ge={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let te=be=class extends _.oY{constructor(q){super(q),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:q}=this,Q=function le(q){const{exifInfo:Q,exifName:V,tagName:D}=q;if(!Q||!V||!D)return null;const x=Q.find(T=>T.name===V);return x?function J(q){const{tagName:Q,tags:V}=q;return V&&Q&&V.find(x=>x.name===Q)?.value||null}({tagName:D,tags:x.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:q});return ge[Q]||null}clone(){return new be({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,k._)([(0,de.MZ)({type:String})],te.prototype,"contentType",void 0),(0,k._)([(0,de.MZ)()],te.prototype,"exifInfo",void 0),(0,k._)([(0,de.MZ)({readOnly:!0})],te.prototype,"orientationInfo",null),(0,k._)([(0,de.MZ)({type:he.jz})],te.prototype,"id",void 0),(0,k._)([(0,de.MZ)({type:String})],te.prototype,"globalId",void 0),(0,k._)([(0,de.MZ)({type:String})],te.prototype,"keywords",void 0),(0,k._)([(0,de.MZ)({type:String})],te.prototype,"name",void 0),(0,k._)([(0,de.MZ)({json:{read:!1}})],te.prototype,"parentGlobalId",void 0),(0,k._)([(0,de.MZ)({json:{read:!1}})],te.prototype,"parentObjectId",void 0),(0,k._)([(0,de.MZ)({type:he.jz})],te.prototype,"size",void 0),(0,k._)([(0,de.MZ)({json:{read:!1}})],te.prototype,"url",void 0),te=be=(0,k._)([(0,me.$)("esri.rest.query.support.AttachmentInfo")],te);const ue=te},43039:(nt,Pe,A)=>{A.d(Pe,{fs:()=>q,i0:()=>xe});var k=A(48266),_=A(86300),U=(A(48218),A(71470),A(22639));function q(X){return(0,_.vE)(X)||(0,_.zD)(X)||(0,_.Ah)(X)}function xe(X,pe){const{format:ae,timeZoneOptions:Be,fieldType:Se}=pe??{};let Qe,ke;if(Be&&({timeZone:Qe,timeZoneName:ke}=(0,U.hv)(Be.layerTimeZone,Be.datesInUnknownTimezone,Be.viewTimeZone,(0,k.J2)(ae||"short-date-short-time"),Se)),"string"==typeof X&&isNaN(Date.parse("time-only"===Se?`1970-01-01T${X}Z`:X)))return X;switch(Se){case"date-only":{const He=(0,k.J2)(ae||"short-date");return"string"==typeof X?(0,k.iS)(X,{...He}):(0,k.Yq)(X,{...He,timeZone:U.n$})}case"time-only":{const He=(0,k.J2)(ae||"short-time");return"string"==typeof X?(0,k.F8)(X,He):(0,k.Yq)(X,{...He,timeZone:U.n$})}case"timestamp-offset":{if(!Qe&&"string"==typeof X&&new Date(X).toISOString()!==X)return X;const He=ae||Be?(0,k.J2)(ae||"short-date-short-time"):void 0,bt=He?{...He,timeZone:Qe,timeZoneName:ke}:void 0;return"string"==typeof X?(0,k.Ey)(X,bt):(0,k.Yq)(X,bt)}default:{const He=ae||Be?(0,k.J2)(ae||"short-date-short-time"):void 0;return(0,k.Yq)("string"==typeof X?new Date(X):X,He?{...He,timeZone:Qe,timeZoneName:ke}:void 0)}}}},76926:(nt,Pe,A)=>{A.d(Pe,{Fe:()=>ue,Nk:()=>be});var k=A(68677),_=A(32117);function be(x){const T=[];return ge((0,_.lW)(x),T),T.length?new k.A((0,_.e6)(T[0])):null}function ge(x,T){if(!x)return;let G;G="CIMTextSymbol"===x.type?x.symbol:x;const O="CIMPolygonSymbol"===x.type;if(G?.symbolLayers)for(const z of G.symbolLayers)if(!(z.colorLocked||O&&((0,_.mA)(z)||(0,_.MM)(z)&&z.markerPlacement&&(0,_.zr)(z.markerPlacement))))switch(z.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":z.tintColor&&te(T,z.tintColor);break;case"CIMVectorMarker":z.markerGraphics?.forEach(j=>{ge(j.symbol,T)});break;case"CIMSolidStroke":case"CIMSolidFill":te(T,z.color);break;case"CIMHatchFill":ge(z.lineSymbol,T)}}function te(x,T){for(const G of x)if(G.join(".")===T.join("."))return;x.push(T)}function ue(x,T,G){T instanceof k.A||(T=new k.A(T));const O=(0,_.lW)(x);O&&q(O,T,G)}function q(x,T,G){if(!x)return;let O;O="CIMTextSymbol"===x.type?x.symbol:x;const z="CIMPolygonSymbol"===O?.type;if(O?.symbolLayers)for(const j of O.symbolLayers){if(j.colorLocked)continue;if(z)if(G){const{layersToColor:re}=G;if(((0,_.mA)(j)||(0,_.MM)(j)&&j.markerPlacement&&(0,_.zr)(j.markerPlacement))&&"fill"===re||(0,_.jn)(j)&&"outline"===re)continue}else if((0,_.mA)(j)||(0,_.MM)(j)&&j.markerPlacement&&(0,_.zr)(j.markerPlacement))continue;const se=T.toArray();switch(j.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":j.tintColor=se;break;case"CIMVectorMarker":j.markerGraphics?.forEach(re=>{q(re.symbol,T,G)});break;case"CIMSolidStroke":case"CIMSolidFill":j.color=se;break;case"CIMHatchFill":q(j.lineSymbol,T,G)}}}},8134:(nt,Pe,A)=>{A.d(Pe,{$4:()=>D,O0:()=>x,O1:()=>T,Sw:()=>G,eH:()=>Q,rc:()=>V});var k=A(90261),_=A(68677),de=A(89563),he=A(33087),U=A(67685),I=A(76926);const me="picture-fill",le="simple-fill",J="simple-line",be="simple-marker",ge="text",te="cim",ue=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),q=new he.q(1e3);function Q(O){const z=O.style;let j=null;if(O)switch(O.type){case be:"cross"!==z&&"x"!==z&&(j=O.color);break;case le:z&&"solid"!==z?"none"!==z&&(j={type:"pattern",x:0,y:0,src:(0,k.s)(`esri/symbols/patterns/${z}.png`),width:5,height:5}):j=O.color;break;case me:j={type:"pattern",src:O.url,width:(0,U.Lz)(O.width)*O.xscale,height:(0,U.Lz)(O.height)*O.yscale,x:(0,U.Lz)(O.xoffset),y:(0,U.Lz)(O.yoffset)};break;case ge:j=O.color;break;case te:j=(0,I.Nk)(O)}return j}function V(O,z){const j=O+"-"+z;return void 0!==q.get(j)?Promise.resolve(q.get(j)):(0,de.A)(O,{responseType:"image"}).then(se=>{const re=se.data,xe=re.naturalWidth,X=re.naturalHeight,pe=document.createElement("canvas");pe.width=xe,pe.height=X;const ae=pe.getContext("2d");ae.fillStyle=z,ae.fillRect(0,0,xe,X),ae.globalCompositeOperation="destination-in",ae.drawImage(re,0,0);const Be=pe.toDataURL();return q.put(j,Be),Be})}function D(O){if(!O)return null;let z=null;switch(O.type){case le:case me:case be:z=D(O.outline);break;case J:{const j=(0,U.Lz)(O.width);null!=O.style&&"none"!==O.style&&0!==j&&(z={color:O.color,style:T(O.style),width:j,cap:O.cap,join:"miter"===O.join?(0,U.Lz)(O.miterLimit):O.join},z.dashArray=x(z).join(",")||"none");break}default:z=null}return z}function x(O){if(!O?.style)return[];const{dashArray:z,style:j,width:se}=O;if("string"==typeof z&&"none"!==z)return z.split(",").map(X=>Number(X));const re=se??0,xe=ue.has(j)?ue.get(j).map(X=>X*re):[];if("butt"!==O.cap)for(const[X,pe]of xe.entries())xe[X]=X%2==1?pe+re:Math.max(pe-re,1);return xe}const T=(()=>{const O={};return z=>{if(O[z])return O[z];const j=z.replaceAll("-","");return O[z]=j,j}})(),G=new _.A([128,128,128])},20175:(nt,Pe,A)=>{A.r(Pe),A.d(Pe,{getPatternDescriptor:()=>xe,getSizeFromOptions:()=>He,getSymbolLayerFill:()=>re,previewSymbol3D:()=>K});var k=A(10467),_=A(90261),de=A(29430),U=(A(3248),A(5922)),I=A(35150),me=A(67685),le=A(8134),J=A(28831),be=A(15225),ge=A(22079),te=A(16633),ue=A(83393),q=A(58964);const Q=ge.CB.size,V=ge.CB.maxSize,D=ge.CB.maxOutlineSize,x=ge.CB.lineWidth,T=ge.CB.tallSymbolWidth;function G(E){const R=E.outline,ie=null!=E.material?E.material.color:null,P=null!=ie?ie.toHex():null;if(null==R||"pattern"in R&&null!=R.pattern&&"style"===R.pattern.type&&"none"===R.pattern.style)return"fill"===E.type&&"#ffffff"===P?{color:"#bdc3c7",width:.75}:null;const B=(0,me.Lz)(R.size)||0;return{color:"rgba("+(null!=R.color?R.color.toRgba():"255,255,255,1")+")",width:Math.min(B,D),style:"pattern"in R&&null!=R.pattern&&"style"===R.pattern.type?(0,le.O1)(R.pattern.style):null,join:"butt",cap:"patternCap"in R?R.patternCap:"butt"}}function z(){return(z=(0,k.A)(function*(E,R){if(E.thumbnail?.url)return E.thumbnail.url;if("icon"===R.type&&R?.resource?.href)return(0,ue.N7)(R);const ie=(0,_.s)("esri/images/Legend/legend3dsymboldefault.png");if(E.styleOrigin&&(E.styleOrigin.styleName||E.styleOrigin.styleUrl)){const P=yield(0,q.resolveWebStyleSymbol)(E.styleOrigin,{portal:E.styleOrigin.portal},"webRef").catch(()=>null);if(P&&"thumbnail"in P&&P.thumbnail?.url)return P.thumbnail.url}return ie})).apply(this,arguments)}function j(E,R=1){const ie=E.a,P=(0,de.N2)(E),B=P.h,Y=P.s/R,oe=100-(100-P.v)/R,{r:fe,g:ve,b:Ae}=(0,de.$)({h:B,s:Y,v:oe});return[fe,ve,Ae,ie]}function se(E){return"water"===E.type?null==E.color?null:E.color:null==E.material?.color?null:E.material.color}function re(E,R=0){const ie=se(E);if(!ie){if("fill"===E.type)return null;const Y=(0,ge.dr)(le.Sw.r,R);return[Y,Y,Y,100]}const P=ie.toRgba();for(let B=0;B<3;B++)P[B]=(0,ge.dr)(P[B],R);return P}function xe(E,R){return X.apply(this,arguments)}function X(){return(X=(0,k.A)(function*(E,R){const ie=E.style;return"none"===ie?null:{type:"pattern",x:0,y:0,src:yield(0,le.rc)((0,_.s)(`esri/symbols/patterns/${ie}.png`),R.toCss(!0)),width:5,height:5}})).apply(this,arguments)}function pe(E){return E.outline?G(E):{color:"rgba(0, 0, 0, 1)",width:1.5}}function ae(E,R){const ie=se(E);if(!ie)return null;let P="rgba(";return P+=(0,ge.dr)(ie.r,R)+",",P+=(0,ge.dr)(ie.g,R)+",",P+=(0,ge.dr)(ie.b,R)+",",P+ie.a+");"}function Be(E,R){const ie=ae(E,R);return ie?"pattern"in E&&null!=E.pattern&&"style"===E.pattern.type&&"none"===E.pattern.style?null:{color:ie,width:Math.min(E.size?(0,me.Lz)(E.size):.75,D),style:"pattern"in E&&null!=E.pattern&&"style"===E.pattern.type?(0,le.O1)(E.pattern.style):null,cap:"cap"in E?E.cap:null,join:"join"in E?"miter"===E.join?(0,me.Lz)(2):E.join:null}:{}}function Se(E,R,ie){const P=null!=ie?.75*ie:0;return{type:"linear",x1:P?.25*P:0,y1:P?.5*P:0,x2:P||4,y2:P?.5*P:4,colors:[{color:E,offset:0},{color:R,offset:1}]}}function He(E){const R="number"==typeof E?.size?E?.size:null;return R?(0,me.Lz)(R):null}function Et(){return Et=(0,k.A)(function*(E,R){const ie=He(R),P=R?.maxSize?(0,me.Lz)(R.maxSize):null,B=R?.disableUpsampling??!1,Y=E.symbolLayers,oe=[];let fe=0,ve=0;const Ae=Y.at(-1);let _e;Ae&&"icon"===Ae.type&&(_e=Ae.size&&(0,me.Lz)(Ae.size)),Y.forEach(Ce=>{if("icon"!==Ce.type&&"object"!==Ce.type)return;const Ue="icon"===Ce.type?Ce.size&&(0,me.Lz)(Ce.size):0,Ne=ie||Ue?Math.ceil(Math.min(ie||Ue,P||V)):Q;if(Ce?.resource?.href){const Le=function O(E,R){return z.apply(this,arguments)}(E,Ce).then(Ee=>{const Ke=Ce?.material?.color,qe=function bt(E){return"icon"===E.type?"multiply":"tint"}(Ce);return(0,te.UB)(Ee,Ne,Ke,qe,B)}).then(Ee=>{const Ke=Ee.width,qe=Ee.height;return fe=Math.max(fe,Ke),ve=Math.max(ve,qe),[{shape:{type:"image",x:0,y:0,width:Ke,height:qe,src:Ee.url},fill:null,stroke:null}]});oe.push(Le)}else{let Le=Ne;"icon"===Ce.type&&_e&&ie&&(Le=Ne*(Ue/_e));const Ee="tall"===R?.symbolConfig||R?.symbolConfig?.isTall||"object"===Ce.type&&function Qe(E){const R=E.depth,ie=E.height,P=E.width;return 0!==P&&0!==R&&0!==ie&&P===R&&null!=P&&null!=ie&&P<ie}(Ce);fe=Math.max(fe,Ee?T:Le),ve=Math.max(ve,Le),oe.push(Promise.resolve(function ke(E,R,ie){const P=[];if(!E)return P;switch(E.type){case"icon":{const oe=R,fe=R;switch(E.resource?.primitive??J.r){case"circle":P.push({shape:{type:"circle",cx:0,cy:0,r:.5*R},fill:re(E,0),stroke:G(E)});break;case"square":P.push({shape:{type:"path",path:[{command:"M",values:[0,fe]},{command:"L",values:[0,0]},{command:"L",values:[oe,0]},{command:"L",values:[oe,fe]},{command:"Z",values:[]}]},fill:re(E,0),stroke:G(E)});break;case"triangle":P.push({shape:{type:"path",path:[{command:"M",values:[0,fe]},{command:"L",values:[.5*oe,0]},{command:"L",values:[oe,fe]},{command:"Z",values:[]}]},fill:re(E,0),stroke:G(E)});break;case"cross":P.push({shape:{type:"path",path:[{command:"M",values:[.5*oe,0]},{command:"L",values:[.5*oe,fe]},{command:"M",values:[0,.5*fe]},{command:"L",values:[oe,.5*fe]}]},stroke:pe(E)});break;case"x":P.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[oe,fe]},{command:"M",values:[oe,0]},{command:"L",values:[0,fe]}]},stroke:pe(E)});break;case"kite":P.push({shape:{type:"path",path:[{command:"M",values:[0,.5*fe]},{command:"L",values:[.5*oe,0]},{command:"L",values:[oe,.5*fe]},{command:"L",values:[.5*oe,fe]},{command:"Z",values:[]}]},fill:re(E,0),stroke:G(E)})}break}case"object":switch(E.resource?.primitive??be.r){case"cone":{const B=Se(re(E,0),re(E,-.6),ie?T:R),Y=(0,ge.mN)(R,ie);P.push({shape:Y[0],fill:B},{shape:Y[1],fill:B});break}case"inverted-cone":{const B=re(E,0),Y=Se(B,re(E,-.6),R),oe=(0,ge.Pc)(R);P.push({shape:oe[0],fill:Y},{shape:oe[1],fill:B});break}case"cube":{const B=(0,ge.cZ)(R,ie);P.push({shape:B[0],fill:re(E,0)},{shape:B[1],fill:re(E,-.3)},{shape:B[2],fill:re(E,-.5)});break}case"cylinder":{const B=Se(re(E,0),re(E,-.6),ie?T:R),Y=(0,ge.dt)(R,ie);P.push({shape:Y[0],fill:B},{shape:Y[1],fill:B},{shape:Y[2],fill:re(E,0)});break}case"diamond":{const B=(0,ge.D)(R);P.push({shape:B[0],fill:re(E,-.3)},{shape:B[1],fill:re(E,0)},{shape:B[2],fill:re(E,-.3)},{shape:B[3],fill:re(E,-.7)});break}case"sphere":{const B=Se(re(E,0),re(E,-.6));B.x1=0,B.y1=0,B.x2=.25*R,B.y2=.25*R,P.push({shape:{type:"circle",cx:0,cy:0,r:.5*R},fill:B});break}case"tetrahedron":{const B=(0,ge.Nz)(R);P.push({shape:B[0],fill:re(E,-.3)},{shape:B[1],fill:re(E,0)},{shape:B[2],fill:re(E,-.6)});break}}}return P}(Ce,Le,Ee)))}});const Re=yield Promise.allSettled(oe),we=[];return Re.forEach(Ce=>{"fulfilled"===Ce.status?we.push(Ce.value):Ce.reason&&I.A.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",Ce.reason)}),(0,te.fz)(we,[fe,ve],{node:R?.node,scale:!1,opacity:R?.opacity,ariaLabel:R?.ariaLabel})}),Et.apply(this,arguments)}function $(){return($=(0,k.A)(function*(E,R){const ie="mesh-3d"===E.type,P=E.symbolLayers,B=He(R),Y=R?.maxSize?(0,me.Lz)(R.maxSize):null,oe=B||Q,fe=[];let ve=0,Ae=0,_e=!1;for(let Re=0;Re<P.length;Re++){const we=P.at(Re),Ce=[];if(!ie||"fill"===we.type){switch(we.type){case"fill":{const Ue=Math.min(oe,Y||V);if(ve=Math.max(ve,Ue),Ae=Math.max(Ae,Ue),_e=!0,ie){const Ne=ge.nq.meshSymbol3DFill,Le=ae(we,-.4),Ee=Le?{color:Le,width:1,join:"round"}:{};Ce.push({shape:Ne[0],fill:re(we,0),stroke:Ee},{shape:Ne[1],fill:re(we,-.2),stroke:Ee},{shape:Ne[2],fill:re(we,-.6),stroke:Ee})}else{let Ne=re(we,0);const Le="pattern"in we?we.pattern:null,Ee=G(we),Ke=se(we);null!=Le&&"style"===Le.type&&"solid"!==Le.style&&Ke&&(Ne=yield xe(Le,Ke)),Ce.push({shape:ge.nq.fill[0],fill:Ne,stroke:Ee})}break}case"line":{const Ue=Be(we,0);if(null==Ue)break;const Ne={stroke:Ue,shape:ge.nq.fill[0]};ve=Math.max(ve,Q),Ae=Math.max(Ae,Q),Ce.push(Ne);break}case"extrude":{const Ue={join:"round",width:1,...Be(we,-.4)},Ne=re(we,0),Le=re(we,-.2),Ee=Math.min(oe,Y||V),Ke=(0,ge.sU)(Ee);Ue.width=1,Ce.push({shape:Ke[0],fill:Le,stroke:Ue},{shape:Ke[1],fill:Le,stroke:Ue},{shape:Ke[2],fill:Ne,stroke:Ue});const Lt=.7*Q+.5*Ee;ve=Math.max(ve,Q),Ae=Math.max(Ae,Lt);break}case"water":{const Ue=se(we),Ne=j(Ue),Le=j(Ue,2),Ee=j(Ue,3),Ke=(0,ge.cP)();_e=!0,Ce.push({shape:Ke[0],fill:Ne},{shape:Ke[1],fill:Le},{shape:Ke[2],fill:Ee});const qe=Math.min(oe,Y||V);ve=Math.max(ve,qe),Ae=Math.max(Ae,qe);break}}fe.push(Ce)}}return(0,te.fz)(fe,[ve,Ae],{node:R?.node,scale:_e,opacity:R?.opacity,ariaLabel:R?.ariaLabel})})).apply(this,arguments)}function K(E,R){if(0===E.symbolLayers.length)return Promise.reject(new U.A("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(E.type){case"point-3d":return function wt(E,R){return Et.apply(this,arguments)}(E,R);case"line-3d":return function It(E,R){const ie=E.symbolLayers,P=[],B=(0,ue.$d)(E),Y=He(R),oe=(R?.maxSize?(0,me.Lz)(R.maxSize):null)||D;let fe,ve=0,Ae=0;return ie.forEach((_e,Re)=>{if(!_e||"line"!==_e.type&&"path"!==_e.type)return;const we=[];switch(_e.type){case"line":{const Ce=Be(_e,0);if(null==Ce)break;const Ue=Ce?.width||0;0===Re&&(fe=Ue);const Ne=Math.min(Y||Ue,oe),Le=0===Re?Ne:Y?Ne*(Ue/fe):Ne,Ee=Le>x/2?2*Le:x;Ae=Math.max(Ae,Le),ve=Math.max(ve,Ee),Ce.width=Le,we.push({shape:{type:"path",path:[{command:"M",values:[0,.5*Ae]},{command:"L",values:[ve,.5*Ae]}]},stroke:Ce});break}case"path":{const Ce=Math.min(Y||Q,oe),Ue=re(_e,0),Ne=re(_e,-.2),Le=ae(_e,-.4),Ee=Le?{color:Le,width:1}:{};if("quad"===_e.profile){const Ke=_e.width,qe=_e.height,Lt=(0,ge.KX)(Ke&&qe?Ke/qe:1,0===qe,0===Ke),qt={...Ee,join:"bevel"};we.push({shape:Lt[0],fill:Ne,stroke:qt},{shape:Lt[1],fill:Ne,stroke:qt},{shape:Lt[2],fill:Ue,stroke:qt})}else we.push({shape:ge.nq.pathSymbol3DLayer[0],fill:Ne,stroke:Ee},{shape:ge.nq.pathSymbol3DLayer[1],fill:Ue,stroke:Ee});Ae=Math.max(Ae,Ce),ve=Ae}}P.push(we)}),Promise.resolve((0,te.fz)(P,[ve,Ae],{node:R?.node,scale:B,opacity:R?.opacity,ariaLabel:R?.ariaLabel}))}(E,R);case"polygon-3d":case"mesh-3d":return function St(E,R){return $.apply(this,arguments)}(E,R)}return Promise.reject(new U.A("symbolPreview: swatchInfo3D","symbol not supported."))}},22079:(nt,Pe,A)=>{A.d(Pe,{CB:()=>_,D:()=>ge,KX:()=>he,Nz:()=>te,Pc:()=>be,QC:()=>q,cP:()=>I,cZ:()=>me,dr:()=>ue,dt:()=>le,mN:()=>J,nq:()=>de,sU:()=>U});var _,Q,k=A(68677);(Q=_||(_={}))[Q.size=22]="size",Q[Q.lineWidth=50]="lineWidth",Q[Q.maxSize=120]="maxSize",Q[Q.maxOutlineSize=80]="maxOutlineSize",Q[Q.tallSymbolWidth=20]="tallSymbolWidth";const de={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function he(Q,V,D){const x=_.size;let T=x,G=x;Q<1?T*=.75:Q>1&&(G*=1.25);let j=x,se=x;return V&&D&&(T=G=j=se=0),[{type:"path",path:[{command:"M",values:[j,0]},{command:"L",values:[D?j:.875*j,0]},{command:"L",values:[D?T-.5*j:0,G-.5*se]},{command:"L",values:[T-.5*j,G-.5*se]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[j,0]},{command:"L",values:[j,V?0:.125*se]},{command:"L",values:[T-.5*j,V?G-.5*se:se]},{command:"L",values:[T-.5*j,G-.5*se]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[T-.5*j,G-.5*se]},{command:"L",values:[D?T-.5*j:0,G-.5*se]},{command:"L",values:[D?T-.5*j:0,V?G-.5*se:se]},{command:"L",values:[T-.5*j,V?G-.5*se:se]},{command:"Z",values:[]}]}]}function U(Q){const V=_.size,D=.5*Q;return[{type:"path",path:[{command:"M",values:[0,.7*V*.5]},{command:"L",values:[.3*V,.7*V]},{command:"L",values:[.3*V,.7*V+D]},{command:"L",values:[0,.7*V+D-.7*V*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*V,.7*V]},{command:"L",values:[.3*V,.7*V+D]},{command:"L",values:[V,D]},{command:"L",values:[V,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*V,0]},{command:"L",values:[V,0]},{command:"L",values:[.3*V,.7*V]},{command:"L",values:[0,.7*V*.5]},{command:"Z",values:[]}]}]}function I(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function me(Q,V){let D=V?_.tallSymbolWidth:Q;const T=V?4:6;D-=D<=_.size?.5*T:T;const z=V?.35*D:.5*D;return[{type:"path",path:[{command:"M",values:[.5*D,0]},{command:"L",values:[D,.5*z]},{command:"L",values:[.5*D,z]},{command:"L",values:[0,.5*z]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*z]},{command:"L",values:[.5*D,z]},{command:"L",values:[.5*D,Q]},{command:"L",values:[0,Q-.5*z]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*D,z]},{command:"L",values:[.5*D,Q]},{command:"L",values:[D,Q-.5*z]},{command:"L",values:[D,.5*z]},{command:"Z",values:[]}]}]}function le(Q,V){let D=V?_.tallSymbolWidth:Q;const T=V?4:6;D-=D<=_.size?.5*T:T;const G=.5*D,O=.15*D,j=Q-O;return[{type:"ellipse",cx:.5*D,cy:j,rx:G,ry:O},{type:"path",path:[{command:"M",values:[0,O]},{command:"L",values:[0,j]},{command:"L",values:[D,j]},{command:"L",values:[D,O]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*D,cy:O,rx:G,ry:O}]}function J(Q,V){let D=V?_.tallSymbolWidth:Q;const T=V?4:6;D-=D<=_.size?.5*T:T;const G=.15*D,O=Q-G;return[{type:"ellipse",cx:.5*D,cy:O,rx:.5*D,ry:G},{type:"path",path:[{command:"M",values:[.5*D,0]},{command:"L",values:[D,O]},{command:"L",values:[0,O]},{command:"Z",values:[]}]}]}function be(Q){let V=Q;V-=V<_.size?3:6;const T=.15*V;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[V,0]},{command:"L",values:[.5*V,Q-T]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*V,cy:0,rx:.5*V,ry:T}]}function ge(Q){let V=Q;const D=Q;V-=V<_.size?2:4;const O=V,z=D,j=Math.floor(Q/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*O,0]},{command:"L",values:[O,.5*z-j]},{command:"L",values:[.45*O-j,.5*z+j]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*O,0]},{command:"L",values:[.45*O-j,.5*z+j]},{command:"L",values:[0,.5*z-j]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*z-j]},{command:"L",values:[.45*O-j,.5*z+j]},{command:"L",values:[.45*O,D]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*O,D]},{command:"L",values:[O,.5*z-j]},{command:"L",values:[.45*O-j,.5*z+j]},{command:"Z",values:[]}]}]}function te(Q){let x=Q;return x-=x<_.size?1:2,[{type:"path",path:[{command:"M",values:[.45*Q,0]},{command:"L",values:[Q,x]},{command:"L",values:[.45*Q,.6*x]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*Q,0]},{command:"L",values:[.45*Q,.6*x]},{command:"L",values:[0,x]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,x]},{command:"L",values:[.45*Q,.6*x]},{command:"L",values:[Q,x]},{command:"Z",values:[]}]}]}function ue(Q,V){return Math.round(Math.min(Math.max(Q+255*V*.75,0),255))}function q(Q,V){if(null==Q)return new k.A;if("type"in Q&&("linear"===Q.type||"pattern"===Q.type))return Q;const D=new k.A(Q);return new k.A([ue(D.r,V),ue(D.g,V),ue(D.b,V),D.a])}},16633:(nt,Pe,A)=>{A.d(Pe,{UB:()=>D,fz:()=>te});var k=A(77469),_=A(89563),de=A(29430),he=A(5922),U=A(3248),me=(A(92129),A(76062)),le=A(94013),J=A(83393);const be=(0,me.F)();function te(x,T,G){const O=Math.ceil(T[0]),z=Math.ceil(T[1]);if(!x.some(se=>!!se.length))return null;const j=G?.node||document.createElement("div");return null!=G.opacity&&(j.style.opacity=G.opacity.toString()),null!=G.effectView&&(j.style.filter=(0,J.di)(G.effectView)),function ge(x,T){be.append(x,T),be.detach(T)}(j,()=>(0,le.d8)(x,O,z,G)),j}function V(x,T,G,O,z){switch(z){case"multiply":x[T]*=G[0],x[T+1]*=G[1],x[T+2]*=G[2],x[T+3]*=G[3];break;default:{const j=(0,de.N2)({r:x[T],g:x[T+1],b:x[T+2]});j.h=O.h,j.s=O.s,j.v=j.v/100*O.v;const se=(0,de.$)(j);x[T]=se.r,x[T+1]=se.g,x[T+2]=se.b,x[T+3]*=G[3];break}}}function D(x,T,G,O,z){return function q(x,T,G){return x?(0,_.A)(x,{responseType:"image"}).then(O=>{const z=O.data,j=z.width,se=z.height,re=j/se;let xe=T;if(G){const X=Math.max(j,se);xe=Math.min(xe,X)}return{image:z,width:re<=1?Math.ceil(xe*re):xe,height:re<=1?xe:Math.ceil(xe/re)}}):Promise.reject(new he.A("renderUtils: imageDataSize","href not provided."))}(x,T,z).then(j=>{const se=j.width??T,re=j.height??T;if(j.image&&function Q(x,T){return!(!x||"ignore"===T||"multiply"===T&&255===x.r&&255===x.g&&255===x.b&&1===x.a)}(G,O)){let xe=j.image.width,X=j.image.height;(0,U.A)("edge")&&/\.svg$/i.test(x)&&(xe-=1,X-=1);const pe=function ue(x,T){x=Math.ceil(x),T=Math.ceil(T);const G=document.createElement("canvas");G.width=x,G.height=T,G.style.width=x+"px",G.style.height=T+"px";const O=G.getContext("2d");return O.clearRect(0,0,x,T),O}(se,re);pe.drawImage(j.image,0,0,xe,X,0,0,se,re);const ae=pe.getImageData(0,0,se,re),Be=[G.r/255,G.g/255,G.b/255,G.a],Se=(0,de.N2)(G);for(let Qe=0;Qe<ae.data.length;Qe+=4)V(ae.data,Qe,Be,Se,O);pe.putImageData(ae,0,0),x=pe.canvas.toDataURL("image/png")}else{const xe=k.id?.findCredential(x);if(xe?.token){const X=x.includes("?")?"&":"?";x=`${x}${X}token=${xe.token}`}}return{url:x,width:se,height:re}}).catch(()=>({url:x,width:T,height:T}))}},94013:(nt,Pe,A)=>{A.d(Pe,{d8:()=>St});var k=A(68677),_=A(3248),de=A(11432),he=A(3672),U=A(76329),I=A(8134),le=(A(60421),A(56295));const J="http://www.w3.org/2000/svg";let be=0,ge=0;const te=(0,_.A)("android"),ue=(0,_.A)("chrome")||te&&te>=4?"auto":"optimizeLegibility",q={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},Q=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let V={},D={};const x=Math.PI;let T=1;function G($,K){const E=$*(x/180);return Math.abs(K*Math.sin(E))+Math.abs(K*Math.cos(E))}function O($){return $.map(K=>`${K.command} ${K.values.join(" ")}`).join(" ").trim()}function z($,K,E,R,ie){if($){if("circle"===$.type)return(0,le.K)("circle",{cx:$.cx,cy:$.cy,fill:K,"fill-rule":"evenodd",r:$.r,stroke:E.color,"stroke-dasharray":E.dashArray,"stroke-dashoffset":E.dashOffset,"stroke-linecap":E.cap,"stroke-linejoin":E.join,"stroke-miterlimit":"4","stroke-width":E.width});if("ellipse"===$.type)return(0,le.K)("ellipse",{cx:$.cx,cy:$.cy,fill:K,"fill-rule":"evenodd",rx:$.rx,ry:$.ry,stroke:E.color,"stroke-dasharray":E.dashArray,"stroke-linecap":E.cap,"stroke-linejoin":E.join,"stroke-miterlimit":"4","stroke-width":E.width});if("rect"===$.type)return(0,le.K)("rect",{fill:K,"fill-rule":"evenodd",height:$.height,stroke:E.color,"stroke-dasharray":E.dashArray,"stroke-linecap":E.cap,"stroke-linejoin":E.join,"stroke-miterlimit":"4","stroke-width":E.width,width:$.width,x:$.x,y:$.y});if("image"===$.type)return(0,le.K)("image",{alt:ie||"image",height:$.height,href:$.src,preserveAspectRatio:"none",width:$.width,x:$.x,y:$.y});if("path"===$.type){const P="string"!=typeof $.path?O($.path):$.path;return(0,le.K)("path",{d:P,fill:K,"fill-rule":"evenodd",stroke:E.color,"stroke-dasharray":E.dashArray,"stroke-linecap":E.cap,"stroke-linejoin":E.join,"stroke-miterlimit":"4","stroke-width":E.width})}if("text"===$.type)return(0,de.Lw)(R),(0,le.K)("text",{"dominant-baseline":R.dominantBaseline,fill:K,"fill-rule":"evenodd","font-family":R.font.family,"font-size":R.font.size,"font-style":R.font.style,"font-variant":R.font.variant,"font-weight":R.font.weight,kerning:R.kerning,rotate:R.rotate,stroke:E.color,"stroke-dasharray":E.dashArray,"stroke-linecap":E.cap,"stroke-linejoin":E.join,"stroke-miterlimit":"4","stroke-width":E.width,"text-anchor":R.align,"text-decoration":R.decoration,"text-rendering":ue,x:$.x,y:$.y},$.text)}return null}function j($){const K={fill:"none",pattern:null,linearGradient:null};if($)if("type"in $&&"pattern"===$.type){const E="patternId-"+ ++be;K.fill=`url(#${E})`,K.pattern={id:E,x:$.x,y:$.y,width:$.width,height:$.height,image:{x:0,y:0,width:$.width,height:$.height,href:$.src}}}else if("type"in $&&"linear"===$.type){const E="linearGradientId-"+ ++ge;K.fill=`url(#${E})`,K.linearGradient={id:E,x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,stops:$.colors.map(R=>({offset:R.offset,color:R.color&&new k.A(R.color).toString()}))}}else if($){const E=new k.A($);K.fill=E.toString()}return K}function se($){const K={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};return $&&(null!=$.width&&(K.width=$.width),$.cap&&(K.cap=$.cap),$.join&&(K.join=$.join.toString()),$.color&&(K.color=new k.A($.color).toString()),$.dashArray&&(K.dashArray=$.dashArray),$.dashoffset&&(K.dashOffset=$.dashoffset),$.style&&!$.dashArray&&(K.dashArray=(0,I.O0)($).join(",")||"none")),K}function re($,K){const E={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if($){const R=$.alignBaseline,ie="baseline"===R?"auto":"top"===R?"text-top":"bottom"===R?"hanging":R;E.align=$.align,E.dominantBaseline=ie,E.decoration=$.decoration,E.kerning=$.kerning?"auto":"0",E.rotate=$.rotated?"90":"0",(0,de.Lw)(K),E.font.style=K.style||"normal",E.font.variant=K.variant||"normal",E.font.weight=K.weight||"normal",E.font.size=K.size&&K.size.toString()||"10pt",E.font.family=K.family||"serif"}return E}function xe($){const{pattern:K,linearGradient:E}=$;if(K)return(0,le.K)("pattern",{height:K.height,id:K.id,patternUnits:"userSpaceOnUse",width:K.width,x:K.x,y:K.y},(0,le.K)("image",{height:K.image.height,href:K.image.href,width:K.image.width,x:K.image.x,y:K.image.y}));if(E){const R=E.stops.map((ie,P)=>(0,le.K)("stop",{key:`${P}-stop`,offset:ie.offset,"stop-color":ie.color}));return(0,le.K)("linearGradient",{gradientUnits:"userSpaceOnUse",id:E.id,x1:E.x1,x2:E.x2,y1:E.y1,y2:E.y2},R)}return null}function X($,K){if(!$||0===$.length)return null;const E=[];for(const R of $){const{shape:ie,fill:P,stroke:B,font:Y}=R,oe=j(P),fe=se(B),ve="text"===ie.type?re(ie,Y):null,Ae=z(ie,oe.fill,fe,ve);Ae&&E.push(Ae)}return(0,le.K)("mask",{id:K,maskUnits:"userSpaceOnUse"},(0,le.K)("g",null,E))}function pe($,K,E){return(0,U.Tl)($,(0,U.D_)($),[K,E])}function ae($,K,E,R,ie){return(0,U.hs)($,(0,U.D_)($),[K,E]),$[4]=$[4]*K-R*K+R,$[5]=$[5]*E-ie*E+ie,$}function Se($,K){V&&"left"in V?(null!=V.left&&V.left>$&&(V.left=$),(null==V.right||V.right<$)&&(V.right=$),(null==V.top||V.top>K)&&(V.top=K),(null==V.bottom||V.bottom<K)&&(V.bottom=K)):V={left:$,bottom:K,right:$,top:K}}function Qe($){const K=$.args,E=K.length;let R;switch($.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(R=0;R<E;R+=2)Se(K[R],K[R+1]);D.x=K[E-2],D.y=K[E-1];break;case"H":for(R=0;R<E;++R)Se(K[R],D.y);D.x=K[E-1];break;case"V":for(R=0;R<E;++R)Se(D.x,K[R]);D.y=K[E-1];break;case"m":{let ie=0;for(("x"in D||(Se(D.x=K[0],D.y=K[1]),ie=2),R=ie);R<E;R+=2)Se(D.x+=K[R],D.y+=K[R+1]);break}case"l":case"t":for(R=0;R<E;R+=2)Se(D.x+=K[R],D.y+=K[R+1]);break;case"h":for(R=0;R<E;++R)Se(D.x+=K[R],D.y);break;case"v":for(R=0;R<E;++R)Se(D.x,D.y+=K[R]);break;case"c":for(R=0;R<E;R+=6)Se(D.x+K[R],D.y+K[R+1]),Se(D.x+K[R+2],D.y+K[R+3]),Se(D.x+=K[R+4],D.y+=K[R+5]);break;case"s":case"q":for(R=0;R<E;R+=4)Se(D.x+K[R],D.y+K[R+1]),Se(D.x+=K[R+2],D.y+=K[R+3]);break;case"A":for(R=0;R<E;R+=7)Se(K[R+5],K[R+6]);D.x=K[E-2],D.y=K[E-1];break;case"a":for(R=0;R<E;R+=7)Se(D.x+=K[R+5],D.y+=K[R+6])}}function ke($,K,E){const R=q[$.toLowerCase()];let ie;"number"==typeof R&&(R?K.length>=R&&(ie={action:$,args:K.slice(0,K.length-K.length%R)},E.push(ie),Qe(ie)):(ie={action:$,args:[]},E.push(ie),Qe(ie)))}function bt($){const K={x:0,y:0,width:0,height:0};if("circle"===$.type)K.x=$.cx-$.r,K.y=$.cy-$.r,K.width=2*$.r,K.height=2*$.r;else if("ellipse"===$.type)K.x=$.cx-$.rx,K.y=$.cy-$.ry,K.width=2*$.rx,K.height=2*$.ry;else if("image"===$.type||"rect"===$.type)K.x=$.x,K.y=$.y,K.width=$.width,K.height=$.height;else if("path"===$.type){const E=function He($){const K=("string"!=typeof $.path?O($.path):$.path).match(Q),E=[];if(V={},D={},!K)return null;let R="",ie=[];const P=K.length;for(let Y=0;Y<P;++Y){const oe=K[Y],fe=parseFloat(oe);isNaN(fe)?(R&&ke(R,ie,E),ie=[],R=oe):ie.push(fe)}ke(R,ie,E);const B={x:0,y:0,width:0,height:0};return V&&"left"in V&&(B.x=V.left,B.y=V.top,B.width=V.right-V.left,B.height=V.bottom-V.top),B}($);K.x=E.x,K.y=E.y,K.width=E.width,K.height=E.height}return K}function wt($){const K={x:0,y:0,width:0,height:0};let E=null,R=Number.NEGATIVE_INFINITY,ie=Number.NEGATIVE_INFINITY;for(const P of $)E?(E.x=Math.min(E.x,P.x),E.y=Math.min(E.y,P.y),R=Math.max(R,P.x+P.width),ie=Math.max(ie,P.y+P.height)):(E=K,E.x=P.x,E.y=P.y,R=P.x+P.width,ie=P.y+P.height);return E&&(E.width=R-E.x,E.height=ie-E.y),E}function Et($,K,E,R,ie,P,B,Y,oe){let fe=(B&&P?G(P,K):K)/2,ve=(B&&P?G(P,E):E)/2;if(oe){const Le=oe[0],Ee=oe[1];fe=(B&&P?G(P,Le):Le)/2,ve=(B&&P?G(P,Ee):Ee)/2}const Ae=$.width+R,_e=$.height+R,Re=(0,he.vt)(),we=(0,he.vt)();let Ce=!1;if(ie&&0!==Ae&&0!==_e){const Le=K!==E?K/E:Ae/_e,Ee=K>E?K:E;let Ke=1,qe=1;isNaN(Ee)||(Le>1?(Ke=Ee/Ae,qe=Ee/Le/_e):(qe=Ee/_e,Ke=Ee*Le/Ae)),(0,U.lw)(we,we,ae(Re,Ke,qe,fe,ve)),Ce=!0}const Ue=$.x+(Ae-R)/2,Ne=$.y+(_e-R)/2;if((0,U.lw)(we,we,pe(Re,fe-Ue,ve-Ne)),!Ce&&(Ae>K||_e>E)){const Le=Ae/K>_e/E,Ee=(Le?K:E)/(Le?Ae:_e);(0,U.lw)(we,we,ae(Re,Ee,Ee,Ue,Ne))}return P&&(0,U.lw)(we,we,function Be($,K,E,R){const ie=K%360*Math.PI/180;(0,U.e$)($,(0,U.D_)($),ie);const P=Math.cos(ie),B=Math.sin(ie),Y=$[4],oe=$[5];return $[4]=Y*P-oe*B+R*B-E*P+E,$[5]=oe*P+Y*B-E*B-R*P+R,$}(Re,P,Ue,Ne)),Y&&(0,U.lw)(we,we,pe(Re,Y[0],Y[1])),`matrix(${we[0]},${we[1]},${we[2]},${we[3]},${we[4]},${we[5]})`}function St($,K,E,R={}){const ie=[],P=[],B=++T,Y=function It($,K,E){const R=$?.effects.find(fe=>"bloom"===fe.type);if(!R)return null;const{strength:ie,radius:P}=R,B=ie>0?P:0,Y=(ie+B)*K,oe=4*ie+1;return(0,le.K)("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:`bloom${E}`,width:"300%",x:"-100%",y:"-100%"},(0,le.K)("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:(ie+.5*B)*(5**(K/100)*(.4+K/100)),result:"dilate"}),(0,le.K)("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:Y/25}),(0,le.K)("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:Y/50}),(0,le.K)("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},(0,le.K)("feFuncR",{slope:oe,type:"linear"}),(0,le.K)("feFuncG",{slope:oe,type:"linear"}),(0,le.K)("feFuncB",{slope:oe,type:"linear"})),(0,le.K)("feMerge",null,(0,le.K)("feMergeNode",{in:"intensityBlur"}),(0,le.K)("feMergeNode",{in:"intensityBrightness"}),(0,le.K)("feGaussianBlur",{stdDeviation:ie/10})))}(R.effectView,K,B);let oe=null;if(Y){const ve=R.effectView?.effects.find(we=>"bloom"===we.type),Ae=(ve.strength?ve.strength+ve.radius/2:0)/3,Re=E+E*Ae;oe=[Math.max(K+K*Ae,10),Math.max(Re,10)]}for(let ve=0;ve<$.length;ve++){const Ae=$[ve],_e=[],Re=[];let we=0,Ce=0,Ue=0;for(const Ee of Ae){const{shape:Ke,fill:qe,stroke:Lt,font:qt,offset:gi}=Ee;R.ignoreStrokeWidth||"text"===Ke.type||(we+=Lt?.width||0);const Vi=j(qe),Yn=se(Lt),Xn="text"===Ke.type?re(Ke,qt):null;ie.push(xe(Vi)),_e.push(z(Ke,Vi.fill,Yn,Xn,R.ariaLabel)),Re.push(bt(Ke)),gi&&(Ce+=gi[0],Ue+=gi[1])}const Ne=Et(wt(Re),K,E,we,R.scale??!1,R.rotation,R.useRotationSize??!1,[Ce,Ue],oe);let Le=null;if(R.masking){const Ee=`mask-${ve}`;ie.push(X(R.masking[ve],Ee)),Le=`url(#${Ee})`}P.push(Le?(0,le.K)("g",{mask:Le},(0,le.K)("g",{transform:Ne},_e)):(0,le.K)("g",{transform:Ne},_e))}return R.useRotationSize&&R.rotation&&(K=G(R.rotation,K),E=G(R.rotation,E)),Y&&((0,de.Lw)(oe),K=oe[0],E=oe[1]),(0,le.K)("svg",{"aria-labelledby":R.ariaLabel,focusable:!1,height:E,role:"img",style:"display: block;",width:K,xmlns:J},Y,(0,le.K)("defs",null,ie),Y?(0,le.K)("g",{filter:`url(#bloom${B})`},P):P)}},83393:(nt,Pe,A)=>{A.d(Pe,{$d:()=>Q,GG:()=>$,N7:()=>V,Sx:()=>D,UQ:()=>It,di:()=>K,dt:()=>z,k_:()=>q,yG:()=>R});var k=A(10467),_=A(68677),de=A(47280),he=A(89447),I=(A(3248),A(67685)),me=A(25866),le=A(72211),J=A(76926),be=A(8134),ge=A(74760);const te=new _.A("white");function q(P){if(!P)return 0;if((0,de.wk)(P)){const B=function ue(P){const B=P.symbolLayers?.at(-1);if(B&&"outline"in B)return B?.outline?.size}(P);return B??0}return(0,I.PN)((0,be.$4)(P)?.width)}function Q(P){if(null==P||!("symbolLayers"in P)||null==P.symbolLayers)return!1;switch(P.type){case"point-3d":return P.symbolLayers.some(B=>"object"===B.type);case"line-3d":return P.symbolLayers.some(B=>"path"===B.type);case"polygon-3d":return P.symbolLayers.some(B=>"object"===B.type||"extrude"===B.type);default:return!1}}function V(P){return P.resource?.href??""}function D(P,B){if(!P)return null;let Y=null;return(0,de.wk)(P)?Y=function x(P){const B=P.symbolLayers;if(!B)return null;let Y=null;return B.forEach(oe=>{"object"===oe.type&&oe.resource?.href||(Y="water"===oe.type?oe.color:oe.material?oe.material.color:null)}),Y?new _.A(Y):null}(P):(0,de.$y)(P)&&(Y="cim"===P.type?(0,J.Nk)(P):P.color?new _.A(P.color):null),Y?T(Y,B):null}function T(P,B){if(null==B||null==P)return P;const Y=P.toRgba();return Y[3]=Y[3]*B,new _.A(Y)}function z(P,B,Y){P&&(B||null!=Y)&&(B&&(B=new _.A(B)),(0,de.wk)(P)?function G(P,B,Y){const oe=P.symbolLayers;if(!oe)return;const fe=ve=>T(B=B??ve??(null!=Y?te:null),Y);oe.forEach(ve=>{if("object"!==ve.type||!ve.resource?.href||B)if("water"===ve.type)ve.color=fe(ve.color);else{const _e=fe(null!=ve.material?ve.material.color:null);null==ve.material?ve.material=new ge.N({color:_e}):ve.material.color=_e,null!=Y&&"outline"in ve&&null!=ve.outline?.color&&(ve.outline.color=T(ve.outline.color,Y))}})}(P,B,Y):(0,de.$y)(P)&&function O(P,B,Y){(B=B??P.color)&&(P.color=T(B,Y)),null!=Y&&"outline"in P&&P.outline?.color&&(P.outline.color=T(P.outline.color,Y))}(P,B,Y))}function se(){return se=(0,k.A)(function*(P,B){const Y=P.symbolLayers;Y&&(yield(0,he.jJ)(Y,function(){var oe=(0,k.A)(function*(fe){return function re(P,B){return xe.apply(this,arguments)}(fe,B)});return function(fe){return oe.apply(this,arguments)}}()))}),se.apply(this,arguments)}function xe(){return xe=(0,k.A)(function*(P,B){switch(P.type){case"extrude":!function ae(P,B){P.size="number"==typeof B[2]?B[2]:0}(P,B);break;case"icon":case"line":case"text":!function X(P,B){const Y=pe(B);null!=Y&&(P.size=Y)}(P,B);break;case"path":!function Qe(P,B){const Y=ke(B,me.Un,[P.width,void 0,P.height]);P.width=wt(B[0],P.width,1,Y),P.height=wt(B[2],P.height,1,Y)}(P,B);break;case"object":yield function Be(P,B){return Se.apply(this,arguments)}(P,B)}}),xe.apply(this,arguments)}function pe(P){for(const B of P)if("number"==typeof B)return B;return null}function Se(){return Se=(0,k.A)(function*(P,B){const{resourceSize:Y,symbolSize:oe}=yield function He(P){return bt.apply(this,arguments)}(P),fe=ke(B,Y,oe);P.width=wt(B[0],oe[0],Y[0],fe),P.depth=wt(B[1],oe[1],Y[1],fe),P.height=wt(B[2],oe[2],Y[2],fe)}),Se.apply(this,arguments)}function ke(P,B,Y){for(let oe=0;oe<3;oe++){const fe=P[oe];switch(fe){case"symbol-value":{const ve=Y[oe];return null!=ve?ve/B[oe]:1}case"proportional":break;default:if(fe&&B[oe])return fe/B[oe]}}return 1}function bt(){return(bt=(0,k.A)(function*(P){const{computeObjectLayerResourceSize:B}=yield A.e(5020).then(A.bind(A,75020)),Y=yield B(P,10),{width:oe,height:fe,depth:ve}=P,Ae=[oe,ve,fe];let _e=1;for(let Re=0;Re<3;Re++){const we=Ae[Re];if(null!=we){_e=we/Y[Re];break}}for(let Re=0;Re<3;Re++)null==Ae[Re]&&(Ae[Re]=Y[Re]*_e);return{resourceSize:Y,symbolSize:Ae}})).apply(this,arguments)}function wt(P,B,Y,oe){switch(P){case"proportional":return Y*oe;case"symbol-value":return B??Y;default:return P}}function It(P,B){return St.apply(this,arguments)}function St(){return St=(0,k.A)(function*(P,B){if(P&&B)return(0,de.wk)(P)?function j(P,B){return se.apply(this,arguments)}(P,B):void((0,de.$y)(P)&&function Et(P,B){const Y=pe(B);if(null!=Y)switch(P.type){case"simple-marker":P.size=Y;break;case"picture-marker":{const oe=P.width/P.height;oe>1?(P.width=Y,P.height=Y*oe):(P.width=Y*oe,P.height=Y);break}case"simple-line":P.width=Y;break;case"text":P.font.size=Y}}(P,B))}),St.apply(this,arguments)}function $(P,B,Y){if(P&&null!=B)if((0,de.wk)(P)){const oe=P.symbolLayers;oe&&oe.forEach(fe=>{if(fe&&"object"===fe.type)switch(Y){case"tilt":fe.tilt=(fe.tilt??0)+B;break;case"roll":fe.roll=(fe.roll??0)+B;break;default:fe.heading=(fe.heading??0)+B}})}else(0,de.$y)(P)&&("simple-marker"!==P.type&&"picture-marker"!==P.type&&"text"!==P.type||(P.angle+=B))}function K(P){if(!P)return null;const B=P.effects.filter(Y=>"bloom"!==Y.type).map(Y=>Y.toJSON());return(0,le.zu)(B)}function R(P,B){return ie.apply(this,arguments)}function ie(){return(ie=(0,k.A)(function*(P,B){return(yield P.fetchSymbol(B))||P.fetchCIMSymbol(B)})).apply(this,arguments)}},6558:(nt,Pe,A)=>{function k(J){return J&&"function"==typeof J.highlight}function he(J,be){if(be&&J){const{minScale:ge,maxScale:te}=J;if(function U(J,be){return null!=J&&J>0||null!=be&&be>0}(ge,te))return function de(J,be,ge){return null==J||J>=ge&&(0===be||J<=be)}(be,ge,te)}return!0}function I(J){return!J?.minScale||!J.maxScale||J.minScale>=J.maxScale}A.d(Pe,{E5:()=>he,Of:()=>k,g7:()=>I})},36634:(nt,Pe,A)=>{A.r(Pe),A.d(Pe,{getColorFromPointCloudStops:()=>ge,getRampStops:()=>I,getRampStopsForPointCloud:()=>be,getStretchRampStops:()=>ue});var k=A(10467),_=A(68677),de=A(54501);const he=new _.A([64,64,64]);function U(q,Q){const V=[],D=q.length-1;return 5===q.length?V.push(0,2,4):V.push(0,D),q.map((x,T)=>V.includes(T)?(0,de.createStopLabel)(x,T,D,Q):null)}function I(q,Q,V){return me.apply(this,arguments)}function me(){return me=(0,k.A)(function*(q,Q,V){let D=!1,x=[],T=[];if(q.stops){const j=q.stops;x=j.map(se=>se.value),D=j.some(se=>!!se.label),D&&(T=j.map(se=>se.label))}if(null==x[0]&&null==x[x.length-1])return null;const z=D?null:U(x,V);return(yield Promise.all(x.map(function(){var j=(0,k.A)(function*(se,re){return{value:se,color:"opacity"===q.type?yield le(se,q,Q):(yield Promise.resolve().then(A.bind(A,77522))).getColor(q,se),label:D?T[re]:z?.[re]??""}});return function(se,re){return j.apply(this,arguments)}}()))).reverse()}),me.apply(this,arguments)}function le(q,Q,V){return J.apply(this,arguments)}function J(){return(J=(0,k.A)(function*(q,Q,V){const D=new _.A(V??he),x=(yield Promise.resolve().then(A.bind(A,77522))).getOpacity(Q,q);return null!=x&&(D.a=x),D})).apply(this,arguments)}function be(q){let Q=!1,V=[],D=[];if(V=q.map(O=>O.value),Q=q.some(O=>!!O.label),Q&&(D=q.map(O=>O.label??"")),null==V[0]&&null==V[V.length-1])return null;const G=Q?null:U(V);return V.map((O,z)=>({value:O,color:ge(O,q),label:Q?D[z]:G?.[z]??""})).reverse()}function ge(q,Q){const{startIndex:V,endIndex:D,weight:x}=function te(q,Q){let V=0,D=Q.length-1;return Q.some((x,T)=>q<x.value?(D=T,!0):(V=T,!1)),{startIndex:V,endIndex:D,weight:(q-Q[V].value)/(Q[D].value-Q[V].value)}}(q,Q);if(V===D)return Q[V].color;const T=_.A.blendColors(Q[V].color,Q[D].color,x);return new _.A(T)}function ue(q,Q){let V=[];if(q&&"multipart"===q.type)q.colorRamps.reverse().forEach((D,x)=>{V.push(0===x?{value:Q.max,color:new _.A(D.toColor),label:"high"}:{value:null,color:new _.A(D.toColor),label:""}),V.push(x===q.colorRamps.length-1?{value:Q.min,color:new _.A(D.fromColor),label:"low"}:{value:null,color:new _.A(D.fromColor),label:""})});else{let D,x;q&&"algorithmic"===q.type?(D=q.fromColor,x=q.toColor):(D=[0,0,0,1],x=[255,255,255,1]),V=[{value:Q.max,color:new _.A(x),label:"high"},{value:Q.min,color:new _.A(D),label:"low"}]}return V}},54501:(nt,Pe,A)=>{A.r(Pe),A.d(Pe,{createStopLabel:()=>be,getDateFormatOptions:()=>T,getMedianColor:()=>te,getReferenceSizeAuthoringInfoVisualVariable:()=>G,getSymbolForFlowRenderer:()=>q,isRasterBandStatistics:()=>V,rgbImgSource:()=>ge,specialCharsGreaterThan:()=>J,specialCharsLessThan:()=>le});var k=A(10467),de=(A(47280),A(97442)),he=A(86300),U=A(91515),I=A(43039),me=A(55417);const le="<",J=">";function be(O,z,j,se){let re="";return 0===z?re=`${le} `:z===j&&(re=`${J} `),re+(se?(0,I.i0)(O,se):(0,U.GP)(O))}const ge=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];function te(O){return ue.apply(this,arguments)}function ue(){return(ue=(0,k.A)(function*(O){if(!("visualVariables"in O)||!O.visualVariables)return null;const z=O.visualVariables.find(X=>"color"===X.type);if(!z)return null;let j=null,se=null;if(z.stops){if(1===z.stops.length)return z.stops[0].color;j=z.stops[0].value,se=z.stops[z.stops.length-1].value}const re=null!=j&&null!=se?j+(se-j)/2:0,{getColor:xe}=yield Promise.resolve().then(A.bind(A,77522));return xe(z,re)??null})).apply(this,arguments)}function q(O,z){return Q.apply(this,arguments)}function Q(){return(Q=(0,k.A)(function*(O,z){const j=O.trailCap,se=O.trailWidth||1,re=z||(yield te(O))||O.color;return new me.A({cap:j,color:re,width:se})})).apply(this,arguments)}function V(O){return null!=O&&"object"==typeof O&&"min"in O&&"max"in O}function T(O,z,j){const se=function D(O,z){if(!z.field)return null;if("featureReduction"in O)switch(O.featureReduction?.type){case"cluster":case"binning":{const j=O.featureReduction.fields.find(({name:se})=>se.toLowerCase()===z.field.toLowerCase());return j&&"getField"in O?O.getField(j.onStatisticField):null}}return"getField"in O?O.getField?.(z.field):null}(O,z);if(!se||!(0,I.fs)(se)&&!(0,he.OH)(se))return null;let re=function x(O,z){const j="popupTemplate"in O?O.popupTemplate?.fieldInfos:null;if(j?.length&&z)return j.find(se=>se.fieldName?.toLowerCase()===z.toLowerCase())?.format?.dateFormat}(O,se.name);if(!re&&"date"===se.type){let xe=0,X=0;z.stops?(xe=z.stops?.at(0)?.value??xe,X=z.stops?.at(-1)?.value??X):"minDataValue"in z&&"maxDataValue"in z&&(xe=z.minDataValue??xe,X=z.maxDataValue??X),re=X-xe>2*de.vf.days?"short-date":"short-date-short-time"}return{fieldType:se.type,format:re,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in O?O.preferredTimeZone:null,viewTimeZone:j,datesInUnknownTimezone:"datesInUnknownTimezone"in O&&O.datesInUnknownTimezone}}}function G(O){if("authoringInfo"in O)return O.authoringInfo?.visualVariables?.find(({theme:z})=>"reference-size"===z)}},87935:(nt,Pe,A)=>{A.r(Pe),A.d(Pe,{default:()=>Yl});var k=A(10467),_=A(8189),de=A(23159),he=A(35150),U=A(48900),I=A(85211),J=(A(3248),A(40707),A(76576)),be=A(11342),te=(A(13242),A(31178));function ue(y,g,v,M){let b=null,w=1e3;"number"==typeof g?(w=g,M=v):(b=g??null,w=v);let F,C=0;const L=()=>{C=0,y.apply(M,F)},S=(...Z)=>{b&&b.apply(M,Z),F=Z,w?C||(C=setTimeout(L,w)):L()};return S.remove=()=>{C&&(clearTimeout(C),C=0)},S.forceUpdate=()=>{C&&(clearTimeout(C),L())},S.hasPendingUpdates=()=>!!C,S}function D(y){switch(y?.type){case"point":return y;case"extent":return y.center;case"polygon":return y.centroid;case"multipoint":case"polyline":return y.extent?.center;default:return null}}A(21152),A(40856),A(28067);var j=A(46186);function re(y){return y?{backgroundImage:`url(${y})`}:{}}var X=A(48669),pe=A(2188),ae=A(5922),Be=A(63583),Qe=(A(73596),A(69287)),ke=A(82663);function It(y,g,v="arithmetic"){return{type:(0,ke.t$)(g),value:y,unit:g,rotationType:v}}(function wt(y,g){(0,ke.t$)(g)})(0,"meters"),function Et(y,g){(0,ke.t$)(g)}(0,"square-meters"),It(0,"radians"),It(0,"degrees"),It(0,"degrees","geographic");var _e=A(1119),Re=A(68479);const es=["B","kB","MB","GB","TB"];var ei=A(81098),Tt=A(98877),_o=A(70994),ts=A(52466),vi=A(48266),ri=A(86300),Fo=A(58443),Bi=A(43039),is=A(48218),$i=A(22639);const Ni=()=>he.A.getLogger("esri.widgets.Feature.support.featureUtils"),Co=/href=(""|'')/gi,xo=/(\{([^{\r\n]+)\})/g,Eo=/'/g,ns=/^\s*expression\//i,Lo=/(\n)/gi,To=/[\u00A0-\u9999<>&]/gim,Po=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,Ro=/^(?:mailto:|tel:)/,ss="relationships/",os=(0,vi.J2)("short-date-short-time");function rs(y){if(null!=y)return(y.sourceLayer||y.layer)??void 0}function Mi(y){return Ki.apply(this,arguments)}function Ki(){return(Ki=(0,k.A)(function*({type:y,value:g,event:v}){try{return"function"==typeof g?g(v):g}catch(M){return void Ni().error("error",`An error occurred when calling the "${y}" function`,{error:M,graphic:v.graphic,value:g})}})).apply(this,arguments)}function ls(y=""){if(y)return!Ro.test(y.trim().toLowerCase())}function zi(y){return!!y&&ns.test(y)}function as(y,g){const v=function Oo(y,g){if(!g||!zi(g)||!y)return;const v=g.replace(ns,"").toLowerCase();return y.find(({name:M})=>M.toLowerCase()===v)}(g,y?.fieldName);return v?v.title||null:y?y.label||y.fieldName:null}function li(y,g){const v=ki(g,y);return v?v.name:y}function ki(y,g){return y&&"function"==typeof y.getField&&g?y.getField(g)??null:null}function ds(y){return`${y}`.trim()}function Nt({attributes:y,globalAttributes:g,layer:v,text:M,expressionAttributes:b,fieldInfoMap:w}){return M?ji({formattedAttributes:g,template:$o(M,{...g,...b,...y},v),fieldInfoMap:w}):""}function ji({formattedAttributes:y,template:g,fieldInfoMap:v}){return ds(function So(y){return y.replaceAll(Co,"")}((0,_e.HC)((0,_e.HC)(g,M=>function Zo(y,g){return`{${g.get(y.toLowerCase())?.fieldName||y}}`}(M,v)),y)))}function Wi(y,g){return y.replaceAll(xo,(v,M,b)=>{const w=ki(g,b);return w?`{${w.name}}`:M})}function $o(y,g,v){const M=Wi(y,v);return M&&M.replaceAll(Po,(b,w,F)=>function Bo(y,g,v){const M=(g=ds(g))&&"{"!==g[0];return(0,_e.HC)(y,function Vo(y,g=!1){const v={...y};return Object.keys(v).forEach(M=>function Do(y,g,v=!1){const M=g[y];if("string"==typeof M){const b="%27",w=(v?encodeURIComponent(M):M).replaceAll(Eo,b);g[y]=w}}(M,v,g)),v}(v,M||!1))}(b,w||F,g))}function Hi(y){return function Ko(y){return null!=y&&"object"==typeof y&&"fieldsIndex"in y&&"geometryType"in y&&"getField"in y&&"load"in y&&"loaded"in y&&"objectIdField"in y&&"spatialReference"in y&&"type"in y&&("feature"===y.type||"scene"===y.type||"sublayer"===y.type)&&"when"in y}(y)&&function zo(y){return null!=y&&"object"==typeof y&&"createQuery"in y&&"queryFeatureCount"in y&&"queryObjectIds"in y&&"queryRelatedFeatures"in y&&"queryRelatedFeaturesCount"in y&&"relationships"in y}(y)}function Gi(y,g,v,M){return y.trim().split(g).map(b=>(0,Re.ZV)(Number(b),(0,Re.yx)(M))).join(v)}function us(y,g){if(y?.length&&g)return y.find(v=>v.fieldName?.toLowerCase()===g.toLowerCase())}function cs(y){const g=[];if(!y)return g;const{fieldInfos:v,content:M}=y;return v&&g.push(...v),M&&Array.isArray(M)&&M.forEach(b=>{if("fields"===b.type){const w=b?.fieldInfos;w&&g.push(...w)}}),g}function Qi(y){return y.replaceAll(To,g=>`&#${g.charCodeAt(0)};`)}function ai(y){return"string"==typeof y?y.replaceAll(Lo,'<br class="esri-text-new-line" />'):y}function hs(y){const{value:g,fieldName:v,fieldInfos:M,fieldInfoMap:b,layer:w,graphic:F,timeZone:C}=y;if(null==g)return"";const L=function Ho({fieldName:y,value:g,graphic:v,layer:M}){if(Pt(y)||!M||"function"!=typeof M.getFieldDomain)return null;const b=v&&M.getFieldDomain(y,{feature:v});return b&&"coded-value"===b.type?b.getName(g):null}({fieldName:v,value:g,graphic:F,layer:w});if(L)return L;const S=function Wo({fieldName:y,graphic:g,layer:v}){if(Pt(y)||!v||"function"!=typeof v.getFeatureType)return null;const{typeIdField:M}=v;if(!M||y!==M)return null;const b=v.getFeatureType(g);return b?b.name:null}({fieldName:v,graphic:F,layer:w});if(S)return S;if(b.get(v.toLowerCase()))return function ko(y,g){const{fieldInfos:v,fieldName:M,preventPlacesFormatting:b,layer:w,timeZone:F}=g,C=us(v,M),L=ki(w,M);if(C&&!(0,ri.JL)(M)){const Z=L?.type,W=C.format?.dateFormat;if("date"===Z||"date-only"===Z||"time-only"===Z||"timestamp-offset"===Z||W)return(0,Bi.i0)(y,{format:W,fieldType:Z,timeZoneOptions:{layerTimeZone:w&&"preferredTimeZone"in w?w.preferredTimeZone:null,viewTimeZone:F,datesInUnknownTimezone:!(!w||!("datesInUnknownTimezone"in w)||!w.datesInUnknownTimezone)}})}const S=C?.format;return"string"==typeof y&&(0,ri.JL)(M)&&S?function jo(y,g){return y=y.trim(),/\d{2}-\d{2}/.test(y)?y:y.includes(",")?Gi(y,",",", ",g):y.includes(";")?Gi(y,";","; ",g):y.includes(" ")?Gi(y," "," ",g):(0,Re.ZV)(Number(y),(0,Re.yx)(g))}(y,S):"string"==typeof(y=function No(y,g){if("string"==typeof y&&g&&null==g.dateFormat&&(null!=g.places||null!=g.digitSeparator)){const v=Number(y);if(!isNaN(v))return v}return y}(y,S))||null==y||null==S?ai(y):(0,Re.ZV)(y,b?{...(0,Re.yx)(S),minimumFractionDigits:0,maximumFractionDigits:20}:(0,Re.yx)(S))}(g,{fieldInfos:M||Array.from(b.values()),fieldName:v,layer:w,timeZone:C});const Z=w?.fieldsIndex?.get(v);return Z&&((0,Bi.fs)(Z)||(0,ri.OH)(Z))?(0,Bi.i0)(g,{fieldType:Z.type,timeZoneOptions:{layerTimeZone:w&&"preferredTimeZone"in w?w.preferredTimeZone:null,viewTimeZone:C,datesInUnknownTimezone:!(!w||!("datesInUnknownTimezone"in w)||!w.datesInUnknownTimezone)}}):ai(g)}function Yi({fieldInfos:y,attributes:g,layer:v,graphic:M,fieldInfoMap:b,relatedInfos:w,timeZone:F}){const C={};return w?.forEach(L=>function qo({attributes:y,relatedInfo:g,fieldInfoMap:v,fieldInfos:M,layer:b,timeZone:w}){y&&g&&(g.relatedFeatures?.forEach(F=>ms({attributes:y,graphic:F,relatedInfo:g,fieldInfoMap:v,fieldInfos:M,layer:b,timeZone:w})),g.relatedStatsFeatures?.forEach(F=>ms({attributes:y,graphic:F,relatedInfo:g,fieldInfoMap:v,fieldInfos:M,layer:b,timeZone:w})))}({attributes:C,relatedInfo:L,fieldInfoMap:b,fieldInfos:y,layer:v,timeZone:F})),g&&Object.keys(g).forEach(L=>{C[L]=hs({fieldName:L,fieldInfos:y,fieldInfoMap:b,layer:v,value:g[L],graphic:M,timeZone:F})}),C}function ps(y,g){return Xi.apply(this,arguments)}function Xi(){return(Xi=(0,k.A)(function*(y,g){const{layer:v,graphic:M,outFields:b,objectIds:w,returnGeometry:F,spatialReference:C}=y,L=w[0];if("number"!=typeof L&&"string"!=typeof L){const Z="Could not query required fields for the specified feature. The feature's ID is invalid.",W={layer:v,graphic:M,objectId:L,requiredFields:b};return Ni().warn(Z,W),null}if(!(0,Fo.BR)(v)?.operations?.supportsQuery){const Z="The specified layer cannot be queried. The following fields will not be available.",W={layer:v,graphic:M,requiredFields:b,returnGeometry:F};return Ni().warn(Z,W),null}const S=v.createQuery();return S.objectIds=w,S.outFields=b?.length?b:[v.objectIdField],S.returnGeometry=!!F,S.returnZ=!!F,S.returnM=!!F,S.outSpatialReference=C,(yield v.queryFeatures(S,g)).features[0]})).apply(this,arguments)}function Ji(){return(Ji=(0,k.A)(function*(y){if(!y.expressionInfos?.length)return!1;const g=yield(0,is.lw)(),{arcadeUtils:{hasGeometryFunctions:v}}=g;return v(y)})).apply(this,arguments)}function qi(){return qi=(0,k.A)(function*({graphic:y,popupTemplate:g,layer:v,spatialReference:M},b){if(!v||!g||("function"==typeof v.load&&(yield v.load(b)),!y.attributes))return;const w=y.attributes[v.objectIdField];if(null==w)return;const F=[w],C=yield g.getRequiredFields(v.fieldsIndex),L=(0,ri.Kl)(C,y),S=L?[]:C,Z=g.returnGeometry||(yield function Yo(y){return Ji.apply(this,arguments)}(g));if(L&&!Z)return;const W=yield ps({layer:v,graphic:y,outFields:S,objectIds:F,returnGeometry:Z,spatialReference:M},b);W&&(W.geometry&&(y.geometry=W.geometry),W.attributes&&(y.attributes={...y.attributes,...W.attributes}))}),qi.apply(this,arguments)}function Pt(y=""){return!!y&&y.includes(ss)}function ms({attributes:y,graphic:g,relatedInfo:v,fieldInfos:M,fieldInfoMap:b,layer:w,timeZone:F}){y&&g&&v&&Object.keys(g.attributes).forEach(C=>{const L=function Jo(y){return y?`${ss}${y.layerId}/${y.fieldName}`:""}({layerId:v.relation.id.toString(),fieldName:C});y[L]=hs({fieldName:L,fieldInfos:M,fieldInfoMap:b,layer:w,value:g.attributes[C],graphic:g,timeZone:F})})}const fs=y=>{if(!y)return!1;const g=y.toUpperCase();return g.includes("CURRENT_TIMESTAMP")||g.includes("CURRENT_DATE")||g.includes("CURRENT_TIME")},ys=({layer:y,method:g,query:v,definitionExpression:M})=>{if(!y.capabilities?.query?.supportsCacheHint||"attachments"===g)return;const b=null!=v.where?v.where:null,w=null!=v.geometry?v.geometry:null;fs(M)||fs(b)||"extent"===w?.type||"tile"===v.resultType||(v.cacheHint=!0)};function bi({relationship:{relatedTableId:y},layer:g,layers:v}){if(!v)return null;const M=v.filter(Hi);if("sublayer"===g.type)return M.find(w=>w!==g&&w.id===y);const b="scene"===g.type&&g.associatedLayer?g.associatedLayer.url:g.url;return b?M.find(w=>w!==g&&w.url===b&&w.layerId===y):null}const gs={editing:!1,operations:{add:!0,update:!0,delete:!0}},vs=te.A.ofType(_o.A);let ht=class extends Tt.A{constructor(y){super(y),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...gs},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new vs,this.fileInfos=new te.A,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles((0,U.wB)(()=>this.graphic,()=>this._graphicChanged(),U.Vh))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(y){return{...gs,...y}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:y}=this;if(!y)return!1;const g=y.layer||y.sourceLayer;return g?.loaded&&"capabilities"in g&&g.capabilities&&"operations"in g.capabilities&&"supportsResizeAttachments"in g.capabilities.operations&&g.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){var y=this;return(0,k.A)(function*(){const{_attachmentLayer:g,attachmentInfos:v}=y;if(!g||"function"!=typeof g.queryAttachments)throw new ae.A("invalid-layer","getAttachments(): A valid layer is required.");const M=y._getObjectId(),b=new ts.A({objectIds:[M],returnMetadata:!0}),w=[],F=g.queryAttachments(b).then(L=>L[M]||w).catch(()=>w);y._getAttachmentsPromise=F,y.notifyChange("state");const C=yield F;return v.drain(L=>L.destroy()),C.length&&v.addMany(C),y._getAttachmentsPromise=null,y.notifyChange("state"),C})()}addAttachment(y,g=this.graphic){var v=this;return(0,k.A)(function*(){const{_attachmentLayer:M,attachmentInfos:b,capabilities:w}=v;if(!g)throw new ae.A("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:g});if(!y)throw new ae.A("invalid-attachment","addAttachment(): An attachment is required.",{attachment:y});if(!w.operations?.add)throw new ae.A("invalid-capabilities","addAttachment(): add capabilities are required.");if(!M||"function"!=typeof M.addAttachment)throw new ae.A("invalid-layer","addAttachment(): A valid layer is required.");const F=M.addAttachment(g,y).then(L=>v._queryAttachment(L.objectId,g)),C=yield F;return b.add(C),C})()}deleteAttachment(y){var g=this;return(0,k.A)(function*(){const{_attachmentLayer:v,attachmentInfos:M,graphic:b,capabilities:w}=g;if(!y)throw new ae.A("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:y});if(!w.operations?.delete)throw new ae.A("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!v||"function"!=typeof v.deleteAttachments)throw new ae.A("invalid-layer","deleteAttachment(): A valid layer is required.");if(!b)throw new ae.A("invalid-graphic","deleteAttachment(): A graphic is required.");const F=v.deleteAttachments(b,[y.id]).then(()=>y),C=yield F;return M.remove(C),C.destroy(),C})()}updateAttachment(y,g=this.activeAttachmentInfo){var v=this;return(0,k.A)(function*(){const{_attachmentLayer:M,attachmentInfos:b,graphic:w,capabilities:F}=v;if(!y)throw new ae.A("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:y});if(!g)throw new ae.A("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:g});if(!F.operations?.update)throw new ae.A("invalid-capabilities","updateAttachment(): Update capabilities are required.");const C=b.indexOf(g);if(!M||"function"!=typeof M.updateAttachment)throw new ae.A("invalid-layer","updateAttachment(): A valid layer is required.");if(!w)throw new ae.A("invalid-graphic","updateAttachment(): A graphic is required.");const L=M.updateAttachment(w,g.id,y).then(Z=>v._queryAttachment(Z.objectId)),S=yield L;return b.splice(C,1,S),S})()}commitFiles(){var y=this;return(0,k.A)(function*(){return yield Promise.all(y.fileInfos.items.map(g=>y.addAttachment(g.form))),y.fileInfos.removeAll(),y.getAttachments()})()}addFile(y,g){if(!y||!g)return null;const v={file:y,form:g};return this.fileInfos.add(v),v}updateFile(y,g,v=this.activeFileInfo){if(!y||!g||!v)return null;const M=this.fileInfos.indexOf(v);return M>-1&&this.fileInfos.splice(M,1,{file:y,form:g}),this.fileInfos.items[M]}deleteFile(y){const g=this.fileInfos.find(v=>v.file===y);return g?(this.fileInfos.remove(g),g):null}_queryAttachment(y,g){var v=this;return(0,k.A)(function*(){const{_attachmentLayer:M}=v;if(!y||!M?.queryAttachments)throw new ae.A("invalid-attachment-id","Could not query attachment.");const b=v._getObjectId(g),w=new ts.A({objectIds:[b],attachmentsWhere:`AttachmentId=${y}`,returnMetadata:!0});return M.queryAttachments(w).then(F=>F[b][0])})()}_getObjectId(y=this.graphic){return y?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:y}=this,g=rs(y);this._attachmentLayer=g?"scene"===g.type&&null!=g.associatedLayer?g.associatedLayer:g:null}};(0,_._)([(0,I.MZ)()],ht.prototype,"capabilities",void 0),(0,_._)([(0,X.w)("capabilities")],ht.prototype,"castCapabilities",null),(0,_._)([(0,I.MZ)()],ht.prototype,"activeAttachmentInfo",void 0),(0,_._)([(0,I.MZ)()],ht.prototype,"activeFileInfo",void 0),(0,_._)([(0,I.MZ)({readOnly:!0,type:vs})],ht.prototype,"attachmentInfos",void 0),(0,_._)([(0,I.MZ)()],ht.prototype,"fileInfos",void 0),(0,_._)([(0,I.MZ)({type:ei.A})],ht.prototype,"graphic",void 0),(0,_._)([(0,I.MZ)()],ht.prototype,"mode",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ht.prototype,"state",null),(0,_._)([(0,I.MZ)()],ht.prototype,"filesEnabled",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ht.prototype,"supportsResizeAttachments",null),ht=(0,_._)([(0,J.$)("esri.widgets.Attachments.AttachmentsViewModel")],ht);const en=ht;var nr=A(90261);function Ms(y){const g=y.toLowerCase();return"image/bmp"===g||"image/emf"===g||"image/exif"===g||"image/gif"===g||"image/x-icon"===g||"image/jpeg"===g||"image/png"===g||"image/tiff"===g||"image/x-wmf"===g}var Kt=A(98091),Oe=A(92190);var At=A(60421),ft=A(5668),N=A(56295);const bs={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},$e="esri-attachments",Ie={base:$e,loaderContainer:`${$e}__loader-container`,loader:`${$e}__loader`,fadeIn:`${$e}--fade-in`,container:`${$e}__container`,containerList:`${$e}__container--list`,containerPreview:`${$e}__container--preview`,actions:`${$e}__actions`,deleteButton:`${$e}__delete-button`,addAttachmentButton:`${$e}__add-attachment-button`,errorMessage:`${$e}__error-message`,items:`${$e}__items`,item:`${$e}__item`,itemButton:`${$e}__item-button`,itemMask:`${$e}__item-mask`,itemMaskIcon:`${$e}__item-mask--icon`,itemImage:`${$e}__image`,itemImageResizable:`${$e}__image--resizable`,itemLabel:`${$e}__label`,itemFilename:`${$e}__filename`,itemChevronIcon:`${$e}__item-chevron-icon`,itemLink:`${$e}__item-link`,itemLinkOverlay:`${$e}__item-link-overlay`,itemLinkOverlayIcon:`${$e}__item-link-overlay-icon`,itemEditIcon:`${$e}__item-edit-icon`,itemAddIcon:`${$e}__item-add-icon`,itemAddButton:`${$e}__item-add-button`,formNode:`${$e}__form-node`,fileFieldset:`${$e}__file-fieldset`,fileLabel:`${$e}__file-label`,fileName:`${$e}__file-name`,fileInput:`${$e}__file-input`,metadata:`${$e}__metadata`,metadataFieldset:`${$e}__metadata-fieldset`,progressBar:`${$e}__progress-bar`},tn=window.CSS;let ot=class extends pe.A{constructor(y,g){super(y,g),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...bs},this._supportsImageOrientation=tn&&tn.supports&&tn.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(y){return y?.viewModel||(y={viewModel:new en,...y}),y}initialize(){this.addHandles([(0,U.on)(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),(0,U.on)(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),(0,U.wB)(()=>this.viewModel?.mode,()=>this._modeChanged(),U.Vh)])}loadDependencies(){return(0,Kt.W)({icon:()=>Promise.all([A.e(2597),A.e(8278)]).then(A.bind(A,8278))})}get capabilities(){return this.viewModel.capabilities}set capabilities(y){this.viewModel.capabilities=y}get effectiveDisplayType(){const{displayType:y}=this;return y&&"auto"!==y?y:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(y){this.viewModel.graphic=y}get icon(){return"attachment"}set icon(y){this._overrideIfSome("icon",y)}get label(){return this.messages?.widgetLabel??""}set label(y){this._overrideIfSome("label",y)}castVisibleElements(y){return{...bs,...y}}addAttachment(){const{_addAttachmentForm:y,viewModel:g}=this;return this._set("submitting",!0),this._set("error",null),g.addAttachment(y).then(v=>(this._set("submitting",!1),this._set("error",null),g.mode="view",v)).catch(v=>{throw this._set("submitting",!1),this._set("error",new ae.A("attachments:add-attachment",this.messages.addErrorMessage,v)),v})}deleteAttachment(y){const{viewModel:g}=this;return this._set("submitting",!0),this._set("error",null),g.deleteAttachment(y).then(v=>(this._set("submitting",!1),this._set("error",null),g.mode="view",v)).catch(v=>{throw this._set("submitting",!1),this._set("error",new ae.A("attachments:delete-attachment",this.messages.deleteErrorMessage,v)),v})}updateAttachment(){const{viewModel:y}=this,{_updateAttachmentForm:g}=this;return this._set("submitting",!0),this._set("error",null),y.updateAttachment(g).then(v=>(this._set("submitting",!1),this._set("error",null),y.mode="view",v)).catch(v=>{throw this._set("submitting",!1),this._set("error",new ae.A("attachments:update-attachment",this.messages.updateErrorMessage,v)),v})}addFile(){const y=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",y}updateFile(){const{viewModel:y}=this,g=y.updateFile(this.selectedFile,this._updateAttachmentForm,y.activeFileInfo);return y.mode="view",g}deleteFile(y){const g=this.viewModel.deleteFile(y||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",g}render(){const{submitting:y,viewModel:g}=this,{state:v}=g;return(0,N.K)("div",{class:this.classes(Ie.base,Oe.D.widget)},y?this._renderProgressBar():null,"loading"===v?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:y,visibleElements:g}=this;return y&&g.errorMessage?(0,N.K)("div",{class:Ie.errorMessage,key:"error-message"},y.message):null}_renderAttachments(){const{activeFileInfo:y,mode:g,activeAttachmentInfo:v}=this.viewModel;return"add"===g?this._renderAddForm():"edit"===g?this._renderDetailsForm(v||y):this._renderAttachmentContainer()}_renderLoading(){return(0,N.K)("div",{class:Ie.loaderContainer,key:"loader"},(0,N.K)("div",{class:Ie.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?(0,N.K)("div",{class:Ie.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:y,selectedFile:g}=this,v=y||!g,M=this.visibleElements.cancelAddButton?(0,N.K)("button",{bind:this,class:this.classes(Oe.D.button,Oe.D.buttonTertiary,Oe.D.buttonSmall,Oe.D.buttonHalf,y&&Oe.D.buttonDisabled),disabled:y,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,b=this.visibleElements.addSubmitButton?(0,N.K)("button",{class:this.classes(Oe.D.button,Oe.D.buttonSecondary,Oe.D.buttonSmall,Oe.D.buttonHalf,{[Oe.D.buttonDisabled]:v}),disabled:v,type:"submit"},this.messages.add):null,w=g?(0,N.K)("span",{class:Ie.fileName,key:"file-name"},g.name):null,F=(0,N.K)("form",{afterCreate:At.cA,afterRemoved:At.N_,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,N.K)("fieldset",{class:Ie.fileFieldset},w,(0,N.K)("label",{class:this.classes(Ie.fileLabel,Oe.D.button,Oe.D.buttonSecondary)},g?this.messages.changeFile:this.messages.selectFile,(0,N.K)("input",{bind:this,class:Ie.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),b,M);return(0,N.K)("div",{class:Ie.formNode,key:"add-form-container"},F)}_renderDetailsForm(y){const{visibleElements:g,viewModel:v,selectedFile:M,submitting:b}=this,{capabilities:w}=v,F=b||!M;let C,L,S,Z;M?(C=M.type,L=M.name,S=M.size):y&&"file"in y?(C=y.file.type,L=y.file.name,S=y.file.size):y&&"contentType"in y&&(C=y.contentType,L=y.name,S=y.size,Z=y.url);const W=w.editing&&w.operations?.delete&&g.deleteButton?(0,N.K)("button",{bind:this,class:this.classes(Oe.D.button,Oe.D.buttonSmall,Oe.D.buttonTertiary,Ie.deleteButton,{[Oe.D.buttonDisabled]:b}),disabled:b,key:"delete-button",onclick:Me=>this._submitDeleteAttachment(Me,y),type:"button"},this.messages.delete):void 0,H=w.editing&&w.operations?.update&&g.updateButton?(0,N.K)("button",{class:this.classes(Oe.D.button,Oe.D.buttonSmall,Oe.D.buttonThird,{[Oe.D.buttonDisabled]:F}),disabled:F,key:"update-button",type:"submit"},this.messages.update):void 0,ee=this.visibleElements.cancelUpdateButton?(0,N.K)("button",{bind:this,class:this.classes(Oe.D.button,Oe.D.buttonSmall,Oe.D.buttonTertiary,Oe.D.buttonThird,{[Oe.D.buttonDisabled]:b}),disabled:b,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,ne=w.editing&&w.operations?.update?(0,N.K)("fieldset",{class:Ie.fileFieldset,key:"file"},(0,N.K)("span",{class:Ie.fileName,key:"file-name"},L),(0,N.K)("label",{class:this.classes(Ie.fileLabel,Oe.D.button,Oe.D.buttonSecondary)},this.messages.changeFile,(0,N.K)("input",{bind:this,class:Ie.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,ce=(0,N.K)("fieldset",{class:Ie.metadataFieldset,key:"size"},(0,N.K)("label",null,function Ao(y,g){let v=0===(g=Math.round(g))?0:Math.floor(Math.log(g)/Math.log(Be.u.KILOBYTES));v=(0,Qe.qE)(v,0,es.length-1);const M=(0,Re.ZV)(g/Be.u.KILOBYTES**v,{maximumFractionDigits:2});return(0,_e.HC)(y.units.bytes[es[v]],{fileSize:M})}(this.messagesUnits,S??0))),ye=(0,N.K)("fieldset",{class:Ie.metadataFieldset,key:"content-type"},(0,N.K)("label",null,C)),Fe=null!=Z?(0,N.K)("a",{class:Ie.itemLink,href:Z,rel:"noreferrer",target:"_blank"},this._renderImageMask(y,400),(0,N.K)("div",{class:Ie.itemLinkOverlay},(0,N.K)("span",{class:Ie.itemLinkOverlayIcon},(0,N.K)("calcite-icon",{icon:"launch"})))):this._renderImageMask(y,400),Ze=(0,N.K)("form",{afterCreate:At.cA,afterRemoved:At.N_,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:Me=>this._submitUpdateAttachment(Me,y)},(0,N.K)("div",{class:Ie.metadata},ce,ye),ne,(0,N.K)("div",{class:Ie.actions},W,ee,H));return(0,N.K)("div",{class:Ie.formNode,key:"edit-form-container"},Fe,Ze)}_renderImageMask(y,g){return y?"file"in y?this._renderGenericImageMask(y.file.name,y.file.type):this._renderImageMaskForAttachment(y,g):null}_renderGenericImageMask(y,g){const{supportsResizeAttachments:v}=this.viewModel,M=function sr(y){const g=(0,nr.s)("esri/themes/base/images/files/");return y?"text/plain"===y?`${g}text-32.svg`:"application/pdf"===y?`${g}pdf-32.svg`:"text/csv"===y?`${g}csv-32.svg`:"application/gpx+xml"===y?`${g}gpx-32.svg`:"application/x-dwf"===y?`${g}cad-32.svg`:"application/postscript"===y||"application/json"===y||"text/xml"===y||"model/vrml"===y?`${g}code-32.svg`:"application/x-zip-compressed"===y||"application/x-7z-compressed"===y||"application/x-gzip"===y||"application/x-tar"===y||"application/x-gtar"===y||"application/x-bzip2"===y||"application/gzip"===y||"application/x-compress"===y||"application/x-apple-diskimage"===y||"application/x-rar-compressed"===y||"application/zip"===y?`${g}zip-32.svg`:y.includes("image/")?`${g}image-32.svg`:y.includes("audio/")?`${g}sound-32.svg`:y.includes("video/")?`${g}video-32.svg`:y.includes("msexcel")||y.includes("ms-excel")||y.includes("spreadsheetml")?`${g}excel-32.svg`:y.includes("msword")||y.includes("ms-word")||y.includes("wordprocessingml")?`${g}word-32.svg`:y.includes("powerpoint")||y.includes("presentationml")?`${g}report-32.svg`:`${g}generic-32.svg`:`${g}generic-32.svg`}(g),b={[Ie.itemImageResizable]:v};return(0,N.K)("div",{class:this.classes(Ie.itemMaskIcon,Ie.itemMask),key:M},(0,N.K)("img",{alt:y,class:this.classes(b,Ie.itemImage),src:M,title:y}))}_renderImageMaskForAttachment(y,g){const{supportsResizeAttachments:v}=this.viewModel;if(!y)return null;const{contentType:M,name:b,url:w}=y;if(!v||!Ms(M))return this._renderGenericImageMask(b,M);const F=this._getCSSTransform(y),C=F?{transform:F,"image-orientation":"none"}:{},L=`${w}${w?.includes("?")?"&":"?"}w=${g}`,S={[Ie.itemImageResizable]:v};return(0,N.K)("div",{class:this.classes(Ie.itemMask),key:L},(0,N.K)("img",{alt:b,class:this.classes(S,Ie.itemImage),src:L,styles:C,title:b}))}_renderFile(y){const{file:g}=y;return(0,N.K)("li",{class:Ie.item,key:g},(0,N.K)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:Ie.itemButton,key:"details-button",onclick:()=>this._startEditFile(y),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(y),(0,N.K)("label",{class:Ie.itemLabel},(0,N.K)("span",{class:Ie.itemFilename},g.name||this.messages.noTitle),(0,N.K)("span",{"aria-hidden":"true",class:this.classes(Ie.itemChevronIcon,(0,At.V8)(this.container)?"esri-icon-left":"esri-icon-right")}))))}_renderAttachmentInfo({attachmentInfo:y,displayType:g}){const{viewModel:v,effectiveDisplayType:M}=this,{capabilities:b,supportsResizeAttachments:w}=v,{contentType:F,name:C,url:L}=y,S=this._renderImageMask(y,"list"===g?48:400),Z=b.editing?(0,N.K)("span",{"aria-hidden":"true",class:this.classes(Ie.itemChevronIcon,(0,At.V8)(this.container)?"esri-icon-left":"esri-icon-right")}):null,W=[S,"preview"===M&&w&&Ms(F)?null:(0,N.K)("label",{class:Ie.itemLabel},(0,N.K)("span",{class:Ie.itemFilename},C||this.messages.noTitle),Z)],H=b.editing?(0,N.K)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:Ie.itemButton,"data-attachment-info-id":y.id,key:"details-button",onclick:()=>this._startEditAttachment(y),title:this.messages.attachmentDetails,type:"button"},W):(0,N.K)("a",{class:Ie.itemButton,href:L??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},W);return(0,N.K)("li",{class:Ie.item,key:y},H)}_renderAttachmentContainer(){const{effectiveDisplayType:y,viewModel:g,visibleElements:v}=this,{attachmentInfos:M,capabilities:b,fileInfos:w}=g,F=!!M?.length,C=!!w?.length,L={[Ie.containerList]:"preview"!==y,[Ie.containerPreview]:"preview"===y},S=b.editing&&b.operations?.add&&v.addButton?(0,N.K)("button",{bind:this,class:this.classes(Oe.D.button,Oe.D.buttonTertiary,Ie.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},(0,N.K)("span",{"aria-hidden":"true",class:this.classes(Ie.itemAddIcon,"esri-icon-plus")}),this.messages.add):void 0,Z=F?(0,N.K)("ul",{class:Ie.items,key:"attachments-list"},M.toArray().map(ee=>this._renderAttachmentInfo({attachmentInfo:ee,displayType:y}))):void 0,W=C?(0,N.K)("ul",{class:Ie.items,key:"file-list"},w.toArray().map(ee=>this._renderFile(ee))):void 0,H=C||F?void 0:(0,N.K)("div",{class:Oe.D.empty},this.messages.noAttachments);return(0,N.K)("div",{class:this.classes(Ie.container,L),key:"attachments-container"},Z,W,H,S)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(y){const g=y.target,v=g.files?.item(0);this._set("selectedFile",v)}_submitDeleteAttachment(y,g){y.preventDefault(),g&&("file"in g?this.deleteFile(g.file):g&&this.deleteAttachment(g))}_submitAddAttachment(y){y.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(y,g){y.preventDefault(),g&&"file"in g?this.updateFile():this.updateAttachment()}_startEditAttachment(y){const{viewModel:g}=this;g.activeFileInfo=null,g.activeAttachmentInfo=y,g.mode="edit"}_startEditFile(y){const{viewModel:g}=this;g.activeAttachmentInfo=null,g.activeFileInfo=y,g.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(y){y.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(y){const{orientationInfo:g}=y;return!this._supportsImageOrientation&&g?[g.rotation?`rotate(${g.rotation}deg)`:"",g.mirrored?"scaleX(-1)":""].join(" "):""}};(0,_._)([(0,I.MZ)()],ot.prototype,"capabilities",null),(0,_._)([(0,I.MZ)()],ot.prototype,"displayType",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ot.prototype,"effectiveDisplayType",null),(0,_._)([(0,I.MZ)()],ot.prototype,"graphic",null),(0,_._)([(0,I.MZ)()],ot.prototype,"icon",null),(0,_._)([(0,I.MZ)()],ot.prototype,"label",null),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/widgets/Attachments/t9n/Attachments")],ot.prototype,"messages",void 0),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/core/t9n/Units")],ot.prototype,"messagesUnits",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ot.prototype,"selectedFile",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ot.prototype,"submitting",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ot.prototype,"error",void 0),(0,_._)([(0,I.MZ)({type:en})],ot.prototype,"viewModel",void 0),(0,_._)([(0,I.MZ)()],ot.prototype,"visibleElements",void 0),(0,_._)([(0,X.w)("visibleElements")],ot.prototype,"castVisibleElements",null),ot=(0,_._)([(0,J.$)("esri.widgets.Attachments")],ot);const or=ot;let di=class extends en{constructor(y){super(y),this.description=null,this.title=null}};(0,_._)([(0,I.MZ)()],di.prototype,"description",void 0),(0,_._)([(0,I.MZ)()],di.prototype,"title",void 0),di=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],di);const nn=di;var sn=A(53158);const on="esri-feature-element-info",rn={base:on,title:`${on}__title`,description:`${on}__description`};let ti=class extends pe.A{constructor(y,g){super(y,g),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,N.K)("div",{class:rn.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:y}=this;return y?(0,N.K)(sn.D,{class:rn.title,innerHTML:y,level:this.headingLevel}):null}_renderDescription(){const{description:y}=this;return y?(0,N.K)("div",{class:rn.description,innerHTML:y,key:"description"}):null}};(0,_._)([(0,I.MZ)()],ti.prototype,"description",void 0),(0,_._)([(0,I.MZ)()],ti.prototype,"headingLevel",void 0),(0,_._)([(0,I.MZ)()],ti.prototype,"title",void 0),ti=(0,_._)([(0,J.$)("esri.widgets.Feature.support.FeatureElementInfo")],ti);const wi=ti;let Ct=class extends pe.A{constructor(y,g){super(y,g),this._featureElementInfo=null,this.attachmentsWidget=new or,this.headingLevel=2,this.viewModel=new nn}initialize(){this._featureElementInfo=new wi,this.addHandles([(0,U.wB)(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),U.Vh),(0,U.wB)(()=>this.viewModel,y=>this.attachmentsWidget.viewModel=y,U.Vh)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(y){this.viewModel.description=y}get displayType(){return this.attachmentsWidget.displayType}set displayType(y){this.attachmentsWidget.displayType=y}get graphic(){return this.viewModel.graphic}set graphic(y){this.viewModel.graphic=y}get title(){return this.viewModel.title}set title(y){this.viewModel.title=y}render(){const{attachmentsWidget:y}=this;return(0,N.K)("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),y?.render())}_setupFeatureElementInfo(){const{description:y,title:g,headingLevel:v}=this;this._featureElementInfo?.set({description:y,title:g,headingLevel:v})}};(0,_._)([(0,I.MZ)({readOnly:!0})],Ct.prototype,"attachmentsWidget",void 0),(0,_._)([(0,I.MZ)()],Ct.prototype,"description",null),(0,_._)([(0,I.MZ)()],Ct.prototype,"displayType",null),(0,_._)([(0,I.MZ)()],Ct.prototype,"graphic",null),(0,_._)([(0,I.MZ)()],Ct.prototype,"headingLevel",void 0),(0,_._)([(0,I.MZ)()],Ct.prototype,"title",null),(0,_._)([(0,I.MZ)({type:nn})],Ct.prototype,"viewModel",void 0),Ct=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureAttachments")],Ct);const lr=Ct;let Ut=class extends Tt.A{constructor(y){super(y),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,U.wB)(()=>this.creator,g=>{this._destroyContent(),this._createContent(g)},U.Vh))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:y,graphic:g,destroyer:v}=this;y&&g&&(Mi({type:"content",value:v,event:{graphic:g}}),this._set("created",null))}_createContent(y){var g=this;return(0,k.A)(function*(){const v=g.graphic;if(!v||!y)return;const M=Mi({type:"content",value:y,event:{graphic:v}});g._loadingPromise=M,g.notifyChange("state");const b=yield M;M===g._loadingPromise&&(g._loadingPromise=null,g.notifyChange("state"),g._set("created",b))})()}};(0,_._)([(0,I.MZ)({readOnly:!0})],Ut.prototype,"created",void 0),(0,_._)([(0,I.MZ)()],Ut.prototype,"creator",void 0),(0,_._)([(0,I.MZ)()],Ut.prototype,"destroyer",void 0),(0,_._)([(0,I.MZ)({type:ei.A})],Ut.prototype,"graphic",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],Ut.prototype,"state",null),Ut=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Ut);const Ai=Ut;var ln=A(44182);const an="esri-feature-content",dn={base:an,loaderContainer:`${an}__loader-container`,loader:`${an}__loader`};let ii=class extends pe.A{constructor(y,g){super(y,g),this.viewModel=null,this._addTargetToAnchors=v=>{Array.from(v.querySelectorAll("a")).forEach(M=>{ls(M.href)&&!M.hasAttribute("target")&&M.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(y){this.viewModel&&(this.viewModel.creator=y)}get graphic(){return this.viewModel?.graphic}set graphic(y){this.viewModel&&(this.viewModel.graphic=y)}render(){const y=this.viewModel?.state;return(0,N.K)("div",{class:dn.base},"loading"===y?this._renderLoading():this._renderCreated())}_renderLoading(){return(0,N.K)("div",{class:dn.loaderContainer,key:"loader"},(0,N.K)("div",{class:dn.loader}))}_renderCreated(){const y=this.viewModel?.created;return y?y instanceof HTMLElement?(0,N.K)("div",{afterCreate:this._attachToNode,bind:y,key:y}):(0,ln.p4)(y)?(0,N.K)("div",{key:y},!y.destroyed&&y.render()):(0,N.K)("div",{afterCreate:this._addTargetToAnchors,innerHTML:y,key:y}):null}_attachToNode(y){y.appendChild(this)}};(0,_._)([(0,I.MZ)()],ii.prototype,"creator",null),(0,_._)([(0,I.MZ)()],ii.prototype,"graphic",null),(0,_._)([(0,I.MZ)({type:Ai})],ii.prototype,"viewModel",void 0),ii=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureContent")],ii);const _i=ii;var ar=A(26025),ws=A(61099);let Ot=class extends Tt.A{constructor(y){super(y),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:y,fieldInfos:g}=this,v=[];return g?.forEach(M=>{if(M.hasOwnProperty("visible")&&!M.visible)return;const b=M.clone();b.label=as(b,y),v.push(b)}),v}};(0,_._)([(0,I.MZ)()],Ot.prototype,"attributes",void 0),(0,_._)([(0,I.MZ)({type:[ar.A]})],Ot.prototype,"expressionInfos",void 0),(0,_._)([(0,I.MZ)()],Ot.prototype,"description",void 0),(0,_._)([(0,I.MZ)({type:[ws.A]})],Ot.prototype,"fieldInfos",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],Ot.prototype,"formattedFieldInfos",null),(0,_._)([(0,I.MZ)()],Ot.prototype,"title",void 0),Ot=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Ot);const Fi=Ot,dr=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}],Ii="esri-feature-fields",Ci={base:Ii,fieldHeader:`${Ii}__field-header`,fieldData:`${Ii}__field-data`,fieldDataDate:`${Ii}__field-data--date`};let _t=class extends pe.A{constructor(y,g){super(y,g),this._featureElementInfo=null,this.viewModel=new Fi,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new wi,this.addHandles((0,U.wB)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),U.Vh))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(y){this.viewModel.attributes=y}get description(){return this.viewModel.description}set description(y){this.viewModel.description=y}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(y){this.viewModel.expressionInfos=y}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(y){this.viewModel.fieldInfos=y}get title(){return this.viewModel.title}set title(y){this.viewModel.title=y}render(){return(0,N.K)("div",{class:Ci.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(y,g){const{attributes:v}=this.viewModel,M=y.fieldName||"",b=y.label||M,w=v?null==v[M]?"":v[M]:"",F=!!y.format?.dateFormat,C="number"!=typeof w||F?function ur(y,g){if("string"!=typeof g||!g)return g;const v=dr.find(L=>L.pattern.test(g));if(!v)return g;const M=g.match(v.pattern),b=M?.[2],w=(0,_e.HC)((0,_e.HC)(v.label,{messages:y,hierPart:b}),{appName:v.appName});return g.replace(v.pattern,`<a${v.target?` target="${v.target}"`:""} href="$1"${"_blank"===v.target?' rel="noreferrer"':""}>${w}</a>`)}(this.messagesURIUtils,w):this._forceLTR(w),L={[Ci.fieldDataDate]:F};return(0,N.K)("tr",{key:`fields-element-info-row-${M}-${g}`},(0,N.K)("th",{class:Ci.fieldHeader,innerHTML:b,key:`fields-element-info-row-header-${M}-${g}`}),(0,N.K)("td",{class:this.classes(Ci.fieldData,L),innerHTML:C,key:`fields-element-info-row-data-${M}-${g}`}))}_renderFields(){const{formattedFieldInfos:y}=this.viewModel;return y?.length?(0,N.K)("table",{class:Oe.D.table,summary:this.messages.fieldsSummary},(0,N.K)("tbody",null,y.map((g,v)=>this._renderFieldInfo(g,v)))):null}_setupFeatureElementInfo(){const{description:y,title:g}=this;this._featureElementInfo?.set({description:y,title:g})}_forceLTR(y){return`&lrm;${y}`}};(0,_._)([(0,I.MZ)()],_t.prototype,"attributes",null),(0,_._)([(0,I.MZ)()],_t.prototype,"description",null),(0,_._)([(0,I.MZ)()],_t.prototype,"expressionInfos",null),(0,_._)([(0,I.MZ)()],_t.prototype,"fieldInfos",null),(0,_._)([(0,I.MZ)()],_t.prototype,"title",null),(0,_._)([(0,I.MZ)({type:Fi,nonNullable:!0})],_t.prototype,"viewModel",void 0),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/widgets/Feature/t9n/Feature")],_t.prototype,"messages",void 0),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/widgets/support/t9n/uriUtils")],_t.prototype,"messagesURIUtils",void 0),_t=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureFields")],_t);const As=_t;var cr=A(76157),zt=A(89952),hr=A(60797),vt=(A(91515),A(5236),A(83393)),pr=A(36634),mr=A(3114);function yt(y,g,v){return un.apply(this,arguments)}function un(){return(un=(0,k.A)(function*(y,g,v){(0,hr.tE)(y,g,()=>[]).push(...v)})).apply(this,arguments)}function cn(){return(cn=(0,k.A)(function*(y){const g=new Map;if(!y)return g;if("visualVariables"in y&&y.visualVariables){const v=y.visualVariables.filter(M=>"color"===M.type);for(const M of v){const b=((yield(0,pr.getRampStops)(M))??[]).map(w=>w.color);yield yt(g,M.field||M.valueExpression,b)}}if("heatmap"===y.type){const v=function fr(y){if(!y.colorStops)return[];const g=[...y.colorStops].filter(M=>M.color?.a>0);let v=g.length-1;if(g&&g[0]){const M=g[v];M&&1!==M.ratio&&(g.push(new mr.A({ratio:1,color:M.color})),v++)}return g.map((M,b)=>{let w="";return 0===b?w=y.legendOptions?.minLabel||"low":b===v&&(w=y.legendOptions?.maxLabel||"high"),{color:M.color,label:w,ratio:M.ratio}}).reverse()}(y).map(M=>M.color);yield yt(g,y.field||y.valueExpression,v)}else if("pie-chart"===y.type){for(const v of y.attributes)yield yt(g,v.field||v.valueExpression,[v.color]);yield yt(g,"default",[y?.othersCategory?.color,(0,vt.Sx)(y.backgroundFillSymbol,null)])}else if("dot-density"===y.type){for(const v of y.attributes)yield yt(g,v.field||v.valueExpression,[v.color]);yield yt(g,"default",[y.backgroundColor])}else if("unique-value"===y.type)if("predominance"===y.authoringInfo?.type)for(const v of y.uniqueValueInfos??[])yield yt(g,v.value.toString(),[(0,vt.Sx)(v.symbol,null)]);else{const v=(y.uniqueValueInfos??[]).map(C=>(0,vt.Sx)(C.symbol,null)),{field:M,field2:b,field3:w,valueExpression:F}=y;(M||F)&&(yield yt(g,M||F,v)),b&&(yield yt(g,b,v)),w&&(yield yt(g,w,v))}else if("class-breaks"===y.type){const v=y.classBreakInfos.map(w=>(0,vt.Sx)(w.symbol,null)),{field:M,valueExpression:b}=y;yield yt(g,M??b,v)}else"simple"===y.type&&(yield yt(g,"default",[(0,vt.Sx)(y.symbol,null)]));return"defaultSymbol"in y&&y.defaultSymbol&&(yield yt(g,"default",[(0,vt.Sx)(y.defaultSymbol,null)])),g.forEach((v,M)=>{const b=(0,zt.Am)(v.filter(Boolean),(w,F)=>JSON.stringify(w)===JSON.stringify(F));g.set(M,b)}),g})).apply(this,arguments)}(0,vi.J2)("short-date");var Ar=A(19457),_r=A(89563),Xe=A(56492),mn=(A(93164),A(34687)),fn=(A(23098),A(77469),A(45272),A(87477),A(58701),A(2296),A(68643),A(21870),A(1749)),yn=(A(55861),A(93615),A(20914),A(32034),A(47258),A(55912),A(93327),A(87086)),gn=A(59487),Fr=(A(61569),A(16842));const Is=()=>he.A.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),Cs=new Map;function xi(y){if(!Pt(y))return null;const[g,v]=y.split("/").slice(1);return{layerId:g,fieldName:v}}function vn(){return(vn=(0,k.A)(function*(y,g,v,M){const b=v.layerId.toString(),{layerInfo:w,relation:F,relatedFields:C,outStatistics:L,url:S,sourceSpatialReference:Z}=g,W=function Or(y){return y?(0,zt.Am)(y):void 0}(C),H=function Zr(y){return y?(0,zt.Am)(y,(g,v)=>JSON.stringify(g.toJSON())===JSON.stringify(v.toJSON())):void 0}(L);if(!w||!F)return null;const ee=function xr({originRelationship:y,relationships:g,layerId:v}){return g.find(({relatedTableId:M,id:b})=>`${M}`===v&&b===y?.id)??null}({originRelationship:F,relationships:w.relationships,layerId:b});if(ee?.relationshipTableId&&ee.keyFieldInRelationshipTable){const ce=(yield function Pr(y,g,v,M){const b=new gn.default;return b.outFields=["*"],b.relationshipId="number"==typeof g.id?g.id:parseInt(g.id,10),b.objectIds=[y.attributes[v.objectIdField]],v.queryRelatedFeatures?.(b,M)??Promise.resolve({})}(y,ee,v,M))[y.attributes[v.objectIdField]];if(!ce)return null;const ye=ce.features.map(Fe=>Fe.attributes[w.objectIdField]);if(H?.length&&w.supportsStatistics){const Fe=new yn.A;Fe.where=function Rr(y,g,v){let M=0;const b=[];for(;M<g.length;)b.push(`${y} IN (${g.slice(M,v+M)})`),M+=v;return b.join(" OR ")}(w.objectIdField,ye,1e3),Fe.outFields=W,Fe.outStatistics=H,Fe.sourceSpatialReference=Z;const Ze={features:Promise.resolve(ce),statsFeatures:(0,mn.s)(S,Fe)};return(0,Xe.Lx)(Ze)}}const ne=ee?.keyField;if(ne){const ce=(0,ri.WA)(function $r(y,g){if(null!=y){g=g.toLowerCase();for(const v of y)if(v&&v.name.toLowerCase()===g)return v}return null}(w.fields,ne)),ye=function Er(y,g){const v=g.toLowerCase();for(const M in y)if(M.toLowerCase()===v)return y[M];return null}(y.attributes,F.keyField),Fe=ce?`${ne}=${ye}`:`${ne}='${ye}'`,Ze=(0,mn.s)(S,new yn.A({where:Fe,outFields:W,sourceSpatialReference:Z}),M),Me=H?.length&&w.supportsStatistics?(0,mn.s)(S,new yn.A({where:Fe,outFields:W,outStatistics:H,sourceSpatialReference:Z}),M):null,Ge={features:Ze};return Me&&(Ge.statsFeatures=Me),(0,Xe.Lx)(Ge)}return null})).apply(this,arguments)}const xs={chartAnimation:!0};let et=class extends Tt.A{constructor(y){super(y),this.abilities={...xs},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(y){return{...xs,...y}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(y){this._setContentElementMedia(y)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(y){const{formattedMediaInfoCount:g}=this;this.activeMediaInfoIndex=(y+g)%g}_pageContentElementMedia(y){const{activeMediaInfoIndex:g}=this;this._setContentElementMedia(g+y)}_formatMediaInfos(){const{mediaInfos:y,layer:g}=this,v=this.attributes??{},M=this.formattedAttributes??{},b=this.expressionAttributes??{},w=this.fieldInfoMap??new Map;return y?.map(F=>{const C=F?.clone();return C?(C.title=Nt({attributes:v,fieldInfoMap:w,globalAttributes:M,expressionAttributes:b,layer:g,text:C.title}),C.caption=Nt({attributes:v,fieldInfoMap:w,globalAttributes:M,expressionAttributes:b,layer:g,text:C.caption}),C.altText=Nt({attributes:v,fieldInfoMap:w,globalAttributes:M,expressionAttributes:b,layer:g,text:C.altText}),"image"===C.type?C.value?(this._setImageValue({value:C.value,formattedAttributes:M,layer:g}),C.value.sourceURL?C:void 0):void 0:"pie-chart"===C.type||"line-chart"===C.type||"column-chart"===C.type||"bar-chart"===C.type?C.value?(this._setChartValue({value:C.value,chartType:C.type,attributes:v,formattedAttributes:M,layer:g,expressionAttributes:b}),C):void 0:null):null}).filter(zt.Ru)??[]}_setImageValue(y){const g=this.fieldInfoMap??new Map,{value:v,formattedAttributes:M,layer:b}=y,{linkURL:w,sourceURL:F}=v;if(F){const C=Wi(F,b);v.sourceURL=ji({formattedAttributes:M,template:C,fieldInfoMap:g})}if(w){const C=Wi(w,b);v.linkURL=ji({formattedAttributes:M,template:C,fieldInfoMap:g})}}_setChartValue(y){const{value:g,attributes:v,formattedAttributes:M,chartType:b,layer:w,expressionAttributes:F}=y,{popupTemplate:C,relatedInfos:L}=this,{fields:S,normalizeField:Z}=g,W=w;if(g.fields=function Uo(y,g){return y&&y.map(v=>li(v,g))}(S,W),Z&&(g.normalizeField=li(Z,W)),!S.some(ee=>!!(null!=M[ee]||Pt(ee)&&L?.size)))return;const H=C?.fieldInfos??[];S.forEach((ee,ne)=>{const ce=g.colors?.[ne];if(Pt(ee))return void(g.series=[...g.series,...this._getRelatedChartInfos({fieldInfos:H,fieldName:ee,formattedAttributes:M,chartType:b,value:g,color:ce})]);const ye=this._getChartOption({value:g,attributes:v,chartType:b,formattedAttributes:M,expressionAttributes:F,fieldName:ee,fieldInfos:H,color:ce});g.series.push(ye)})}_getRelatedChartInfos(y){const{fieldInfos:g,fieldName:v,formattedAttributes:M,chartType:b,value:w,color:F}=y,C=[],L=xi(v),S=L&&this.relatedInfos?.get(L.layerId.toString());if(!S)return C;const{relatedFeatures:Z,relation:W}=S;if(!W||!Z)return C;const{cardinality:H}=W;return Z.forEach(ee=>{const{attributes:ne}=ee;ne&&Object.keys(ne).forEach(ce=>{ce===L.fieldName&&C.push(this._getChartOption({value:w,attributes:ne,formattedAttributes:M,fieldName:v,chartType:b,relatedFieldName:ce,hasMultipleRelatedFeatures:Z?.length>1,fieldInfos:g,color:F}))})}),"one-to-many"===H||"many-to-many"===H?C:[C[0]]}_getTooltip({label:y,value:g,chartType:v}){return"pie-chart"===v?`${y}`:`${y}: ${g}`}_getChartOption(y){const{value:g,attributes:v,formattedAttributes:M,expressionAttributes:b,fieldName:w,relatedFieldName:F,fieldInfos:C,chartType:L,hasMultipleRelatedFeatures:S,color:Z}=y,W=this.layer,H=this.fieldInfoMap??new Map,{normalizeField:ee,tooltipField:ne}=g,ce=ee?Pt(ee)?v[xi(ee).fieldName]:v[ee]:null,ye=zi(w)&&b&&void 0!==b[w]?b[w]:F&&void 0!==v[F]?v[F]:void 0!==v[w]?v[w]:M[w],Fe=new Ar.A({fieldName:w,color:Z,value:void 0===ye?null:ye&&ce?ye/ce:ye});if(Pt(w)){const at=H.get(w.toLowerCase()),Mt=ne&&H.get(ne.toLowerCase()),Si=at?.fieldName??w,yi=S&&ne?xi(ne).fieldName:Mt?.fieldName??ne;return Fe.tooltip=this._getTooltip({label:S&&yi?v[yi]:M[yi]??at?.label??at?.fieldName??F,value:S&&F?v[F]:M[Si],chartType:L}),Fe}const Ze=us(C,w),Me=li(w,W),Ge=ne&&void 0!==M[ne]?M[ne]:as(Ze||new ws.A({fieldName:Me}),this.popupTemplate?.expressionInfos);return Fe.tooltip=this._getTooltip({label:Ge,value:M[Me],chartType:L}),Fe}};(0,_._)([(0,I.MZ)()],et.prototype,"abilities",void 0),(0,_._)([(0,X.w)("abilities")],et.prototype,"castAbilities",null),(0,_._)([(0,I.MZ)()],et.prototype,"activeMediaInfoIndex",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],et.prototype,"activeMediaInfo",null),(0,_._)([(0,I.MZ)()],et.prototype,"attributes",void 0),(0,_._)([(0,I.MZ)()],et.prototype,"description",void 0),(0,_._)([(0,I.MZ)()],et.prototype,"fieldInfoMap",void 0),(0,_._)([(0,I.MZ)()],et.prototype,"formattedAttributes",void 0),(0,_._)([(0,I.MZ)()],et.prototype,"expressionAttributes",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],et.prototype,"formattedMediaInfos",null),(0,_._)([(0,I.MZ)()],et.prototype,"isAggregate",void 0),(0,_._)([(0,I.MZ)()],et.prototype,"layer",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],et.prototype,"formattedMediaInfoCount",null),(0,_._)([(0,I.MZ)()],et.prototype,"mediaInfos",void 0),(0,_._)([(0,I.MZ)()],et.prototype,"popupTemplate",void 0),(0,_._)([(0,I.MZ)()],et.prototype,"relatedInfos",void 0),(0,_._)([(0,I.MZ)()],et.prototype,"title",void 0),et=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],et);const kt=et;var Nr=A(67722);const tt="esri-feature-media",dt={base:tt,mediaContainer:`${tt}__container`,mediaItemContainer:`${tt}__item-container`,mediaItem:`${tt}__item`,mediaItemText:`${tt}__item-text`,mediaItemTitle:`${tt}__item-title`,mediaItemCaption:`${tt}__item-caption`,mediaNavigation:`${tt}__item-navigation`,mediaPagination:`${tt}__pagination`,mediaPaginationText:`${tt}__pagination-text`,mediaPrevious:`${tt}__previous`,mediaPreviousIconLTR:`${tt}__previous-icon`,mediaPreviousIconRTL:`${tt}__previous-icon--rtl`,mediaNext:`${tt}__next`,mediaNextIconLTR:`${tt}__next-icon`,mediaNextIconRTL:`${tt}__next-icon--rtl`,mediaChart:`${tt}__chart`,mediaPaginationButton:`${tt}__pagination-button`,mediaPaginationIcon:`${tt}__pagination-icon`,mediaChartRendered:`${tt}__chart--rendered`},Dt="category",hi="value";let ut=class extends pe.A{constructor(y,g){var v;super(y,g),v=this,this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new kt,this.messages=null,this._disposeChart=M=>{this._chartRootMap.get(M)?.dispose(),this._chartRootMap.delete(M)},this._createChart=function(){var M=(0,k.A)(function*(b){const{destroyed:w,viewModel:F}=v;if(w||!F||!b)return;const{createRoot:C}=yield Promise.all([A.e(3568),A.e(2076),A.e(959)]).then(A.bind(A,60959)),L=yield C(b);v._chartRootMap.set(b,L),v._renderChart({mediaInfo:F.activeMediaInfo,root:L})});return function(b){return M.apply(this,arguments)}}()}initialize(){this._featureElementInfo=new wi,this.addHandles([(0,U.wB)(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),U.Vh),(0,U.wB)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),U.Vh)])}loadDependencies(){return(0,Kt.W)({icon:()=>Promise.all([A.e(2597),A.e(8278)]).then(A.bind(A,8278))})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(y){this.viewModel.attributes=y}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(y){this.viewModel.activeMediaInfoIndex=y}get description(){return this.viewModel.description}set description(y){this.viewModel.description=y}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(y){this.viewModel.fieldInfoMap=y}get layer(){return this.viewModel.layer}set layer(y){this.viewModel.layer=y}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(y){this.viewModel.mediaInfos=y}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(y){this.viewModel.popupTemplate=y}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(y){this.viewModel.relatedInfos=y}get title(){return this.viewModel.title}set title(y){this.viewModel.title=y}render(){return(0,N.K)("div",{bind:this,class:dt.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:y,activeMediaInfoIndex:g}=this.viewModel,v=this._renderMediaText();return y?(0,N.K)("div",{class:dt.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,N.K)("div",{class:dt.mediaNavigation},v,y>1?(0,N.K)("div",{class:dt.mediaPagination},this._renderMediaPageButton("previous"),(0,N.K)("span",{class:dt.mediaPaginationText},(0,j.V)(this.messages.pageText,{index:g+1,total:y})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:y}=this.viewModel;if(!y)return null;const g=y&&y.title?(0,N.K)("div",{class:dt.mediaItemTitle,innerHTML:y.title,key:"media-title"}):null,v=y&&y.caption?(0,N.K)("div",{class:dt.mediaItemCaption,innerHTML:y.caption,key:"media-caption"}):null;return g||v?(0,N.K)("div",{class:dt.mediaItemText,key:"media-text"},g,v):null}_renderImageMediaInfo(y){if(!y.value)return null;const{_refreshIntervalInfo:g}=this,{activeMediaInfoIndex:v,formattedMediaInfoCount:M}=this.viewModel,{value:b,refreshInterval:w,altText:F,title:C,type:L}=y,{sourceURL:S,linkURL:Z}=b,W=ls(Z??void 0)?"_blank":"_self",H="_blank"===W?"noreferrer":"",ee=w?g:null,ye=(0,N.K)("img",{alt:F||C,key:`media-${L}-${v}-${M}-${ee?ee.timestamp:0}`,src:(ee?ee.sourceURL:S)??void 0});return(Z?(0,N.K)("a",{href:Z,rel:H,target:W,title:C},ye):null)??ye}_renderChartMediaInfo(y){const{activeMediaInfoIndex:g,formattedMediaInfoCount:v}=this.viewModel;return(0,N.K)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:dt.mediaChart,key:`media-${y.type}-${g}-${v}`})}_renderMediaInfoType(){const{activeMediaInfo:y}=this.viewModel;return y?"image"===y.type?this._renderImageMediaInfo(y):y.type.includes("chart")?this._renderChartMediaInfo(y):null:null}_renderMediaInfo(){const{activeMediaInfo:y}=this.viewModel;return y?(0,N.K)("div",{class:dt.mediaItemContainer,key:"media-container"},(0,N.K)("div",{class:dt.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(y){if(this.viewModel.formattedMediaInfoCount<2)return null;const g="previous"===y,v=g?this.messages.previous:this.messages.next;return(0,N.K)("button",{"aria-label":v,bind:this,class:dt.mediaPaginationButton,key:g?"media-previous":"media-next",onclick:g?this._previous:this._next,tabIndex:0,title:v,type:"button"},(0,N.K)("calcite-icon",{class:dt.mediaPaginationIcon,icon:g?"chevron-left":"chevron-right",scale:"s"}))}_setupFeatureElementInfo(){const{description:y,title:g}=this;this._featureElementInfo?.set({description:y,title:g})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:y,layer:g}=this.viewModel;return y&&g?.featureReduction&&"renderer"in g.featureReduction?g.featureReduction.renderer:g?.renderer}_getSeriesColors(y){return(0,k.A)(function*(){const{colorAm5:g}=yield Promise.all([A.e(3568),A.e(2076),A.e(4674)]).then(A.bind(A,14674)),v=new Map;return y.forEach(M=>{M.color&&v.set(M,g(M.color.toCss(!0)))}),v})()}_getRendererColors(){var y=this;return(0,k.A)(function*(){const{colorAm5:g}=yield Promise.all([A.e(3568),A.e(2076),A.e(4674)]).then(A.bind(A,14674)),v=new Map,M=y._getRenderer();if(!M)return v;const w=yield function vr(y){return cn.apply(this,arguments)}(M);return w.delete("default"),Array.from(w.values()).every(F=>1===F?.length)&&Array.from(w.keys()).forEach(F=>{const C=w.get(F)?.[0]?.toCss(!0);C&&v.set(F,g(C))}),v})()}_handleMediaKeyup(y){const{key:g}=y;"ArrowLeft"===g&&(y.stopPropagation(),this.viewModel.previous()),"ArrowRight"===g&&(y.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!(0,cr.O)()}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}_renderChart(y){var g=this;return(0,k.A)(function*(){const{root:v,mediaInfo:M}=y,{value:b,type:w}=M,{ResponsiveThemeAm5:F,DarkThemeAm5:C,AnimatedThemeAm5:L,ColorSetAm5:S,ThemeAm5:Z,esriChartColorSet:W}=yield Promise.all([A.e(3568),A.e(2076),A.e(4674)]).then(A.bind(A,14674)),H=Z.new(v);H.rule("ColorSet").set("colors",W),H.rule("ColorSet").set("reuse",!0);const ee=[F.new(v),H];(0,Nr.g4)()&&ee.push(C.new(v)),g._canAnimateChart()&&ee.push(L.new(v)),v.setThemes(ee);const ne=yield g._getRendererColors(),ce=yield g._getSeriesColors(b.series),ye=S.new(v,{}),Fe=ce.get(b.series[0]),Ze=Fe?{lineSettings:{stroke:Fe}}:void 0,Me=b.series.map((Ge,mt)=>{const at=ce.get(Ge)||ne.get(Ge.fieldName)||ye.getIndex(mt);return{[Dt]:Ge.tooltip,[hi]:Ge.value,columnSettings:{fill:at,stroke:at},...Ze}}).filter(Ge=>"pie-chart"!==w||null!=Ge.value&&Ge.value>0);"pie-chart"===w?g._createPieChart(y,Me):g._createXYChart(y,Me)})()}_getDirection(){return(0,At.V8)(this.container)?"rtl":"ltr"}_isInversed(){return!!(0,At.V8)(this.container)}_customizeChartTooltip(y,g="horizontal"){var v=this;return(0,k.A)(function*(){const{colorAm5:M}=yield Promise.all([A.e(3568),A.e(2076),A.e(4674)]).then(A.bind(A,14674));y.setAll({pointerOrientation:g}),y.get("background")?.setAll({stroke:M("rgba(50, 50, 50, 1)")}),y.label.setAll({direction:v._getDirection(),oversizedBehavior:"wrap",maxWidth:200})})()}_createPieChart(y,g){var v=this;return(0,k.A)(function*(){const{TooltipAm5:M}=yield Promise.all([A.e(3568),A.e(2076),A.e(4674)]).then(A.bind(A,14674)),{PieChartAm5:b,PieSeriesAm5:w}=yield Promise.all([A.e(3568),A.e(6887),A.e(2644)]).then(A.bind(A,22644)),{mediaInfo:F,root:C}=y,{title:L}=F,W=C.container.children.push(b.new(C,{ariaLabel:F?.altText||F?.title||"",focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),H="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",ee=M.new(C,{labelText:H}),ne=W.series.push(w.new(C,{name:L,valueField:hi,categoryField:Dt,tooltip:ee}));ne.ticks.template.set("forceHidden",!0),ne.labels.template.set("forceHidden",!0),ne.slices.template.states.create("active",{shiftRadius:5}),v._customizeChartTooltip(ee),ne.slices.template.setAll({ariaLabel:H,focusable:!0,templateField:"columnSettings"}),ne.data.setAll(g),ne.appear(v._getChartSeriesAnimationMS()),W.appear(v._getChartAnimationMS()),W.root.dom.classList.toggle(dt.mediaChartRendered,!0)})()}_getMinSeriesValue(y){let g=0;return y.forEach(v=>g=Math.min(v.value,g)),g}_createColumnChart(y,g,v){var M=this;return(0,k.A)(function*(){const{TooltipAm5:b,ScrollbarAm5:w}=yield Promise.all([A.e(3568),A.e(2076),A.e(4674)]).then(A.bind(A,14674)),{CategoryAxisAm5:F,AxisRendererXAm5:C,ValueAxisAm5:L,AxisRendererYAm5:S,ColumnSeriesAm5:Z}=yield Promise.all([A.e(3568),A.e(6887),A.e(2076),A.e(9064)]).then(A.bind(A,29064)),{mediaInfo:W,root:H}=g,{value:ee,title:ne}=W;y.setAll({wheelX:"panX",wheelY:"zoomX"});const ce=y.xAxes.push(F.new(H,{renderer:C.new(H,{inversed:M._isInversed()}),categoryField:Dt}));ce.get("renderer").labels.template.setAll({forceHidden:!0});const ye=y.yAxes.push(L.new(H,{renderer:S.new(H,{inside:!1}),min:M._getMinSeriesValue(ee.series)}));ye.get("renderer").labels.template.setAll({direction:M._getDirection()});const Fe="{categoryX}",Ze=b.new(H,{labelText:Fe}),Me=y.series.push(Z.new(H,{name:ne,xAxis:ce,yAxis:ye,valueYField:hi,categoryXField:Dt,tooltip:Ze}));M._customizeChartTooltip(Ze),Me.columns.template.setAll({ariaLabel:Fe,focusable:!0,templateField:"columnSettings"}),ee.series.length>15&&y.set("scrollbarX",w.new(H,{orientation:"horizontal"})),ce.data.setAll(v),Me.data.setAll(v),Me.appear(M._getChartSeriesAnimationMS()),y.appear(M._getChartAnimationMS())})()}_createBarChart(y,g,v){var M=this;return(0,k.A)(function*(){const{TooltipAm5:b,ScrollbarAm5:w}=yield Promise.all([A.e(3568),A.e(2076),A.e(4674)]).then(A.bind(A,14674)),{CategoryAxisAm5:F,AxisRendererXAm5:C,ValueAxisAm5:L,AxisRendererYAm5:S,ColumnSeriesAm5:Z}=yield Promise.all([A.e(3568),A.e(6887),A.e(2076),A.e(9064)]).then(A.bind(A,29064)),{mediaInfo:W,root:H}=g,{value:ee,title:ne}=W;y.setAll({wheelX:"panY",wheelY:"zoomY"});const ce=y.yAxes.push(F.new(H,{renderer:S.new(H,{inversed:!0}),categoryField:Dt}));ce.get("renderer").labels.template.setAll({forceHidden:!0});const ye=y.xAxes.push(L.new(H,{renderer:C.new(H,{inside:!1,inversed:M._isInversed()}),min:M._getMinSeriesValue(ee.series)}));ye.get("renderer").labels.template.setAll({direction:M._getDirection()});const Fe="{categoryY}",Ze=b.new(H,{labelText:Fe}),Me=y.series.push(Z.new(H,{name:ne,xAxis:ye,yAxis:ce,valueXField:hi,categoryYField:Dt,tooltip:Ze}));M._customizeChartTooltip(Ze,"vertical"),Me.columns.template.setAll({ariaLabel:Fe,focusable:!0,templateField:"columnSettings"}),ee.series.length>15&&y.set("scrollbarY",w.new(H,{orientation:"vertical"})),ce.data.setAll(v),Me.data.setAll(v),Me.appear(M._getChartSeriesAnimationMS()),y.appear(M._getChartAnimationMS())})()}_createLineChart(y,g,v){var M=this;return(0,k.A)(function*(){const{TooltipAm5:b,ScrollbarAm5:w}=yield Promise.all([A.e(3568),A.e(2076),A.e(4674)]).then(A.bind(A,14674)),{CategoryAxisAm5:F,AxisRendererXAm5:C,ValueAxisAm5:L,AxisRendererYAm5:S,LineSeriesAm5:Z}=yield Promise.all([A.e(3568),A.e(6887),A.e(2076),A.e(9064)]).then(A.bind(A,29064)),{root:W,mediaInfo:H}=g,{value:ee,title:ne}=H;y.setAll({wheelX:"panX",wheelY:"zoomX"});const ce=y.xAxes.push(F.new(W,{renderer:C.new(W,{inversed:M._isInversed()}),categoryField:Dt}));ce.get("renderer").labels.template.setAll({forceHidden:!0});const ye=y.yAxes.push(L.new(W,{renderer:S.new(W,{inside:!1}),min:M._getMinSeriesValue(ee.series)}));ye.get("renderer").labels.template.setAll({direction:M._getDirection()});const Ze=v[0]?.lineSettings?.stroke,Me=b.new(W,{getFillFromSprite:!Ze,labelText:"{categoryX}"});Ze&&Me.get("background")?.setAll({fill:Ze});const Ge=y.series.push(Z.new(W,{name:ne,xAxis:ce,yAxis:ye,valueYField:hi,categoryXField:Dt,tooltip:Me}));Ge.strokes.template.setAll({templateField:"lineSettings"}),M._customizeChartTooltip(Me,"vertical"),ee.series.length>15&&y.set("scrollbarX",w.new(W,{orientation:"horizontal"})),ce.data.setAll(v),Ge.data.setAll(v),Ge.appear(M._getChartSeriesAnimationMS()),y.appear(M._getChartAnimationMS())})()}_createXYChart(y,g){var v=this;return(0,k.A)(function*(){const{XYChartAm5:M,XYCursorAm5:b}=yield Promise.all([A.e(3568),A.e(6887),A.e(2076),A.e(9064)]).then(A.bind(A,29064)),{root:w,mediaInfo:F}=y,{type:C}=F,S=w.container.children.push(M.new(w,{ariaLabel:F?.altText||F?.title||"",focusable:!0,panX:!0,panY:!0}));S.set("cursor",b.new(w,{})),"column-chart"===C&&(yield v._createColumnChart(S,y,g)),"bar-chart"===C&&(yield v._createBarChart(S,y,g)),"line-chart"===C&&(yield v._createLineChart(S,y,g)),S.root.dom.classList.toggle(dt.mediaChartRendered,!0)})()}_clearMediaRefreshTimer(){const{_refreshTimer:y}=this;y&&(clearTimeout(y),this._refreshTimer=null)}_updateMediaInfoTimestamp(y){const g=Date.now();this._refreshIntervalInfo={timestamp:g,sourceURL:y&&this._getImageSource(y,g)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:y}=this.viewModel;"image"===y?.type&&y?.refreshInterval>0&&this._setRefreshTimeout(y)}_setRefreshTimeout(y){const{refreshInterval:g,value:v}=y,M=6e4*g;this._updateMediaInfoTimestamp(v.sourceURL);const b=setInterval(()=>{this._updateMediaInfoTimestamp(v.sourceURL)},M);this._refreshTimer=b}_getImageSource(y,g){const v=y.includes("?")?"&":"?",[M,b=""]=y.split("#");return`${M}${v}timestamp=${g}${b?"#":""}${b}`}};(0,_._)([(0,I.MZ)()],ut.prototype,"_refreshIntervalInfo",void 0),(0,_._)([(0,I.MZ)()],ut.prototype,"attributes",null),(0,_._)([(0,I.MZ)()],ut.prototype,"activeMediaInfoIndex",null),(0,_._)([(0,I.MZ)()],ut.prototype,"description",null),(0,_._)([(0,I.MZ)()],ut.prototype,"fieldInfoMap",null),(0,_._)([(0,I.MZ)()],ut.prototype,"layer",null),(0,_._)([(0,I.MZ)()],ut.prototype,"mediaInfos",null),(0,_._)([(0,I.MZ)()],ut.prototype,"popupTemplate",null),(0,_._)([(0,I.MZ)()],ut.prototype,"relatedInfos",null),(0,_._)([(0,I.MZ)()],ut.prototype,"title",null),(0,_._)([(0,I.MZ)({type:kt})],ut.prototype,"viewModel",void 0),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/widgets/Feature/t9n/Feature")],ut.prototype,"messages",void 0),ut=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureMedia")],ut);const Es=ut;A(54042),A(75432),A(65121),A(558);var Wr=A(8975),Hr=A(90792),Ls=(A(83902),A(98089)),Gr=A(19969),Qr=A(35940);const Ts=()=>he.A.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function Xr(y){return"string"==typeof y?ai(Qi(y)):Array.isArray(y)?function Jr(y){return`<ul class="esri-widget__list">${y.map(g=>`<li>${"string"==typeof g?ai(Qi(g)):g}</li>`).join("")}</ul>`}(y):"esri.arcade.Dictionary"===y?.declaredClass?function qr(y){const g=y.keys().map(v=>{const M=y.field(v);return`<tr><th>${v}</th><td>${"string"==typeof M?ai(Qi(M)):M}</td></tr>`}).join("");return`<table class="${Oe.D.table}">${g}</table>`}(y):y}function Ps(){return Promise.all([A.e(7936),A.e(2076),A.e(5724)]).then(A.bind(A,55724))}function tl(y){return bn.apply(this,arguments)}function bn(){return(bn=(0,k.A)(function*({graphic:y,view:g,options:v}){const{isAggregate:M,layer:b}=y;if(!M||!b||"2d"!==g?.type)return[];const w=yield g.whenLayerView(b);if(!function el(y){return"createQuery"in y&&"queryFeatures"in y}(w))return[];const F=w.createQuery(),C=y.getObjectId();F.aggregateIds=null!=C?[C]:[];const{features:L}=yield w.queryFeatures(F,v);return L})).apply(this,arguments)}function Rs(y){return wn.apply(this,arguments)}function wn(){return(wn=(0,k.A)(function*({expressionInfo:y,arcade:g,interceptor:v,spatialReference:M,map:b,graphic:w,location:F,view:C,options:L}){if(!y?.expression)return null;const{isAggregate:S}=w,Z=(w.sourceLayer||w.layer)??void 0,W=S?"feature-reduction-popup":"popup",H=g.createArcadeProfile(W),ee=g.createArcadeExecutor(y.expression,H).catch(Me=>Ts().error("arcade-executor-error",{error:Me,expressionInfo:y})),[ne,ce]=yield Promise.all([tl({graphic:w,view:C,options:L}),ee]);if(!ce)return null;const ye="feature-reduction-popup"===W?function il({layer:y,aggregatedFeatures:g,interceptor:v}){const{fields:M,objectIdField:b,geometryType:w,spatialReference:F,displayField:C}=y;return new Qr.default({fields:M,objectIdField:b,geometryType:w,spatialReference:F,displayField:C,interceptor:v,..."feature"===y.type?{templates:y.templates,typeIdField:y.typeIdField,types:y.types}:null,source:g})}({layer:Z,aggregatedFeatures:ne,interceptor:v}):void 0,Fe={..."feature-reduction-popup"===W?{$aggregatedFeatures:ye}:{$datastore:Z?.url,$layer:"feature"===Z?.type||"subtype-sublayer"===Z?.type||"catalog-footprint"===Z?.type||"oriented-imagery"===Z?.type?Z:"scene"===Z?.type&&null!=Z.associatedLayer?Z.associatedLayer:void 0,$map:b,$userInput:F,$graph:"knowledge-graph-sublayer"===Z?.type?Z?.parentCompositeLayer?.knowledgeGraph:void 0},$feature:w},Ze={abortSignal:L?.signal??void 0,interceptor:v??void 0,rawOutput:!0,spatialReference:M??void 0,timeZone:C?.timeZone};return yield ce.executeAsync(Fe,Ze).catch(Me=>Ts().error("arcade-execution-error",{error:Me,graphic:w,expressionInfo:y})).finally(()=>ye?.destroy())})).apply(this,arguments)}function nl(y){return An.apply(this,arguments)}function An(){return(An=(0,k.A)(function*({expressionInfos:y,spatialReference:g,graphic:v,interceptor:M,map:b,view:w,location:F,options:C}){if(!y?.length)return{};const L=yield Ps(),S={};for(const H of y)S[`expression/${H.name}`]=Rs({expressionInfo:H,arcade:L,interceptor:M,spatialReference:g,map:b,graphic:v,location:F,view:w,options:C});const Z=yield(0,Xe.Lx)(S),W={};for(const H in Z)W[H]=Xr(Z[H].value);return W})).apply(this,arguments)}let pt=class extends Tt.A{constructor(y){var g;super(y),g=this,this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:v}=this;v&&v.abort(),this._abortController=null},this._createVM=()=>{const v=this.contentElement?.type;this.contentElementViewModel?.destroy();const M="fields"===v?new Fi:"media"===v?new kt:"text"===v?new Ai:null;this._set("contentElementViewModel",M)},this._compile=(0,k.A)(function*(){g._cancelQuery();const v=new AbortController;g._abortController=v,yield g._compileExpression(),g._abortController===v&&(g._abortController=null)}),this._compileThrottled=ue(this._compile,1,this),this._compileExpression=(0,k.A)(function*(){const{expressionInfo:v,graphic:M,interceptor:b,spatialReference:w,map:F,location:C,view:L,_abortController:S}=g;if(!v||!M)return void g._set("contentElement",null);const Z=yield Ps();if(S!==g._abortController)return;const W=yield Rs({arcade:Z,expressionInfo:v,graphic:M,location:C,interceptor:b,map:F,spatialReference:w,view:L});if(!W||"esri.arcade.Dictionary"!==W.declaredClass)return void g._set("contentElement",null);const H=yield W.castAsJsonAsync(S?.signal),ee=H?.type,ne="media"===ee?Hr.A.fromJSON(H):"text"===ee?Ls.A.fromJSON(H):"fields"===ee?Wr.A.fromJSON(H):null;g._set("contentElement",ne)}),this.addHandles([(0,U.wB)(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),U.Vh),(0,U.wB)(()=>[this.contentElement],()=>this._createVM(),U.Vh)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(y){this._override("spatialReference",y)}get state(){const{_abortController:y,contentElement:g,contentElementViewModel:v}=this;return y?"loading":g||v?"ready":"disabled"}get map(){return this.view?.map??null}set map(y){this._override("map",y)}};(0,_._)([(0,I.MZ)()],pt.prototype,"_abortController",void 0),(0,_._)([(0,I.MZ)({type:Gr.A})],pt.prototype,"expressionInfo",void 0),(0,_._)([(0,I.MZ)({type:ei.A})],pt.prototype,"graphic",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],pt.prototype,"contentElement",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],pt.prototype,"contentElementViewModel",void 0),(0,_._)([(0,I.MZ)()],pt.prototype,"interceptor",void 0),(0,_._)([(0,I.MZ)({type:fn.A})],pt.prototype,"location",void 0),(0,_._)([(0,I.MZ)()],pt.prototype,"spatialReference",null),(0,_._)([(0,I.MZ)({readOnly:!0})],pt.prototype,"state",null),(0,_._)([(0,I.MZ)()],pt.prototype,"map",null),(0,_._)([(0,I.MZ)()],pt.prototype,"view",void 0),pt=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],pt);const _n=pt,Os="esri-feature",Zs={base:`${Os}-expression`,loadingSpinnerContainer:`${Os}__loading-container`};let Ei=class extends pe.A{constructor(y,g){super(y,g),this._contentWidget=null,this.viewModel=new _n}initialize(){this.addHandles((0,U.wB)(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),U.Vh))}loadDependencies(){return(0,Kt.W)({loader:()=>A.e(2748).then(A.bind(A,2748))})}destroy(){this._destroyContentWidget()}render(){const{state:y}=this.viewModel;return(0,N.K)("div",{class:Zs.base},"loading"===y?this._renderLoading():"disabled"===y?null:this._contentWidget?.render())}_renderLoading(){return(0,N.K)("div",{class:Zs.loadingSpinnerContainer,key:"loading-container"},(0,N.K)("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:y}=this;y&&(y.viewModel=null,y.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:y,contentElement:g}=this.viewModel,v=g?.type;this._destroyContentWidget();const M=y?"fields"===v?new As({viewModel:y}):"media"===v?new Es({viewModel:y}):"text"===v?new _i({viewModel:y}):null:null;this._contentWidget=M,this.scheduleRender()}};(0,_._)([(0,I.MZ)({type:_n})],Ei.prototype,"viewModel",void 0),Ei=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureExpression")],Ei);const ol=Ei;var Fn,rl=A(11432),ll=A(90660),Ss=A(3046);A(69690),A(77806),A(54444),A(77365),(Fn||(Fn={})).TOO_SHORT="length-validation-error::too-short";const fl=y=>{const g=[];if(y.formTemplate){const{description:v,title:M}=y.formTemplate;y.fields?.forEach(b=>{const w=M&&(0,_e.mk)(M,b.name),F=v&&(0,_e.mk)(v,b.name);(w||F)&&g.push(b.name)})}return g};let ze=class extends((0,ll.O)((0,Ss.sA)(Tt.A))){constructor(y){var g;super(y),g=this,this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:v}=this;v&&v.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:v}=this;v&&v.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:v}=this;v&&v.abort(),this._queryPageAbortController=null},this._queryController=(0,k.A)(function*(){g._cancelQuery();const v=new AbortController;g._queryAbortController=v,yield(0,Xe.QZ)(g._query()),g._queryAbortController===v&&(g._queryAbortController=null)}),this._queryFeatureCountController=(0,k.A)(function*(){g._loaded=!1,g._cancelQueryFeatureCount();const v=new AbortController;g._queryFeatureCountAbortController=v,yield(0,Xe.QZ)(g._queryFeatureCount()),g._queryFeatureCountAbortController===v&&(g._queryFeatureCountAbortController=null),g._loaded=!0}),this._queryPageController=(0,k.A)(function*(){const v=new AbortController;g._queryPageAbortController=v,yield(0,Xe.QZ)(g._queryPage()),g._queryPageAbortController===v&&(g._queryPageAbortController=null)}),this._queryDebounced=(0,Xe.sg)(this._queryController,100),this._queryFeatureCountDebounced=(0,Xe.sg)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,Xe.sg)(this._queryPageController,100),this._query=(0,k.A)(function*(){const{_queryAbortController:v,relatedFeatures:M}=g;g.featureCount&&(g._destroyRelatedFeatureViewModels(),g.featurePage=1,M.drain(b=>b.destroy()),g.destroyed||M.addMany(g._sliceFeatures(yield g._queryRelatedFeatures({signal:v?.signal}))))}),this.addHandles([(0,U.wB)(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),U.Vh),(0,U.wB)(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),(0,U.wB)(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.drain(y=>y.destroy()),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(y){const{featuresPerPage:g,featureCount:v}=this,b=Math.ceil(v/g)||1;this._set("featurePage",Math.min(Math.max(y,1),b))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:y,relatedLayer:g}=this;return y&&g?.loaded?y.map(v=>{const M=v.clone();return M.field=li(v.field,g),M}):y??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&null!=this.relationshipId&&"number"==typeof this.objectId}get canQuery(){const y=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&null!=this.relationshipId&&null!=this.objectId&&y?.supportsCount&&y?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(y){this._set("displayCount",Math.min(Math.max(y,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new te.A}get relatedLayer(){const{layer:y,map:g,relationship:v}=this;return y?.loaded&&g&&v?function ir(y,g,v){return y&&g&&v?"sublayer"===g.type?bi({layers:g.layer?.sublayers,layer:g,relationship:v})||bi({layers:g.layer?.subtables,layer:g,relationship:v}):bi({layers:y.allLayers,layer:g,relationship:v})||bi({layers:y.allTables,layer:g,relationship:v}):null}(g,y,v)??null:null}get relationship(){const{relationshipId:y,layer:g}=this;return null!=y?g?.relationships?.find(({id:v})=>v===y)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new te.A}get state(){const{_queryAbortController:y,_queryFeatureCountAbortController:g,_queryPageAbortController:v,canQuery:M,_loaded:b,canLoad:w}=this;return g||w&&!b?"loading":y||v?"querying":M?"ready":"disabled"}getRelatedFeatureByObjectId(y){return this.relatedFeatures.find(g=>g.getObjectId()===y)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.forEach(y=>!y.destroyed&&y.destroy()),this.relatedFeatureViewModels.removeAll()}_queryFeatureCount(){var y=this;return(0,k.A)(function*(){const{layer:g,relatedLayer:v,relationshipId:M,objectId:b,_queryFeatureCountAbortController:w,canQuery:F,supportsCacheHint:C}=y;if(yield g?.load(),yield v?.load(),!F||!g||!v||null==b)return void y._set("featureCount",0);const L=v.createQuery(),S=new gn.default({cacheHint:C,relationshipId:M,returnGeometry:!1,objectIds:[b],where:L.where??void 0}),Z=yield g.queryRelatedFeaturesCount(S,{signal:w?.signal});y._set("featureCount",Z[b]||0)})()}_sliceFeatures(y){const{showAllEnabled:g,displayCount:v}=this;return g?y:v?y.slice(0,v):[]}_queryPage(){var y=this;return(0,k.A)(function*(){const{relatedFeatures:g,featurePage:v,showAllEnabled:M,_queryPageAbortController:b,featureCount:w}=y;!M||v<2||!w||g.addMany(yield y._queryRelatedFeatures({signal:b?.signal}))})()}_queryRelatedFeatures(y){var g=this;return(0,k.A)(function*(){const{orderByFieldsFixedCasing:v,showAllEnabled:M,featuresPerPage:b,displayCount:w,layer:F,relationshipId:C,featurePage:L,featureCount:S,relatedLayer:Z,supportsCacheHint:W}=g,{canQuery:H,objectId:ee}=g;if(!H||!F||!Z||null==ee)return[];const ne=M?((L-1)*b+S)%S:0,ce=M?b:w,ye=Z.objectIdField,Fe=[...v.map(Mt=>Mt.field),...fl(Z),ye].filter(zt.Ru),Ze=v.map(Mt=>`${Mt.field} ${Mt.order}`),Me=Z.createQuery(),Ge=new gn.default({orderByFields:Ze,start:ne,num:ce,outFields:Fe,cacheHint:W,relationshipId:C,returnGeometry:!1,objectIds:[ee],where:Me.where??void 0}),mt=yield F.queryRelatedFeatures(Ge,{signal:y?.signal}),at=mt[ee]?.features||[];return at.forEach(Mt=>{Mt.sourceLayer=Z,Mt.layer=Z}),at})()}};(0,_._)([(0,I.MZ)()],ze.prototype,"_loaded",void 0),(0,_._)([(0,I.MZ)()],ze.prototype,"_queryAbortController",void 0),(0,_._)([(0,I.MZ)()],ze.prototype,"_queryPageAbortController",void 0),(0,_._)([(0,I.MZ)()],ze.prototype,"_queryFeatureCountAbortController",void 0),(0,_._)([(0,I.MZ)({value:1})],ze.prototype,"featurePage",null),(0,_._)([(0,I.MZ)()],ze.prototype,"featuresPerPage",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"orderByFieldsFixedCasing",null),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"supportsCacheHint",null),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"canLoad",null),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"canQuery",null),(0,_._)([(0,I.MZ)()],ze.prototype,"description",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"itemDescriptionFieldName",null),(0,_._)([(0,I.MZ)({value:3})],ze.prototype,"displayCount",null),(0,_._)([(0,I.MZ)({type:ei.A})],ze.prototype,"graphic",void 0),(0,_._)([(0,I.MZ)()],ze.prototype,"layer",void 0),(0,_._)([(0,I.MZ)()],ze.prototype,"map",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"objectId",null),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"objectIdField",null),(0,_._)([(0,I.MZ)()],ze.prototype,"orderByFields",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"relatedFeatures",null),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"relatedLayer",null),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"relationship",null),(0,_._)([(0,I.MZ)()],ze.prototype,"featureCount",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ze.prototype,"relatedFeatureViewModels",null),(0,_._)([(0,I.MZ)()],ze.prototype,"relationshipId",void 0),(0,_._)([(0,I.MZ)()],ze.prototype,"showAllEnabled",void 0),(0,_._)([(0,I.MZ)()],ze.prototype,"state",null),(0,_._)([(0,I.MZ)()],ze.prototype,"title",void 0),ze=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],ze);const Cn=ze,Pi="esri-feature",pi=`${Pi}-relationship`,Vt={base:pi,listContainer:`${pi}__list`,listItem:`${pi}__list-item`,listItemHidden:`${pi}__list-item--hidden`,listContainerQuerying:`${pi}__list--querying`,featureObserver:`${Pi}__feature-observer`,stickySpinnerContainer:`${Pi}__sticky-loading-container`,loadingSpinnerContainer:`${Pi}__loading-container`},Ks={title:!0,description:!0};let ct=class extends pe.A{constructor(y,g){super(y,g),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([v])=>{v?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Cn,this.messages=null,this.messagesCommon=null,this.visibleElements={...Ks},this._increaseFeaturePage=()=>{const{state:v,showAllEnabled:M,relatedFeatures:b,featuresPerPage:w,featurePage:F}=this.viewModel;"ready"===v&&M&&b.length>=w*F&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new wi,this.addHandles([(0,U.wB)(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),U.Vh),(0,U.wB)(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),(0,U.on)(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return(0,Kt.W)({icon:()=>Promise.all([A.e(2597),A.e(8278)]).then(A.bind(A,8278)),list:()=>Promise.all([A.e(2597),A.e(1594),A.e(8991),A.e(4827),A.e(2076),A.e(861)]).then(A.bind(A,861)),"list-item":()=>Promise.all([A.e(2597),A.e(1594),A.e(8843),A.e(2076),A.e(4835)]).then(A.bind(A,4835)),loader:()=>A.e(2748).then(A.bind(A,2748)),notice:()=>Promise.all([A.e(2597),A.e(1594),A.e(5661)]).then(A.bind(A,85661))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,rl.pR)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:y,featureCount:g,displayCount:v,state:M}=this.viewModel;return!y&&!!g&&"ready"===M&&(g>v||0===v)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(y){this.viewModel.description=y}get featureCountDescription(){const{messages:y}=this,{featureCount:g}=this.viewModel;return(0,j.V)(y?.numberRecords,{number:g})}get title(){return this.viewModel.title}set title(y){this.viewModel.title=y}castVisibleElements(y){return{...Ks,...y}}render(){const{state:y}=this.viewModel;return(0,N.K)("div",{class:this.classes(Vt.base,Oe.D.widget)},this._featureElementInfo?.render(),"loading"===y?this._renderLoading():"disabled"===y?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,N.K)("div",{class:Vt.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,N.K)("calcite-loader",{inline:!0,label:""})}_renderLoading(){return(0,N.K)("div",{class:Vt.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return(0,N.K)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const y=(0,At.V8)(this.container)?"chevron-left":"chevron-right";return(0,N.K)("calcite-icon",{icon:y,scale:"s",slot:"content-end"})}_renderRelatedFeature(y){const{itemDescriptionFieldName:g}=this.viewModel,v=y.title;y.description=g&&y.formattedAttributes?.global[g];const M="loading"===y.state;return(0,N.K)("calcite-list-item",{class:this.classes(Vt.listItem,{[Vt.listItemHidden]:M}),description:y.description??"",key:y.uid,label:v,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:y})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?(0,N.K)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return(0,N.K)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,N.K)("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return(0,N.K)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Vt.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:y}=this.viewModel;return(0,N.K)("calcite-list",null,y.toArray().map(g=>this._renderRelatedFeature(g)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:y}=this,{state:g}=this.viewModel;return(0,N.K)("div",{class:this.classes(Vt.listContainer,{[Vt.listContainerQuerying]:"querying"===g}),key:"list-container"},y?this._renderList():"ready"===g?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return(0,N.K)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,N.K)("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:y}=this.viewModel,g="related-feature-viewmodels";this.removeHandles(g),y?.forEach(v=>{this.addHandles((0,U.wB)(()=>[v.title,v.state],()=>this.scheduleRender(),U.Vh),g)}),this.scheduleRender()}_setupFeatureElementInfo(){const{headingLevel:y,visibleElements:g}=this,v=g.description&&this.description,M=g.title&&this.title;this._featureElementInfo?.set({description:v,title:M,headingLevel:y})}_handleRelatedFeatureObserverChange(){var y=this;return(0,k.A)(function*(){y._unobserveRelatedFeatureObserver();const{state:g,showAllEnabled:v}=y.viewModel;yield(0,Xe.Pl)(0),y._relatedFeatureIntersectionObserverNode&&"ready"===g&&v&&y._relatedFeatureIntersectionObserver.observe(y._relatedFeatureIntersectionObserverNode)})()}_relatedFeatureIntersectionObserverCreated(y){this._relatedFeatureIntersectionObserverNode=y}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,_._)([(0,I.MZ)()],ct.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],ct.prototype,"displayShowAllButton",null),(0,_._)([(0,I.MZ)({readOnly:!0})],ct.prototype,"displayListItems",null),(0,_._)([(0,I.MZ)()],ct.prototype,"description",null),(0,_._)([(0,I.MZ)({readOnly:!0})],ct.prototype,"featureCountDescription",null),(0,_._)([(0,I.MZ)()],ct.prototype,"headingLevel",void 0),(0,_._)([(0,I.MZ)()],ct.prototype,"title",null),(0,_._)([(0,I.MZ)({type:Cn})],ct.prototype,"viewModel",void 0),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/widgets/Feature/t9n/Feature")],ct.prototype,"messages",void 0),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/t9n/common")],ct.prototype,"messagesCommon",void 0),(0,_._)([(0,I.MZ)()],ct.prototype,"visibleElements",void 0),(0,_._)([(0,X.w)("visibleElements")],ct.prototype,"castVisibleElements",null),ct=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureRelationship")],ct);const zs=ct;var mi;const ks="content-view-models",js="relationship-view-models",Ws={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let je=mi=class extends((0,Ss.sA)(Tt.A)){constructor(y){super(y),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=ue(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Ws},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=g=>{const{abilities:v}=this;return"attachments"===g.type&&!!v.attachmentsContent||"custom"===g.type&&!!v.customContent||"fields"===g.type&&!!v.fieldsContent||"media"===g.type&&!!v.mediaContent||"text"===g.type&&!!v.textContent||"expression"===g.type&&!!v.expressionContent||"relationship"===g.type&&!!v.relationshipContent},this.addHandles((0,U.wB)(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),U.Vh))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function Qo(y,g){const v=new Map;if(!y)return v;for(const M of y){if(!M.fieldName)continue;const b=li(M.fieldName,g);M.fieldName=b,v.set(b.toLowerCase(),M)}return v}(cs(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return rs(this.graphic)}castAbilities(y){return{...Ws,...y}}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(y){this._set("graphic",y?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(y){this._override("spatialReference",y)}get timeZone(){return this.view?.timeZone??$i.qU}set timeZone(y){this._overrideIfSome("timeZone",y)}get map(){return this.view?.map||null}set map(y){this._override("map",y)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(y,g){const v=this.contentViewModels[y];v instanceof kt&&v.setActiveMedia(g)}nextMedia(y){const g=this.contentViewModels[y];g instanceof kt&&g.next()}previousMedia(y){const g=this.contentViewModels[y];g instanceof kt&&g.previous()}updateGeometry(){var y=this;return(0,k.A)(function*(){const{graphic:g,spatialReference:v,_sourceLayer:M}=y;yield M?.load();const b=M?.objectIdField;if(!b||!g||!M)return;const w=g?.attributes?.[b];if(null==w)return;const F=[w];if(!g.geometry){const C=yield ps({layer:M,graphic:g,outFields:[],objectIds:F,returnGeometry:!0,spatialReference:v}),L=C?.geometry;L&&(g.geometry=L)}})()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){var y=this;return(0,k.A)(function*(){y._cancelFeatureQuery(),y._error=null,y._clear();const{graphic:g}=y;if(!g)return;const v=new AbortController;y._featureAbortController=v;try{yield y._queryFeature({signal:v.signal})}catch(M){(0,Xe.zf)(M)||(y._error=M,he.A.getLogger(y).error("error","The popupTemplate could not be displayed for this feature.",{error:M,graphic:g,popupTemplate:y._effectivePopupTemplate}))}y._featureAbortController===v&&(y._featureAbortController=null)})()}_cancelFeatureQuery(){const{_featureAbortController:y}=this;y&&y.abort(),this._featureAbortController=null}_compileContentElement(y,g){return"attachments"===y.type?this._compileAttachments(y,g):"custom"===y.type?this._compileCustom(y,g):"fields"===y.type?this._compileFields(y,g):"media"===y.type?this._compileMedia(y,g):"text"===y.type?this._compileText(y,g):"expression"===y.type?this._compileExpression(y,g):"relationship"===y.type?this._compileRelationship(y,g):void 0}_compileContent(y){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(y)?y.filter(this._isAllowedContentType).map((g,v)=>this._compileContentElement(g,v)).filter(zt.Ru):"string"==typeof y?this._compileText(new Ls.A({text:y}),0).text:y}_destroyContentViewModels(){this.removeHandles(js),this.removeHandles(ks),this.contentViewModels.forEach(y=>y&&!y.destroyed&&y.destroy()),this._set("contentViewModels",[])}_matchesFeature(y,g){const v=y?.graphic?.getObjectId(),M=g?.getObjectId();return null!=v&&null!=M&&v===M}_setRelatedFeaturesViewModels({relatedFeatureViewModels:y,relatedFeatures:g,map:v}){const{view:M,spatialReference:b,timeZone:w}=this;g?.filter(Boolean).forEach(F=>{y.some(C=>this._matchesFeature(C,F))||y.add(new mi({abilities:{relationshipContent:!1},map:v,view:M,spatialReference:b,timeZone:w,graphic:F}))}),y.forEach(F=>{g?.find(L=>this._matchesFeature(F,L))||y.remove(F)})}_setExpressionContentVM(y,g){const v=this.formattedAttributes,{contentElement:M,contentElementViewModel:b}=y,w=M?.type;b&&w&&("fields"===w&&(this._createFieldsFormattedAttributes({contentElement:M,contentElementIndex:g,formattedAttributes:v}),b.set(this._createFieldsVMParams(M,g))),"media"===w&&(this._createMediaFormattedAttributes({contentElement:M,contentElementIndex:g,formattedAttributes:v}),b.set(this._createMediaVMParams(M,g))),"text"===w&&b.set(this._createTextVMParams(M)))}_compileRelationship(y,g){const{displayCount:v,orderByFields:M,relationshipId:b,title:w,description:F}=y,{_sourceLayer:C,graphic:L,map:S}=this;if(!Hi(C))return;const Z=new Cn({displayCount:v,graphic:L,orderByFields:M,relationshipId:b,layer:C,map:S,...this._compileTitleAndDesc({title:w,description:F})});return this.contentViewModels[g]=Z,this.addHandles((0,U.on)(()=>Z.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(Z)),js),y}_compileExpression(y,g){const{expressionInfo:v}=y,{graphic:M,map:b,spatialReference:w,view:F,location:C}=this,L=new _n({expressionInfo:v,graphic:M,interceptor:mi.interceptor,map:b,spatialReference:w,view:F,location:C});return this.contentViewModels[g]=L,this.addHandles((0,U.wB)(()=>L.contentElementViewModel,()=>this._setExpressionContentVM(L,g),U.Vh),ks),y}_compileAttachments(y,g){const{graphic:v}=this,{description:M,title:b}=y;return this.contentViewModels[g]=new nn({graphic:v,...this._compileTitleAndDesc({title:b,description:M})}),y}_compileCustom(y,g){const{graphic:v}=this,{creator:M,destroyer:b}=y;return this.contentViewModels[g]=new Ai({graphic:v,creator:M,destroyer:b}),y}_compileTitleAndDesc({title:y,description:g}){const{_fieldInfoMap:v,_sourceLayer:M,graphic:b,formattedAttributes:w}=this,F=b?.attributes,C=this._expressionAttributes,L=w.global;return{title:Nt({attributes:F,fieldInfoMap:v,globalAttributes:L,expressionAttributes:C,layer:M,text:y}),description:Nt({attributes:F,fieldInfoMap:v,globalAttributes:L,expressionAttributes:C,layer:M,text:g})}}_createFieldsVMParams(y,g){const v=this._effectivePopupTemplate,M=this.formattedAttributes,b={...M?.global,...M?.content[g]},w=y?.fieldInfos||v?.fieldInfos,F=w?.filter(({fieldName:Z})=>!!Z&&(zi(Z)||Pt(Z)||b.hasOwnProperty(Z))),C=v?.expressionInfos,{description:L,title:S}=y;return{attributes:b,expressionInfos:C,fieldInfos:F,...this._compileTitleAndDesc({title:S,description:L})}}_compileFields(y,g){const v=y.clone(),M=new Fi(this._createFieldsVMParams(y,g));return this.contentViewModels[g]=M,v.fieldInfos=M.formattedFieldInfos.slice(0),v}_createMediaVMParams(y,g){const{abilities:v,graphic:M,_fieldInfoMap:b,_effectivePopupTemplate:w,relatedInfos:F,_sourceLayer:C,_expressionAttributes:L}=this,S=this.formattedAttributes,Z=M?.attributes??{},{description:W,mediaInfos:H,title:ee}=y;return{abilities:{chartAnimation:v.chartAnimation},activeMediaInfoIndex:y.activeMediaInfoIndex||0,attributes:Z,isAggregate:M?.isAggregate,layer:C,fieldInfoMap:b,formattedAttributes:{...S?.global,...S?.content[g]},expressionAttributes:L,mediaInfos:H,popupTemplate:w,relatedInfos:F,...this._compileTitleAndDesc({title:ee,description:W})}}_compileMedia(y,g){const v=y.clone(),M=new kt(this._createMediaVMParams(y,g));return v.mediaInfos=M.formattedMediaInfos.slice(0),this.contentViewModels[g]=M,v}_createTextVMParams(y){const{graphic:g,_fieldInfoMap:v,_sourceLayer:M,_expressionAttributes:b}=this;return y&&y.text&&(y.text=Nt({attributes:g?.attributes??{},fieldInfoMap:v,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:b,layer:M,text:y.text})),{graphic:g,creator:y.text}}_compileText(y,g){const v=y.clone();return this.contentViewModels[g]=new Ai(this._createTextVMParams(v)),v}_compileLastEditInfo(){const{_effectivePopupTemplate:y,_sourceLayer:g,graphic:v,timeZone:M}=this;if(!y)return;const{lastEditInfoEnabled:b}=y,w=g?.editFieldsInfo;return b&&w?function Go(y,g,v,M){const{creatorField:b,creationDateField:w,editorField:F,editDateField:C}=y;if(!g)return;const L=(0,$i.hv)(M&&"preferredTimeZone"in M?M.preferredTimeZone:null,!(!M||!("datesInUnknownTimezone"in M)||!M.datesInUnknownTimezone),v,os,"date"),S={...os,...L},Z=g[C];if("number"==typeof Z){const H=g[F];return{type:"edit",date:(0,vi.Yq)(Z,S),user:H}}const W=g[w];if("number"==typeof W){const H=g[b];return{type:"create",date:(0,vi.Yq)(W,S),user:H}}return null}(w,v?.attributes,M,g):void 0}_compileTitle(y){const{_fieldInfoMap:g,_sourceLayer:v,graphic:M,_expressionAttributes:b}=this;return Nt({attributes:M?.attributes??{},fieldInfoMap:g,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:b,layer:v,text:y})}_getTitle(){var y=this;return(0,k.A)(function*(){const{_effectivePopupTemplate:g,graphic:v}=y;return v?Mi({type:"title",value:g?.title,event:{graphic:v}}):null})()}_getContent(){var y=this;return(0,k.A)(function*(){const{_effectivePopupTemplate:g,graphic:v}=y;return v?Mi({type:"content",value:g?.content,event:{graphic:v}}):null})()}_queryFeature(y){var g=this;return(0,k.A)(function*(){const{_featureAbortController:v,_sourceLayer:M,graphic:b,_effectivePopupTemplate:w}=g,F=g.map,C=g.view,L=g.spatialReference,S=g.location;if(v!==g._featureAbortController||!b)return;yield function Xo(y,g){return qi.apply(this,arguments)}({graphic:b,popupTemplate:w,layer:M,spatialReference:L},y);const{content:{value:Z},title:{value:W}}=yield(0,Xe.Lx)({content:g._getContent(),title:g._getTitle()}),{expressionAttributes:{value:H}}=yield(0,Xe.Lx)({checkForRelatedFeatures:g._checkForRelatedFeatures(y),expressionAttributes:nl({expressionInfos:w?.expressionInfos,spatialReference:L,graphic:b,map:F,interceptor:mi.interceptor,view:C,options:y,location:S})});v===g._featureAbortController&&b&&(g._expressionAttributes=H,g._graphicExpressionAttributes={...b.attributes,...H},g._set("formattedAttributes",g._createFormattedAttributes(Z)),g._set("title",g._compileTitle(W)),g._set("lastEditInfo",g._compileLastEditInfo()||null),g._set("content",g._compileContent(Z)||null))})()}_createMediaFormattedAttributes({contentElement:y,contentElementIndex:g,formattedAttributes:v}){const{_effectivePopupTemplate:M,graphic:b,relatedInfos:w,_sourceLayer:F,_fieldInfoMap:C,_graphicExpressionAttributes:L,timeZone:S}=this;v.content[g]=Yi({fieldInfos:M?.fieldInfos,graphic:b,attributes:{...L,...y.attributes},layer:F,fieldInfoMap:C,relatedInfos:w,timeZone:S})}_createFieldsFormattedAttributes({contentElement:y,contentElementIndex:g,formattedAttributes:v}){if(y.fieldInfos){const{graphic:M,relatedInfos:b,_sourceLayer:w,_fieldInfoMap:F,_graphicExpressionAttributes:C,timeZone:L}=this;v.content[g]=Yi({fieldInfos:y.fieldInfos,graphic:M,attributes:{...C,...y.attributes},layer:w,fieldInfoMap:F,relatedInfos:b,timeZone:L})}}_createFormattedAttributes(y){const{_effectivePopupTemplate:g,graphic:v,relatedInfos:M,_sourceLayer:b,_fieldInfoMap:w,_graphicExpressionAttributes:F,timeZone:C}=this,L=g?.fieldInfos,S={global:Yi({fieldInfos:L,graphic:v,attributes:F,layer:b,fieldInfoMap:w,relatedInfos:M,timeZone:C}),content:[]};return Array.isArray(y)&&y.forEach((Z,W)=>{"fields"===Z.type&&this._createFieldsFormattedAttributes({contentElement:Z,contentElementIndex:W,formattedAttributes:S}),"media"===Z.type&&this._createMediaFormattedAttributes({contentElement:Z,contentElementIndex:W,formattedAttributes:S})}),S}_checkForRelatedFeatures(y){const{graphic:g,_effectivePopupTemplate:v}=this;return this._queryRelatedInfos(g,cs(v),y)}_queryRelatedInfos(y,g,v){var M=this;return(0,k.A)(function*(){const{relatedInfos:b,_sourceLayer:w}=M;b.clear();const F=null!=w?.associatedLayer?yield w?.associatedLayer.load(v):w;if(!F||!y||!g.filter(Z=>!!Z.fieldName&&Pt(Z.fieldName))?.length)return;g.forEach(Z=>M._configureRelatedInfo(Z,F));const L=yield function Dr({relatedInfos:y,layer:g},v){const M={};return y.forEach((b,w)=>{const{relation:F}=b;if(!F){const W=new ae.A("relation-required","A relation is required on a layer to retrieve related records.");throw Is().error(W),W}const{relatedTableId:C}=F;if("number"!=typeof C){const W=new ae.A("A related table ID is required on a layer to retrieve related records.");throw Is().error(W),W}const L=`${g.url}/${C}`,S=Cs.get(L),Z=S??function Ur(y,g){return(0,_r.A)(y,{query:{f:"json"},signal:g?.signal})}(L);S||Cs.set(L,Z),M[w]=Z}),(0,Xe.qr)((0,Xe.Lx)(M),v)}({relatedInfos:b,layer:F},v);Object.keys(L).forEach(Z=>{const W=b.get(Z.toString()),H=L[Z]?.value;W&&H&&(W.layerInfo=H.data)});const S=yield function Vr({graphic:y,relatedInfos:g,layer:v},M){const b={};return g.forEach((w,F)=>{w.layerInfo&&(b[F]=function Sr(y,g,v,M){return vn.apply(this,arguments)}(y,w,v,M))}),(0,Xe.Lx)(b)}({graphic:y,relatedInfos:b,layer:F},v);Object.keys(S).forEach(Z=>{!function Tr(y,g){if(!g||!y)return;const{features:v,statsFeatures:M}=y,b=v?.value;g.relatedFeatures=b?b.features:[];const w=M?.value;g.relatedStatsFeatures=w?w.features:[]}(S[Z]?.value,b.get(Z.toString()))})})()}_configureRelatedInfo(y,g){const{relatedInfos:v}=this,M=xi(y.fieldName||"");if(!M)return;const{layerId:b,fieldName:w}=M;if(!b)return;const F=v.get(b.toString())||function Lr(y,g){const v=function Cr(y,g){if(!g.relationships)return null;let v=null;const{relationships:M}=g;return M.some(b=>b.id===parseInt(y,10)&&(v=b,!0)),v}(y,g);if(v)return{url:`${g.url}/${v.relatedTableId}`,sourceSpatialReference:g.spatialReference,relation:v,relatedFields:[],outStatistics:[]}}(b,g);F&&(function Br({relatedInfo:y,fieldName:g,fieldInfo:v}){if(y.relatedFields?.push(g),v.statisticType){const M=new Fr.A({statisticType:v.statisticType,onStatisticField:g,outStatisticFieldName:g});y.outStatistics?.push(M)}}({relatedInfo:F,fieldName:w,fieldInfo:y}),this.relatedInfos.set(b,F))}};je.interceptor=new class yl{constructor(g,v){this.preLayerQueryCallback=g,this.preRequestCallback=v,this.preLayerQueryCallback||(this.preLayerQueryCallback=M=>{}),this.preRequestCallback||(this.preLayerQueryCallback=M=>{})}}(({query:y,layer:g,method:v})=>{ys({layer:g,method:v,query:y,definitionExpression:`${g.definitionExpression} ${g.serviceDefinitionExpression??""}`})},({queryPayload:y,layer:g,method:v})=>{ys({layer:g,method:v,query:y,definitionExpression:`${g.definitionExpression} ${g.serviceDefinitionExpression??""}`})}),(0,_._)([(0,I.MZ)()],je.prototype,"_error",void 0),(0,_._)([(0,I.MZ)()],je.prototype,"_featureAbortController",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"_effectivePopupTemplate",null),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"_fieldInfoMap",null),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"_sourceLayer",null),(0,_._)([(0,I.MZ)()],je.prototype,"abilities",void 0),(0,_._)([(0,X.w)("abilities")],je.prototype,"castAbilities",null),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"content",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"contentViewModels",void 0),(0,_._)([(0,I.MZ)()],je.prototype,"description",void 0),(0,_._)([(0,I.MZ)({type:Boolean})],je.prototype,"defaultPopupTemplateEnabled",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"isTable",null),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"state",null),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"formattedAttributes",void 0),(0,_._)([(0,I.MZ)({type:ei.A,value:null})],je.prototype,"graphic",null),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"lastEditInfo",void 0),(0,_._)([(0,I.MZ)({type:fn.A})],je.prototype,"location",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"relatedInfos",void 0),(0,_._)([(0,I.MZ)()],je.prototype,"spatialReference",null),(0,_._)([(0,I.MZ)()],je.prototype,"timeZone",null),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"title",void 0),(0,_._)([(0,I.MZ)()],je.prototype,"map",null),(0,_._)([(0,I.MZ)({readOnly:!0})],je.prototype,"waitingForContent",null),(0,_._)([(0,I.MZ)()],je.prototype,"view",void 0),je=mi=(0,_._)([(0,J.$)("esri.widgets.Feature.FeatureViewModel")],je);const xn=je,rt="esri-feature",Ye={base:rt,container:`${rt}__size-container`,title:`${rt}__title`,main:`${rt}__main-container`,btn:`${rt}__button`,icon:`${rt}__icon`,content:`${rt}__content`,contentNode:`${rt}__content-node`,contentNodeText:`${rt}__content-node--text`,contentElement:`${rt}__content-element`,text:`${rt}__text`,lastEditedInfo:`${rt}__last-edited-info`,fields:`${rt}__fields`,fieldHeader:`${rt}__field-header`,fieldData:`${rt}__field-data`,fieldDataDate:`${rt}__field-data--date`,loadingSpinnerContainer:`${rt}__loading-container`},Hs=y=>{let g=class extends y{constructor(){super(...arguments),this.renderNodeContent=v=>(0,ln.p4)(v)&&!v.destroyed?(0,N.K)("div",{class:Ye.contentNode,key:v},v.render()):v instanceof HTMLElement?(0,N.K)("div",{afterCreate:this._attachToNode,bind:v,class:Ye.contentNode,key:v}):(0,ln.xk)(v)?(0,N.K)("div",{afterCreate:this._attachToNode,bind:v.domNode,class:Ye.contentNode,key:v}):null}_attachToNode(v){v.appendChild(this)}};return g=(0,_._)([(0,J.$)("esri.widgets.Feature.support.FeatureContentMixin")],g),g};var En;const Gs={title:!0,content:!0,lastEditedInfo:!0},Qs="relationship-handles";let it=En=class extends(Hs(pe.A)){constructor(y,g){super(y,g),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...Gs},this.viewModel=new xn}initialize(){this.addHandles((0,U.wB)(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),U.Vh))}loadDependencies(){return(0,Kt.W)({notice:()=>Promise.all([A.e(2597),A.e(1594),A.e(5661)]).then(A.bind(A,85661)),loader:()=>A.e(2748).then(A.bind(A,2748))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(y){this.viewModel.graphic=y}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(y){this.viewModel.defaultPopupTemplateEnabled=y}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(y){this._overrideIfSome("icon",y)}get label(){return this.messages?.widgetLabel??""}set label(y){this._overrideIfSome("label",y)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(y){this.viewModel.spatialReference=y}get timeZone(){return this.viewModel.timeZone}set timeZone(y){this.viewModel.timeZone=y}get title(){return this.viewModel.title}castVisibleElements(y){return{...Gs,...y}}get map(){return this.viewModel.map}set map(y){this.viewModel.map=y}get view(){return this.viewModel.view}set view(y){this.viewModel.view=y}setActiveMedia(y,g){return this.viewModel.setActiveMedia(y,g)}nextMedia(y){return this.viewModel.nextMedia(y)}previousMedia(y){return this.viewModel.previousMedia(y)}render(){const{state:y}=this.viewModel,g=(0,N.K)("div",{class:Ye.container,key:"container"},this._renderTitle(),"error"===y?this._renderError():"loading"===y?this._renderLoading():this._renderContentContainer());return(0,N.K)("div",{class:this.classes(Ye.base,Oe.D.widget)},g)}_renderError(){const{messagesCommon:y,messages:g,visibleElements:v}=this;return(0,N.K)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},v.title?(0,N.K)("div",{key:"error-title",slot:"title"},y.errorMessage):null,(0,N.K)("div",{key:"error-message",slot:"message"},g.loadingError))}_renderLoading(){return(0,N.K)("div",{class:Ye.loadingSpinnerContainer,key:"loading-container"},(0,N.K)("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:y}=this;return y.content?(0,N.K)("div",{class:Ye.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:y,title:g}=this;return y.title?(0,N.K)(sn.D,{class:Ye.title,innerHTML:g,level:this.headingLevel}):null}_renderContent(){const y=this.viewModel.content,g="content";if(!y)return null;if(Array.isArray(y))return y.length?(0,N.K)("div",{class:Ye.contentNode,key:`${g}-content-elements`},y.map(this._renderContentElement,this)):null;if("string"==typeof y){const v=this._contentWidgets[0];return!v||v.destroyed?null:(0,N.K)("div",{class:this.classes(Ye.contentNode,Ye.contentNodeText),key:`${g}-content`},v.render())}return this.renderNodeContent(y)}_renderContentElement(y,g){const{visibleElements:v}=this;if("boolean"!=typeof v.content&&!v.content?.[y.type])return null;switch(y.type){case"attachments":return this._renderAttachments(g);case"custom":return this._renderCustom(y,g);case"fields":return this._renderFields(g);case"media":return this._renderMedia(g);case"text":return this._renderText(y,g);case"expression":return this._renderExpression(g);case"relationship":return this._renderRelationship(g);default:return null}}_renderAttachments(y){const g=this._contentWidgets[y];if(!g||g.destroyed)return null;const{state:v,attachmentInfos:M}=g.viewModel;return"loading"===v||M.length>0?(0,N.K)("div",{class:this.classes(Ye.contentElement),key:this._buildKey("attachments-element",y)},g.render()):null}_renderRelationship(y){const g=this._contentWidgets[y];return g&&!g.destroyed&&this.flowItems?(0,N.K)("div",{class:Ye.contentElement,key:this._buildKey("relationship-element",y)},g.render()):null}_renderExpression(y){const g=this._contentWidgets[y];return!g||g.destroyed?null:(0,N.K)("div",{class:Ye.contentElement,key:this._buildKey("expression-element",y)},g.render())}_renderCustom(y,g){const{creator:v}=y,M=this._contentWidgets[g];return!M||M.destroyed?null:v?(0,N.K)("div",{class:Ye.contentElement,key:this._buildKey("custom-element",g)},M.render()):null}_renderFields(y){const g=this._contentWidgets[y];return!g||g.destroyed?null:(0,N.K)("div",{class:Ye.contentElement,key:this._buildKey("fields-element",y)},g.render())}_renderMedia(y){const g=this._contentWidgets[y];return!g||g.destroyed?null:(0,N.K)("div",{class:Ye.contentElement,key:this._buildKey("media-element",y)},g.render())}_renderLastEditInfo(){const{visibleElements:y,messages:g}=this,{lastEditInfo:v}=this.viewModel;if(!v||!y.lastEditedInfo)return null;const{date:M,user:b}=v,F=(0,j.V)("edit"===v.type?b?g.lastEditedByUser:g.lastEdited:b?g.lastCreatedByUser:g.lastCreated,{date:M,user:b});return(0,N.K)("div",{class:this.classes(Ye.lastEditedInfo,Ye.contentElement),key:"edit-info-element"},F)}_renderText(y,g){const M=this._contentWidgets[g];return!M||M.destroyed?null:y.text?(0,N.K)("div",{class:this.classes(Ye.contentElement,Ye.text),key:this._buildKey("text-element",g)},M.render()):null}_buildKey(y,...g){return`${y}__${this.viewModel?.graphic?.uid||"0"}-${g.join("-")}`}_destroyContentWidget(y){y&&(y.viewModel=null,!y.destroyed&&y.destroy())}_destroyContentWidgets(){this.removeHandles(Qs),this._contentWidgets.forEach(y=>this._destroyContentWidget(y)),this._contentWidgets=[]}_addFeatureRelationshipHandles(y){const{flowItems:g,visibleElements:v}=this;this.addHandles([(0,U.on)(()=>y,"select-record",({featureViewModel:M})=>{g&&(M.abilities={relationshipContent:!0},g.push(new En({flowItems:g,viewModel:M,visibleElements:v})))}),(0,U.on)(()=>y,"show-all-records",()=>{if(!g)return;const{viewModel:M}=y;M.showAllEnabled=!0;const b=new zs({visibleElements:{title:!1,description:!1},viewModel:M});this._addFeatureRelationshipHandles(b),g.push(b)})],Qs)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:y,visibleElements:g}=this,v=this.viewModel?.content,{contentViewModels:M}=this.viewModel;if(Array.isArray(v))v.forEach((b,w)=>{if("attachments"===b.type&&(this._contentWidgets[w]=new lr({displayType:b.displayType,headingLevel:g.title&&y<6?y+1:y,viewModel:M[w]})),"fields"===b.type&&(this._contentWidgets[w]=new As({viewModel:M[w]})),"media"===b.type&&(this._contentWidgets[w]=new Es({viewModel:M[w]})),"text"===b.type&&(this._contentWidgets[w]=new _i({viewModel:M[w]})),"custom"===b.type&&(this._contentWidgets[w]=new _i({viewModel:M[w]})),"expression"===b.type&&(this._contentWidgets[w]=new ol({viewModel:M[w]})),"relationship"===b.type){const F=new zs({viewModel:M[w]});this._addFeatureRelationshipHandles(F),this._contentWidgets[w]=F}},this);else{const b=M[0];b&&!b.destroyed&&(this._contentWidgets[0]=new _i({viewModel:b}))}this.scheduleRender()}};(0,_._)([(0,I.MZ)()],it.prototype,"graphic",null),(0,_._)([(0,I.MZ)()],it.prototype,"defaultPopupTemplateEnabled",null),(0,_._)([(0,I.MZ)()],it.prototype,"flowItems",void 0),(0,_._)([(0,I.MZ)()],it.prototype,"headingLevel",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],it.prototype,"isTable",null),(0,_._)([(0,I.MZ)()],it.prototype,"icon",null),(0,_._)([(0,I.MZ)()],it.prototype,"label",null),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/widgets/Feature/t9n/Feature")],it.prototype,"messages",void 0),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/t9n/common")],it.prototype,"messagesCommon",void 0),(0,_._)([(0,I.MZ)()],it.prototype,"spatialReference",null),(0,_._)([(0,I.MZ)()],it.prototype,"timeZone",null),(0,_._)([(0,I.MZ)({readOnly:!0})],it.prototype,"title",null),(0,_._)([(0,I.MZ)()],it.prototype,"visibleElements",void 0),(0,_._)([(0,X.w)("visibleElements")],it.prototype,"castVisibleElements",null),(0,_._)([(0,I.MZ)()],it.prototype,"map",null),(0,_._)([(0,I.MZ)()],it.prototype,"view",null),(0,_._)([(0,I.MZ)({type:xn})],it.prototype,"viewModel",void 0),it=En=(0,_._)([(0,J.$)("esri.widgets.Feature")],it);const vl=it;var Ml=A(42425),Ln=A(11817);let jt=class extends Ml.A.EventedAccessor{constructor(y){super(y),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,U.z7)(()=>{const g=this.screenLocationEnabled?this.view:null;return g?[g.size,"3d"===g.type?g.camera:g.viewpoint]:null},()=>this.notifyChange("screenLocation")),(0,U.wB)(()=>this.screenLocation,(g,v)=>{null!=g&&null!=v&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:y,view:g,screenLocationEnabled:v}=this,M=g?.spatialReference,b=M?(0,Ln.projectOrLoad)(y,M).geometry:null;return v&&b&&g?.ready?g.toScreen(b):null}};(0,_._)([(0,I.MZ)()],jt.prototype,"location",void 0),(0,_._)([(0,I.MZ)()],jt.prototype,"screenLocation",null),(0,_._)([(0,I.MZ)()],jt.prototype,"screenLocationEnabled",void 0),(0,_._)([(0,I.MZ)()],jt.prototype,"view",void 0),jt=(0,_._)([(0,J.$)("esri.widgets.support.AnchorElementViewModel")],jt);const Ys=jt;let Ri=class extends Ys{constructor(y){super(y),this.visible=!1}};(0,_._)([(0,I.MZ)()],Ri.prototype,"visible",void 0),Ri=(0,_._)([(0,J.$)("esri.widgets.Spinner.SpinnerViewModel")],Ri);const Xs=Ri,Tn="esri-spinner",Pn_base=Tn,Pn_spinnerStart=`${Tn}--start`,Pn_spinnerFinish=`${Tn}--finish`;let Wt=class extends pe.A{constructor(y,g){super(y,g),this._animationDelay=500,this._animationPromise=null,this.viewModel=new Xs}initialize(){this.addHandles((0,U.wB)(()=>this.visible,y=>this._visibleChange(y)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(y){this.viewModel.location=y}get view(){return this.viewModel.view}set view(y){this.viewModel.view=y}get visible(){return this.viewModel.visible}set visible(y){this.viewModel.visible=y}show(y){const{location:g,promise:v}=y??{};g&&(this.viewModel.location=g),this.visible=!0,v&&v.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:y}=this,{screenLocation:g}=this.viewModel,v=!!g,M=y&&v,b=!y&&v,w={[Pn_spinnerStart]:M,[Pn_spinnerFinish]:b},F=this._getPositionStyles();return(0,N.K)("div",{class:this.classes(Pn_base,w),styles:F})}_visibleChange(y){if(y)return void(this.viewModel.screenLocationEnabled=!0);const g=(0,Xe.Pl)(this._animationDelay);this._animationPromise=g,g.catch(()=>{}).then(()=>{this._animationPromise===g&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:y,view:g}=this.viewModel;if(null==g||null==y)return{};const{padding:v}=g;return{left:y.x-v.left+"px",top:y.y-v.top+"px"}}};(0,_._)([(0,I.MZ)()],Wt.prototype,"location",null),(0,_._)([(0,I.MZ)()],Wt.prototype,"view",null),(0,_._)([(0,I.MZ)({type:Xs})],Wt.prototype,"viewModel",void 0),(0,_._)([(0,I.MZ)()],Wt.prototype,"visible",null),Wt=(0,_._)([(0,J.$)("esri.widgets.Spinner")],Wt);const bl=Wt,lt="esri-features",st={icon:`${lt}__icon`,actionImage:`${lt}__action-image`,base:lt,container:`${lt}__container`,contentContainer:`${lt}__content-container`,contentFeature:`${lt}__content-feature`,flowItemCollapsed:`${lt}__flow-item--collapsed`,header:`${lt}__header`,footer:`${lt}__footer`,featureMenuObserver:`${lt}__feature-menu-observer`,actionExit:`${lt}__action--exit`,loader:`${lt}__loader`,featuresHeading:`${lt}__heading`,paginationActionBar:`${lt}__pagination-action-bar`,paginationPrevious:`${lt}__pagination-previous`,paginationNext:`${lt}__pagination-next`};let Ht=class extends pe.A{constructor(y,g){super(y,g),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=v=>{this.emit("open-related-feature",{feature:v})}}loadDependencies(){return(0,Kt.W)({action:()=>Promise.all([A.e(2597),A.e(1594),A.e(8843),A.e(822)]).then(A.bind(A,14201)),"flow-item":()=>Promise.all([A.e(2597),A.e(1594),A.e(6883),A.e(8843),A.e(4847),A.e(5387),A.e(9507)]).then(A.bind(A,9507))})}render(){const{flowItems:y}=this,g=y?.toArray();return(0,N.K)(N.w,null,g?.map(v=>this._renderRelatedRecordsFlowItem(v)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){const y=this.flowItems?.pop();y&&("showAllEnabled"in y.viewModel&&(y.viewModel.showAllEnabled=!1),y&&(y.viewModel=null,y.destroy()))}_renderRelatedRecordsFlowItem(y){const{messages:g,closable:v,closed:M}=this,b="graphic"in y&&!y.isTable&&y.graphic?.geometry,w=g.exitRelatedRecords,F=g.selectFeature;return(0,N.K)("calcite-flow-item",{bind:this,closable:v,closed:M,description:this._getRelatedRecordsFlowItemDescription(y),heading:y.title??"",key:`flow-item-${y.viewModel.uid}`,onCalciteFlowItemBack:C=>{C.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},(0,N.K)("calcite-action",{appearance:"transparent",bind:this,class:st.actionExit,icon:"move-up",key:"exit-related-records-action",onclick:this._handleExitClick,slot:"header-actions-start",text:w,title:w}),b?(0,N.K)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",onclick:()=>this._handleOpenRelatedFeature(y),slot:"header-actions-end",text:F,title:F}):null,(0,N.K)("div",{class:st.container},y.render()))}_getRelatedRecordsFlowItemDescription(y){return"featureCountDescription"in y?y.featureCountDescription:y.viewModel.description??""}};(0,_._)([(0,I.MZ)()],Ht.prototype,"flowItems",void 0),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/widgets/Features/t9n/Features")],Ht.prototype,"messages",void 0),(0,_._)([(0,I.MZ)()],Ht.prototype,"closed",void 0),(0,_._)([(0,I.MZ)()],Ht.prototype,"closable",void 0),Ht=(0,_._)([(0,J.$)("esri.widgets.Features.FeaturesRelatedRecords")],Ht);const wl=Ht;A(47280);var Gt=A(9700),Al=A(4032);class _l{constructor(g){this._observable=new Al.I,this._set=new Set(g)}get size(){return(0,Gt.gc)(this._observable),this._set.size}add(g){const v=this._set.size;return this._set.add(g),this._set.size!==v&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(g){const v=this._set.delete(g);return v&&this._observable.notify(),v}entries(){return(0,Gt.gc)(this._observable),this._set.entries()}forEach(g,v){(0,Gt.gc)(this._observable),this._set.forEach((M,b)=>g.call(v,M,b,this),v)}has(g){return(0,Gt.gc)(this._observable),this._set.has(g)}keys(){return(0,Gt.gc)(this._observable),this._set.keys()}values(){return(0,Gt.gc)(this._observable),this._set.values()}[Symbol.iterator](){return(0,Gt.gc)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}var Fl=A(55039),Js=A(95478);const qs="OBJECTID";function On(y){return y&&"opacity"in y?y.opacity*On(y.parent):1}function oo(y,g){return Zn.apply(this,arguments)}function Zn(){return(Zn=(0,k.A)(function*(y,g){if(!y)return;const v=y.sourceLayer,M=(null!=g&&g.useSourceLayer?v:y.layer)??v,b=On(M);if(null!=y.symbol&&(null==g||!0!==g.ignoreGraphicSymbol)){const Me="web-style"===y.symbol.type?yield(0,vt.yG)(y.symbol,{...g,cache:null!=g?g.webStyleCache:null}):y.symbol.clone();return(0,vt.dt)(Me,null,b),Me}const w=g?.renderer??function fi(y){if(y)return"renderer"in y?y.renderer:void 0}(M);let F=w&&"getSymbolAsync"in w?yield w.getSymbolAsync(y,g):null;if(!F)return;if(F="web-style"===F.type?yield F.fetchSymbol({...g,cache:null!=g?g.webStyleCache:null}):F.clone(),!w||!("visualVariables"in w)||!w.visualVariables?.length)return(0,vt.dt)(F,null,b),F;if("arcadeRequiredForVisualVariables"in w&&w.arcadeRequiredForVisualVariables&&null==g?.arcade){const Me={...g};Me.arcade=yield(0,is.lw)(),g=Me}const{getColor:C,getOpacity:L,getAllSizes:S,getRotationAngle:Z}=yield Promise.resolve().then(A.bind(A,77522)),W=[],H=[],ee=[],ne=[];for(const Me of w.visualVariables)switch(Me.type){case"color":W.push(Me);break;case"opacity":H.push(Me);break;case"rotation":ne.push(Me);break;case"size":Me.target||ee.push(Me)}const ce=!!W.length&&W[W.length-1],ye=ce?C(ce,y,g):null,Fe=!!H.length&&H[H.length-1];let Ze=Fe?L(Fe,y,g):null;if(null!=b&&(Ze=null!=Ze?Ze*b:b),(0,vt.dt)(F,ye,Ze),ee.length){const Me=S(ee,y,g);yield(0,vt.UQ)(F,Me)}for(const Me of ne)(0,vt.GG)(F,Z(Me,y,g),Me.axis);return F})).apply(this,arguments)}A(8134),A(22079),A(16633),A(94013),A(20175);var ro=A(6558),Ol=A(52491),lo=A(41866);const Qt=te.A.ofType({key:"type",defaultKeyValue:"button",base:Ol.A,typeMap:{button:be.A,toggle:lo.A}}),$t=new be.A({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),Dn=new be.A({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),Yt=new be.A({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),Zt=new lo.A({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table",value:!1}),Oi=()=>he.A.getLogger("esri.widgets.Popup.PopupViewModel"),Sl=y=>{const{event:g,view:v,viewModel:M}=y,{action:b}=g;if(!b)return Promise.reject(new ae.A("trigger-action:missing-arguments","Event has no action"));const{disabled:w,id:F}=b;if(!F)return Promise.reject(new ae.A("trigger-action:invalid-action","action.id is missing"));if(w)return Promise.reject(new ae.A("trigger-action:invalid-action","Action is disabled"));if(F===$t.id)return function Dl(y){return Bn.apply(this,arguments)}(M).catch(Xe.jH);if(F===Yt.id)return function Vl(y){return $n.apply(this,arguments)}(M);if(F===Zt.id)return M.browseClusterEnabled=!M.browseClusterEnabled,M.featureMenuOpen=M.browseClusterEnabled,Promise.resolve();if(F===Dn.id){M.visible=!1;const{selectedFeature:C}=M;if(!C)return Promise.reject(new ae.A(`trigger-action:${Dn.id}`,"selectedFeature is required",{selectedFeature:C}));const{sourceLayer:L}=C;return L?L.remove(C):v?.graphics.remove(C),Promise.resolve()}return Promise.resolve()};function ao(y){const{selectedFeature:g,location:v,view:M}=y;return M?g??v??null:null}function Xt(y){return!!y&&y.isAggregate&&"cluster"===y.sourceLayer?.featureReduction?.type}function Vn(){return(Vn=(0,k.A)(function*(y,g){if("3d"!==g?.type||!y||"esri.Graphic"!==y.declaredClass)return!0;const v=g.getViewForGraphic(y);if(v&&"whenGraphicBounds"in v){let M=null;try{M=yield v.whenGraphicBounds(y,{useViewElevation:!0})}catch{}return!M||!M.boundingBox||M.boundingBox[0]===M.boundingBox[3]&&M.boundingBox[1]===M.boundingBox[4]&&M.boundingBox[2]===M.boundingBox[5]}return!0})).apply(this,arguments)}function Bn(){return Bn=(0,k.A)(function*(y){const{location:g,selectedFeature:v,view:M,zoomFactor:b}=y,w=ao(y);if(!M||!w){const Z=new ae.A("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:w,view:M});throw Oi().error(Z),Z}const F=M.scale/b,C=y.selectedFeature?.geometry,L=C??g,S=null!=L&&"point"===L.type&&(yield function Ul(y,g){return Vn.apply(this,arguments)}(v,M));$t.active=!0,$t.disabled=!0;try{yield y.zoomTo({target:{target:w,scale:S?F:void 0}})}catch{const W=new ae.A("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:v});Oi().error(W)}finally{$t.active=!1,$t.disabled=!1,y.zoomToLocation=null,S&&(y.location=L)}}),Bn.apply(this,arguments)}function $n(){return($n=(0,k.A)(function*(y){const{selectedFeature:g,view:v}=y;if("2d"!==v?.type){const F=new ae.A("zoomToCluster:invalid-view","View must be 2d MapView.",{view:v});throw Oi().error(F),F}if(!g||!Xt(g)){const F=new ae.A("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:g});throw Oi().error(F),F}const[M,b]=yield zn(v,g);Yt.active=!0,Yt.disabled=!0;const{extent:w}=yield M.queryExtent(b);w&&(yield y.zoomTo({target:w})),Yt.active=!1,Yt.disabled=!1})).apply(this,arguments)}function Nn(){return(Nn=(0,k.A)(function*(y){const{view:g,selectedFeature:v}=y;if(!g||!v)return;const[M,b]=yield zn(g,v),{extent:w}=yield M.queryExtent(b);y.selectedClusterBoundaryFeature.geometry=w,g.graphics.add(y.selectedClusterBoundaryFeature)})).apply(this,arguments)}function Kn(){return(Kn=(0,k.A)(function*(y){const{selectedFeature:g,view:v}=y;if(!v||!g)return;const[M,b]=yield zn(v,g);Zt.active=!0,Zt.disabled=!0;const{features:w}=yield M.queryFeatures(b);Zt.active=!1,Zt.disabled=!1,Zt.value=!0,y?.open({features:[g].concat(w),featureMenuOpen:!0})})).apply(this,arguments)}function zn(y,g){return kn.apply(this,arguments)}function kn(){return(kn=(0,k.A)(function*(y,g){const v=yield y.whenLayerView(g.sourceLayer),M=v.createQuery(),b=g.getObjectId();return M.aggregateIds=null!=b?[b]:[],[v,M]})).apply(this,arguments)}var Kl=A(10361),zl=A(88521);let Zi=null,Te=class extends((0,Kl.R)(Ys)){constructor(y){var g;super(y),g=this,this._pendingPromises=new _l,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this._locationScaleHandle=null,this.actions=new Qt,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new ei.A({symbol:new zl.A({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=(0,Xe.sg)(function(){var v=(0,k.A)(function*(M){const{spatialReference:b}=g,w=g.selectedFeature?.geometry?.type,F=g.location??M;if("mesh"!==w&&b&&F&&g.selectedFeature)if("point"!==w)try{const{pendingFeatures:C}=yield g._fetchFeaturesWithController({mapPoint:F}),L=(yield Promise.all(C)).flat().filter(Boolean);if(!L.length)return;if(L.length!==g.features.length){const H=g._getHighlightLayer(g.selectedFeature),ee="imagery"===H?.type?void 0:H&&"objectIdField"in H?H.objectIdField||qs:null;if(ee){const ne=g.selectedFeature.getObjectId(),ce=L.findIndex(ye=>g._getHighlightLayer(ye)?.uid===H?.uid&&ye.attributes[ee]===ne);g.features=L,g.selectedFeatureIndex=ce}}const S=L[g.selectedFeatureIndex]?.geometry,Z=("mesh"!==S?.type?S:null)??g.selectedFeature.geometry,W=Z?(0,Ln.project)(Z,b):null;if(!W)return;Zi||(Zi=yield A.e(6773).then(A.bind(A,16773))),(yield Zi.intersects(W,F))||(g.location=(yield Zi.nearestCoordinate(W,F)).coordinate??F)}catch(C){(0,Xe.zf)(C)||he.A.getLogger(g).error(C)}else g.location=D(g.selectedFeature.geometry)??F});return function(M){return v.apply(this,arguments)}}())}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),(0,U.wB)(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),(0,U.wB)(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),(0,U.wB)(()=>this.view?.animation?.state,y=>this._animationStateChange(y)),(0,U.wB)(()=>this.location,y=>this._locationChange(y)),(0,U.wB)(()=>this.selectedFeature,y=>this._selectedFeatureChange(y)),(0,U.wB)(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),(0,U.wB)(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),(0,U.wB)(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",y=>Sl({event:y,viewModel:this,view:this.view})),(0,U.z7)(()=>!this.waitingForResult,()=>this._waitingForResultChange(),U.OH),(0,U.wB)(()=>[this.features,this.map,this.spatialReference,this.timeZone],()=>this._updateFeatureVMs()),(0,U.wB)(()=>this.view?.scale,()=>this._viewScaleChange()),(0,U.z7)(()=>!this.visible,()=>this.browseClusterEnabled=!1),(0,U.wB)(()=>this.browseClusterEnabled,y=>y?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null,this._locationScaleHandle?.remove(),this._locationScaleHandle=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const y=this._get("allActions")||new Qt;y.removeAll();const{actions:g,defaultActions:v,defaultPopupTemplateEnabled:M,includeDefaultActions:b,selectedFeature:w}=this,F=b?v.concat(g):g,C=w&&("function"==typeof w.getEffectivePopupTemplate&&w.getEffectivePopupTemplate(M)||w.popupTemplate),L=C?.actions;return(C?.overwriteActions?L:L?.concat(F)??F)?.filter(Boolean).forEach(Z=>y.add(Z)),y}get defaultActions(){const y=this._get("defaultActions")||new Qt;return y.removeAll(),y.addMany(Xt(this.selectedFeature)?[Yt.clone(),Zt.clone()]:[$t.clone()]),y}get featureCount(){return this.features.length}set features(y){const g=y||[];this._set("features",g);const{pendingPromisesCount:v,promiseCount:M,selectedFeatureIndex:b}=this,w=M&&g.length;w&&v&&-1===b?this.selectedFeatureIndex=0:w&&-1!==b||(this.selectedFeatureIndex=g.length?0:-1)}set location(y){let g=y;const v=this.spatialReference?.isWebMercator;y?.spatialReference?.isWGS84&&v&&(g=(0,Fl.Gh)(y)),this._set("location",g)}get map(){return this.view?.map??null}set map(y){this._override("map",y)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(y){this._pendingPromises.clear(),this.features=[],Array.isArray(y)&&y.length?(this._set("promises",y),(y=y.slice(0)).forEach(g=>this._pendingPromises.add(g)),y.reduce((g,v)=>g.finally(()=>v.then(M=>{this._pendingPromises.has(v)&&this._updateFeatures(M)}).finally(()=>this._pendingPromises.delete(v)).catch(()=>{})),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:y,selectedFeatureIndex:g}=this;return-1===g?null:y[g]||null}get selectedFeatureIndex(){const y=this._get("selectedFeatureIndex");return"number"==typeof y?y:-1}set selectedFeatureIndex(y){const{featureCount:g}=this;y=isNaN(y)||y<-1||!g?-1:(y+g)%g,this.activeFeature=null,this._set("selectedFeatureIndex",y)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(y){this._override("spatialReference",y)}get state(){const{view:y,map:g}=this;return y?y.ready?"ready":"disabled":g?"ready":"disabled"}get timeZone(){return this.view?.timeZone??$i.qU}set timeZone(y){this._overrideIfSome("timeZone",y)}get waitingForContents(){return this.featureViewModels.some(y=>y.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:y}=this,g=ao(this);return g&&y?this.callGoTo({target:{target:g,scale:y.scale}}):Promise.reject(new ae.A("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:g,view:y}))}zoomTo(y){return this.callGoTo(y)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(y,g){const{view:v}=this;if(!v||!y)throw new ae.A("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:y,view:v});return v.fetchPopupFeatures(y,{pointerType:g?.event?.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:g?.signal})}open(y){const g={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...y,visible:!0},{fetchFeatures:v}=g;delete g.fetchFeatures,v&&this._setFetchFeaturesPromises(g.location);const M=["actionsMenuOpen","collapsed"];for(const b of M)delete g[b];this.set(g)}triggerAction(y){const g=this.allActions.at(y);g&&!g.disabled&&this.emit("trigger-action",{action:g})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function Nl(y){Zt.value=!1;const g=y.features.filter(v=>Xt(v));g.length&&(y.features=g)})(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){var y=this;return(0,k.A)(function*(){const{view:g,selectedFeature:v}=y;"2d"===g?.type?Xt(v)?(yield function Bl(y){return Nn.apply(this,arguments)}(y),yield function $l(y){return Kn.apply(this,arguments)}(y)):he.A.getLogger(y).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",v):he.A.getLogger(y).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",v)})()}handleViewClick(y){this._fetchFeaturesAndOpen(y)}_animationStateChange(y){this.zoomToLocation||($t.disabled="waiting-for-target"===y)}_clearBrowsedClusterGraphics(){const y=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(zt.Ru);this.view?.graphics?.removeMany(y),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Xt(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(y){const{selectedFeature:g,updateLocationEnabled:v,view:M}=this;M&&v&&y&&(!g||g.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:y,featureCount:g,featurePage:v,featuresPerPage:M,featureViewModels:b}=this;if(null===v)return;const w=((v-1)*M+g)%g;b.slice(w,w+M).forEach((C,L)=>{C&&(C.graphic??=y[w+L])})}_selectedFeatureChange(y){var g=this;return(0,k.A)(function*(){const{location:v,updateLocationEnabled:M,view:b}=g;if(!y||!b)return;if(g.browseClusterEnabled)return g._selectedClusterFeature&&(b.graphics.remove(g._selectedClusterFeature),g._selectedClusterFeature=null),Xt(y)?void 0:(y.symbol=yield oo(y),g._selectedClusterFeature=y,void b.graphics.add(g._selectedClusterFeature));const w=y.sourceLayer?.type;if("map-image"!==w&&"imagery"!==w&&"imagery-tile"!==w||(y.symbol=yield oo(y)),!M&&v||!y.geometry){if(M&&!y.geometry){yield g.centerAtLocation();const F=b.center?.clone();F&&(g.location=F)}}else g.location=D(y.geometry)})()}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(y){var g=this;return(0,k.A)(function*(){const{pendingFeatures:v}=yield g._fetchFeaturesWithController({mapPoint:y});g.promises=v})()}_destroyFeatureVMs(){this.featureViewModels.forEach(y=>y&&!y.destroyed&&y.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:y,features:g,featureViewModels:v,view:M,spatialReference:b,map:w,timeZone:F,location:C}=this;if(Xt(y)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!g?.length)return;const L=v.slice(0),S=[];g.forEach((Z,W)=>{if(!Z)return;let H=null;if(L.some((ee,ne)=>(ee&&ee.graphic===Z&&(H=ee,L.splice(ne,1)),!!H)),H)S[W]=H;else{const ee=new xn({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:b,graphic:Z===y?Z:null,location:C,map:w,view:M,timeZone:F});S[W]=ee}}),L.forEach(Z=>Z&&!Z.destroyed&&Z.destroy()),this._set("featureViewModels",S)}_getScreenPoint(y,g){var v=this;return(0,k.A)(function*(){const{spatialReference:M,view:b}=v;if(!b)return null;yield b?.when();const w=y?.spatialReference;return w&&M?(yield(0,Ln.initializeProjection)(w,M,null,g),b.toScreen(y)):null})()}_cancelFetchingFeatures(){const y=this._fetchFeaturesController;y&&y.abort(),this._fetchFeaturesController=null}_projectScreenPointAndFetchFeatures({mapPoint:y,screenPoint:g,event:v,signal:M}){var b=this;return(0,k.A)(function*(){return b.fetchFeatures(g??(yield b._getScreenPoint(y??b.location,{signal:M})),{signal:M,event:v})})()}_fetchFeaturesWithController({mapPoint:y,screenPoint:g,event:v}){this._cancelFetchingFeatures();const M=new AbortController,{signal:b}=M;this._fetchFeaturesController=M;const w=this._projectScreenPointAndFetchFeatures({mapPoint:y,screenPoint:g,signal:b,event:v});return w.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),w}_fetchFeaturesAndOpen(y){var g=this;return(0,k.A)(function*(){const{mapPoint:v,screenPoint:M}=y,{view:b}=g;g._locationScaleHandle?.remove(),g._locationScaleHandle=(0,U.wB)(()=>g.view?.scale,()=>g._debouncedLocationUpdate(v).catch(F=>{(0,Xe.zf)(F)||he.A.getLogger(g).error(F)}));const{pendingFeatures:w}=yield g._fetchFeaturesWithController({mapPoint:v,screenPoint:M,event:y});b?.popup&&"open"in b.popup&&b.popup.open({location:v??void 0,promises:w})})()}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(y,g){return(0,k.A)(function*(){return yield y.when(),y.whenLayerView(g)})()}_getHighlightLayer(y){const{layer:g,sourceLayer:v}=y;return v&&"layer"in v&&v.layer?v.layer:"map-notes"===v?.type||"subtype-group"===v?.type?v:g}_getHighlightTarget(y,g,v){if(function Wl(y,g){return"building-scene"===y||"2d"===g&&("map-image"===y||"tile"===y||"imagery"===y||"imagery-tile"===y)}(g.type,v))return y;const M=y.getObjectId();if(null!=M)return M;const b="imagery"===g.type?void 0:"objectIdField"in g?g.objectIdField||qs:null,w=y.attributes;return w&&b&&w[b]||y}_mapIncludesLayer(y){return!!this.map?.allLayers?.includes(y)}_highlightActiveFeature(){var y=this;return(0,k.A)(function*(){const g="highlight-active-feature";y.removeHandles(g);const{highlightEnabled:v,view:M,activeFeature:b,visible:w}=y;if(!(b&&M&&v&&w))return;const F=y._getHighlightLayer(b);if(!(F&&F instanceof Js.A&&y._mapIncludesLayer(F)))return;const C=y._getLayerView(M,F);y._highlightActiveFeaturePromise=C;const L=yield C;if(!(L&&(0,ro.Of)(L)&&y._highlightActiveFeaturePromise===C&&y.activeFeature&&y.highlightEnabled))return;const S=L.highlight(y._getHighlightTarget(b,F,M.type));y.addHandles(S,g)})()}_highlightSelectedFeature(){var y=this;return(0,k.A)(function*(){const g="highlight-selected-feature";y.removeHandles(g);const{selectedFeature:v,highlightEnabled:M,view:b,visible:w}=y;if(!(v&&b&&M&&w))return;const F=y._getHighlightLayer(v);if(!(F&&F instanceof Js.A&&y._mapIncludesLayer(F)))return;const C=y._getLayerView(b,F);y._highlightSelectedFeaturePromise=C;const L=yield C;if(!(L&&(0,ro.Of)(L)&&y._highlightSelectedFeaturePromise===C&&y.selectedFeature&&y.highlightEnabled&&y.visible))return;const S=L.highlight(y._getHighlightTarget(v,F,b.type));y.addHandles(S,g)})()}_updateFeatures(y){const{features:g}=this,v=y.filter(M=>!g.includes(M));v?.length&&(this.features=g.concat(v))}};(0,_._)([(0,I.MZ)()],Te.prototype,"_fetchFeaturesController",void 0),(0,_._)([(0,I.MZ)({type:Qt})],Te.prototype,"actions",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"active",null),(0,_._)([(0,I.MZ)()],Te.prototype,"activeFeature",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"allActions",null),(0,_._)([(0,I.MZ)()],Te.prototype,"autoCloseEnabled",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"browseClusterEnabled",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"content",void 0),(0,_._)([(0,I.MZ)({type:Qt,readOnly:!0})],Te.prototype,"defaultActions",null),(0,_._)([(0,I.MZ)({type:Boolean})],Te.prototype,"defaultPopupTemplateEnabled",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"featureCount",null),(0,_._)([(0,I.MZ)()],Te.prototype,"featurePage",void 0),(0,_._)([(0,I.MZ)({value:[]})],Te.prototype,"features",null),(0,_._)([(0,I.MZ)()],Te.prototype,"featuresPerPage",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"featureMenuOpen",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"featureViewModelAbilities",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"featureViewModels",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"highlightEnabled",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"includeDefaultActions",void 0),(0,_._)([(0,I.MZ)({type:fn.A})],Te.prototype,"location",null),(0,_._)([(0,I.MZ)()],Te.prototype,"map",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"pendingPromisesCount",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"promiseCount",null),(0,_._)([(0,I.MZ)()],Te.prototype,"promises",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"selectedClusterBoundaryFeature",void 0),(0,_._)([(0,I.MZ)({value:null,readOnly:!0})],Te.prototype,"selectedFeature",null),(0,_._)([(0,I.MZ)({value:-1})],Te.prototype,"selectedFeatureIndex",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"selectedFeatureViewModel",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"state",null),(0,_._)([(0,I.MZ)()],Te.prototype,"timeZone",null),(0,_._)([(0,I.MZ)()],Te.prototype,"title",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"updateLocationEnabled",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"view",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"visible",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"waitingForContents",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Te.prototype,"waitingForResult",null),(0,_._)([(0,I.MZ)()],Te.prototype,"zoomFactor",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"zoomToLocation",void 0),(0,_._)([(0,I.MZ)()],Te.prototype,"centerAtLocation",null),Te=(0,_._)([(0,J.$)("esri.widgets.Features.FeaturesViewModel")],Te);const jn=Te;let Ft=class extends Tt.A{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Ft.prototype,"actionBar",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Ft.prototype,"closeButton",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Ft.prototype,"collapseButton",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Ft.prototype,"featureNavigation",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Ft.prototype,"featureListLayerTitle",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Ft.prototype,"flow",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Ft.prototype,"heading",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],Ft.prototype,"spinner",void 0),Ft=(0,_._)([(0,J.$)("esri.widgets.Features.FeaturesVisibleElements")],Ft);const uo=Ft;var co=A(24092);const ho="selected-index",po="features-spinner";function mo(y){return y?.declaredClass.startsWith("esri.layers.")??!1}let De=class extends(Hs(pe.A)){constructor(y,g){var v;super(y,g),v=this,this._featureMenuIntersectionObserverCallback=([M])=>{M?.isIntersecting&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new te.A,this._relatedRecordsWidget=new wl({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new Qt,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new jn,this.visibleElements=new uo,this._renderAction=(M,b)=>{const w=this._getActionTitle(M),{type:F,active:C,uid:L,disabled:S,indicator:Z}=M;return M.visible?(0,N.K)("calcite-action",{active:"toggle"===F&&M.value,appearance:"solid",bind:this,"data-action-uid":L,disabled:S,icon:this._getActionIcon(M),indicator:Z,key:`action-${b}`,loading:C,onclick:this._triggerAction,scale:"s",text:w,title:this._hideActionText?w:void 0},this._getFallbackIcon(M)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=M=>{this._focusOn===M&&requestAnimationFrame((0,k.A)(function*(){switch(M){case"menu-flow-item":yield v._featureMenuViewportNode?.setFocus();break;case"root-flow-item":yield v._rootFlowItemNode?.setFocus()}v._focusOn=null}))},this._focusFlowItemNodeThrottled=ue(this._focusFlowItemNode,50),this._displaySpinnerThrottled=ue(()=>this._displaySpinner(),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,(0,U.wB)(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),(0,U.wB)(()=>this.viewModel?.active,M=>this._relatedRecordsWidget.closed=!M),(0,U.wB)(()=>this.visibleElements?.closeButton,M=>this._relatedRecordsWidget.closable=M),(0,U.wB)(()=>this.visibleElements?.spinner,M=>this._spinnerEnabledChange(M)),(0,U.wB)(()=>this.viewModel?.view,(M,b)=>this._viewChange(M,b)),(0,U.wB)(()=>this.viewModel?.view?.ready,(M,b)=>this._viewReadyChange(M??!1,b??!1)),(0,U.wB)(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),(0,U.wB)(()=>this.viewModel?.screenLocation,()=>this._closeOpenActionMenu()),(0,U.wB)(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),(0,U.wB)(()=>{const M=this.selectedFeatureWidget?.viewModel;return[M?.title,M?.state]},()=>this._setTitleFromFeatureWidget()),(0,U.wB)(()=>{const M=this.selectedFeatureWidget?.viewModel;return[M?.content,M?.state]},()=>this._setContentFromFeatureWidget()),(0,U.wB)(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:M})=>this._openRelatedFeature(M))])}loadDependencies(){return(0,Kt.W)({action:()=>Promise.all([A.e(2597),A.e(1594),A.e(8843),A.e(822)]).then(A.bind(A,14201)),"action-bar":()=>Promise.all([A.e(2597),A.e(1594),A.e(6883),A.e(8843),A.e(4847),A.e(8469),A.e(9511)]).then(A.bind(A,79511)),"action-group":()=>Promise.all([A.e(2597),A.e(1594),A.e(6883),A.e(8843),A.e(4847),A.e(8469),A.e(1887)]).then(A.bind(A,41887)),button:()=>Promise.all([A.e(2597),A.e(1594),A.e(8991),A.e(6729),A.e(1319)]).then(A.bind(A,91319)),flow:()=>A.e(6195).then(A.bind(A,66195)),"flow-item":()=>Promise.all([A.e(2597),A.e(1594),A.e(6883),A.e(8843),A.e(4847),A.e(5387),A.e(9507)]).then(A.bind(A,9507)),list:()=>Promise.all([A.e(2597),A.e(1594),A.e(8991),A.e(4827),A.e(2076),A.e(861)]).then(A.bind(A,861)),"list-item":()=>Promise.all([A.e(2597),A.e(1594),A.e(8843),A.e(2076),A.e(4835)]).then(A.bind(A,4835)),"list-item-group":()=>Promise.all([A.e(2076),A.e(7277)]).then(A.bind(A,17277)),loader:()=>A.e(2748).then(A.bind(A,2748))})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;const y=this.view?.widthBreakpoint;return"xsmall"===y||"small"===y||"medium"===y}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(y){this.viewModel.content=y}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(y){this.viewModel.featureMenuOpen=y}get features(){return this.viewModel.features}set features(y){this.viewModel.features=y}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(y){this.viewModel.goToOverride=y}get location(){return this.viewModel.location}set location(y){this.viewModel.location=y}get label(){return this.messages?.widgetLabel??""}set label(y){this._overrideIfSome("label",y)}get map(){return this.viewModel.map}set map(y){this.viewModel.map=y}get promises(){return this.viewModel.promises}set promises(y){this.viewModel.promises=y}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(y){this.viewModel.selectedFeatureIndex=y}get selectedFeatureWidget(){const{_feature:y,headingLevel:g,_relatedRecordsFlowItems:v,timeZone:M,spatialReference:b,map:w}=this,{selectedFeatureViewModel:F}=this.viewModel,C={title:!1};return F?(y?(y.viewModel=F,y.visibleElements=C):this._feature=new vl({flowItems:v,headingLevel:g+1,timeZone:M,spatialReference:b,map:w,viewModel:F,visibleElements:C}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(y){this.viewModel.spatialReference=y}get title(){return this.viewModel.title}set title(y){this.viewModel.title=y}get timeZone(){return this.viewModel.timeZone}set timeZone(y){this.viewModel.timeZone=y}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(y){this.viewModel.updateLocationEnabled=y}get view(){return this.viewModel.view}set view(y){this.viewModel.view=y}get visible(){return this.viewModel.visible}set visible(y){this.viewModel.visible=y}blur(){const{active:y}=this.viewModel;y?this._rootFlowItemNode?.blur():he.A.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(y,g){return this.viewModel.fetchFeatures(y,g)}focus(){const{active:y}=this.viewModel;y?this._setFocusOn():he.A.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(y){this.removeHandles(ho),this.set({collapsed:y?.collapsed??!1}),this.viewModel.open(y),this.addHandles((0,U.z7)(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(y){return this.viewModel.triggerAction(y)}render(){return(0,N.K)("div",{bind:this,class:this.classes(st.base,Oe.D.widget,Oe.D.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,N.K)("div",{class:st.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,N.K)("div",{class:st.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:y,viewModel:g}=this,{featureCount:v,selectedFeatureIndex:M,pendingPromisesCount:b}=g;return(0,N.K)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:y.selectFeature,loading:b>0,onclick:this._openFeatureMenu,scale:"s",text:(0,j.V)(y.pageText,{index:(0,Re.ZV)(M+1),total:(0,Re.ZV)(v)}),textEnabled:!0,title:y.selectFeature})}_renderPagination(){const{previous:y,next:g}=this.messagesCommon.pagination;return(0,N.K)("calcite-action-bar",{class:st.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,N.K)("calcite-action-group",{scale:"s"},(0,N.K)("calcite-action",{appearance:"solid",class:st.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:y,onclick:this._previousFeature,scale:"s",text:y,title:y}),(0,N.K)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:g,onclick:this._nextFeature,scale:"s",text:g,title:g})))}_renderFeatureMenuItem(y){const{selectedFeatureViewModel:g,featureViewModels:v}=this.viewModel,M=y===g,b=v.indexOf(y);return(0,N.K)("calcite-list-item",{bind:this,"data-feature-index":b,key:`feature-menu-item-${y.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:M,onCalciteListItemSelect:this._selectFeature},(0,N.K)("span",{innerHTML:y.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:y}=this.viewModel,g=new Map;return y.forEach(v=>{const M=v?.graphic;if(!M)return;const{layer:b,sourceLayer:w}=M,F=(mo(b)?b:null)||(mo(w)?w:null),C=g.get(F)??[];g.set(F,[...C,v])}),g}_renderFeatureMenu(){const{featureViewModels:y}=this.viewModel,g=this._groupResultsByLayer();return y.length?(0,N.K)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(g.keys(),v=>{const M=g.get(v)?.map(w=>this._renderFeatureMenuItem(w)),b=v?v.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&null!==b?(0,N.K)("calcite-list-item-group",{heading:b,key:v?.uid||"map-graphics"},M):M})):null}_renderHeaderAction(y,g){const v=y.title||"";return y.visible?(0,N.K)("calcite-action",{active:"toggle"===y.type&&y.value,appearance:"solid",bind:this,"data-action-uid":y.uid,disabled:y.disabled,icon:y.icon??void 0,indicator:y.indicator,key:`header-action-${g}`,loading:y.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:v,title:v}):null}_renderHeaderActions(){return this.headerActions.map((y,g)=>this._renderHeaderAction(y,g)).toArray()}_renderContentFeature(){const{headingLevel:y,visibleElements:g,_isCollapsed:v,_collapseEnabled:M,featureNavigationTop:b}=this,{title:w,active:F}=this.viewModel,C=g.heading&&w?w:"";return(0,N.K)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[st.contentFeature]:!0,[st.flowItemCollapsed]:v}),closable:g.closeButton,closed:!F,collapsed:v,collapseDirection:b?"down":"up",collapsible:M,headingLevel:y,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},C?(0,N.K)(sn.D,{class:this.classes(st.featuresHeading,Oe.D.heading),innerHTML:C,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),v?null:(0,N.K)("div",{class:this.classes(st.container,st.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:y,featureMenuOpen:g,messages:v,messagesCommon:M}=this,{active:b,featureViewModels:w,pendingPromisesCount:F}=y;return g?(0,N.K)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!b,description:(0,j.V)(v.total,{total:w.length}),heading:v.selectFeature,key:"feature-menu",loading:y.waitingForContents,onCalciteFlowItemBack:C=>{C.preventDefault(),this._handleFeatureMenuBack()}},F>0?(0,N.K)("calcite-loader",{class:st.loader,inline:!0,key:"feature-menu-loader",label:M.loading,slot:"header-actions-end"}):null,(0,N.K)("div",{class:st.container},this._renderFeatureMenu()),(0,N.K)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:st.featureMenuObserver}),(0,N.K)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},M.back)):null}_renderContentContainer(){const y=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?(0,N.K)("calcite-flow",{key:"content-container"},y):y}_getFallbackIcon(y){const{className:g,icon:v}=y;if(v)return null;const M=function xe({action:y,feature:g}){const v=g?.attributes,M="image"in y?y.image:void 0;return M&&v?(0,j.V)(M,v):M??""}({action:y,feature:this.selectedFeature}),b={[st.icon]:!!g,[st.actionImage]:!!M};return g&&(b[g]=!0),M||g?(0,N.K)("span",{"aria-hidden":"true",class:this.classes(st.icon,b),key:"icon",styles:re(M)}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?(0,N.K)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,N.K)("calcite-action-group",{afterCreate:y=>this._actionBarMenuNode=y,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){const y=this.viewModel?.content;return y?"string"==typeof y?(0,N.K)("div",{class:Ye.contentNode,innerHTML:y,key:y}):this.renderNodeContent(y):null}_setFocusOn(){this.renderNow(),requestAnimationFrame(()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"})}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(y){var g=this;return(0,k.A)(function*(){yield y.viewModel.updateGeometry();const v=y.graphic,M=v?.geometry;if(null==M||null==v)return;g._destroyRelatedRecordsFlowItemWidgets(),yield g.viewModel.zoomTo({target:M});const b=D(M);g.open({features:[v],location:b??void 0})})()}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(y){this._rootFlowItemNode=y,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(y){this._featureMenuViewportNode=y,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(y){const{viewModel:g}=this,v=y.currentTarget["data-feature-index"];g.activeFeature=g.features?.[v]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(y){const g=y.currentTarget["data-feature-index"];isNaN(g)||(this.viewModel.selectedFeatureIndex=g),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(y){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(y),this._featureMenuIntersectionObserverNode=y}_getActionIcon(y){return y.icon?y.icon:y.image||y.className?void 0:"question"}_getActionTitle(y){const{messages:g,selectedFeature:v,messagesCommon:M}=this,{id:b}=y,w=v?.attributes,F=y.title??"",C="zoom-to-feature"===b?(0,j.V)(F,{messages:g}):"remove-selected-feature"===b?(0,j.V)(F,{messages:M}):"zoom-to-clustered-features"===b||"browse-clustered-features"===b?(0,j.V)(F,{messages:g}):y.title;return C&&w?(0,j.V)(C,w):C??""}_onMainKeydown(y){const{key:g}=y;"ArrowLeft"===g&&(y.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===g&&(y.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:y}=this;y&&(this.viewModel.content=y)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:y,messagesCommon:g}=this,v=y?.viewModel;y&&(this.viewModel.title="error"===v?.state?g?.errorMessage:v?.title||"")}_addSelectedFeatureIndexHandle(){const y=(0,U.wB)(()=>this.viewModel?.selectedFeatureIndex,(g,v)=>this._selectedFeatureIndexUpdated(g,v));this.addHandles(y,ho)}_selectedFeatureIndexUpdated(y,g){const{featureCount:v}=this.viewModel;v&&y!==g&&-1!==y&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(y){const g=y.currentTarget;if(g.disabled)return;const v=g.dataset.actionUid,M=this.headerActions.find(({uid:b})=>b===v);M&&!M.disabled&&("toggle"===M?.type&&(M.value=!M.value),this.emit("trigger-header-action",{action:M}))}_triggerAction(y){const g=y.currentTarget;if(g.disabled)return;const v=g.dataset.actionUid,{allActions:M}=this.viewModel,b=M.findIndex(F=>F.uid===v),w=M.at(b);w&&"toggle"===w.type&&(w.value=!w.value),this.viewModel.triggerAction(b)}_createSpinner(y){y&&(this._spinner=new bl({view:y}),y.ui.add(this._spinner,{key:po,position:"manual",internal:!0}))}_wireUpView(y){this._destroySpinner(),y&&this.visibleElements?.spinner&&this._createSpinner(y)}_hideSpinner(){const{_spinner:y}=this;y&&(y.location=null,y.hide())}_viewReadyChange(y,g){y?this._wireUpView(this.viewModel?.view):g&&this.viewModel.clear()}_viewChange(y,g){y&&g&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:y}=this;y&&(y.viewModel=null,!y.destroyed&&y.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:y}=this;y&&(y.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.drain(y=>{"showAllEnabled"in y.viewModel&&(y.viewModel.showAllEnabled=!1),y.viewModel=null,y.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:y}=this;y&&(y.screenLocationEnabled=y.active)}_displaySpinner(){const{_spinner:y}=this;if(!y)return;const{location:g,waitingForResult:v}=this.viewModel;v&&g?y.show({location:g}):y.hide()}_destroySpinner(){const{_spinner:y,view:g}=this;y&&(g?.ui?.remove(y,po),y.destroy(),this._spinner=null)}_spinnerEnabledChange(y){this._destroySpinner(),y&&this._createSpinner(this.viewModel?.view)}};(0,_._)([(0,I.MZ)()],De.prototype,"_focusOn",void 0),(0,_._)([(0,I.MZ)()],De.prototype,"_relatedRecordsFlowItems",void 0),(0,_._)([(0,I.MZ)()],De.prototype,"_hideActionText",null),(0,_._)([(0,I.MZ)()],De.prototype,"_featureNavigationVisible",null),(0,_._)([(0,I.MZ)()],De.prototype,"_isCollapsed",null),(0,_._)([(0,I.MZ)()],De.prototype,"_collapseEnabled",null),(0,_._)([(0,I.MZ)({readOnly:!0})],De.prototype,"active",null),(0,_._)([(0,I.MZ)()],De.prototype,"collapsed",void 0),(0,_._)([(0,I.MZ)()],De.prototype,"content",null),(0,_._)([(0,I.MZ)()],De.prototype,"icon",null),(0,_._)([(0,I.MZ)()],De.prototype,"featureMenuOpen",null),(0,_._)([(0,I.MZ)()],De.prototype,"featureNavigationTop",void 0),(0,_._)([(0,I.MZ)()],De.prototype,"features",null),(0,_._)([(0,I.MZ)()],De.prototype,"goToOverride",null),(0,_._)([(0,I.MZ)({type:Qt})],De.prototype,"headerActions",void 0),(0,_._)([(0,I.MZ)()],De.prototype,"headingLevel",void 0),(0,_._)([(0,I.MZ)()],De.prototype,"location",null),(0,_._)([(0,I.MZ)()],De.prototype,"label",null),(0,_._)([(0,I.MZ)()],De.prototype,"map",null),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/widgets/Features/t9n/Features")],De.prototype,"messages",void 0),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/t9n/common")],De.prototype,"messagesCommon",void 0),(0,_._)([(0,I.MZ)()],De.prototype,"promises",null),(0,_._)([(0,I.MZ)()],De.prototype,"responsiveActionsEnabled",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],De.prototype,"selectedFeature",null),(0,_._)([(0,I.MZ)()],De.prototype,"selectedFeatureIndex",null),(0,_._)([(0,I.MZ)({readOnly:!0})],De.prototype,"selectedFeatureWidget",null),(0,_._)([(0,I.MZ)()],De.prototype,"spatialReference",null),(0,_._)([(0,I.MZ)()],De.prototype,"title",null),(0,_._)([(0,I.MZ)()],De.prototype,"timeZone",null),(0,_._)([(0,I.MZ)()],De.prototype,"updateLocationEnabled",null),(0,_._)([(0,I.MZ)()],De.prototype,"view",null),(0,_._)([(0,I.MZ)({type:jn}),(0,co.U)(["triggerAction","trigger-action"])],De.prototype,"viewModel",void 0),(0,_._)([(0,I.MZ)({type:uo,nonNullable:!0})],De.prototype,"visibleElements",void 0),(0,_._)([(0,I.MZ)()],De.prototype,"visible",null),De=(0,_._)([(0,J.$)("esri.widgets.Features")],De);const Ql=De,gt="esri-popup",Jt=`${gt}--is-docked`,Je={base:gt,baseHidden:`${gt}--hidden`,main:`${gt}__main-container`,shadow:`${gt}--shadow`,isDocked:Jt,isDockedTopLeft:`${Jt}-top-left`,isDockedTopCenter:`${Jt}-top-center`,isDockedTopRight:`${Jt}-top-right`,isDockedBottomLeft:`${Jt}-bottom-left`,isDockedBottomCenter:`${Jt}-bottom-center`,isDockedBottomRight:`${Jt}-bottom-right`,alignTopCenter:`${gt}--aligned-top-center`,alignBottomCenter:`${gt}--aligned-bottom-center`,alignTopLeft:`${gt}--aligned-top-left`,alignBottomLeft:`${gt}--aligned-bottom-left`,alignTopRight:`${gt}--aligned-top-right`,alignBottomRight:`${gt}--aligned-bottom-right`,pointer:`${gt}__pointer`,pointerDirection:`${gt}__pointer-direction`};let Wn=class extends jn{constructor(y){super(y)}};Wn=(0,_._)([(0,J.$)("esri.widgets.Popup.PopupViewModel")],Wn);const fo=Wn;let xt=class extends Tt.A{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],xt.prototype,"actionBar",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],xt.prototype,"closeButton",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],xt.prototype,"collapseButton",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],xt.prototype,"featureNavigation",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],xt.prototype,"featureListLayerTitle",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],xt.prototype,"heading",void 0),(0,_._)([(0,I.MZ)({type:Boolean,nonNullable:!0})],xt.prototype,"spinner",void 0),xt=(0,_._)([(0,J.$)("esri.widgets.Popup.PopupVisibleElements")],xt);const Hn=xt,yo={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let Ve=class extends pe.A{constructor(y,g){super(y,g),this._dockAction=new be.A({id:"popup-dock-action"}),this._featuresWidget=new Ql({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new fo,this.visibleElements=new Hn}initialize(){this.addHandles([(0,U.wB)(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),U.Vh),(0,U.wB)(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),U.Vh),(0,U.wB)(()=>this.dockOptions,y=>{const{_dockAction:g}=this,v=this._featuresWidget.headerActions;v.remove(g),y.buttonEnabled&&v.add(g)},U.Vh),(0,U.wB)(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),(0,U.wB)(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),(0,U.wB)(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),(0,U.wB)(()=>this.viewModel?.view?.size,(y,g)=>this._updateDockEnabledForViewSize(y,g)),(0,U.wB)(()=>this.viewModel?.view,(y,g)=>this._viewChange(y,g)),(0,U.wB)(()=>this.viewModel?.view?.ready,(y,g)=>this._viewReadyChange(y??!1,g??!1)),(0,U.wB)(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,U.Vh),(0,U.wB)(()=>this._featureNavigationTop,y=>this._featuresWidget.featureNavigationTop=y,U.Vh),(0,U.wB)(()=>this.headingLevel,y=>this._featuresWidget.headingLevel=y,U.Vh),(0,U.wB)(()=>this.visibleElements.actionBar,y=>this._featuresWidget.visibleElements.actionBar=!!y,U.Vh),(0,U.wB)(()=>this.visibleElements.closeButton,y=>this._featuresWidget.visibleElements.closeButton=!!y,U.Vh),(0,U.wB)(()=>this.visibleElements.collapseButton,y=>this._featuresWidget.visibleElements.collapseButton=!!y,U.Vh),(0,U.wB)(()=>this.visibleElements.heading,y=>this._featuresWidget.visibleElements.heading=!!y,U.Vh),(0,U.wB)(()=>this.visibleElements.spinner,y=>this._featuresWidget.visibleElements.spinner=!!y,U.Vh),(0,U.wB)(()=>this.visibleElements.featureNavigation,y=>this._featuresWidget.visibleElements.featureNavigation=!!y,U.Vh),(0,U.wB)(()=>this.visibleElements.featureListLayerTitle,y=>this._featuresWidget.visibleElements.featureListLayerTitle=!!y,U.Vh),(0,U.on)(()=>this._featuresWidget,"trigger-header-action",y=>{y.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(y){const g={...y};return null!=y?.visibleElements&&(g.visibleElements=new Hn(y.visibleElements),null!=y.collapseEnabled&&(g.visibleElements.collapseButton=y.collapseEnabled),null!=y.spinnerEnabled&&(g.visibleElements.spinner=y.spinnerEnabled)),g}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){const{currentAlignment:y,currentDockPosition:g}=this;return"bottom-left"===y||"bottom-center"===y||"bottom-right"===y||"top-left"===g||"top-center"===g||"top-right"===g}get actions(){return this.viewModel.actions}set actions(y){this.viewModel.actions=y}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(y){this.viewModel.autoCloseEnabled=y}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(y){this.viewModel.defaultPopupTemplateEnabled=y}get content(){return this.viewModel.content}set content(y){this.viewModel.content=y}get collapsed(){return this._featuresWidget.collapsed}set collapsed(y){this._featuresWidget.collapsed=y}get collapseEnabled(){return(0,de.Lx)(he.A.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(y){(0,de.Lx)(he.A.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=y}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||yo}set dockOptions(y){const g={...yo},v=this.viewModel?.view?.breakpoints,M={};v&&(M.width=v.xsmall,M.height=v.xsmall);const b={...g,...y},w={...g.breakpoint,...M},{breakpoint:F}=b;"object"==typeof F?b.breakpoint={...w,...F}:F&&(b.breakpoint=w),this._set("dockOptions",b),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(y){this.viewModel.featureMenuOpen=y}get features(){return this.viewModel.features}set features(y){this.viewModel.features=y}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(y){this.viewModel.goToOverride=y}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(y){this.viewModel.highlightEnabled=y}get icon(){return"popup"}set icon(y){this._overrideIfSome("icon",y)}get location(){return this.viewModel.location}set location(y){this.viewModel.location=y}get label(){return this.messages?.widgetLabel??""}set label(y){this._overrideIfSome("label",y)}get promises(){return this.viewModel.promises}set promises(y){this.viewModel.promises=y}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(y){this.viewModel.selectedFeatureIndex=y}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return(0,de.Lx)(he.A.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(y){(0,de.Lx)(he.A.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=y}get title(){return this.viewModel.title}set title(y){this.viewModel.title=y}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(y){this.viewModel.updateLocationEnabled=y}get view(){return this.viewModel.view}set view(y){this.viewModel.view=y}get visible(){return this.viewModel.visible}set visible(y){this.viewModel.visible=y}blur(){const{active:y}=this.viewModel;y||he.A.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(y,g){return this.viewModel.fetchFeatures(y,g)}focus(){const{active:y}=this.viewModel;y||he.A.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame(()=>{this._featuresWidget.focus()})}next(){return this.viewModel.next()}open(y){this.set({collapsed:!!y&&!!y.collapsed,featureMenuOpen:!!y&&!!y.featureMenuOpen}),this.viewModel.open(y),this._shouldFocus(y)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(y){return this.viewModel.triggerAction(y)}render(){const{dockEnabled:y,currentAlignment:g,currentDockPosition:v}=this,{active:M,screenLocation:b}=this.viewModel,w=M&&y,F=M&&!y,C=this.selectedFeature?.layer?.title,L=this.selectedFeature?.layer?.id;return(0,N.K)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(Je.base,{[Je.alignTopCenter]:"top-center"===g,[Je.alignBottomCenter]:"bottom-center"===g,[Je.alignTopLeft]:"top-left"===g,[Je.alignBottomLeft]:"bottom-left"===g,[Je.alignTopRight]:"top-right"===g,[Je.alignBottomRight]:"bottom-right"===g,[Je.isDocked]:w,[Je.shadow]:F,[Je.isDockedTopLeft]:"top-left"===v,[Je.isDockedTopCenter]:"top-center"===v,[Je.isDockedTopRight]:"top-right"===v,[Je.isDockedBottomLeft]:"bottom-left"===v,[Je.isDockedBottomCenter]:"bottom-center"===v,[Je.isDockedBottomRight]:"bottom-right"===v},{[Je.baseHidden]:!b&&!y}),"data-layer-id":L,"data-layer-title":C,role:"presentation"},M?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:(0,N.K)("div",{class:Je.pointer,key:"popup-pointer",role:"presentation"},(0,N.K)("div",{class:this.classes(Je.pointerDirection,Je.shadow)}))}_renderMainContainer(){const{dockEnabled:y}=this;return(0,N.K)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(Je.main,Oe.D.widget,{[Je.shadow]:y})},this._featuresWidget.render())}_shouldFocus(y){var g=this;return(0,k.A)(function*(){y?.shouldFocus&&(yield(0,U.C_)(()=>!0===g.viewModel?.active),g.focus())})()}_isOutsideView(y){const{popupHeight:g,popupWidth:v,screenLocation:M,side:b,view:w}=y;if(isNaN(v)||isNaN(g)||!w||!M)return!1;const F=w.padding;return"right"===b&&M.x+v/2>w.width-F.right||"left"===b&&M.x-v/2<F.left||"top"===b&&M.y-g<F.top||"bottom"===b&&M.y+g>w.height-F.bottom}_calculateAutoAlignment(y){if("auto"!==y)return y;const{_pointerOffsetInPx:g,_containerNode:v,_mainContainerNode:M,viewModel:b}=this,{screenLocation:w,view:F}=b;if(null==w||!F||!v)return"top-center";function C(Me){return parseInt(Me.replaceAll(/[^-\d.]/g,""),10)}const L=M?window.getComputedStyle(M,null):null,S=L?C(L.getPropertyValue("max-height")):0,Z=L?C(L.getPropertyValue("height")):0,{height:W,width:H}=v.getBoundingClientRect(),ee=H+g,ne=Math.max(W,S,Z)+g,ce=this._isOutsideView({popupHeight:ne,popupWidth:ee,screenLocation:w,side:"right",view:F}),ye=this._isOutsideView({popupHeight:ne,popupWidth:ee,screenLocation:w,side:"left",view:F}),Fe=this._isOutsideView({popupHeight:ne,popupWidth:ee,screenLocation:w,side:"top",view:F}),Ze=this._isOutsideView({popupHeight:ne,popupWidth:ee,screenLocation:w,side:"bottom",view:F});return ye?Fe?"bottom-right":"top-right":ce?Fe?"bottom-left":"top-left":Fe?Ze?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(y){return"function"==typeof y?y.call(this):y}_getCurrentAlignment(){const{alignment:y,dockEnabled:g}=this;return g||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(y)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(y){const g=["left","right"];return(0,At.V8)(this.container)&&g.reverse(),y?.replace(/leading/gi,g[0]).replaceAll(/trailing/gi,g[1])}_callDockPosition(y){return"function"==typeof y?y.call(this):y}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(y){if("auto"!==y)return y;const g=this.viewModel?.view,v=(0,At.V8)(this.container)?"top-left":"top-right";if(!g)return v;const M=g.padding||{left:0,right:0,top:0,bottom:0},b=g.width-M.left-M.right,{breakpoints:w}=g;return w&&b<=w.xsmall?"bottom-center":v}_getDockIcon(){const y=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(y){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(y){this._mainContainerNode=y}_positionContainer(y=this._containerNode){if(y&&(this._containerNode=y),!this._containerNode)return;const{screenLocation:g}=this.viewModel,{width:v}=this._containerNode.getBoundingClientRect(),M=this._calculatePositionStyle(g,v);M&&Object.assign(this._containerNode.style,M)}_calculateFullWidth(y){const{currentAlignment:g,_pointerOffsetInPx:v}=this;return"top-left"===g||"bottom-left"===g||"top-right"===g||"bottom-right"===g?y+v:y}_calculateAlignmentPosition(y,g,v,M){const{currentAlignment:b,_pointerOffsetInPx:w}=this;if(!v)return;const{padding:F}=v,C=M/2,L=v.height-g,S=v.width-y;return"bottom-center"===b?{top:g+w-F.top,left:y-C-F.left}:"top-left"===b?{bottom:L+w-F.bottom,right:S+w-F.right}:"bottom-left"===b?{top:g+w-F.top,right:S+w-F.right}:"top-right"===b?{bottom:L+w-F.bottom,left:y+w-F.left}:"bottom-right"===b?{top:g+w-F.top,left:y+w-F.left}:"top-center"===b?{bottom:L+w-F.bottom,left:y-C-F.left}:void 0}_calculatePositionStyle(y,g){const{dockEnabled:v,view:M}=this;if(!M)return;if(v)return{left:"",top:"",right:"",bottom:""};if(null==y||!g)return;const b=this._calculateFullWidth(g),w=this._calculateAlignmentPosition(y.x,y.y,M,b);return w?{top:void 0!==w.top?`${w.top}px`:"auto",left:void 0!==w.left?`${w.left}px`:"auto",bottom:void 0!==w.bottom?`${w.bottom}px`:"auto",right:void 0!==w.right?`${w.right}px`:"auto"}:void 0}_viewChange(y,g){y&&g&&(this.close(),this.clear())}_viewReadyChange(y,g){y?this._wireUpView():g&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(y,g,v){const[M,b]=y,[w,F]=g,{width:C=0,height:L=0}=v??{};return M<=C&&w>C||M>C&&w<=C||b<=L&&F>L||b>L&&F<=L}_updateDockEnabledForViewSize(y,g){if(!y||!g)return;const v=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},M=v.left+v.right,b=v.top+v.bottom,w=[],F=[];w[0]=y[0]-M,w[1]=y[1]-b,F[0]=g[0]-M,F[1]=g[1]-b;const{dockOptions:C}=this;this._dockingThresholdCrossed(w,F,C.breakpoint)&&this._setDockEnabledForViewSize(C),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:y,viewModel:g}=this;g&&(g.screenLocationEnabled=g.active&&!y)}_shouldDockAtCurrentViewSize(y){const g=y.breakpoint,v=this.viewModel?.view?.ui;if(!v)return!1;const{width:M,height:b}=v;if(isNaN(M)||isNaN(b)||!g)return!1;const w=g.hasOwnProperty("width")&&M<=(g.width??0),F=g.hasOwnProperty("height")&&b<=(g.height??0);return w||F}_setDockEnabledForViewSize(y){y.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(y))}};(0,_._)([(0,I.MZ)({readOnly:!0})],Ve.prototype,"_featureNavigationTop",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"actions",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Ve.prototype,"active",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"alignment",void 0),(0,_._)([(0,I.MZ)()],Ve.prototype,"autoCloseEnabled",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"defaultPopupTemplateEnabled",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"content",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"collapsed",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"collapseEnabled",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Ve.prototype,"currentAlignment",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Ve.prototype,"currentDockPosition",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"dockOptions",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"dockEnabled",void 0),(0,_._)([(0,I.MZ)({readOnly:!0})],Ve.prototype,"featureCount",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"featureMenuOpen",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"features",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"goToOverride",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"headingLevel",void 0),(0,_._)([(0,I.MZ)()],Ve.prototype,"highlightEnabled",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"icon",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"location",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"label",null),(0,_._)([(0,I.MZ)(),(0,ft.G)("esri/widgets/Popup/t9n/Popup")],Ve.prototype,"messages",void 0),(0,_._)([(0,I.MZ)()],Ve.prototype,"promises",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Ve.prototype,"selectedFeature",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"selectedFeatureIndex",null),(0,_._)([(0,I.MZ)({readOnly:!0})],Ve.prototype,"selectedFeatureWidget",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"spinnerEnabled",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"title",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"updateLocationEnabled",null),(0,_._)([(0,I.MZ)()],Ve.prototype,"view",null),(0,_._)([(0,I.MZ)({type:fo}),(0,co.U)(["triggerAction","trigger-action"])],Ve.prototype,"viewModel",void 0),(0,_._)([(0,I.MZ)()],Ve.prototype,"visible",null),(0,_._)([(0,I.MZ)({type:Hn,nonNullable:!0})],Ve.prototype,"visibleElements",void 0),Ve=(0,_._)([(0,J.$)("esri.widgets.Popup")],Ve);const Yl=Ve}}]);