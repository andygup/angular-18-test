"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[3136],{33136:(xe,C,i)=>{i.r(C),i.d(C,{default:()=>ft});var y=i(10467),s=i(8189),z=i(81098),pe=i(92165),P=(i(79122),i(70176),i(92089),i(9826),i(15317),i(38582),i(96128),i(13318),i(85718),i(36156)),E=i(90660),w=i(31178),f=i(5922),L=i(35150),d=i(39693),u=i(56492),g=i(48900),n=i(85211),N=(i(3248),i(40707),i(74220)),F=i(17221),b=i(76576),q=i(26514),Ee=i(62767),je=i(1749),Ze=i(95478),fe=i(63758),Re=i(94376),De=i(25936),Ue=i(23e3),Ce=i(58277),Ne=i(17049),Ge=i(85551),Ve=i(33036),k=i(46406),$e=i(84311),he=i(12849),Qe=i(99980),G=i(71065),j=i(86300);function me({associatedLayer:e,serviceUpdateTimeStamp:r}){const t=e?.editingInfo?.lastEditDate,a=e?.serverGens,l=null!=t,p=null!=r,c=l&&p&&r.lastUpdate!==t.getTime();return l&&(c||!p&&a?.minServerGen!==a?.serverGen)}var ge=i(38488);const We=e=>{let r=class extends e{constructor(){super(...arguments),this.serviceTimeInfo=null}get timeInfo(){const t=this.associatedLayer?.timeInfo;if(null==t)return null;const a=t.clone();return(0,j.sv)(a,this.fieldsIndex),a}set timeInfo(t){(0,j.sv)(t,this.fieldsIndex),this._override("timeInfo",t)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(t){this._override("timeExtent",t)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(t){this._override("timeOffset",t)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(t){this._override("datesInUnknownTimezone",t)}loadTimeInfoFromService(t){var a=this;return(0,y.A)(function*(){const{serviceTimeInfo:l}=a;if(null==l)return;const{startTimeField:p,endTimeField:c}=l;if(null==p&&null==c||me({associatedLayer:a.associatedLayer,serviceUpdateTimeStamp:a.serviceUpdateTimeStamp}))return;const h=function(){var I=(0,y.A)(function*(A){let x=null;try{x=(yield a.fetchStatistics?.(A,t))?.stats}catch{}if(null==x)return null;const{minTimeStr:ne,min:oe,maxTimeStr:ae,max:le}=x,W=A===p?ne??oe:ae??le;return null!=W?new Date(W):null});return function(x){return I.apply(this,arguments)}}(),[m,v]=yield Promise.all([h(p),h(c)]);if(null!=p&&null==m||null!=c&&null==v)return;const T=new he.A({start:m,end:v});a.setAtOrigin("timeInfo",new ge.A({endField:c,startField:p,fullTimeExtent:T}),"service")})()}};return(0,s._)([(0,n.MZ)({type:ge.A,json:{read:!1,write:!1}})],r.prototype,"timeInfo",null),(0,s._)([(0,n.MZ)({type:he.A,json:{read:!1,write:!1}})],r.prototype,"timeExtent",null),(0,s._)([(0,n.MZ)({type:Qe.A,json:{read:!1,write:!1}})],r.prototype,"timeOffset",null),(0,s._)([(0,n.MZ)({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],r.prototype,"datesInUnknownTimezone",null),(0,s._)([(0,n.MZ)({type:Z,readOnly:!0,json:{read:{source:"timeInfo"}}})],r.prototype,"serviceTimeInfo",void 0),r=(0,s._)([(0,b.$)("esri.layers.mixins.TemporalSceneLayer")],r),r};let Z=class extends G.oY{constructor(){super(...arguments),this.endTimeField=null,this.startTimeField=null}};(0,s._)([(0,n.MZ)({type:String})],Z.prototype,"endTimeField",void 0),(0,s._)([(0,n.MZ)({type:String})],Z.prototype,"startTimeField",void 0),Z=(0,s._)([(0,b.$)("esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo")],Z);var ve=i(68438),ze=i(86537),Je=i(75783),R=i(22329),Ie=i(39729),Ke=i(27378),He=i(71906),Be=i(3404),Ye=i(73258),D=i(10581),Le=i(6829),Xe=i(20329),Ae=i(73975),qe=i(64584),ke=i(64833);let S=class extends G.oY{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};(0,s._)([(0,n.MZ)({type:String,json:{read:!0,write:!0}})],S.prototype,"name",void 0),(0,s._)([(0,n.MZ)({type:String,json:{read:!0,write:!0}})],S.prototype,"field",void 0),(0,s._)([(0,n.MZ)({type:[Number],json:{read:!0,write:!0}})],S.prototype,"currentRangeExtent",void 0),(0,s._)([(0,n.MZ)({type:[Number],json:{read:!0,write:!0}})],S.prototype,"fullRangeExtent",void 0),(0,s._)([(0,n.MZ)({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],S.prototype,"type",void 0),S=(0,s._)([(0,b.$)("esri.layers.support.RangeInfo")],S);var V,Fe=i(89563),_e=i(77806),et=i(25968),Se=i(96996),_=i(55861),we=i(11817);let ee=V=class extends((0,G.Te)(w.A.ofType(_.A))){constructor(e){super(e)}clone(){return new V(this.items.map(e=>e.clone()))}write(e,r){return this.toJSON(r)}toJSON(e){const r=e?.layer?.spatialReference;return r?this.toArray().map(t=>{if(!r.equals(t.spatialReference)){if(!(0,we.canProjectWithoutEngine)(t.spatialReference,r))return e?.messages&&e.messages.push(new Se.A("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const l=new _.A;(0,we.projectPolygon)(t,l,r),t=l}const a=t.toJSON(e);return delete a.spatialReference,a}).filter(t=>null!=t):(e?.messages&&e.messages.push(new Se.A("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(t=>t.toJSON(e)))}static fromJSON(e,r){const t=new V;return e.forEach(a=>t.add(_.A.fromJSON(a,r))),t}};ee=V=(0,s._)([(0,b.$)("esri.layers.support.PolygonCollection")],ee);const $=ee;var te,tt=i(88135);let O=te=class extends G.oY{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new $,this._geometriesSource=null}initialize(){this.addHandles((0,g.on)(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,g.OH))}readGeometries(e,r,t){Array.isArray(e)?this.geometries=$.fromJSON(e,t):this._geometriesSource={url:(0,tt.f)(e,t),context:t}}loadGeometries(e,r){var t=this;return(0,y.A)(function*(){if(null==t._geometriesSource)return;const{url:a,context:l}=t._geometriesSource,p=yield(0,Fe.A)(a,{responseType:"json",signal:r?.signal}),c=e.toJSON(),h=p.data.map(m=>({...m,spatialReference:c}));t.geometries=$.fromJSON(h,l),t._geometriesSource=null})()}clone(){const e=new te({geometries:(0,_e.o8)(this.geometries),spatialRelationship:this.spatialRelationship});return e._geometriesSource=this._geometriesSource,e}};(0,s._)([(0,n.MZ)({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],O.prototype,"spatialRelationship",void 0),(0,s._)([(0,n.MZ)({type:$,nonNullable:!0,json:{write:!0}}),(0,et.P)({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],O.prototype,"geometries",void 0),(0,s._)([(0,F.w)(["web-scene","portal-item"],"geometries")],O.prototype,"readGeometries",null),O=te=(0,s._)([(0,b.$)("esri.layers.support.SceneFilter")],O);const rt=O;var it=i(45272);function re(){return(re=(0,y.A)(function*({fieldName:e,statisticsInfo:r,errorContext:t,fieldsIndex:a,path:l,customParameters:p,apiKey:c,signal:h}){if(null==r)throw new f.A(`${t}:no-cached-statistics`,"Cached statistics are not available for this layer");const m=a.get(e);if(null==m)throw new f.A(`${t}:field-unexisting`,`Field '${e}' does not exist on the layer`);const v=r.find(A=>A.name===m.name);if(null==v)throw new f.A(`${t}:no-cached-statistics`,"Cached statistics for this attribute are not available");const T=(0,it.fj)(l,v.href),{data:I}=yield(0,Fe.A)(T,{query:{f:"json",...p,token:c},responseType:"json",signal:h});return I})).apply(this,arguments)}var nt=i(8691),ot=i(87086),Q=i(73812),Te=i(12089),at=i(41843);function ie(){return(ie=(0,y.A)(function*(e){const r=[];for(const t of e)t.name.toLowerCase().endsWith(".zip")?r.push(dt(t)):r.push(Promise.resolve(t));return(yield Promise.all(r)).flat()})).apply(this,arguments)}function dt(e){return se.apply(this,arguments)}function se(){return(se=(0,y.A)(function*(e){const{BlobReader:r,ZipReader:t,BlobWriter:a}=yield Promise.all([i.e(2076),i.e(7344)]).then(i.bind(i,47344)),l=[];return(yield new t(new r(e)).getEntries()).forEach(c=>{if(c.directory||/^__MACOS/i.test(c.filename))return;const h=new a,m=c.getData?.(h).then(v=>new File([v],c.filename));m&&l.push(m)}),Promise.all(l)})).apply(this,arguments)}var pt=i(10401),Me=i(64935),ut=i(46873);const yt=new Set(["3DObject","Point"]),be=(0,Be.p)();let o=class extends(We((0,Ce.w6)((0,k.w6)((0,De.b)((0,Ne.q)((0,Ge.A)((0,Ve.j)((0,d.P)((0,Ue.d)((0,Re.p)((0,E.O)(Ze.A)))))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new w.A,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(e,r){return"string"==typeof e?{url:e,...r}:e}destroy(){this._set("renderer",null)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,r){const t=this.getFeatureType(r?.feature)?.domains?.[e];return t&&"inherited"!==t.type?t:this.getField(e)?.domain??null}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new Ye.A(this.fields)}readNodePages(e,r,t){return"Point"===r.layerType&&(e=r.pointNodePages),null==e||"object"!=typeof e?null:D.W4.fromJSON(e,t)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return null!=this.associatedLayer&&(0,Ie.C$)(this.associatedLayer)}get geometryType(){return ct[this.profile]||"mesh"}set renderer(e){(0,j.yp)(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return null!=e&&"object"==typeof e||(e={}),null==e.color&&(e.color=!1),e}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(e){e=e??Je.P;const{query:r,queryRelated:t,editing:{supportsGlobalId:a,supportsRollbackOnFailure:l,supportsUploadWithItemId:p,supportsGeometryUpdate:c,supportsReturnServiceEditsInSourceSpatialReference:h},data:{supportsZ:m,supportsM:v,isVersioned:T,supportsAttachment:I},operations:{supportsEditing:A,supportsAdd:x,supportsUpdate:ne,supportsDelete:oe,supportsQuery:ae,supportsQueryAttachments:le,supportsAsyncConvert3D:W}}=e,U=e.operations.supportsChangeTracking,de=!!this.associatedLayer?.infoFor3D&&(0,Te.Vo)();return{query:r,queryRelated:t,editing:{supportsGlobalId:a,supportsReturnServiceEditsInSourceSpatialReference:h,supportsRollbackOnFailure:l,supportsGeometryUpdate:de&&c,supportsUploadWithItemId:p},data:{supportsAttachment:I,supportsZ:m,supportsM:v,isVersioned:T},operations:{supportsQuery:ae,supportsQueryAttachments:le,supportsEditing:A&&U,supportsAdd:de&&x&&U,supportsDelete:de&&oe&&U,supportsUpdate:ne&&U,supportsAsyncConvert3D:W}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.associatedLayer?.editingEnabled??!1}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,r){return!e&&r.fields&&r.fields.some(t=>("esriFieldTypeOID"===t.type&&(e=t.name),!!e)),e||void 0}readGlobalIdField(e,r){return!e&&r.fields&&r.fields.some(t=>("esriFieldTypeGlobalID"===t.type&&(e=t.name),!!e)),e||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(e,r){const t=r.store.profile;return null!=t&&Oe[t]?Oe[t]:(L.A.getLogger(this).error("Unknown or missing profile",{profile:t,layer:this}),"mesh-pyramids")}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(e){this._override("useViewTime",e)}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}_load(e){var r=this;return(0,y.A)(function*(){const t=null!=e?e.signal:null;yield r.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(u.QP),yield r._fetchService(t),yield Promise.all([r._fetchIndexAndUpdateExtent(r.nodePages,t),r._setAssociatedFeatureLayer(t),r._loadFilterGeometries()]),r._validateElevationInfo(),r._applyAssociatedLayerOverrides(),r._populateFieldUsageInfo(),yield r.loadTimeInfoFromService(e),yield(0,nt.L)(r,{origin:"service"},t),(0,j.yp)(r.renderer,r.fieldsIndex),yield r.finishLoadEditablePortalLayer(e)})()}beforeSave(){var e=this;return(0,y.A)(function*(){null!=e.filter&&(e.filter=e.filter.clone(),yield e.load())})()}_loadFilterGeometries(){var e=this;return(0,y.A)(function*(){if(e.filter)try{yield e.filter.loadGeometries(e.spatialReference)}catch(r){L.A.getLogger(e).error("#_loadFilterGeometries()",e,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:r}),e.filter=null}})()}createQuery(){const e=new ot.A;return"mesh"===this.geometryType?this.associatedLayer?.infoFor3D&&(e.returnGeometry=!0):(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e.outFields=["*"],e}queryExtent(e,r){return this._getAssociatedLayerForQuery().then(t=>t.queryExtent(e||this.createQuery(),r))}queryFeatureCount(e,r){return this._getAssociatedLayerForQuery().then(t=>t.queryFeatureCount(e||this.createQuery(),r))}queryFeatures(e,r){return this._getAssociatedLayerForQuery().then(t=>t.queryFeatures(e||this.createQuery(),r)).then(t=>{if(t?.features)for(const a of t.features)a.layer=this,a.sourceLayer=this;return t})}queryRelatedFeatures(e,r){var t=this;return(0,y.A)(function*(){if(yield t.load(),!t.associatedLayer)throw new f.A("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:t});return t.associatedLayer.queryRelatedFeatures(e,r)})()}queryRelatedFeaturesCount(e,r){var t=this;return(0,y.A)(function*(){if(yield t.load(),!t.associatedLayer)throw new f.A("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:t});return t.associatedLayer.queryRelatedFeaturesCount(e,r)})()}queryCachedAttributes(e,r){var t=this;return(0,y.A)(function*(){const a=(0,j.hL)(t.fieldsIndex,yield(0,Me.TO)(t,(0,Me.D8)(t)));return(0,pt.s1)(t.parsedUrl?.path??"",t.attributeStorageInfo??[],e,r,a,t.apiKey,t.customParameters)})()}queryCachedFeature(e,r){var t=this;return(0,y.A)(function*(){const a=yield t.queryCachedAttributes(e,[r]);if(!a||0===a.length)throw new f.A("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const l=new z.A;return l.attributes=a[0],l.layer=t,l.sourceLayer=t,l})()}queryObjectIds(e,r){return this._getAssociatedLayerForQuery().then(t=>t.queryObjectIds(e||this.createQuery(),r))}queryAttachments(e,r){return this._getAssociatedLayerForQuery().then(t=>t.queryAttachments(e,r))}getFieldUsageInfo(e){const r={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||r:(L.A.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),r)}createPopupTemplate(e){return(0,at.tn)(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return e?.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}_loadAssociatedLayerForQuery(){var e=this;return(0,y.A)(function*(){if(yield e.load(),!e.associatedLayer)throw new f.A("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:e});try{yield e.associatedLayer.load()}catch(r){throw new f.A("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:e,error:r})}return e.associatedLayer})()}hasCachedStatistics(e){return null!=this.statisticsInfo&&this.statisticsInfo.some(r=>r.name===e)}queryCachedStatistics(e,r){var t=this;return(0,y.A)(function*(){return yield t.load(r),yield t.fetchStatistics(e,r)})()}saveAs(e,r){var t=this;return(0,y.A)(function*(){return t._debouncedSaveOperations(k.Xh.SAVE_AS,{...r,getTypeKeywords:()=>t._getTypeKeywords(),portalItemLayerType:"scene"},e)})()}save(){var e=this;return(0,y.A)(function*(){const r={getTypeKeywords:()=>e._getTypeKeywords(),portalItemLayerType:"scene"};return e._debouncedSaveOperations(k.Xh.SAVE,r)})()}applyEdits(e,r){var t=this;return(0,y.A)(function*(){const{applyEdits:a}=yield i.e(1447).then(i.bind(i,13828));let l=r;yield t.load();const p=t.associatedLayer;if(!p)throw new f.A(`${t.type}-layer:not-editable`,"Service is not editable");yield p.load();const{globalIdField:c}=p,h=!!p.infoFor3D,m=l?.globalIdUsed??!0;if(h&&null==c)throw new f.A(`${t.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(h&&!m)throw new f.A(`${t.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");return(0,ve.Wo)(p.url)&&h&&null!=e.deleteFeatures&&null!=c&&(l={...l,globalIdToObjectId:yield(0,Ie.GA)(p,e.deleteFeatures,c)}),a(t,p.source,e,l)})()}uploadAssets(e,r){var t=this;return(0,y.A)(function*(){if(yield t.load(),null==t.associatedLayer)throw new f.A(`${t.type}-layer:not-editable`,"Service is not editable");return yield t.associatedLayer.load(),t.associatedLayer.uploadAssets(e,r)})()}on(e,r){return super.on(e,r)}convertMesh(e,r){var t=this;return(0,y.A)(function*(){const a=I=>{throw L.A.getLogger(t).error(".convertMesh()",I.message),I};yield t.load(),t.infoFor3D||a(new f.A("invalid:layer","SceneLayer has no capability for mesh conversion"));const l=yield t.extractAndFilterFiles(e),p=l.reduce((I,A)=>(0,Le.oF)(t.infoFor3D,A)?I+1:I,0);0===p&&a(new fe.VP),p>1&&a(new fe.XQ);const c=t.spatialReference,h=r?.location??new je.A({x:0,y:0,z:0,spatialReference:c}),v=Ee.A.createWithExternalSource(h,l,{vertexSpace:h.spatialReference.isGeographic?"local":"georeferenced"}),[T]=yield t.uploadAssets([v],r);return T})()}extractAndFilterFiles(e){var r=this;return(0,y.A)(function*(){yield r.load();const t=r.infoFor3D;return t?(yield function lt(e){return ie.apply(this,arguments)}(e)).filter(a=>(0,Le.fu)(t,a)):e})()}validateLayer(e){if(e.layerType&&!yt.has(e.layerType))throw new f.A("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new f.A("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new f.A("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});!function r(t,a){let l=!1,p=!1;if(null==t)l=!0,p=!0;else{const c=a&&a.isGeographic;switch(t){case"east-north-up":case"earth-centered":l=!0,p=c;break;case"vertex-reference-frame":l=!0,p=!c;break;default:l=!1}}if(!l)throw new f.A("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!p)throw new f.A("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if("points"===this.profile)e.push("Point");else{if("mesh-pyramids"!==this.profile)throw new f.A("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const r=!!this.attributeStorageInfo?.some(l=>l.name===e.name),t=!!this.associatedLayer?.fields?.some(l=>l&&e.name===l.name);this._fieldUsageInfo[e.name]={supportsLabelingInfo:r,supportsRenderer:r,supportsPopupTemplate:r||t,supportsLayerQuery:t}}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let e=null;for(const r of this.associatedLayer.fields){const t=this.getField(r.name);t?(!t.domain&&r.domain&&(t.domain=r.domain.clone()),t.editable=r.editable,t.nullable=r.nullable,t.length=r.length):(e||(e=this.fields?this.fields.slice():[]),e.push(r.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const e=["popupTemplate","popupEnabled"],r=(0,N.oY)(this);for(let t=0;t<e.length;t++){const a=e[t],l=this.originIdOf(a),p=this.associatedLayer.originIdOf(a);l<p&&(p===q.Gr.SERVICE||p===q.Gr.PORTAL_ITEM)&&r.setAtOrigin(a,this.associatedLayer[a],p)}}_applyAssociatedLayerExtentOverride(){const e=this.associatedLayer?.getAtOrigin("fullExtent","service");(0,Te.Vo)()&&null!=this.associatedLayer?.infoFor3D&&e&&(0,ve.Wo)(this.associatedLayer?.url)&&me(this)&&(0,N.oY)(this).setAtOrigin("fullExtent",e.clone(),q.Gr.SERVICE)}_applyAssociatedLayerPrivileges(){const e=this.associatedLayer;e&&(this._set("userHasEditingPrivileges",e.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",e.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",e.userHasUpdateItemPrivileges))}_setAssociatedFeatureLayer(e){var r=this;return(0,y.A)(function*(){if(["mesh-pyramids","points"].includes(r.profile))try{const{serverUrl:t,layerId:a,portalItem:l}=yield(0,ze.L)(`${r.url}/layers/${r.layerId}`,{sceneLayerItem:r.portalItem,customParameters:r.customParameters,apiKey:r.apiKey,signal:e}),p=yield ke.S.FeatureLayer();r.associatedLayer=new p({url:t,customParameters:r.customParameters,layerId:a,portalItem:l}),yield r.associatedLayer.load()}catch(t){(0,u.zf)(t)||r._logWarningOnPopupEnabled()}})()}_logWarningOnPopupEnabled(){var e=this;return(0,y.A)(function*(){yield(0,g.C_)(()=>e.popupEnabled&&null!=e.popupTemplate);const r=`this SceneLayer: ${e.title}`;null==e.attributeStorageInfo?L.A.getLogger(e).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${r}`):L.A.getLogger(e).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${r}`)})()}_validateElevationInfo(){const e=this.elevationInfo;"mesh-pyramids"===this.profile&&(0,Q.XF)(L.A.getLogger(this),(0,Q.$7)("Mesh scene layers","relative-to-scene",e)),(0,Q.XF)(L.A.getLogger(this),(0,Q.tW)("Scene layers",e))}fetchStatistics(e,r){var t=this;return(0,y.A)(function*(){return yield function st(e){return re.apply(this,arguments)}({fieldName:e,statisticsInfo:t.statisticsInfo,errorContext:"scenelayer",fieldsIndex:t.fieldsIndex,path:t.parsedUrl?.path??"",customParameters:t.customParameters,apiKey:t.apiKey,signal:r?.signal})})()}};(0,s._)([(0,n.MZ)({types:{key:"type",base:Ke.c,typeMap:{selection:He.A}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],o.prototype,"featureReduction",void 0),(0,s._)([(0,n.MZ)({type:[S],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],o.prototype,"rangeInfos",void 0),(0,s._)([(0,n.MZ)({json:{read:!1}})],o.prototype,"associatedLayer",void 0),(0,s._)([(0,n.MZ)({type:["show","hide"]})],o.prototype,"listMode",void 0),(0,s._)([(0,n.MZ)({type:["ArcGISSceneServiceLayer"]})],o.prototype,"operationalLayerType",void 0),(0,s._)([(0,n.MZ)({json:{read:!1},readOnly:!0})],o.prototype,"type",void 0),(0,s._)([(0,n.MZ)({...be.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],o.prototype,"fields",void 0),(0,s._)([(0,n.MZ)()],o.prototype,"types",null),(0,s._)([(0,n.MZ)()],o.prototype,"typeIdField",null),(0,s._)([(0,n.MZ)()],o.prototype,"templates",null),(0,s._)([(0,n.MZ)()],o.prototype,"formTemplate",null),(0,s._)([(0,n.MZ)({readOnly:!0,clonable:!1})],o.prototype,"fieldsIndex",null),(0,s._)([(0,n.MZ)({type:qe.A,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],o.prototype,"floorInfo",void 0),(0,s._)([(0,n.MZ)(be.outFields)],o.prototype,"outFields",void 0),(0,s._)([(0,n.MZ)({type:D.W4,readOnly:!0,json:{read:!1}})],o.prototype,"nodePages",void 0),(0,s._)([(0,F.w)("service","nodePages",["nodePages","pointNodePages"])],o.prototype,"readNodePages",null),(0,s._)([(0,n.MZ)({type:[D.uV],readOnly:!0})],o.prototype,"materialDefinitions",void 0),(0,s._)([(0,n.MZ)({type:[D.Ot],readOnly:!0})],o.prototype,"textureSetDefinitions",void 0),(0,s._)([(0,n.MZ)({type:[D.L0],readOnly:!0})],o.prototype,"geometryDefinitions",void 0),(0,s._)([(0,n.MZ)({readOnly:!0})],o.prototype,"serviceUpdateTimeStamp",void 0),(0,s._)([(0,n.MZ)({readOnly:!0})],o.prototype,"attributeStorageInfo",void 0),(0,s._)([(0,n.MZ)({readOnly:!0})],o.prototype,"statisticsInfo",void 0),(0,s._)([(0,n.MZ)({type:w.A.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],o.prototype,"excludeObjectIds",void 0),(0,s._)([(0,n.MZ)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],o.prototype,"definitionExpression",void 0),(0,s._)([(0,n.MZ)({type:rt,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],o.prototype,"filter",void 0),(0,s._)([(0,n.MZ)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],o.prototype,"path",void 0),(0,s._)([(0,n.MZ)(R.Yj)],o.prototype,"elevationInfo",null),(0,s._)([(0,n.MZ)({readOnly:!0,json:{read:!1}})],o.prototype,"effectiveCapabilities",null),(0,s._)([(0,n.MZ)({readOnly:!0})],o.prototype,"effectiveEditingEnabled",null),(0,s._)([(0,n.MZ)({type:String})],o.prototype,"geometryType",null),(0,s._)([(0,n.MZ)(R.kF)],o.prototype,"labelsVisible",void 0),(0,s._)([(0,n.MZ)({type:[Xe.A],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:Ae.w},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:Ae.w},write:!0}})],o.prototype,"labelingInfo",void 0),(0,s._)([(0,n.MZ)(R.fV)],o.prototype,"legendEnabled",void 0),(0,s._)([(0,n.MZ)({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,r){if("number"==typeof e&&e>=0&&e<=1)return e;const t=r.layerDefinition?.drawingInfo?.transparency;return void 0!==t?(0,ut.D)(t):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],o.prototype,"opacity",void 0),(0,s._)([(0,n.MZ)({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],o.prototype,"priority",void 0),(0,s._)([(0,n.MZ)({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],o.prototype,"semantic",void 0),(0,s._)([(0,n.MZ)({types:P.X,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],o.prototype,"renderer",null),(0,s._)([(0,n.MZ)({json:{read:!1}})],o.prototype,"cachedDrawingInfo",void 0),(0,s._)([(0,F.w)("service","cachedDrawingInfo")],o.prototype,"readCachedDrawingInfo",null),(0,s._)([(0,n.MZ)({readOnly:!0,json:{read:!1}})],o.prototype,"capabilities",null),(0,s._)([(0,n.MZ)({type:Boolean,json:{read:!1}})],o.prototype,"editingEnabled",null),(0,s._)([(0,n.MZ)({readOnly:!0,json:{write:!1,read:!1}})],o.prototype,"infoFor3D",null),(0,s._)([(0,n.MZ)({readOnly:!0,json:{write:!1,read:!1}})],o.prototype,"relationships",null),(0,s._)([(0,n.MZ)(R.M6)],o.prototype,"popupEnabled",void 0),(0,s._)([(0,n.MZ)({type:pe.A,json:{name:"popupInfo",write:!0}})],o.prototype,"popupTemplate",void 0),(0,s._)([(0,n.MZ)({readOnly:!0,json:{read:!1}})],o.prototype,"defaultPopupTemplate",null),(0,s._)([(0,n.MZ)({type:String,json:{read:!1}})],o.prototype,"objectIdField",void 0),(0,s._)([(0,F.w)("service","objectIdField",["objectIdField","fields"])],o.prototype,"readObjectIdField",null),(0,s._)([(0,n.MZ)({type:String,json:{read:!1}})],o.prototype,"globalIdField",void 0),(0,s._)([(0,F.w)("service","globalIdField",["globalIdField","fields"])],o.prototype,"readGlobalIdField",null),(0,s._)([(0,n.MZ)({readOnly:!0,type:String,json:{read:!1}})],o.prototype,"displayField",null),(0,s._)([(0,n.MZ)({type:String,json:{read:!1}})],o.prototype,"profile",void 0),(0,s._)([(0,F.w)("service","profile",["store.profile"])],o.prototype,"readProfile",null),(0,s._)([(0,n.MZ)({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],o.prototype,"normalReferenceFrame",void 0),(0,s._)([(0,n.MZ)(R.PY)],o.prototype,"screenSizePerspectiveEnabled",void 0),(0,s._)([(0,n.MZ)({json:{read:!1,origins:{service:{read:!0}}}})],o.prototype,"serviceItemId",void 0),(0,s._)([(0,n.MZ)($e.B)],o.prototype,"useViewTime",null),o=(0,s._)([(0,b.$)("esri.layers.SceneLayer")],o);const Oe={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},ct={"mesh-pyramids":"mesh",points:"point"},ft=o},6829:(xe,C,i)=>{i.d(C,{E1:()=>K,Fm:()=>ue,JZ:()=>L,R_:()=>J,fu:()=>s,oF:()=>z,rq:()=>H});const y=[["binary","application/octet-stream","bin",""]];function s(d,u){return null!=B(u.name,d?.supportedFormats??[])}function z(d,u){if(!d)return!1;const g=H(u,d.supportedFormats??[]);return null!=g&&d.editFormats.includes(g)}function J(d,u){return P(function ce(d,u){const g=d.toLowerCase();return M(u).find(n=>E(n)===g)}(d,u))}function K(d,u){return P(B(d,u))}function ue(d,u){return E(function ye(d,u){return M(u).find(g=>P(g)===d)}(d,u))}function H(d,u){return K(d.name,u)??J(d.type,u)}function M(d){return[...y,...d]}function B(d,u){const g=d.toLowerCase();return M(u).find(n=>function w(d){return d?.[2].split(",").map(u=>u.toLowerCase())??[]}(n).some(Y=>g.endsWith(Y)))}function P(d){return d?.[0]}function E(d){return d?.[1].toLowerCase()}function L(d){return d.tables?.find(u=>"assetMaps"===u.role)}}}]);