"use strict";(self.webpackChunkangular_18_test=self.webpackChunkangular_18_test||[]).push([[6406,7340,9063],{23506:($,U,r)=>{r.d(U,{v:()=>i});var d=r(99305);function i(E){E?.writtenProperties&&E.writtenProperties.forEach(({target:y,propName:S,newOrigin:w})=>{(0,d.H)(y)&&w&&y.originOf(S)!==w&&y.updateOrigin(S,w)})}},99305:($,U,r)=>{function d(i){return i&&"getAtOrigin"in i&&"originOf"in i}r.d(U,{H:()=>d})},46406:($,U,r)=>{r.d(U,{Xh:()=>H,w6:()=>V});var d=r(10467),i=r(8189),E=r(89563),y=r(5922),S=r(35150),w=r(56492),M=r(45272),p=r(85211),g=(r(3248),r(40707),r(17221)),T=r(76576),b=r(50305),c=r(23506),f=r(28067),A=r(33119),m=r(32034),P=r(68438),j=r(22329),o=r(27834);var D=r(73874),l=r(46577),O=r(15764),W=r(3458),K=r(96904),L=r(95945);const V=v=>{let h=class extends v{constructor(){var n;super(...arguments),n=this,this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,w.sg)(function(){var e=(0,d.A)(function*(t,s,a){switch(t){case H.SAVE:return n._save(s);case H.SAVE_AS:return n._saveAs(a,s)}});return function(t,s,a){return e.apply(this,arguments)}}())}readSpatialReference(n,e){return B(e)}readFullExtent(n,e,t){if(null!=n&&"object"==typeof n){const N=null==n.spatialReference?{...n,spatialReference:B(e)}:n;return f.A.fromJSON(N,t)}const s=e.store,a=B(e);return null==a||null==s?.extent||!Array.isArray(s.extent)||s.extent.some(N=>N<C)?null:new f.A({xmin:s.extent[0],ymin:s.extent[1],xmax:s.extent[2],ymax:s.extent[3],spatialReference:a})}parseVersionString(n){const e={major:Number.NaN,minor:Number.NaN,versionString:n},t=n.split(".");return t.length>=2&&(e.major=parseInt(t[0],10),e.minor=parseInt(t[1],10)),e}readVersion(n,e){const t=e.store,s=null!=t.version?t.version.toString():"";return this.parseVersionString(s)}readTitlePortalItem(n){return"item-title"!==this.sublayerTitleMode?void 0:n}readTitleService(n,e){const t=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return this.url?(0,P.yG)(this.url,e.name):e.name;let s=e.name;if(!s&&this.url){const a=(0,P.qg)(this.url);null!=a&&(s=a.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&t&&(s=t+" - "+s),(0,P.cr)(s)}set url(n){if(null==n)return void this._set("url",n);const e=(0,P.HZ)({layer:this,url:n,nonStandardUrlAllowed:!1,logger:S.A.getLogger(this)});this._set("url",e.url),null!=e.layerId&&this._set("layerId",e.layerId)}writeUrl(n,e,t,s){(0,P.LS)(this,n,"layers",e,s)}get parsedUrl(){const n=this._get("url"),e=(0,M.An)(n);return e&&null!=this.layerId&&(e.path=`${e.path}/layers/${this.layerId}`),e}_fetchIndexAndUpdateExtent(n,e){var t=this;return(0,d.A)(function*(){t.indexInfo=(0,o.F)(t.parsedUrl?.path??"",t.rootNode,n,t.customParameters,t.apiKey,S.A.getLogger(t),e),null==t.fullExtent||t.fullExtent.hasZ||t._updateExtent(yield t.indexInfo)})()}_updateExtent(n){if("page"===n?.type){const e=n.rootIndex%n.pageSize,t=n.rootPage?.nodes?.[e];if(null==t?.obb?.center||null==t.obb.halfSize)throw new y.A("sceneservice:invalid-node-page","Invalid node page.");if(t.obb.center[0]<C||null==this.fullExtent||this.fullExtent.hasZ)return;const s=t.obb.halfSize,a=t.obb.center[2],N=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);this.fullExtent.zmin=a-N,this.fullExtent.zmax=a+N}else if("node"===n?.type){const e=n.rootNode?.mbs;if(!Array.isArray(e)||4!==e.length||e[0]<C)return;const t=e[2],s=e[3],{fullExtent:a}=this;a&&(a.zmin=t-s,a.zmax=t+s)}}_fetchService(n){var e=this;return(0,d.A)(function*(){if(null==e.url)throw new y.A("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==e.layerId&&/SceneServer\/*$/i.test(e.url)){const t=yield e._fetchFirstLayerId(n);null!=t&&(e.layerId=t)}return e._fetchServiceLayer(n)})()}_fetchFirstLayerId(n){var e=this;return(0,d.A)(function*(){const t=yield(0,E.A)(e.url??"",{query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:n});if(t.data&&Array.isArray(t.data.layers)&&t.data.layers.length>0)return t.data.layers[0].id})()}_fetchServiceLayer(n){var e=this;return(0,d.A)(function*(){const t=yield(0,E.A)(e.parsedUrl?.path??"",{query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:n});t.ssl&&e.url&&(e.url=e.url.replace(/^http:/i,"https:"));let s=!1;if(t.data.layerType&&"Voxel"===t.data.layerType&&(s=!0),s)return e._fetchVoxelServiceLayer();const a=t.data;e.read(a,e._getServiceContext()),e.validateLayer(a)})()}_fetchVoxelServiceLayer(n){var e=this;return(0,d.A)(function*(){const t=(yield(0,E.A)(e.parsedUrl?.path+"/layer",{query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:n})).data;e.read(t,e._getServiceContext()),e.validateLayer(t)})()}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}_ensureLoadBeforeSave(){var n=this;return(0,d.A)(function*(){yield n.load(),"beforeSave"in n&&"function"==typeof n.beforeSave&&(yield n.beforeSave())})()}validateLayer(n){}_saveAs(n,e){var t=this;return(0,d.A)(function*(){const s={...X,...e};let a=l.default.from(n);if(!a)throw new y.A("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");(0,K.X)(a),a.id&&(a=a.clone(),a.id=null);const N=a.portal||D.A.getDefault();yield t._ensureLoadBeforeSave(),a.type=J,a.portal=N;const F=(0,O.m)(a,"portal-item",!0),G={layers:[t.write({},F)]};return yield Promise.all(F.resources.pendingOperations??[]),yield t._validateAgainstJSONSchema(G,F,s),t.url&&(a.url=t.url),a.title||(a.title=t.title),Z(a,s,z.newItem),yield N.signIn(),yield N.user?.addItem({item:a,folder:s?.folder,data:G}),yield(0,W.r)(t.resourceReferences,F),t.portalItem=a,(0,c.v)(F),F.portalItem=a,a})()}_save(n){var e=this;return(0,d.A)(function*(){const t={...X,...n};if(!e.portalItem)throw new y.A("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if((0,K.X)(e.portalItem),e.portalItem.type!==J)throw new y.A("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${J}"`);yield e._ensureLoadBeforeSave();const s=(0,O.m)(e.portalItem,"portal-item",!0),a={layers:[e.write({},s)]};return yield Promise.all(s.resources.pendingOperations??[]),yield e._validateAgainstJSONSchema(a,s,t),e.url&&(e.portalItem.url=e.url),e.portalItem.title||(e.portalItem.title=e.title),Z(e.portalItem,t,z.existingItem),yield(0,W.S)(e.portalItem,a,e.resourceReferences,s),(0,c.v)(s),e.portalItem})()}_validateAgainstJSONSchema(n,e,t){var s=this;return(0,d.A)(function*(){const a=t?.validationOptions;(0,L.c)(e,{errorName:"sceneservice:save"},{ignoreUnsupported:a?.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});const N=a?.enabled,F=null;if(N&&F){const G=(yield F()).validate(n,t.portalItemLayerType);if(!G.length)return;const Q=`Layer item did not validate:\n${G.join("\n")}`;if(S.A.getLogger(s).error(`_validateAgainstJSONSchema(): ${Q}`),"throw"===a.failPolicy){const Y=G.map(k=>new y.A("sceneservice:schema-validation",k));throw new y.A("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{validationErrors:Y})}}})()}};return(0,i._)([(0,p.MZ)(j.id)],h.prototype,"id",void 0),(0,i._)([(0,p.MZ)({type:m.A})],h.prototype,"spatialReference",void 0),(0,i._)([(0,g.w)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],h.prototype,"readSpatialReference",null),(0,i._)([(0,p.MZ)({type:f.A})],h.prototype,"fullExtent",void 0),(0,i._)([(0,g.w)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],h.prototype,"readFullExtent",null),(0,i._)([(0,p.MZ)({readOnly:!0,type:A.A})],h.prototype,"heightModelInfo",void 0),(0,i._)([(0,p.MZ)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],h.prototype,"minScale",void 0),(0,i._)([(0,p.MZ)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],h.prototype,"maxScale",void 0),(0,i._)([(0,p.MZ)({readOnly:!0})],h.prototype,"version",void 0),(0,i._)([(0,g.w)("version",["store.version"])],h.prototype,"readVersion",null),(0,i._)([(0,p.MZ)({type:String,json:{read:{source:"copyrightText"}}})],h.prototype,"copyright",void 0),(0,i._)([(0,p.MZ)({type:String,json:{read:!1}})],h.prototype,"sublayerTitleMode",void 0),(0,i._)([(0,p.MZ)({type:String})],h.prototype,"title",void 0),(0,i._)([(0,g.w)("portal-item","title")],h.prototype,"readTitlePortalItem",null),(0,i._)([(0,g.w)("service","title",["name"])],h.prototype,"readTitleService",null),(0,i._)([(0,p.MZ)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],h.prototype,"layerId",void 0),(0,i._)([(0,p.MZ)(j.OZ)],h.prototype,"url",null),(0,i._)([(0,b.K)("url")],h.prototype,"writeUrl",null),(0,i._)([(0,p.MZ)()],h.prototype,"parsedUrl",null),(0,i._)([(0,p.MZ)({readOnly:!0})],h.prototype,"store",void 0),(0,i._)([(0,p.MZ)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],h.prototype,"rootNode",void 0),h=(0,i._)([(0,T.$)("esri.layers.mixins.SceneService")],h),h},C=-1e38;function B(v){if(null!=v.spatialReference)return m.A.fromJSON(v.spatialReference);const h=v.store,n=h.indexCRS||h.geographicCRS,e=n&&parseInt(n.substring(n.lastIndexOf("/")+1,n.length),10);return null!=e?new m.A(e):null}function Z(v,h,n){v.typeKeywords||(v.typeKeywords=[]);const e=h.getTypeKeywords();for(const t of e)v.typeKeywords.push(t);v.typeKeywords&&(v.typeKeywords=v.typeKeywords.filter((t,s,a)=>a.indexOf(t)===s),n===z.newItem&&(v.typeKeywords=v.typeKeywords.filter(t=>"Hosted Service"!==t)))}var z,v;(v=z||(z={}))[v.existingItem=0]="existingItem",v[v.newItem=1]="newItem";const J="Scene Service",X={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var H;!function(v){v[v.SAVE=0]="SAVE",v[v.SAVE_AS=1]="SAVE_AS"}(H||(H={}))},27834:($,U,r)=>{r.d(U,{F:()=>y});var d=r(10467),i=r(89563),E=r(5922);function y(w,M,p,R,_,g,T){return S.apply(this,arguments)}function S(){return(S=(0,d.A)(function*(w,M,p,R,_,g,T){let b=null;if(null!=p){const m=`${w}/nodepages/`,P=m+Math.floor(p.rootIndex/p.nodesPerPage);try{return{type:"page",rootPage:(yield(0,i.A)(P,{query:{f:"json",...R,token:_},responseType:"json",signal:T})).data,rootIndex:p.rootIndex,pageSize:p.nodesPerPage,lodMetric:p.lodSelectionMetricType,urlPrefix:m}}catch(j){g?.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",P,j),b=j}}if(!M)return null;const c=M?.split("/").pop(),f=`${w}/nodes/`,A=f+c;try{return{type:"node",rootNode:(yield(0,i.A)(A,{query:{f:"json",...R,token:_},responseType:"json",signal:T})).data,urlPrefix:f}}catch(m){throw new E.A("sceneservice:root-node-missing","Root node missing.",{pageError:b,nodeError:m,url:A})}})).apply(this,arguments)}},57340:($,U,r)=>{r.r(U),r.d(U,{addOrUpdateResources:()=>M,contentToBlob:()=>A,fetchResources:()=>S,getSiblingOfSameType:()=>P,getSiblingOfSameTypeI:()=>j,removeAllResources:()=>g,removeResource:()=>R,splitPrefixFileNameAndExtension:()=>c});var d=r(10467),i=r(89563),E=r(5922),y=r(45272);function S(o){return w.apply(this,arguments)}function w(){return(w=(0,d.A)(function*(o,u={},x){yield o.load(x);const I=(0,y.fj)(o.itemUrl,"resources"),{start:D=1,num:l=10,sortOrder:O="asc",sortField:W="resource"}=u,K={query:{start:D,num:l,sortOrder:O,sortField:W,token:o.apiKey},signal:x?.signal},L=yield o.portal.request(I,K);return{total:L.total,nextStart:L.nextStart,resources:L.resources.map(({created:V,size:C,resource:B})=>({created:new Date(V),size:C,resource:o.resourceFromPath(B)}))}})).apply(this,arguments)}function M(o,u,x,I){return p.apply(this,arguments)}function p(){return(p=(0,d.A)(function*(o,u,x,I){const D=new Map;for(const{resource:O,content:W,compress:K,access:L}of u){if(!O.hasPath())throw new E.A(`portal-item-resource-${x}:invalid-path`,"Resource does not have a valid path");const[V,C]=b(O.path),B=`${V}/${K??""}/${L??""}`;D.has(B)||D.set(B,{prefix:V,compress:K,access:L,files:[]}),D.get(B).files.push({fileName:C,content:W})}yield o.load(I);const l=(0,y.fj)(o.userItemUrl,"add"===x?"addResources":"updateResources");for(const{prefix:O,compress:W,access:K,files:L}of D.values())for(let C=0;C<L.length;C+=25){const B=L.slice(C,C+25),Z=new FormData;O&&"."!==O&&Z.append("resourcesPrefix",O),W&&Z.append("compress","true"),K&&Z.append("access",K);let z=0;for(const{fileName:J,content:X}of B)Z.append("file"+ ++z,X,J);Z.append("f","json"),yield o.portal.request(l,{method:"post",body:Z,signal:I?.signal})}})).apply(this,arguments)}function R(o,u,x){return _.apply(this,arguments)}function _(){return(_=(0,d.A)(function*(o,u,x){if(!u.hasPath())throw new E.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield o.load(x);const I=(0,y.fj)(o.userItemUrl,"removeResources");yield o.portal.request(I,{method:"post",query:{resource:u.path},signal:x?.signal}),u.portalItem=null})).apply(this,arguments)}function g(o,u){return T.apply(this,arguments)}function T(){return(T=(0,d.A)(function*(o,u){yield o.load(u);const x=(0,y.fj)(o.userItemUrl,"removeResources");return o.portal.request(x,{method:"post",query:{deleteAll:!0},signal:u?.signal})})).apply(this,arguments)}function b(o){const u=o.lastIndexOf("/");return-1===u?[".",o]:[o.slice(0,u),o.slice(u+1)]}function c(o){const[u,x]=function f(o){const u=(0,y.Zo)(o);return null==u?[o,""]:[o.slice(0,o.length-u.length-1),`.${u}`]}(o),[I,D]=b(u);return[I,D,x]}function A(o){return m.apply(this,arguments)}function m(){return(m=(0,d.A)(function*(o){return"blob"===o.type?o.blob:"json"===o.type?new Blob([o.jsonString],{type:"application/json"}):(yield(0,i.A)(o.url,{responseType:"blob"})).data})).apply(this,arguments)}function P(o,u){if(!o.hasPath())return null;const[x,,I]=c(o.path);return o.portalItem.resourceFromPath((0,y.fj)(x,u+I))}function j(o,u){if(!o.hasPath())return null;const[x,,I]=c(o.path);return o.portalItem.resourceFromPath((0,y.fj)(x,u+I))}},3458:($,U,r)=>{r.d(U,{S:()=>p,r:()=>w});var d=r(10467),i=r(5922),E=r(56492),y=r(43085),S=r(57340);function w(c,f,A){return M.apply(this,arguments)}function M(){return(M=(0,d.A)(function*(c,f,A){const m=yield _(c,f,A);yield T(m,f,A)})).apply(this,arguments)}function p(c,f,A,m,P){return R.apply(this,arguments)}function R(){return(R=(0,d.A)(function*(c,f,A,m,P){const j=yield _(A,m,P);yield c.update({data:f}),yield T(j,m,P)})).apply(this,arguments)}function _(c,f,A){return g.apply(this,arguments)}function g(){return(g=(0,d.A)(function*(c,f,A){if(!f?.resources)return;const m=f.portalItem===c.portalItem?new Set(c.paths):new Set;c.paths.length=0,c.portalItem=f.portalItem;const P=new Set(f.resources.toKeep.map(l=>l.resource.path)),j=new Set,o=[];P.forEach(l=>{m.delete(l),c.paths.push(l)});const u=[],x=[],I=[];for(const l of f.resources.toUpdate)if(m.delete(l.resource.path),P.has(l.resource.path)||j.has(l.resource.path)){const{resource:O,content:W,finish:K}=l,L=(0,S.getSiblingOfSameTypeI)(O,(0,y.lk)());c.paths.push(L.path),u.push({resource:L,content:yield(0,S.contentToBlob)(W),compress:l.compress}),K&&I.push(()=>K(L))}else{c.paths.push(l.resource.path),x.push({resource:l.resource,content:yield(0,S.contentToBlob)(l.content),compress:l.compress});const O=l.finish;O&&I.push(()=>O(l.resource)),j.add(l.resource.path)}for(const l of f.resources.toAdd)if(c.paths.push(l.resource.path),m.has(l.resource.path))m.delete(l.resource.path);else{u.push({resource:l.resource,content:yield(0,S.contentToBlob)(l.content),compress:l.compress});const O=l.finish;O&&I.push(()=>O(l.resource))}if(u.length||x.length){const{addOrUpdateResources:l}=yield Promise.resolve().then(r.bind(r,57340));yield l(f.portalItem,u,"add",A),yield l(f.portalItem,x,"update",A)}if(I.forEach(l=>l()),0===o.length)return m;const D=yield(0,E.Ol)(o);if((0,E.Te)(A),D.length>0)throw new i.A("save:resources","Failed to save one or more resources",{errors:D});return m})).apply(this,arguments)}function T(c,f,A){return b.apply(this,arguments)}function b(){return(b=(0,d.A)(function*(c,f,A){if(!c||!f.portalItem)return;const m=[];for(const P of c){const j=f.portalItem.resourceFromPath(P);m.push(j.portalItem.removeResource(j,A))}yield(0,E.Lx)(m)})).apply(this,arguments)}},96904:($,U,r)=>{r.d(U,{X:()=>y});var d=r(23098),i=r(5922),E=r(2174);function y(S){if(d.A.apiKey&&(0,E.Q)(S.portal.url))throw new i.A("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${S.portal.url} when using an api key`)}},95945:($,U,r)=>{r.d(U,{c:()=>w,d:()=>E});var d=r(10467),i=r(5922);function E(M){return y.apply(this,arguments)}function y(){return(y=(0,d.A)(function*(M){const p=[];for(const R of M.allLayers)if("beforeSave"in R&&"function"==typeof R.beforeSave){const _=R.beforeSave();_&&p.push(_)}yield Promise.allSettled(p)})).apply(this,arguments)}const S=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function w(M,p,R){let _=(M.messages??[]).filter(({type:g})=>"error"===g).map(({name:g,message:T,details:b})=>new i.A(g,T,b));if(M.blockedRelativeUrls&&(_=_.concat(M.blockedRelativeUrls.map(g=>new i.A("url:unsupported",`Relative url '${g}' is not supported`)))),R){const{ignoreUnsupported:g,supplementalUnsupportedErrors:T=[],requiredPropertyChecksDisabled:b}=R;g&&(_=_.filter(({name:c})=>!(S.has(c)||T.includes(c)))),b&&(_=_.filter(c=>"web-document-write:property-required"!==c.name))}if(_.length>0)throw new i.A(p.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:_})}}}]);